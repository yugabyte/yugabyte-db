!!com.yugabyte.yw.common.audit.otel.OtelCollectorConfigFormat
exporters:
  datadog/metrics_00000000-0000-0000-0000-000000000000: !!com.yugabyte.yw.common.audit.otel.OtelCollectorConfigFormat$DataDogExporter
    api: {key: test, site: test}
    retry_on_failure: {enabled: true, initial_interval: 30s, max_elapsed_time: 60m,
      max_interval: 10m}
extensions:
  file_storage/queue: !!com.yugabyte.yw.common.audit.otel.OtelCollectorConfigFormat$StorageExtension
    compaction: {directory: /mnt/d0/otel-collector/queue, on_rebound: true, on_start: true,
      rebound_needed_threshold_mib: 100, rebound_trigger_threshold_mib: 10}
    directory: /mnt/d0/otel-collector/queue
processors:
  attributes/metrics_00000000-0000-0000-0000-000000000000: !!com.yugabyte.yw.common.audit.otel.OtelCollectorConfigFormat$AttributesProcessor
    actions:
    - {action: upsert, key: host, value: test-node}
    - {action: upsert, key: yugabyte.node_name, value: test-node}
    - {action: upsert, key: yugabyte.cloud, value: ''}
    - {action: upsert, key: yugabyte.universe_uuid, value: 00000000-0000-0000-0000-000000000000}
    - {action: upsert, key: yugabyte.node_type, value: PRIMARY}
    - {action: upsert, key: yugabyte.region, value: ''}
    - {action: upsert, key: yugabyte.zone, value: ''}
    - {action: upsert, key: yugabyte.purpose, value: DATA_DOG_METRICS_EXPORT}
    - {action: upsert, key: tag, value: value}
    - {action: upsert, key: test, value: specific_targets}
  batch/metrics_00000000-0000-0000-0000-000000000000: !!com.yugabyte.yw.common.audit.otel.OtelCollectorConfigFormat$BatchProcessor {
    send_batch_max_size: 1000, send_batch_size: 100, timeout: 10s}
  memory_limiter/metrics_00000000-0000-0000-0000-000000000000: !!com.yugabyte.yw.common.audit.otel.OtelCollectorConfigFormat$MemoryLimiterProcessor {
    check_interval: 10s, limit_mib: 2048}
receivers:
  prometheus/yugabyte: !!com.yugabyte.yw.common.audit.otel.OtelCollectorConfigFormat$PrometheusReceiver
    config:
      global: {scrape_interval: 45s, scrape_timeout: 25s}
      scrape_configs:
      - job_name: yugabyte
        metric_relabel_configs:
        - regex: (.*)
          replacement: $1
          source_labels: [__name__]
          target_label: saved_name
        - regex: handler_latency_(yb_[^_]*)_([^_]*)_([^_]*)(.*)
          replacement: $1
          source_labels: [__name__]
          target_label: server_type
        - regex: handler_latency_(yb_[^_]*)_([^_]*)_([^_]*)(.*)
          replacement: $2
          source_labels: [__name__]
          target_label: service_type
        - regex: handler_latency_(yb_[^_]*)_([^_]*)_([^_]*)(_sum|_count)?
          replacement: $3
          source_labels: [__name__]
          target_label: service_method
        - regex: handler_latency_(yb_[^_]*)_([^_]*)_([^_]*)(_sum|_count)?
          replacement: rpc_latency$4
          source_labels: [__name__]
          target_label: __name__
        metrics_path: /prometheus-metrics
        scheme: http
        static_configs:
        - labels: {export_type: master_export, __param_show_help: 'false', service: yb-master}
          targets: ['127.0.0.1:7000']
        - labels: {export_type: tserver_export, __param_show_help: 'false', service: yb-tserver}
          targets: ['127.0.0.1:9000']
        tls_config: {insecure_skip_verify: true}
      - job_name: otel-collector
        metrics_path: /metrics
        scheme: http
        static_configs:
        - labels: {export_type: otel_export, service: otel-collector}
          targets: ['127.0.0.1:8889']
        tls_config: {insecure_skip_verify: true}
service:
  extensions: [file_storage/queue]
  pipelines:
    metrics/metrics_00000000-0000-0000-0000-000000000000:
      exporters: [datadog/metrics_00000000-0000-0000-0000-000000000000]
      processors: [attributes/metrics_00000000-0000-0000-0000-000000000000, batch/metrics_00000000-0000-0000-0000-000000000000,
        memory_limiter/metrics_00000000-0000-0000-0000-000000000000]
      receivers: [prometheus/yugabyte]
  telemetry:
    logs:
      output_paths: [/home/yugabyte/otel-collector/logs/otel-collector.logs]
    metrics: {address: '0.0.0.0:8889'}

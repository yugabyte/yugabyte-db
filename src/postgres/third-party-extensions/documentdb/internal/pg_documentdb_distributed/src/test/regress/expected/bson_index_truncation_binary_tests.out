SET search_path TO documentdb_api_catalog, documentdb_core;
SET citus.next_shard_id TO 1150000;
SET documentdb.next_collection_id TO 11500;
SET documentdb.next_collection_index_id TO 11500;
-- Set configs to something reasonable for testing.
SET documentdb.indexTermLimitOverride to 20;
SELECT documentdb_api_internal.create_indexes_non_concurrently('db', '{ "createIndexes": "index_truncation_binary_tests", "indexes": [ { "key": { "ikey": 1 }, "name": "ikey_1", "enableLargeIndexKeys": true } ] }');
NOTICE:  creating collection
                                                                                                   create_indexes_non_concurrently                                                                                                   
---------------------------------------------------------------------
 { "raw" : { "defaultShard" : { "numIndexesBefore" : { "$numberInt" : "1" }, "numIndexesAfter" : { "$numberInt" : "2" }, "createdCollectionAutomatically" : true, "ok" : { "$numberInt" : "1" } } }, "ok" : { "$numberInt" : "1" } }
(1 row)

\d documentdb_data.documents_11500
                   Table "documentdb_data.documents_11500"
     Column      |           Type           | Collation | Nullable | Default 
---------------------------------------------------------------------
 shard_key_value | bigint                   |           | not null | 
 object_id       | bson                     |           | not null | 
 document        | bson                     |           | not null | 
 creation_time   | timestamp with time zone |           |          | 
Indexes:
    "collection_pk_11500" PRIMARY KEY, btree (shard_key_value, object_id)
    "documents_rum_index_11501" documentdb_rum (document bson_rum_single_path_ops (path=ikey, tl='20'))
Check constraints:
    "shard_key_value_check" CHECK (shard_key_value = '11500'::bigint)

-- Insert binary BSON data with all subtypes
SELECT documentdb_api.insert_one('db', 'index_truncation_binary_tests', '{ "_id": 1, "ikey": { "$binary" : { "base64": "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "00" } }, "item": "A" }');
                              insert_one                              
---------------------------------------------------------------------
 { "n" : { "$numberInt" : "1" }, "ok" : { "$numberDouble" : "1.0" } }
(1 row)

SELECT documentdb_api.insert_one('db', 'index_truncation_binary_tests', '{ "_id": 2, "ikey": { "$binary" : { "base64": "eyAiYSI6IDEsICJiIjogMyB9", "subType" : "01" } } }');
                              insert_one                              
---------------------------------------------------------------------
 { "n" : { "$numberInt" : "1" }, "ok" : { "$numberDouble" : "1.0" } }
(1 row)

SELECT documentdb_api.insert_one('db', 'index_truncation_binary_tests', '{ "_id": 3, "ikey": { "$binary" : { "base64": "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "04" } } }');
                              insert_one                              
---------------------------------------------------------------------
 { "n" : { "$numberInt" : "1" }, "ok" : { "$numberDouble" : "1.0" } }
(1 row)

SELECT documentdb_api.insert_one('db', 'index_truncation_binary_tests', '{ "_id": 4, "ikey": { "$binary" : { "base64": "YWJvYm9yYQ==", "subType" : "05" } } }');
                              insert_one                              
---------------------------------------------------------------------
 { "n" : { "$numberInt" : "1" }, "ok" : { "$numberDouble" : "1.0" } }
(1 row)

SELECT documentdb_api.insert_one('db', 'index_truncation_binary_tests', '{ "_id": 5, "ikey": { "$binary" : { "base64": "eyAiYSI6IDEsICJiIjogMyB9", "subType" : "06" } } }');
                              insert_one                              
---------------------------------------------------------------------
 { "n" : { "$numberInt" : "1" }, "ok" : { "$numberDouble" : "1.0" } }
(1 row)

SELECT documentdb_api.insert_one('db', 'index_truncation_binary_tests', '{ "_id": 6, "ikey": { "$binary" : { "base64": "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "07" } }, "item": "F", "customKey": 6 }');
                              insert_one                              
---------------------------------------------------------------------
 { "n" : { "$numberInt" : "1" }, "ok" : { "$numberDouble" : "1.0" } }
(1 row)

SELECT documentdb_api.insert_one('db', 'index_truncation_binary_tests', '{ "_id": 7, "ikey": { "$binary" : { "base64": "eyAiYSI6ICIxMjM0NSIsICJiIjogMTIzMTIzMTIzMjExMjMxIH0=", "subType" : "01" } }, "item": "G", "customKey": 6 }');
                              insert_one                              
---------------------------------------------------------------------
 { "n" : { "$numberInt" : "1" }, "ok" : { "$numberDouble" : "1.0" } }
(1 row)

SELECT documentdb_api.insert_one('db', 'index_truncation_binary_tests', '{ "_id": 8, "ikey": { "$binary" : { "base64": "dGhpcyBpcyBhIHRlc3Qgc3RyaW5n", "subType" : "00" } } }');
                              insert_one                              
---------------------------------------------------------------------
 { "n" : { "$numberInt" : "1" }, "ok" : { "$numberDouble" : "1.0" } }
(1 row)

SELECT documentdb_api.insert_one('db', 'index_truncation_binary_tests', '{ "_id": 9, "ikey": { "$binary" : { "base64": "eyAiYSI6ICIxMjM0NSIsICJiIjogMTIzMTIzMTIzMjExMjMxIH0=", "subType" : "04" } }, "item": "H", "customKey": 8 }');
                              insert_one                              
---------------------------------------------------------------------
 { "n" : { "$numberInt" : "1" }, "ok" : { "$numberDouble" : "1.0" } }
(1 row)

SELECT documentdb_api.insert_one('db', 'index_truncation_binary_tests', '{ "_id": 10, "ikey": { "$binary" : { "base64": "dGhpcyBpcyBhIHRlc3Qgc3RyaW5n", "subType" : "01" } }, "item": "H", "customKey": 9 }');
                              insert_one                              
---------------------------------------------------------------------
 { "n" : { "$numberInt" : "1" }, "ok" : { "$numberDouble" : "1.0" } }
(1 row)

/* All terms should be truncated */
SELECT did, length(bson_dollar_project(term, '{ "t": 0 }')::bytea), term FROM ( SELECT documentdb_distributed_test_helpers.gin_bson_get_single_path_generated_terms(document, 'ikey', false, true, true, 20) term, document-> '_id' as did from documentdb_data.documents_11500) docs;
               did                | length |                                          term                                          
---------------------------------------------------------------------
 { "" : { "$numberInt" : "1" } }  |     20 | { "$" : { "$binary" : { "base64" : "eyAiZXhhbQ==", "subType" : "00" } }, "t" : true }
 { "" : { "$numberInt" : "1" } }  |      8 | { "" : true, "t" : false }
 { "" : { "$numberInt" : "1" } }  |      7 | { "" : { "$maxKey" : 1 }, "t" : true }
 { "" : { "$numberInt" : "2" } }  |     20 | { "$" : { "$binary" : { "base64" : "eyAiYSI6IA==", "subType" : "01" } }, "t" : true }
 { "" : { "$numberInt" : "2" } }  |      8 | { "" : true, "t" : false }
 { "" : { "$numberInt" : "2" } }  |      7 | { "" : { "$maxKey" : 1 }, "t" : true }
 { "" : { "$numberInt" : "3" } }  |     20 | { "$" : { "$binary" : { "base64" : "eyAiZXhhbQ==", "subType" : "04" } }, "t" : true }
 { "" : { "$numberInt" : "3" } }  |      8 | { "" : true, "t" : false }
 { "" : { "$numberInt" : "3" } }  |      7 | { "" : { "$maxKey" : 1 }, "t" : true }
 { "" : { "$numberInt" : "4" } }  |     20 | { "$" : { "$binary" : { "base64" : "YWJvYm9yYQ==", "subType" : "05" } }, "t" : false }
 { "" : { "$numberInt" : "4" } }  |      8 | { "" : true, "t" : false }
 { "" : { "$numberInt" : "5" } }  |     20 | { "$" : { "$binary" : { "base64" : "eyAiYSI6IA==", "subType" : "06" } }, "t" : true }
 { "" : { "$numberInt" : "5" } }  |      8 | { "" : true, "t" : false }
 { "" : { "$numberInt" : "5" } }  |      7 | { "" : { "$maxKey" : 1 }, "t" : true }
 { "" : { "$numberInt" : "6" } }  |     20 | { "$" : { "$binary" : { "base64" : "eyAiZXhhbQ==", "subType" : "07" } }, "t" : true }
 { "" : { "$numberInt" : "6" } }  |      8 | { "" : true, "t" : false }
 { "" : { "$numberInt" : "6" } }  |      7 | { "" : { "$maxKey" : 1 }, "t" : true }
 { "" : { "$numberInt" : "7" } }  |     20 | { "$" : { "$binary" : { "base64" : "eyAiYSI6IA==", "subType" : "01" } }, "t" : true }
 { "" : { "$numberInt" : "7" } }  |      8 | { "" : true, "t" : false }
 { "" : { "$numberInt" : "7" } }  |      7 | { "" : { "$maxKey" : 1 }, "t" : true }
 { "" : { "$numberInt" : "8" } }  |     20 | { "$" : { "$binary" : { "base64" : "dGhpcyBpcw==", "subType" : "00" } }, "t" : true }
 { "" : { "$numberInt" : "8" } }  |      8 | { "" : true, "t" : false }
 { "" : { "$numberInt" : "8" } }  |      7 | { "" : { "$maxKey" : 1 }, "t" : true }
 { "" : { "$numberInt" : "9" } }  |     20 | { "$" : { "$binary" : { "base64" : "eyAiYSI6IA==", "subType" : "04" } }, "t" : true }
 { "" : { "$numberInt" : "9" } }  |      8 | { "" : true, "t" : false }
 { "" : { "$numberInt" : "9" } }  |      7 | { "" : { "$maxKey" : 1 }, "t" : true }
 { "" : { "$numberInt" : "10" } } |     20 | { "$" : { "$binary" : { "base64" : "dGhpcyBpcw==", "subType" : "01" } }, "t" : true }
 { "" : { "$numberInt" : "10" } } |      8 | { "" : true, "t" : false }
 { "" : { "$numberInt" : "10" } } |      7 | { "" : { "$maxKey" : 1 }, "t" : true }
(29 rows)

/* Only a subset of the terms should be truncated */
SELECT did, length(bson_dollar_project(term, '{ "t": 0 }')::bytea), term FROM ( SELECT documentdb_distributed_test_helpers.gin_bson_get_single_path_generated_terms(document, 'ikey', false, true, true, 40) term, document-> '_id' as did from documentdb_data.documents_11500) docs;
               did                | length |                                                     term                                                      
---------------------------------------------------------------------
 { "" : { "$numberInt" : "1" } }  |     40 | { "$" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjog", "subType" : "00" } }, "t" : true }
 { "" : { "$numberInt" : "1" } }  |      8 | { "" : true, "t" : false }
 { "" : { "$numberInt" : "1" } }  |      7 | { "" : { "$maxKey" : 1 }, "t" : true }
 { "" : { "$numberInt" : "2" } }  |     31 | { "$" : { "$binary" : { "base64" : "eyAiYSI6IDEsICJiIjogMyB9", "subType" : "01" } }, "t" : false }
 { "" : { "$numberInt" : "2" } }  |      8 | { "" : true, "t" : false }
 { "" : { "$numberInt" : "3" } }  |     40 | { "$" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjog", "subType" : "04" } }, "t" : true }
 { "" : { "$numberInt" : "3" } }  |      8 | { "" : true, "t" : false }
 { "" : { "$numberInt" : "3" } }  |      7 | { "" : { "$maxKey" : 1 }, "t" : true }
 { "" : { "$numberInt" : "4" } }  |     20 | { "$" : { "$binary" : { "base64" : "YWJvYm9yYQ==", "subType" : "05" } }, "t" : false }
 { "" : { "$numberInt" : "4" } }  |      8 | { "" : true, "t" : false }
 { "" : { "$numberInt" : "5" } }  |     31 | { "$" : { "$binary" : { "base64" : "eyAiYSI6IDEsICJiIjogMyB9", "subType" : "06" } }, "t" : false }
 { "" : { "$numberInt" : "5" } }  |      8 | { "" : true, "t" : false }
 { "" : { "$numberInt" : "6" } }  |     40 | { "$" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjog", "subType" : "07" } }, "t" : true }
 { "" : { "$numberInt" : "6" } }  |      8 | { "" : true, "t" : false }
 { "" : { "$numberInt" : "6" } }  |      7 | { "" : { "$maxKey" : 1 }, "t" : true }
 { "" : { "$numberInt" : "7" } }  |     40 | { "$" : { "$binary" : { "base64" : "eyAiYSI6ICIxMjM0NSIsICJiIjogMTIzMTIz", "subType" : "01" } }, "t" : true }
 { "" : { "$numberInt" : "7" } }  |      8 | { "" : true, "t" : false }
 { "" : { "$numberInt" : "7" } }  |      7 | { "" : { "$maxKey" : 1 }, "t" : true }
 { "" : { "$numberInt" : "8" } }  |     34 | { "$" : { "$binary" : { "base64" : "dGhpcyBpcyBhIHRlc3Qgc3RyaW5n", "subType" : "00" } }, "t" : false }
 { "" : { "$numberInt" : "8" } }  |      8 | { "" : true, "t" : false }
 { "" : { "$numberInt" : "9" } }  |     40 | { "$" : { "$binary" : { "base64" : "eyAiYSI6ICIxMjM0NSIsICJiIjogMTIzMTIz", "subType" : "04" } }, "t" : true }
 { "" : { "$numberInt" : "9" } }  |      8 | { "" : true, "t" : false }
 { "" : { "$numberInt" : "9" } }  |      7 | { "" : { "$maxKey" : 1 }, "t" : true }
 { "" : { "$numberInt" : "10" } } |     34 | { "$" : { "$binary" : { "base64" : "dGhpcyBpcyBhIHRlc3Qgc3RyaW5n", "subType" : "01" } }, "t" : false }
 { "" : { "$numberInt" : "10" } } |      8 | { "" : true, "t" : false }
(25 rows)

/* $eq (all terms truncated) */
SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$binary" : { "base64": "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "00" } } }';
                                                                              document                                                                              
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "1" }, "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "00" } }, "item" : "A" }
(1 row)

SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$binary" : { "base64": "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "04" } } }';
                                                                       document                                                                       
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "3" }, "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "04" } } }
(1 row)

SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$binary" : { "base64": "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "07" } } }';
                                                                                                 document                                                                                                 
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "6" }, "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "07" } }, "item" : "F", "customKey" : { "$numberInt" : "6" } }
(1 row)

SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$binary": { "base64": "eyAiYSI6IDEsICJiIjogMyB9", "subType" : "01" } } }';
                                                         document                                                         
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "2" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6IDEsICJiIjogMyB9", "subType" : "01" } } }
(1 row)

SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$binary": { "base64": "eyAiYSI6IDEsICJiIjogMyB9", "subType" : "06" } } }';
                                                         document                                                         
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "5" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6IDEsICJiIjogMyB9", "subType" : "06" } } }
(1 row)

SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$binary" : { "base64": "YWJvYm9yYQ==", "subType" : "05" } } }';
                                                   document                                                   
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "4" }, "ikey" : { "$binary" : { "base64" : "YWJvYm9yYQ==", "subType" : "05" } } }
(1 row)

EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$binary" : { "base64": "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "00" } } }';
                                                                                                                                                                          QUERY PLAN                                                                                                                                                                          
---------------------------------------------------------------------
 Custom Scan (Citus Adaptive)
   Output: remote_scan.document
   Task Count: 1
   Tasks Shown: All
   ->  Task
         Query: SELECT document FROM documentdb_data.documents_11500_1150003 collection WHERE ((document OPERATOR(documentdb_api_catalog.#=) '{ "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "00" } } }'::documentdb_core.bsonquery) AND (shard_key_value OPERATOR(pg_catalog.=) '11500'::bigint))
         Node: host=localhost port=58070 dbname=regression
         ->  Bitmap Heap Scan on documentdb_data.documents_11500_1150003 collection
               Output: document
               Recheck Cond: (collection.document OPERATOR(documentdb_api_catalog.@=) '{ "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "00" } } }'::documentdb_core.bson)
               ->  Bitmap Index Scan on ikey_1
                     Index Cond: (collection.document OPERATOR(documentdb_api_catalog.@=) '{ "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "00" } } }'::documentdb_core.bson)
(12 rows)

EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$binary" : { "base64": "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "04" } } }';
                                                                                                                                                                          QUERY PLAN                                                                                                                                                                          
---------------------------------------------------------------------
 Custom Scan (Citus Adaptive)
   Output: remote_scan.document
   Task Count: 1
   Tasks Shown: All
   ->  Task
         Query: SELECT document FROM documentdb_data.documents_11500_1150003 collection WHERE ((document OPERATOR(documentdb_api_catalog.#=) '{ "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "04" } } }'::documentdb_core.bsonquery) AND (shard_key_value OPERATOR(pg_catalog.=) '11500'::bigint))
         Node: host=localhost port=58070 dbname=regression
         ->  Bitmap Heap Scan on documentdb_data.documents_11500_1150003 collection
               Output: document
               Recheck Cond: (collection.document OPERATOR(documentdb_api_catalog.@=) '{ "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "04" } } }'::documentdb_core.bson)
               ->  Bitmap Index Scan on ikey_1
                     Index Cond: (collection.document OPERATOR(documentdb_api_catalog.@=) '{ "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "04" } } }'::documentdb_core.bson)
(12 rows)

EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$binary" : { "base64": "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "07" } } }';
                                                                                                                                                                          QUERY PLAN                                                                                                                                                                          
---------------------------------------------------------------------
 Custom Scan (Citus Adaptive)
   Output: remote_scan.document
   Task Count: 1
   Tasks Shown: All
   ->  Task
         Query: SELECT document FROM documentdb_data.documents_11500_1150003 collection WHERE ((document OPERATOR(documentdb_api_catalog.#=) '{ "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "07" } } }'::documentdb_core.bsonquery) AND (shard_key_value OPERATOR(pg_catalog.=) '11500'::bigint))
         Node: host=localhost port=58070 dbname=regression
         ->  Bitmap Heap Scan on documentdb_data.documents_11500_1150003 collection
               Output: document
               Recheck Cond: (collection.document OPERATOR(documentdb_api_catalog.@=) '{ "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "07" } } }'::documentdb_core.bson)
               ->  Bitmap Index Scan on ikey_1
                     Index Cond: (collection.document OPERATOR(documentdb_api_catalog.@=) '{ "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "07" } } }'::documentdb_core.bson)
(12 rows)

EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$binary": { "base64": "eyAiYSI6IDEsICJiIjogMyB9", "subType" : "01" } } }';
                                                                                                                                                            QUERY PLAN                                                                                                                                                            
---------------------------------------------------------------------
 Custom Scan (Citus Adaptive)
   Output: remote_scan.document
   Task Count: 1
   Tasks Shown: All
   ->  Task
         Query: SELECT document FROM documentdb_data.documents_11500_1150003 collection WHERE ((document OPERATOR(documentdb_api_catalog.#=) '{ "ikey" : { "$binary" : { "base64" : "eyAiYSI6IDEsICJiIjogMyB9", "subType" : "01" } } }'::documentdb_core.bsonquery) AND (shard_key_value OPERATOR(pg_catalog.=) '11500'::bigint))
         Node: host=localhost port=58070 dbname=regression
         ->  Bitmap Heap Scan on documentdb_data.documents_11500_1150003 collection
               Output: document
               Recheck Cond: (collection.document OPERATOR(documentdb_api_catalog.@=) '{ "ikey" : { "$binary" : { "base64" : "eyAiYSI6IDEsICJiIjogMyB9", "subType" : "01" } } }'::documentdb_core.bson)
               ->  Bitmap Index Scan on ikey_1
                     Index Cond: (collection.document OPERATOR(documentdb_api_catalog.@=) '{ "ikey" : { "$binary" : { "base64" : "eyAiYSI6IDEsICJiIjogMyB9", "subType" : "01" } } }'::documentdb_core.bson)
(12 rows)

EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$binary": { "base64": "eyAiYSI6IDEsICJiIjogMyB9", "subType" : "06" } } }';
                                                                                                                                                            QUERY PLAN                                                                                                                                                            
---------------------------------------------------------------------
 Custom Scan (Citus Adaptive)
   Output: remote_scan.document
   Task Count: 1
   Tasks Shown: All
   ->  Task
         Query: SELECT document FROM documentdb_data.documents_11500_1150003 collection WHERE ((document OPERATOR(documentdb_api_catalog.#=) '{ "ikey" : { "$binary" : { "base64" : "eyAiYSI6IDEsICJiIjogMyB9", "subType" : "06" } } }'::documentdb_core.bsonquery) AND (shard_key_value OPERATOR(pg_catalog.=) '11500'::bigint))
         Node: host=localhost port=58070 dbname=regression
         ->  Bitmap Heap Scan on documentdb_data.documents_11500_1150003 collection
               Output: document
               Recheck Cond: (collection.document OPERATOR(documentdb_api_catalog.@=) '{ "ikey" : { "$binary" : { "base64" : "eyAiYSI6IDEsICJiIjogMyB9", "subType" : "06" } } }'::documentdb_core.bson)
               ->  Bitmap Index Scan on ikey_1
                     Index Cond: (collection.document OPERATOR(documentdb_api_catalog.@=) '{ "ikey" : { "$binary" : { "base64" : "eyAiYSI6IDEsICJiIjogMyB9", "subType" : "06" } } }'::documentdb_core.bson)
(12 rows)

EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$binary" : { "base64": "YWJvYm9yYQ==", "subType" : "05" } } }';
                                                                                                                                                      QUERY PLAN                                                                                                                                                      
---------------------------------------------------------------------
 Custom Scan (Citus Adaptive)
   Output: remote_scan.document
   Task Count: 1
   Tasks Shown: All
   ->  Task
         Query: SELECT document FROM documentdb_data.documents_11500_1150003 collection WHERE ((document OPERATOR(documentdb_api_catalog.#=) '{ "ikey" : { "$binary" : { "base64" : "YWJvYm9yYQ==", "subType" : "05" } } }'::documentdb_core.bsonquery) AND (shard_key_value OPERATOR(pg_catalog.=) '11500'::bigint))
         Node: host=localhost port=58070 dbname=regression
         ->  Bitmap Heap Scan on documentdb_data.documents_11500_1150003 collection
               Output: document
               Recheck Cond: (collection.document OPERATOR(documentdb_api_catalog.@=) '{ "ikey" : { "$binary" : { "base64" : "YWJvYm9yYQ==", "subType" : "05" } } }'::documentdb_core.bson)
               ->  Bitmap Index Scan on ikey_1
                     Index Cond: (collection.document OPERATOR(documentdb_api_catalog.@=) '{ "ikey" : { "$binary" : { "base64" : "YWJvYm9yYQ==", "subType" : "05" } } }'::documentdb_core.bson)
(12 rows)

/* $gt/$gte (all terms truncated) */
SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$gt": { "$binary" : { "base64": "eyAiYSI6ICIxMjM0NSIsICJiIjogMTIzMTIzMTIzMjExMjMxIH0=", "subType" : "01" } } } }';
                                                                                                 document                                                                                                 
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "3" }, "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "04" } } }
 { "_id" : { "$numberInt" : "6" }, "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "07" } }, "item" : "F", "customKey" : { "$numberInt" : "6" } }
 { "_id" : { "$numberInt" : "9" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6ICIxMjM0NSIsICJiIjogMTIzMTIzMTIzMjExMjMxIH0=", "subType" : "04" } }, "item" : "H", "customKey" : { "$numberInt" : "8" } }
(3 rows)

SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$gte": { "$binary" : { "base64": "eyAiYSI6ICIxMjM0NSIsICJiIjogMTIzMTIzMTIzMjExMjMxIH0=", "subType" : "01" } } } }';
                                                                                                 document                                                                                                 
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "3" }, "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "04" } } }
 { "_id" : { "$numberInt" : "6" }, "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "07" } }, "item" : "F", "customKey" : { "$numberInt" : "6" } }
 { "_id" : { "$numberInt" : "7" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6ICIxMjM0NSIsICJiIjogMTIzMTIzMTIzMjExMjMxIH0=", "subType" : "01" } }, "item" : "G", "customKey" : { "$numberInt" : "6" } }
 { "_id" : { "$numberInt" : "9" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6ICIxMjM0NSIsICJiIjogMTIzMTIzMTIzMjExMjMxIH0=", "subType" : "04" } }, "item" : "H", "customKey" : { "$numberInt" : "8" } }
(4 rows)

SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$gt": { "$minKey" : 1 } } }';
                                                                                                 document                                                                                                 
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "1" }, "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "00" } }, "item" : "A" }
 { "_id" : { "$numberInt" : "2" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6IDEsICJiIjogMyB9", "subType" : "01" } } }
 { "_id" : { "$numberInt" : "3" }, "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "04" } } }
 { "_id" : { "$numberInt" : "4" }, "ikey" : { "$binary" : { "base64" : "YWJvYm9yYQ==", "subType" : "05" } } }
 { "_id" : { "$numberInt" : "5" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6IDEsICJiIjogMyB9", "subType" : "06" } } }
 { "_id" : { "$numberInt" : "6" }, "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "07" } }, "item" : "F", "customKey" : { "$numberInt" : "6" } }
 { "_id" : { "$numberInt" : "7" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6ICIxMjM0NSIsICJiIjogMTIzMTIzMTIzMjExMjMxIH0=", "subType" : "01" } }, "item" : "G", "customKey" : { "$numberInt" : "6" } }
 { "_id" : { "$numberInt" : "8" }, "ikey" : { "$binary" : { "base64" : "dGhpcyBpcyBhIHRlc3Qgc3RyaW5n", "subType" : "00" } } }
 { "_id" : { "$numberInt" : "9" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6ICIxMjM0NSIsICJiIjogMTIzMTIzMTIzMjExMjMxIH0=", "subType" : "04" } }, "item" : "H", "customKey" : { "$numberInt" : "8" } }
 { "_id" : { "$numberInt" : "10" }, "ikey" : { "$binary" : { "base64" : "dGhpcyBpcyBhIHRlc3Qgc3RyaW5n", "subType" : "01" } }, "item" : "H", "customKey" : { "$numberInt" : "9" } }
(10 rows)

SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$gt": { "$binary" : { "base64": "YWJvYm9yYQ==", "subType" : "05" } } } }';
                                                                                                 document                                                                                                 
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "5" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6IDEsICJiIjogMyB9", "subType" : "06" } } }
 { "_id" : { "$numberInt" : "6" }, "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "07" } }, "item" : "F", "customKey" : { "$numberInt" : "6" } }
(2 rows)

SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$gte": { "$binary" : { "base64": "YWJvYm9yYQ==", "subType" : "05" } } } }';
                                                                                                 document                                                                                                 
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "4" }, "ikey" : { "$binary" : { "base64" : "YWJvYm9yYQ==", "subType" : "05" } } }
 { "_id" : { "$numberInt" : "5" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6IDEsICJiIjogMyB9", "subType" : "06" } } }
 { "_id" : { "$numberInt" : "6" }, "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "07" } }, "item" : "F", "customKey" : { "$numberInt" : "6" } }
(3 rows)

EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$gt": { "$binary" : { "base64": "eyAiYSI6ICIxMjM0NSIsICJiIjogMTIzMTIzMTIzMjExMjMxIH0=", "subType" : "01" } } } }';
                                                                                                                                                                          QUERY PLAN                                                                                                                                                                          
---------------------------------------------------------------------
 Custom Scan (Citus Adaptive)
   Output: remote_scan.document
   Task Count: 1
   Tasks Shown: All
   ->  Task
         Query: SELECT document FROM documentdb_data.documents_11500_1150003 collection WHERE ((document OPERATOR(documentdb_api_catalog.#>) '{ "ikey" : { "$binary" : { "base64" : "eyAiYSI6ICIxMjM0NSIsICJiIjogMTIzMTIzMTIzMjExMjMxIH0=", "subType" : "01" } } }'::documentdb_core.bsonquery) AND (shard_key_value OPERATOR(pg_catalog.=) '11500'::bigint))
         Node: host=localhost port=58070 dbname=regression
         ->  Bitmap Heap Scan on documentdb_data.documents_11500_1150003 collection
               Output: document
               Recheck Cond: (collection.document OPERATOR(documentdb_api_catalog.@>) '{ "ikey" : { "$binary" : { "base64" : "eyAiYSI6ICIxMjM0NSIsICJiIjogMTIzMTIzMTIzMjExMjMxIH0=", "subType" : "01" } } }'::documentdb_core.bson)
               ->  Bitmap Index Scan on ikey_1
                     Index Cond: (collection.document OPERATOR(documentdb_api_catalog.@>) '{ "ikey" : { "$binary" : { "base64" : "eyAiYSI6ICIxMjM0NSIsICJiIjogMTIzMTIzMTIzMjExMjMxIH0=", "subType" : "01" } } }'::documentdb_core.bson)
(12 rows)

EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$gte": { "$binary" : { "base64": "eyAiYSI6ICIxMjM0NSIsICJiIjogMTIzMTIzMTIzMjExMjMxIH0=", "subType" : "00" } } } }';
                                                                                                                                                                          QUERY PLAN                                                                                                                                                                           
---------------------------------------------------------------------
 Custom Scan (Citus Adaptive)
   Output: remote_scan.document
   Task Count: 1
   Tasks Shown: All
   ->  Task
         Query: SELECT document FROM documentdb_data.documents_11500_1150003 collection WHERE ((document OPERATOR(documentdb_api_catalog.#>=) '{ "ikey" : { "$binary" : { "base64" : "eyAiYSI6ICIxMjM0NSIsICJiIjogMTIzMTIzMTIzMjExMjMxIH0=", "subType" : "00" } } }'::documentdb_core.bsonquery) AND (shard_key_value OPERATOR(pg_catalog.=) '11500'::bigint))
         Node: host=localhost port=58070 dbname=regression
         ->  Bitmap Heap Scan on documentdb_data.documents_11500_1150003 collection
               Output: document
               Recheck Cond: (collection.document OPERATOR(documentdb_api_catalog.@>=) '{ "ikey" : { "$binary" : { "base64" : "eyAiYSI6ICIxMjM0NSIsICJiIjogMTIzMTIzMTIzMjExMjMxIH0=", "subType" : "00" } } }'::documentdb_core.bson)
               ->  Bitmap Index Scan on ikey_1
                     Index Cond: (collection.document OPERATOR(documentdb_api_catalog.@>=) '{ "ikey" : { "$binary" : { "base64" : "eyAiYSI6ICIxMjM0NSIsICJiIjogMTIzMTIzMTIzMjExMjMxIH0=", "subType" : "00" } } }'::documentdb_core.bson)
(12 rows)

EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$gt": { "$minKey" : 1 } } }';
                                                                                                                               QUERY PLAN                                                                                                                               
---------------------------------------------------------------------
 Custom Scan (Citus Adaptive)
   Output: remote_scan.document
   Task Count: 1
   Tasks Shown: All
   ->  Task
         Query: SELECT document FROM documentdb_data.documents_11500_1150003 collection WHERE ((document OPERATOR(documentdb_api_catalog.#>) '{ "ikey" : { "$minKey" : 1 } }'::documentdb_core.bsonquery) AND (shard_key_value OPERATOR(pg_catalog.=) '11500'::bigint))
         Node: host=localhost port=58070 dbname=regression
         ->  Bitmap Heap Scan on documentdb_data.documents_11500_1150003 collection
               Output: document
               Recheck Cond: (collection.document OPERATOR(documentdb_api_catalog.@>) '{ "ikey" : { "$minKey" : 1 } }'::documentdb_core.bson)
               ->  Bitmap Index Scan on ikey_1
                     Index Cond: (collection.document OPERATOR(documentdb_api_catalog.@>) '{ "ikey" : { "$minKey" : 1 } }'::documentdb_core.bson)
(12 rows)

EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$gt": { "$binary" : { "base64": "YWJvYm9yYQ==", "subType" : "05" } } } }';
                                                                                                                                                      QUERY PLAN                                                                                                                                                      
---------------------------------------------------------------------
 Custom Scan (Citus Adaptive)
   Output: remote_scan.document
   Task Count: 1
   Tasks Shown: All
   ->  Task
         Query: SELECT document FROM documentdb_data.documents_11500_1150003 collection WHERE ((document OPERATOR(documentdb_api_catalog.#>) '{ "ikey" : { "$binary" : { "base64" : "YWJvYm9yYQ==", "subType" : "05" } } }'::documentdb_core.bsonquery) AND (shard_key_value OPERATOR(pg_catalog.=) '11500'::bigint))
         Node: host=localhost port=58070 dbname=regression
         ->  Bitmap Heap Scan on documentdb_data.documents_11500_1150003 collection
               Output: document
               Recheck Cond: (collection.document OPERATOR(documentdb_api_catalog.@>) '{ "ikey" : { "$binary" : { "base64" : "YWJvYm9yYQ==", "subType" : "05" } } }'::documentdb_core.bson)
               ->  Bitmap Index Scan on ikey_1
                     Index Cond: (collection.document OPERATOR(documentdb_api_catalog.@>) '{ "ikey" : { "$binary" : { "base64" : "YWJvYm9yYQ==", "subType" : "05" } } }'::documentdb_core.bson)
(12 rows)

EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$gte": { "$binary" : { "base64": "YWJvYm9yYQ==", "subType" : "05" } } } }';
                                                                                                                                                      QUERY PLAN                                                                                                                                                       
---------------------------------------------------------------------
 Custom Scan (Citus Adaptive)
   Output: remote_scan.document
   Task Count: 1
   Tasks Shown: All
   ->  Task
         Query: SELECT document FROM documentdb_data.documents_11500_1150003 collection WHERE ((document OPERATOR(documentdb_api_catalog.#>=) '{ "ikey" : { "$binary" : { "base64" : "YWJvYm9yYQ==", "subType" : "05" } } }'::documentdb_core.bsonquery) AND (shard_key_value OPERATOR(pg_catalog.=) '11500'::bigint))
         Node: host=localhost port=58070 dbname=regression
         ->  Bitmap Heap Scan on documentdb_data.documents_11500_1150003 collection
               Output: document
               Recheck Cond: (collection.document OPERATOR(documentdb_api_catalog.@>=) '{ "ikey" : { "$binary" : { "base64" : "YWJvYm9yYQ==", "subType" : "05" } } }'::documentdb_core.bson)
               ->  Bitmap Index Scan on ikey_1
                     Index Cond: (collection.document OPERATOR(documentdb_api_catalog.@>=) '{ "ikey" : { "$binary" : { "base64" : "YWJvYm9yYQ==", "subType" : "05" } } }'::documentdb_core.bson)
(12 rows)

/* $lt/$lte (all terms truncated) */
SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$lt": { "$binary" : { "base64": "eyAiYSI6ICIxMjM0NSIsICJiIjogMTIzMTIzMTIzMjExMjMxIH0=", "subType" : "01" } } } }';
                                                                                     document                                                                                      
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "1" }, "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "00" } }, "item" : "A" }
 { "_id" : { "$numberInt" : "2" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6IDEsICJiIjogMyB9", "subType" : "01" } } }
 { "_id" : { "$numberInt" : "8" }, "ikey" : { "$binary" : { "base64" : "dGhpcyBpcyBhIHRlc3Qgc3RyaW5n", "subType" : "00" } } }
 { "_id" : { "$numberInt" : "10" }, "ikey" : { "$binary" : { "base64" : "dGhpcyBpcyBhIHRlc3Qgc3RyaW5n", "subType" : "01" } }, "item" : "H", "customKey" : { "$numberInt" : "9" } }
(4 rows)

SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$lte": { "$binary" : { "base64": "eyAiYSI6ICIxMjM0NSIsICJiIjogMTIzMTIzMTIzMjExMjMxIH0=", "subType" : "01" } } } }';
                                                                                                 document                                                                                                 
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "1" }, "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "00" } }, "item" : "A" }
 { "_id" : { "$numberInt" : "2" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6IDEsICJiIjogMyB9", "subType" : "01" } } }
 { "_id" : { "$numberInt" : "7" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6ICIxMjM0NSIsICJiIjogMTIzMTIzMTIzMjExMjMxIH0=", "subType" : "01" } }, "item" : "G", "customKey" : { "$numberInt" : "6" } }
 { "_id" : { "$numberInt" : "8" }, "ikey" : { "$binary" : { "base64" : "dGhpcyBpcyBhIHRlc3Qgc3RyaW5n", "subType" : "00" } } }
 { "_id" : { "$numberInt" : "10" }, "ikey" : { "$binary" : { "base64" : "dGhpcyBpcyBhIHRlc3Qgc3RyaW5n", "subType" : "01" } }, "item" : "H", "customKey" : { "$numberInt" : "9" } }
(5 rows)

SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$lt": { "$maxKey" : 1 } } }';
                                                                                                 document                                                                                                 
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "1" }, "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "00" } }, "item" : "A" }
 { "_id" : { "$numberInt" : "2" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6IDEsICJiIjogMyB9", "subType" : "01" } } }
 { "_id" : { "$numberInt" : "3" }, "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "04" } } }
 { "_id" : { "$numberInt" : "4" }, "ikey" : { "$binary" : { "base64" : "YWJvYm9yYQ==", "subType" : "05" } } }
 { "_id" : { "$numberInt" : "5" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6IDEsICJiIjogMyB9", "subType" : "06" } } }
 { "_id" : { "$numberInt" : "6" }, "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "07" } }, "item" : "F", "customKey" : { "$numberInt" : "6" } }
 { "_id" : { "$numberInt" : "7" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6ICIxMjM0NSIsICJiIjogMTIzMTIzMTIzMjExMjMxIH0=", "subType" : "01" } }, "item" : "G", "customKey" : { "$numberInt" : "6" } }
 { "_id" : { "$numberInt" : "8" }, "ikey" : { "$binary" : { "base64" : "dGhpcyBpcyBhIHRlc3Qgc3RyaW5n", "subType" : "00" } } }
 { "_id" : { "$numberInt" : "9" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6ICIxMjM0NSIsICJiIjogMTIzMTIzMTIzMjExMjMxIH0=", "subType" : "04" } }, "item" : "H", "customKey" : { "$numberInt" : "8" } }
 { "_id" : { "$numberInt" : "10" }, "ikey" : { "$binary" : { "base64" : "dGhpcyBpcyBhIHRlc3Qgc3RyaW5n", "subType" : "01" } }, "item" : "H", "customKey" : { "$numberInt" : "9" } }
(10 rows)

SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$lt": { "$binary" : { "base64": "YWJvYm9yYQ==", "subType" : "05" } } } }';
                                                                                                 document                                                                                                 
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "1" }, "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "00" } }, "item" : "A" }
 { "_id" : { "$numberInt" : "2" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6IDEsICJiIjogMyB9", "subType" : "01" } } }
 { "_id" : { "$numberInt" : "3" }, "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "04" } } }
 { "_id" : { "$numberInt" : "7" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6ICIxMjM0NSIsICJiIjogMTIzMTIzMTIzMjExMjMxIH0=", "subType" : "01" } }, "item" : "G", "customKey" : { "$numberInt" : "6" } }
 { "_id" : { "$numberInt" : "8" }, "ikey" : { "$binary" : { "base64" : "dGhpcyBpcyBhIHRlc3Qgc3RyaW5n", "subType" : "00" } } }
 { "_id" : { "$numberInt" : "9" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6ICIxMjM0NSIsICJiIjogMTIzMTIzMTIzMjExMjMxIH0=", "subType" : "04" } }, "item" : "H", "customKey" : { "$numberInt" : "8" } }
 { "_id" : { "$numberInt" : "10" }, "ikey" : { "$binary" : { "base64" : "dGhpcyBpcyBhIHRlc3Qgc3RyaW5n", "subType" : "01" } }, "item" : "H", "customKey" : { "$numberInt" : "9" } }
(7 rows)

SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$lte": { "$binary" : { "base64": "YWJvYm9yYQ==", "subType" : "05" } } } }';
                                                                                                 document                                                                                                 
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "1" }, "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "00" } }, "item" : "A" }
 { "_id" : { "$numberInt" : "2" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6IDEsICJiIjogMyB9", "subType" : "01" } } }
 { "_id" : { "$numberInt" : "3" }, "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "04" } } }
 { "_id" : { "$numberInt" : "4" }, "ikey" : { "$binary" : { "base64" : "YWJvYm9yYQ==", "subType" : "05" } } }
 { "_id" : { "$numberInt" : "7" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6ICIxMjM0NSIsICJiIjogMTIzMTIzMTIzMjExMjMxIH0=", "subType" : "01" } }, "item" : "G", "customKey" : { "$numberInt" : "6" } }
 { "_id" : { "$numberInt" : "8" }, "ikey" : { "$binary" : { "base64" : "dGhpcyBpcyBhIHRlc3Qgc3RyaW5n", "subType" : "00" } } }
 { "_id" : { "$numberInt" : "9" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6ICIxMjM0NSIsICJiIjogMTIzMTIzMTIzMjExMjMxIH0=", "subType" : "04" } }, "item" : "H", "customKey" : { "$numberInt" : "8" } }
 { "_id" : { "$numberInt" : "10" }, "ikey" : { "$binary" : { "base64" : "dGhpcyBpcyBhIHRlc3Qgc3RyaW5n", "subType" : "01" } }, "item" : "H", "customKey" : { "$numberInt" : "9" } }
(8 rows)

EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$lt": { "$binary" : { "base64": "eyAiYSI6ICIxMjM0NSIsICJiIjogMTIzMTIzMTIzMjExMjMxIH0=", "subType" : "01" } } } }';
                                                                                                                                                                          QUERY PLAN                                                                                                                                                                          
---------------------------------------------------------------------
 Custom Scan (Citus Adaptive)
   Output: remote_scan.document
   Task Count: 1
   Tasks Shown: All
   ->  Task
         Query: SELECT document FROM documentdb_data.documents_11500_1150003 collection WHERE ((document OPERATOR(documentdb_api_catalog.#<) '{ "ikey" : { "$binary" : { "base64" : "eyAiYSI6ICIxMjM0NSIsICJiIjogMTIzMTIzMTIzMjExMjMxIH0=", "subType" : "01" } } }'::documentdb_core.bsonquery) AND (shard_key_value OPERATOR(pg_catalog.=) '11500'::bigint))
         Node: host=localhost port=58070 dbname=regression
         ->  Bitmap Heap Scan on documentdb_data.documents_11500_1150003 collection
               Output: document
               Recheck Cond: (collection.document OPERATOR(documentdb_api_catalog.@<) '{ "ikey" : { "$binary" : { "base64" : "eyAiYSI6ICIxMjM0NSIsICJiIjogMTIzMTIzMTIzMjExMjMxIH0=", "subType" : "01" } } }'::documentdb_core.bson)
               ->  Bitmap Index Scan on ikey_1
                     Index Cond: (collection.document OPERATOR(documentdb_api_catalog.@<) '{ "ikey" : { "$binary" : { "base64" : "eyAiYSI6ICIxMjM0NSIsICJiIjogMTIzMTIzMTIzMjExMjMxIH0=", "subType" : "01" } } }'::documentdb_core.bson)
(12 rows)

EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$lte": { "$binary" : { "base64": "eyAiYSI6ICIxMjM0NSIsICJiIjogMTIzMTIzMTIzMjExMjMxIH0=", "subType" : "01" } } } }';
                                                                                                                                                                          QUERY PLAN                                                                                                                                                                           
---------------------------------------------------------------------
 Custom Scan (Citus Adaptive)
   Output: remote_scan.document
   Task Count: 1
   Tasks Shown: All
   ->  Task
         Query: SELECT document FROM documentdb_data.documents_11500_1150003 collection WHERE ((document OPERATOR(documentdb_api_catalog.#<=) '{ "ikey" : { "$binary" : { "base64" : "eyAiYSI6ICIxMjM0NSIsICJiIjogMTIzMTIzMTIzMjExMjMxIH0=", "subType" : "01" } } }'::documentdb_core.bsonquery) AND (shard_key_value OPERATOR(pg_catalog.=) '11500'::bigint))
         Node: host=localhost port=58070 dbname=regression
         ->  Bitmap Heap Scan on documentdb_data.documents_11500_1150003 collection
               Output: document
               Recheck Cond: (collection.document OPERATOR(documentdb_api_catalog.@<=) '{ "ikey" : { "$binary" : { "base64" : "eyAiYSI6ICIxMjM0NSIsICJiIjogMTIzMTIzMTIzMjExMjMxIH0=", "subType" : "01" } } }'::documentdb_core.bson)
               ->  Bitmap Index Scan on ikey_1
                     Index Cond: (collection.document OPERATOR(documentdb_api_catalog.@<=) '{ "ikey" : { "$binary" : { "base64" : "eyAiYSI6ICIxMjM0NSIsICJiIjogMTIzMTIzMTIzMjExMjMxIH0=", "subType" : "01" } } }'::documentdb_core.bson)
(12 rows)

EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$lt": { "$maxKey" : 1 } } }';
                                                                                                                               QUERY PLAN                                                                                                                               
---------------------------------------------------------------------
 Custom Scan (Citus Adaptive)
   Output: remote_scan.document
   Task Count: 1
   Tasks Shown: All
   ->  Task
         Query: SELECT document FROM documentdb_data.documents_11500_1150003 collection WHERE ((document OPERATOR(documentdb_api_catalog.#<) '{ "ikey" : { "$maxKey" : 1 } }'::documentdb_core.bsonquery) AND (shard_key_value OPERATOR(pg_catalog.=) '11500'::bigint))
         Node: host=localhost port=58070 dbname=regression
         ->  Bitmap Heap Scan on documentdb_data.documents_11500_1150003 collection
               Output: document
               Recheck Cond: (collection.document OPERATOR(documentdb_api_catalog.@<) '{ "ikey" : { "$maxKey" : 1 } }'::documentdb_core.bson)
               ->  Bitmap Index Scan on ikey_1
                     Index Cond: (collection.document OPERATOR(documentdb_api_catalog.@<) '{ "ikey" : { "$maxKey" : 1 } }'::documentdb_core.bson)
(12 rows)

EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$lt": { "$binary" : { "base64": "YWJvYm9yYQ==", "subType" : "05" } } } }';
                                                                                                                                                      QUERY PLAN                                                                                                                                                      
---------------------------------------------------------------------
 Custom Scan (Citus Adaptive)
   Output: remote_scan.document
   Task Count: 1
   Tasks Shown: All
   ->  Task
         Query: SELECT document FROM documentdb_data.documents_11500_1150003 collection WHERE ((document OPERATOR(documentdb_api_catalog.#<) '{ "ikey" : { "$binary" : { "base64" : "YWJvYm9yYQ==", "subType" : "05" } } }'::documentdb_core.bsonquery) AND (shard_key_value OPERATOR(pg_catalog.=) '11500'::bigint))
         Node: host=localhost port=58070 dbname=regression
         ->  Bitmap Heap Scan on documentdb_data.documents_11500_1150003 collection
               Output: document
               Recheck Cond: (collection.document OPERATOR(documentdb_api_catalog.@<) '{ "ikey" : { "$binary" : { "base64" : "YWJvYm9yYQ==", "subType" : "05" } } }'::documentdb_core.bson)
               ->  Bitmap Index Scan on ikey_1
                     Index Cond: (collection.document OPERATOR(documentdb_api_catalog.@<) '{ "ikey" : { "$binary" : { "base64" : "YWJvYm9yYQ==", "subType" : "05" } } }'::documentdb_core.bson)
(12 rows)

EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$lte": { "$binary" : { "base64": "YWJvYm9yYQ==", "subType" : "05" } } } }';
                                                                                                                                                      QUERY PLAN                                                                                                                                                       
---------------------------------------------------------------------
 Custom Scan (Citus Adaptive)
   Output: remote_scan.document
   Task Count: 1
   Tasks Shown: All
   ->  Task
         Query: SELECT document FROM documentdb_data.documents_11500_1150003 collection WHERE ((document OPERATOR(documentdb_api_catalog.#<=) '{ "ikey" : { "$binary" : { "base64" : "YWJvYm9yYQ==", "subType" : "05" } } }'::documentdb_core.bsonquery) AND (shard_key_value OPERATOR(pg_catalog.=) '11500'::bigint))
         Node: host=localhost port=58070 dbname=regression
         ->  Bitmap Heap Scan on documentdb_data.documents_11500_1150003 collection
               Output: document
               Recheck Cond: (collection.document OPERATOR(documentdb_api_catalog.@<=) '{ "ikey" : { "$binary" : { "base64" : "YWJvYm9yYQ==", "subType" : "05" } } }'::documentdb_core.bson)
               ->  Bitmap Index Scan on ikey_1
                     Index Cond: (collection.document OPERATOR(documentdb_api_catalog.@<=) '{ "ikey" : { "$binary" : { "base64" : "YWJvYm9yYQ==", "subType" : "05" } } }'::documentdb_core.bson)
(12 rows)

/* $in/$nin/$ne/$all (all terms truncated) */
SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$in": [{ "$binary" : { "base64": "dGhpcyBpcyBhIHRlc3Qgc3RyaW5n", "subType" : "01" } }, { "$binary" : { "base64": "MTIzNDUxMjM0NQ==", "subType" : "07" } }] } }';
                                                                                     document                                                                                      
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "10" }, "ikey" : { "$binary" : { "base64" : "dGhpcyBpcyBhIHRlc3Qgc3RyaW5n", "subType" : "01" } }, "item" : "H", "customKey" : { "$numberInt" : "9" } }
(1 row)

SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$nin": [{ "$binary" : { "base64": "dGhpcyBpcyBhIHRlc3Qgc3RyaW5n", "subType" : "01" } }, { "$binary" : { "base64": "MTIzNDUxMjM0NQ==", "subType" : "07" } }] } }';
                                                                                                 document                                                                                                 
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "1" }, "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "00" } }, "item" : "A" }
 { "_id" : { "$numberInt" : "2" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6IDEsICJiIjogMyB9", "subType" : "01" } } }
 { "_id" : { "$numberInt" : "3" }, "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "04" } } }
 { "_id" : { "$numberInt" : "4" }, "ikey" : { "$binary" : { "base64" : "YWJvYm9yYQ==", "subType" : "05" } } }
 { "_id" : { "$numberInt" : "5" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6IDEsICJiIjogMyB9", "subType" : "06" } } }
 { "_id" : { "$numberInt" : "6" }, "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "07" } }, "item" : "F", "customKey" : { "$numberInt" : "6" } }
 { "_id" : { "$numberInt" : "7" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6ICIxMjM0NSIsICJiIjogMTIzMTIzMTIzMjExMjMxIH0=", "subType" : "01" } }, "item" : "G", "customKey" : { "$numberInt" : "6" } }
 { "_id" : { "$numberInt" : "8" }, "ikey" : { "$binary" : { "base64" : "dGhpcyBpcyBhIHRlc3Qgc3RyaW5n", "subType" : "00" } } }
 { "_id" : { "$numberInt" : "9" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6ICIxMjM0NSIsICJiIjogMTIzMTIzMTIzMjExMjMxIH0=", "subType" : "04" } }, "item" : "H", "customKey" : { "$numberInt" : "8" } }
(9 rows)

SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$in": [{ "$binary" : { "base64": "MTIzNDUxMjM0NQ==", "subType" : "07" } }] } }';
 document 
---------------------------------------------------------------------
(0 rows)

SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$nin": [{ "$binary" : { "base64": "MTIzNDUxMjM0NQ==", "subType" : "07" } }] } }';
                                                                                                 document                                                                                                 
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "1" }, "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "00" } }, "item" : "A" }
 { "_id" : { "$numberInt" : "2" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6IDEsICJiIjogMyB9", "subType" : "01" } } }
 { "_id" : { "$numberInt" : "3" }, "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "04" } } }
 { "_id" : { "$numberInt" : "4" }, "ikey" : { "$binary" : { "base64" : "YWJvYm9yYQ==", "subType" : "05" } } }
 { "_id" : { "$numberInt" : "5" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6IDEsICJiIjogMyB9", "subType" : "06" } } }
 { "_id" : { "$numberInt" : "6" }, "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "07" } }, "item" : "F", "customKey" : { "$numberInt" : "6" } }
 { "_id" : { "$numberInt" : "7" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6ICIxMjM0NSIsICJiIjogMTIzMTIzMTIzMjExMjMxIH0=", "subType" : "01" } }, "item" : "G", "customKey" : { "$numberInt" : "6" } }
 { "_id" : { "$numberInt" : "8" }, "ikey" : { "$binary" : { "base64" : "dGhpcyBpcyBhIHRlc3Qgc3RyaW5n", "subType" : "00" } } }
 { "_id" : { "$numberInt" : "9" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6ICIxMjM0NSIsICJiIjogMTIzMTIzMTIzMjExMjMxIH0=", "subType" : "04" } }, "item" : "H", "customKey" : { "$numberInt" : "8" } }
 { "_id" : { "$numberInt" : "10" }, "ikey" : { "$binary" : { "base64" : "dGhpcyBpcyBhIHRlc3Qgc3RyaW5n", "subType" : "01" } }, "item" : "H", "customKey" : { "$numberInt" : "9" } }
(10 rows)

SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$ne": { "$binary" : { "base64": "YWJvYm9yYQ==", "subType" : "05" } } } }';
                                                                                                 document                                                                                                 
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "1" }, "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "00" } }, "item" : "A" }
 { "_id" : { "$numberInt" : "2" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6IDEsICJiIjogMyB9", "subType" : "01" } } }
 { "_id" : { "$numberInt" : "3" }, "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "04" } } }
 { "_id" : { "$numberInt" : "5" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6IDEsICJiIjogMyB9", "subType" : "06" } } }
 { "_id" : { "$numberInt" : "6" }, "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "07" } }, "item" : "F", "customKey" : { "$numberInt" : "6" } }
 { "_id" : { "$numberInt" : "7" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6ICIxMjM0NSIsICJiIjogMTIzMTIzMTIzMjExMjMxIH0=", "subType" : "01" } }, "item" : "G", "customKey" : { "$numberInt" : "6" } }
 { "_id" : { "$numberInt" : "8" }, "ikey" : { "$binary" : { "base64" : "dGhpcyBpcyBhIHRlc3Qgc3RyaW5n", "subType" : "00" } } }
 { "_id" : { "$numberInt" : "9" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6ICIxMjM0NSIsICJiIjogMTIzMTIzMTIzMjExMjMxIH0=", "subType" : "04" } }, "item" : "H", "customKey" : { "$numberInt" : "8" } }
 { "_id" : { "$numberInt" : "10" }, "ikey" : { "$binary" : { "base64" : "dGhpcyBpcyBhIHRlc3Qgc3RyaW5n", "subType" : "01" } }, "item" : "H", "customKey" : { "$numberInt" : "9" } }
(9 rows)

SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$ne": { "$binary" : { "base64": "eyAiYSI6ICIxMjM0NSIsICJiIjogMTIzMTIzMTIzMjExMjMxIH0=", "subType" : "01" } } } }';
                                                                                                 document                                                                                                 
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "1" }, "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "00" } }, "item" : "A" }
 { "_id" : { "$numberInt" : "2" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6IDEsICJiIjogMyB9", "subType" : "01" } } }
 { "_id" : { "$numberInt" : "3" }, "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "04" } } }
 { "_id" : { "$numberInt" : "4" }, "ikey" : { "$binary" : { "base64" : "YWJvYm9yYQ==", "subType" : "05" } } }
 { "_id" : { "$numberInt" : "5" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6IDEsICJiIjogMyB9", "subType" : "06" } } }
 { "_id" : { "$numberInt" : "6" }, "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "07" } }, "item" : "F", "customKey" : { "$numberInt" : "6" } }
 { "_id" : { "$numberInt" : "8" }, "ikey" : { "$binary" : { "base64" : "dGhpcyBpcyBhIHRlc3Qgc3RyaW5n", "subType" : "00" } } }
 { "_id" : { "$numberInt" : "9" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6ICIxMjM0NSIsICJiIjogMTIzMTIzMTIzMjExMjMxIH0=", "subType" : "04" } }, "item" : "H", "customKey" : { "$numberInt" : "8" } }
 { "_id" : { "$numberInt" : "10" }, "ikey" : { "$binary" : { "base64" : "dGhpcyBpcyBhIHRlc3Qgc3RyaW5n", "subType" : "01" } }, "item" : "H", "customKey" : { "$numberInt" : "9" } }
(9 rows)

SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$all": [{ "$binary" : { "base64": "dGhpcyBpcyBhIHRlc3Qgc3RyaW5n", "subType" : "01" } }, { "$binary" : { "base64": "MTIzNDUxMjM0NQ==", "subType" : "07" } }] } }';
 document 
---------------------------------------------------------------------
(0 rows)

EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$in": [{ "$binary" : { "base64": "dGhpcyBpcyBhIHRlc3Qgc3RyaW5n", "subType" : "01" } }, { "$binary" : { "base64": "MTIzNDUxMjM0NQ==", "subType" : "07" } }] } }';
                                                                                                                                                                                                                                                                                                                                                                    QUERY PLAN                                                                                                                                                                                                                                                                                                                                                                     
---------------------------------------------------------------------
 Custom Scan (Citus Adaptive)
   Output: remote_scan.document
   Task Count: 1
   Tasks Shown: All
   ->  Task
         Query: SELECT document FROM documentdb_data.documents_11500_1150003 collection WHERE (documentdb_api_catalog.bson_dollar_in(document, '{ "ikey" : [ { "$binary" : { "base64" : "dGhpcyBpcyBhIHRlc3Qgc3RyaW5n", "subType" : "01" } }, { "$binary" : { "base64" : "MTIzNDUxMjM0NQ==", "subType" : "07" } } ] }'::documentdb_core.bson) AND (document OPERATOR(documentdb_api_internal.##=) ANY (ARRAY['{ "ikey" : { "$binary" : { "base64" : "dGhpcyBpcyBhIHRlc3Qgc3RyaW5n", "subType" : "01" } } }'::documentdb_api_internal.bsonindexbounds, '{ "ikey" : { "$binary" : { "base64" : "MTIzNDUxMjM0NQ==", "subType" : "07" } } }'::documentdb_api_internal.bsonindexbounds])) AND (shard_key_value OPERATOR(pg_catalog.=) '11500'::bigint))
         Node: host=localhost port=58070 dbname=regression
         ->  Bitmap Heap Scan on documentdb_data.documents_11500_1150003 collection
               Output: document
               Recheck Cond: (collection.document OPERATOR(documentdb_api_catalog.@*=) '{ "ikey" : [ { "$binary" : { "base64" : "dGhpcyBpcyBhIHRlc3Qgc3RyaW5n", "subType" : "01" } }, { "$binary" : { "base64" : "MTIzNDUxMjM0NQ==", "subType" : "07" } } ] }'::documentdb_core.bson)
               ->  Bitmap Index Scan on ikey_1
                     Index Cond: (collection.document OPERATOR(documentdb_api_catalog.@*=) '{ "ikey" : [ { "$binary" : { "base64" : "dGhpcyBpcyBhIHRlc3Qgc3RyaW5n", "subType" : "01" } }, { "$binary" : { "base64" : "MTIzNDUxMjM0NQ==", "subType" : "07" } } ] }'::documentdb_core.bson)
(12 rows)

EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$nin": [{ "$binary" : { "base64": "dGhpcyBpcyBhIHRlc3Qgc3RyaW5n", "subType" : "01" } }, { "$binary" : { "base64": "MTIzNDUxMjM0NQ==", "subType" : "07" } }] } }';
                                                                                                                                                                                                 QUERY PLAN                                                                                                                                                                                                  
---------------------------------------------------------------------
 Custom Scan (Citus Adaptive)
   Output: remote_scan.document
   Task Count: 1
   Tasks Shown: All
   ->  Task
         Query: SELECT document FROM documentdb_data.documents_11500_1150003 collection WHERE (documentdb_api_catalog.bson_dollar_nin(document, '{ "ikey" : [ { "$binary" : { "base64" : "dGhpcyBpcyBhIHRlc3Qgc3RyaW5n", "subType" : "01" } }, { "$binary" : { "base64" : "MTIzNDUxMjM0NQ==", "subType" : "07" } } ] }'::documentdb_core.bson) AND (shard_key_value OPERATOR(pg_catalog.=) '11500'::bigint))
         Node: host=localhost port=58070 dbname=regression
         ->  Bitmap Heap Scan on documentdb_data.documents_11500_1150003 collection
               Output: document
               Recheck Cond: (collection.document OPERATOR(documentdb_api_catalog.@!*=) '{ "ikey" : [ { "$binary" : { "base64" : "dGhpcyBpcyBhIHRlc3Qgc3RyaW5n", "subType" : "01" } }, { "$binary" : { "base64" : "MTIzNDUxMjM0NQ==", "subType" : "07" } } ] }'::documentdb_core.bson)
               ->  Bitmap Index Scan on ikey_1
                     Index Cond: (collection.document OPERATOR(documentdb_api_catalog.@!*=) '{ "ikey" : [ { "$binary" : { "base64" : "dGhpcyBpcyBhIHRlc3Qgc3RyaW5n", "subType" : "01" } }, { "$binary" : { "base64" : "MTIzNDUxMjM0NQ==", "subType" : "07" } } ] }'::documentdb_core.bson)
(12 rows)

EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$in": [{ "$binary" : { "base64": "MTIzNDUxMjM0NQ==", "subType" : "07" } }] } }';
                                                                                                                                                        QUERY PLAN                                                                                                                                                        
---------------------------------------------------------------------
 Custom Scan (Citus Adaptive)
   Output: remote_scan.document
   Task Count: 1
   Tasks Shown: All
   ->  Task
         Query: SELECT document FROM documentdb_data.documents_11500_1150003 collection WHERE ((document OPERATOR(documentdb_api_catalog.#=) '{ "ikey" : { "$binary" : { "base64" : "MTIzNDUxMjM0NQ==", "subType" : "07" } } }'::documentdb_core.bsonquery) AND (shard_key_value OPERATOR(pg_catalog.=) '11500'::bigint))
         Node: host=localhost port=58070 dbname=regression
         ->  Bitmap Heap Scan on documentdb_data.documents_11500_1150003 collection
               Output: document
               Recheck Cond: (collection.document OPERATOR(documentdb_api_catalog.@=) '{ "ikey" : { "$binary" : { "base64" : "MTIzNDUxMjM0NQ==", "subType" : "07" } } }'::documentdb_core.bson)
               ->  Bitmap Index Scan on ikey_1
                     Index Cond: (collection.document OPERATOR(documentdb_api_catalog.@=) '{ "ikey" : { "$binary" : { "base64" : "MTIzNDUxMjM0NQ==", "subType" : "07" } } }'::documentdb_core.bson)
(12 rows)

EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$nin": [{ "$binary" : { "base64": "MTIzNDUxMjM0NQ==", "subType" : "07" } }] } }';
                                                                                                                                                      QUERY PLAN                                                                                                                                                       
---------------------------------------------------------------------
 Custom Scan (Citus Adaptive)
   Output: remote_scan.document
   Task Count: 1
   Tasks Shown: All
   ->  Task
         Query: SELECT document FROM documentdb_data.documents_11500_1150003 collection WHERE (documentdb_api_catalog.bson_dollar_ne(document, '{ "ikey" : { "$binary" : { "base64" : "MTIzNDUxMjM0NQ==", "subType" : "07" } } }'::documentdb_core.bson) AND (shard_key_value OPERATOR(pg_catalog.=) '11500'::bigint))
         Node: host=localhost port=58070 dbname=regression
         ->  Bitmap Heap Scan on documentdb_data.documents_11500_1150003 collection
               Output: document
               Recheck Cond: (collection.document OPERATOR(documentdb_api_catalog.@!=) '{ "ikey" : { "$binary" : { "base64" : "MTIzNDUxMjM0NQ==", "subType" : "07" } } }'::documentdb_core.bson)
               ->  Bitmap Index Scan on ikey_1
                     Index Cond: (collection.document OPERATOR(documentdb_api_catalog.@!=) '{ "ikey" : { "$binary" : { "base64" : "MTIzNDUxMjM0NQ==", "subType" : "07" } } }'::documentdb_core.bson)
(12 rows)

EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$ne": { "$binary" : { "base64": "YWJvYm9yYQ==", "subType" : "05" } } } }';
                                                                                                                                                    QUERY PLAN                                                                                                                                                     
---------------------------------------------------------------------
 Custom Scan (Citus Adaptive)
   Output: remote_scan.document
   Task Count: 1
   Tasks Shown: All
   ->  Task
         Query: SELECT document FROM documentdb_data.documents_11500_1150003 collection WHERE (documentdb_api_catalog.bson_dollar_ne(document, '{ "ikey" : { "$binary" : { "base64" : "YWJvYm9yYQ==", "subType" : "05" } } }'::documentdb_core.bson) AND (shard_key_value OPERATOR(pg_catalog.=) '11500'::bigint))
         Node: host=localhost port=58070 dbname=regression
         ->  Bitmap Heap Scan on documentdb_data.documents_11500_1150003 collection
               Output: document
               Recheck Cond: (collection.document OPERATOR(documentdb_api_catalog.@!=) '{ "ikey" : { "$binary" : { "base64" : "YWJvYm9yYQ==", "subType" : "05" } } }'::documentdb_core.bson)
               ->  Bitmap Index Scan on ikey_1
                     Index Cond: (collection.document OPERATOR(documentdb_api_catalog.@!=) '{ "ikey" : { "$binary" : { "base64" : "YWJvYm9yYQ==", "subType" : "05" } } }'::documentdb_core.bson)
(12 rows)

EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$ne": { "$binary" : { "base64": "eyAiYSI6ICIxMjM0NSIsICJiIjogMTIzMTIzMTIzMjExMjMxIH0=", "subType" : "01" } } } }';
                                                                                                                                                                        QUERY PLAN                                                                                                                                                                         
---------------------------------------------------------------------
 Custom Scan (Citus Adaptive)
   Output: remote_scan.document
   Task Count: 1
   Tasks Shown: All
   ->  Task
         Query: SELECT document FROM documentdb_data.documents_11500_1150003 collection WHERE (documentdb_api_catalog.bson_dollar_ne(document, '{ "ikey" : { "$binary" : { "base64" : "eyAiYSI6ICIxMjM0NSIsICJiIjogMTIzMTIzMTIzMjExMjMxIH0=", "subType" : "01" } } }'::documentdb_core.bson) AND (shard_key_value OPERATOR(pg_catalog.=) '11500'::bigint))
         Node: host=localhost port=58070 dbname=regression
         ->  Bitmap Heap Scan on documentdb_data.documents_11500_1150003 collection
               Output: document
               Recheck Cond: (collection.document OPERATOR(documentdb_api_catalog.@!=) '{ "ikey" : { "$binary" : { "base64" : "eyAiYSI6ICIxMjM0NSIsICJiIjogMTIzMTIzMTIzMjExMjMxIH0=", "subType" : "01" } } }'::documentdb_core.bson)
               ->  Bitmap Index Scan on ikey_1
                     Index Cond: (collection.document OPERATOR(documentdb_api_catalog.@!=) '{ "ikey" : { "$binary" : { "base64" : "eyAiYSI6ICIxMjM0NSIsICJiIjogMTIzMTIzMTIzMjExMjMxIH0=", "subType" : "01" } } }'::documentdb_core.bson)
(12 rows)

EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$all": [{ "$binary" : { "base64": "dGhpcyBpcyBhIHRlc3Qgc3RyaW5n", "subType" : "01" } }, { "$binary" : { "base64": "MTIzNDUxMjM0NQ==", "subType" : "07" } }] } }';
                                                                                                                                                                                                 QUERY PLAN                                                                                                                                                                                                  
---------------------------------------------------------------------
 Custom Scan (Citus Adaptive)
   Output: remote_scan.document
   Task Count: 1
   Tasks Shown: All
   ->  Task
         Query: SELECT document FROM documentdb_data.documents_11500_1150003 collection WHERE (documentdb_api_catalog.bson_dollar_all(document, '{ "ikey" : [ { "$binary" : { "base64" : "dGhpcyBpcyBhIHRlc3Qgc3RyaW5n", "subType" : "01" } }, { "$binary" : { "base64" : "MTIzNDUxMjM0NQ==", "subType" : "07" } } ] }'::documentdb_core.bson) AND (shard_key_value OPERATOR(pg_catalog.=) '11500'::bigint))
         Node: host=localhost port=58070 dbname=regression
         ->  Bitmap Heap Scan on documentdb_data.documents_11500_1150003 collection
               Output: document
               Recheck Cond: (collection.document OPERATOR(documentdb_api_catalog.@&=) '{ "ikey" : [ { "$binary" : { "base64" : "dGhpcyBpcyBhIHRlc3Qgc3RyaW5n", "subType" : "01" } }, { "$binary" : { "base64" : "MTIzNDUxMjM0NQ==", "subType" : "07" } } ] }'::documentdb_core.bson)
               ->  Bitmap Index Scan on ikey_1
                     Index Cond: (collection.document OPERATOR(documentdb_api_catalog.@&=) '{ "ikey" : [ { "$binary" : { "base64" : "dGhpcyBpcyBhIHRlc3Qgc3RyaW5n", "subType" : "01" } }, { "$binary" : { "base64" : "MTIzNDUxMjM0NQ==", "subType" : "07" } } ] }'::documentdb_core.bson)
(12 rows)

/* $bitsAllClear (all terms truncated) */
SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$bitsAllClear": { "$binary" : { "base64": "dGhpcyBpcyBhIHRlc3Qgc3RyaW5n", "subType" : "01" } } } }';
 document 
---------------------------------------------------------------------
(0 rows)

SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$bitsAllClear": 0 } }';
                                                                                                 document                                                                                                 
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "1" }, "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "00" } }, "item" : "A" }
 { "_id" : { "$numberInt" : "2" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6IDEsICJiIjogMyB9", "subType" : "01" } } }
 { "_id" : { "$numberInt" : "3" }, "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "04" } } }
 { "_id" : { "$numberInt" : "4" }, "ikey" : { "$binary" : { "base64" : "YWJvYm9yYQ==", "subType" : "05" } } }
 { "_id" : { "$numberInt" : "5" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6IDEsICJiIjogMyB9", "subType" : "06" } } }
 { "_id" : { "$numberInt" : "6" }, "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "07" } }, "item" : "F", "customKey" : { "$numberInt" : "6" } }
 { "_id" : { "$numberInt" : "7" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6ICIxMjM0NSIsICJiIjogMTIzMTIzMTIzMjExMjMxIH0=", "subType" : "01" } }, "item" : "G", "customKey" : { "$numberInt" : "6" } }
 { "_id" : { "$numberInt" : "8" }, "ikey" : { "$binary" : { "base64" : "dGhpcyBpcyBhIHRlc3Qgc3RyaW5n", "subType" : "00" } } }
 { "_id" : { "$numberInt" : "9" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6ICIxMjM0NSIsICJiIjogMTIzMTIzMTIzMjExMjMxIH0=", "subType" : "04" } }, "item" : "H", "customKey" : { "$numberInt" : "8" } }
 { "_id" : { "$numberInt" : "10" }, "ikey" : { "$binary" : { "base64" : "dGhpcyBpcyBhIHRlc3Qgc3RyaW5n", "subType" : "01" } }, "item" : "H", "customKey" : { "$numberInt" : "9" } }
(10 rows)

SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$bitsAllClear": 1 } }';
                                                                                     document                                                                                      
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "8" }, "ikey" : { "$binary" : { "base64" : "dGhpcyBpcyBhIHRlc3Qgc3RyaW5n", "subType" : "00" } } }
 { "_id" : { "$numberInt" : "10" }, "ikey" : { "$binary" : { "base64" : "dGhpcyBpcyBhIHRlc3Qgc3RyaW5n", "subType" : "01" } }, "item" : "H", "customKey" : { "$numberInt" : "9" } }
(2 rows)

SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$bitsAllClear": 32 } }';
 document 
---------------------------------------------------------------------
(0 rows)

SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$bitsAllClear": 54 } }';
 document 
---------------------------------------------------------------------
(0 rows)

SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$bitsAllClear": { "$binary": { "base64": "////////////////////////////", "subType": "02"} } } }';
 document 
---------------------------------------------------------------------
(0 rows)

EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$bitsAllClear": { "$binary" : { "base64": "dGhpcyBpcyBhIHRlc3Qgc3RyaW5n", "subType" : "01" } } } }';
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 QUERY PLAN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
---------------------------------------------------------------------
 Custom Scan (Citus Adaptive)
   Output: remote_scan.document
   Task Count: 1
   Tasks Shown: All
   ->  Task
         Query: SELECT document FROM documentdb_data.documents_11500_1150003 collection WHERE (documentdb_api_catalog.bson_dollar_bits_all_clear(document, '{ "ikey" : [ { "$numberInt" : "2" }, { "$numberInt" : "4" }, { "$numberInt" : "5" }, { "$numberInt" : "6" }, { "$numberInt" : "11" }, { "$numberInt" : "13" }, { "$numberInt" : "14" }, { "$numberInt" : "16" }, { "$numberInt" : "19" }, { "$numberInt" : "21" }, { "$numberInt" : "22" }, { "$numberInt" : "24" }, { "$numberInt" : "25" }, { "$numberInt" : "28" }, { "$numberInt" : "29" }, { "$numberInt" : "30" }, { "$numberInt" : "37" }, { "$numberInt" : "40" }, { "$numberInt" : "43" }, { "$numberInt" : "45" }, { "$numberInt" : "46" }, { "$numberInt" : "48" }, { "$numberInt" : "49" }, { "$numberInt" : "52" }, { "$numberInt" : "53" }, { "$numberInt" : "54" }, { "$numberInt" : "61" }, { "$numberInt" : "64" }, { "$numberInt" : "69" }, { "$numberInt" : "70" }, { "$numberInt" : "77" }, { "$numberInt" : "82" }, { "$numberInt" : "84" }, { "$numberInt" : "85" }, { "$numberInt" : "86" }, { "$numberInt" : "88" }, { "$numberInt" : "90" }, { "$numberInt" : "93" }, { "$numberInt" : "94" }, { "$numberInt" : "96" }, { "$numberInt" : "97" }, { "$numberInt" : "100" }, { "$numberInt" : "101" }, { "$numberInt" : "102" }, { "$numberInt" : "106" }, { "$numberInt" : "108" }, { "$numberInt" : "109" }, { "$numberInt" : "110" }, { "$numberInt" : "117" }, { "$numberInt" : "120" }, { "$numberInt" : "121" }, { "$numberInt" : "124" }, { "$numberInt" : "125" }, { "$numberInt" : "126" }, { "$numberInt" : "130" }, { "$numberInt" : "132" }, { "$numberInt" : "133" }, { "$numberInt" : "134" }, { "$numberInt" : "137" }, { "$numberInt" : "140" }, { "$numberInt" : "141" }, { "$numberInt" : "142" }, { "$numberInt" : "144" }, { "$numberInt" : "147" }, { "$numberInt" : "149" }, { "$numberInt" : "150" }, { "$numberInt" : "153" }, { "$numberInt" : "154" }, { "$numberInt" : "155" }, { "$numberInt" : "157" }, { "$numberInt" : "158" }, { "$numberInt" : "160" }, { "$numberInt" : "161" }, { "$numberInt" : "162" }, { "$numberInt" : "165" }, { "$numberInt" : "166" } ] }'::documentdb_core.bson) AND (shard_key_value OPERATOR(pg_catalog.=) '11500'::bigint))
         Node: host=localhost port=58070 dbname=regression
         ->  Bitmap Heap Scan on documentdb_data.documents_11500_1150003 collection
               Output: document
               Recheck Cond: (collection.document OPERATOR(documentdb_api_catalog.@!&) '{ "ikey" : [ { "$numberInt" : "2" }, { "$numberInt" : "4" }, { "$numberInt" : "5" }, { "$numberInt" : "6" }, { "$numberInt" : "11" }, { "$numberInt" : "13" }, { "$numberInt" : "14" }, { "$numberInt" : "16" }, { "$numberInt" : "19" }, { "$numberInt" : "21" }, { "$numberInt" : "22" }, { "$numberInt" : "24" }, { "$numberInt" : "25" }, { "$numberInt" : "28" }, { "$numberInt" : "29" }, { "$numberInt" : "30" }, { "$numberInt" : "37" }, { "$numberInt" : "40" }, { "$numberInt" : "43" }, { "$numberInt" : "45" }, { "$numberInt" : "46" }, { "$numberInt" : "48" }, { "$numberInt" : "49" }, { "$numberInt" : "52" }, { "$numberInt" : "53" }, { "$numberInt" : "54" }, { "$numberInt" : "61" }, { "$numberInt" : "64" }, { "$numberInt" : "69" }, { "$numberInt" : "70" }, { "$numberInt" : "77" }, { "$numberInt" : "82" }, { "$numberInt" : "84" }, { "$numberInt" : "85" }, { "$numberInt" : "86" }, { "$numberInt" : "88" }, { "$numberInt" : "90" }, { "$numberInt" : "93" }, { "$numberInt" : "94" }, { "$numberInt" : "96" }, { "$numberInt" : "97" }, { "$numberInt" : "100" }, { "$numberInt" : "101" }, { "$numberInt" : "102" }, { "$numberInt" : "106" }, { "$numberInt" : "108" }, { "$numberInt" : "109" }, { "$numberInt" : "110" }, { "$numberInt" : "117" }, { "$numberInt" : "120" }, { "$numberInt" : "121" }, { "$numberInt" : "124" }, { "$numberInt" : "125" }, { "$numberInt" : "126" }, { "$numberInt" : "130" }, { "$numberInt" : "132" }, { "$numberInt" : "133" }, { "$numberInt" : "134" }, { "$numberInt" : "137" }, { "$numberInt" : "140" }, { "$numberInt" : "141" }, { "$numberInt" : "142" }, { "$numberInt" : "144" }, { "$numberInt" : "147" }, { "$numberInt" : "149" }, { "$numberInt" : "150" }, { "$numberInt" : "153" }, { "$numberInt" : "154" }, { "$numberInt" : "155" }, { "$numberInt" : "157" }, { "$numberInt" : "158" }, { "$numberInt" : "160" }, { "$numberInt" : "161" }, { "$numberInt" : "162" }, { "$numberInt" : "165" }, { "$numberInt" : "166" } ] }'::documentdb_core.bson)
               ->  Bitmap Index Scan on ikey_1
                     Index Cond: (collection.document OPERATOR(documentdb_api_catalog.@!&) '{ "ikey" : [ { "$numberInt" : "2" }, { "$numberInt" : "4" }, { "$numberInt" : "5" }, { "$numberInt" : "6" }, { "$numberInt" : "11" }, { "$numberInt" : "13" }, { "$numberInt" : "14" }, { "$numberInt" : "16" }, { "$numberInt" : "19" }, { "$numberInt" : "21" }, { "$numberInt" : "22" }, { "$numberInt" : "24" }, { "$numberInt" : "25" }, { "$numberInt" : "28" }, { "$numberInt" : "29" }, { "$numberInt" : "30" }, { "$numberInt" : "37" }, { "$numberInt" : "40" }, { "$numberInt" : "43" }, { "$numberInt" : "45" }, { "$numberInt" : "46" }, { "$numberInt" : "48" }, { "$numberInt" : "49" }, { "$numberInt" : "52" }, { "$numberInt" : "53" }, { "$numberInt" : "54" }, { "$numberInt" : "61" }, { "$numberInt" : "64" }, { "$numberInt" : "69" }, { "$numberInt" : "70" }, { "$numberInt" : "77" }, { "$numberInt" : "82" }, { "$numberInt" : "84" }, { "$numberInt" : "85" }, { "$numberInt" : "86" }, { "$numberInt" : "88" }, { "$numberInt" : "90" }, { "$numberInt" : "93" }, { "$numberInt" : "94" }, { "$numberInt" : "96" }, { "$numberInt" : "97" }, { "$numberInt" : "100" }, { "$numberInt" : "101" }, { "$numberInt" : "102" }, { "$numberInt" : "106" }, { "$numberInt" : "108" }, { "$numberInt" : "109" }, { "$numberInt" : "110" }, { "$numberInt" : "117" }, { "$numberInt" : "120" }, { "$numberInt" : "121" }, { "$numberInt" : "124" }, { "$numberInt" : "125" }, { "$numberInt" : "126" }, { "$numberInt" : "130" }, { "$numberInt" : "132" }, { "$numberInt" : "133" }, { "$numberInt" : "134" }, { "$numberInt" : "137" }, { "$numberInt" : "140" }, { "$numberInt" : "141" }, { "$numberInt" : "142" }, { "$numberInt" : "144" }, { "$numberInt" : "147" }, { "$numberInt" : "149" }, { "$numberInt" : "150" }, { "$numberInt" : "153" }, { "$numberInt" : "154" }, { "$numberInt" : "155" }, { "$numberInt" : "157" }, { "$numberInt" : "158" }, { "$numberInt" : "160" }, { "$numberInt" : "161" }, { "$numberInt" : "162" }, { "$numberInt" : "165" }, { "$numberInt" : "166" } ] }'::documentdb_core.bson)
(12 rows)

EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$bitsAllClear": 0 } }';
                                                                                                                             QUERY PLAN                                                                                                                             
---------------------------------------------------------------------
 Custom Scan (Citus Adaptive)
   Output: remote_scan.document
   Task Count: 1
   Tasks Shown: All
   ->  Task
         Query: SELECT document FROM documentdb_data.documents_11500_1150003 collection WHERE (documentdb_api_catalog.bson_dollar_bits_all_clear(document, '{ "ikey" : [  ] }'::documentdb_core.bson) AND (shard_key_value OPERATOR(pg_catalog.=) '11500'::bigint))
         Node: host=localhost port=58070 dbname=regression
         ->  Bitmap Heap Scan on documentdb_data.documents_11500_1150003 collection
               Output: document
               Recheck Cond: (collection.document OPERATOR(documentdb_api_catalog.@!&) '{ "ikey" : [  ] }'::documentdb_core.bson)
               ->  Bitmap Index Scan on ikey_1
                     Index Cond: (collection.document OPERATOR(documentdb_api_catalog.@!&) '{ "ikey" : [  ] }'::documentdb_core.bson)
(12 rows)

EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$bitsAllClear": 1 } }';
                                                                                                                                        QUERY PLAN                                                                                                                                        
---------------------------------------------------------------------
 Custom Scan (Citus Adaptive)
   Output: remote_scan.document
   Task Count: 1
   Tasks Shown: All
   ->  Task
         Query: SELECT document FROM documentdb_data.documents_11500_1150003 collection WHERE (documentdb_api_catalog.bson_dollar_bits_all_clear(document, '{ "ikey" : [ { "$numberInt" : "0" } ] }'::documentdb_core.bson) AND (shard_key_value OPERATOR(pg_catalog.=) '11500'::bigint))
         Node: host=localhost port=58070 dbname=regression
         ->  Bitmap Heap Scan on documentdb_data.documents_11500_1150003 collection
               Output: document
               Recheck Cond: (collection.document OPERATOR(documentdb_api_catalog.@!&) '{ "ikey" : [ { "$numberInt" : "0" } ] }'::documentdb_core.bson)
               ->  Bitmap Index Scan on ikey_1
                     Index Cond: (collection.document OPERATOR(documentdb_api_catalog.@!&) '{ "ikey" : [ { "$numberInt" : "0" } ] }'::documentdb_core.bson)
(12 rows)

EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$bitsAllClear": 32 } }';
                                                                                                                                        QUERY PLAN                                                                                                                                        
---------------------------------------------------------------------
 Custom Scan (Citus Adaptive)
   Output: remote_scan.document
   Task Count: 1
   Tasks Shown: All
   ->  Task
         Query: SELECT document FROM documentdb_data.documents_11500_1150003 collection WHERE (documentdb_api_catalog.bson_dollar_bits_all_clear(document, '{ "ikey" : [ { "$numberInt" : "5" } ] }'::documentdb_core.bson) AND (shard_key_value OPERATOR(pg_catalog.=) '11500'::bigint))
         Node: host=localhost port=58070 dbname=regression
         ->  Bitmap Heap Scan on documentdb_data.documents_11500_1150003 collection
               Output: document
               Recheck Cond: (collection.document OPERATOR(documentdb_api_catalog.@!&) '{ "ikey" : [ { "$numberInt" : "5" } ] }'::documentdb_core.bson)
               ->  Bitmap Index Scan on ikey_1
                     Index Cond: (collection.document OPERATOR(documentdb_api_catalog.@!&) '{ "ikey" : [ { "$numberInt" : "5" } ] }'::documentdb_core.bson)
(12 rows)

EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$bitsAllClear": 54 } }';
                                                                                                                                                                            QUERY PLAN                                                                                                                                                                            
---------------------------------------------------------------------
 Custom Scan (Citus Adaptive)
   Output: remote_scan.document
   Task Count: 1
   Tasks Shown: All
   ->  Task
         Query: SELECT document FROM documentdb_data.documents_11500_1150003 collection WHERE (documentdb_api_catalog.bson_dollar_bits_all_clear(document, '{ "ikey" : [ { "$numberInt" : "1" }, { "$numberInt" : "2" }, { "$numberInt" : "4" }, { "$numberInt" : "5" } ] }'::documentdb_core.bson) AND (shard_key_value OPERATOR(pg_catalog.=) '11500'::bigint))
         Node: host=localhost port=58070 dbname=regression
         ->  Bitmap Heap Scan on documentdb_data.documents_11500_1150003 collection
               Output: document
               Recheck Cond: (collection.document OPERATOR(documentdb_api_catalog.@!&) '{ "ikey" : [ { "$numberInt" : "1" }, { "$numberInt" : "2" }, { "$numberInt" : "4" }, { "$numberInt" : "5" } ] }'::documentdb_core.bson)
               ->  Bitmap Index Scan on ikey_1
                     Index Cond: (collection.document OPERATOR(documentdb_api_catalog.@!&) '{ "ikey" : [ { "$numberInt" : "1" }, { "$numberInt" : "2" }, { "$numberInt" : "4" }, { "$numberInt" : "5" } ] }'::documentdb_core.bson)
(12 rows)

EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$bitsAllClear": { "$binary": { "base64": "////////////////////////////", "subType": "02"} } } }';
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             QUERY PLAN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
---------------------------------------------------------------------
 Custom Scan (Citus Adaptive)
   Output: remote_scan.document
   Task Count: 1
   Tasks Shown: All
   ->  Task
         Query: SELECT document FROM documentdb_data.documents_11500_1150003 collection WHERE (documentdb_api_catalog.bson_dollar_bits_all_clear(document, '{ "ikey" : [ { "$numberInt" : "0" }, { "$numberInt" : "1" }, { "$numberInt" : "2" }, { "$numberInt" : "3" }, { "$numberInt" : "4" }, { "$numberInt" : "5" }, { "$numberInt" : "6" }, { "$numberInt" : "7" }, { "$numberInt" : "8" }, { "$numberInt" : "9" }, { "$numberInt" : "10" }, { "$numberInt" : "11" }, { "$numberInt" : "12" }, { "$numberInt" : "13" }, { "$numberInt" : "14" }, { "$numberInt" : "15" }, { "$numberInt" : "16" }, { "$numberInt" : "17" }, { "$numberInt" : "18" }, { "$numberInt" : "19" }, { "$numberInt" : "20" }, { "$numberInt" : "21" }, { "$numberInt" : "22" }, { "$numberInt" : "23" }, { "$numberInt" : "24" }, { "$numberInt" : "25" }, { "$numberInt" : "26" }, { "$numberInt" : "27" }, { "$numberInt" : "28" }, { "$numberInt" : "29" }, { "$numberInt" : "30" }, { "$numberInt" : "31" }, { "$numberInt" : "32" }, { "$numberInt" : "33" }, { "$numberInt" : "34" }, { "$numberInt" : "35" }, { "$numberInt" : "36" }, { "$numberInt" : "37" }, { "$numberInt" : "38" }, { "$numberInt" : "39" }, { "$numberInt" : "40" }, { "$numberInt" : "41" }, { "$numberInt" : "42" }, { "$numberInt" : "43" }, { "$numberInt" : "44" }, { "$numberInt" : "45" }, { "$numberInt" : "46" }, { "$numberInt" : "47" }, { "$numberInt" : "48" }, { "$numberInt" : "49" }, { "$numberInt" : "50" }, { "$numberInt" : "51" }, { "$numberInt" : "52" }, { "$numberInt" : "53" }, { "$numberInt" : "54" }, { "$numberInt" : "55" }, { "$numberInt" : "56" }, { "$numberInt" : "57" }, { "$numberInt" : "58" }, { "$numberInt" : "59" }, { "$numberInt" : "60" }, { "$numberInt" : "61" }, { "$numberInt" : "62" }, { "$numberInt" : "63" }, { "$numberInt" : "64" }, { "$numberInt" : "65" }, { "$numberInt" : "66" }, { "$numberInt" : "67" }, { "$numberInt" : "68" }, { "$numberInt" : "69" }, { "$numberInt" : "70" }, { "$numberInt" : "71" }, { "$numberInt" : "72" }, { "$numberInt" : "73" }, { "$numberInt" : "74" }, { "$numberInt" : "75" }, { "$numberInt" : "76" }, { "$numberInt" : "77" }, { "$numberInt" : "78" }, { "$numberInt" : "79" }, { "$numberInt" : "80" }, { "$numberInt" : "81" }, { "$numberInt" : "82" }, { "$numberInt" : "83" }, { "$numberInt" : "84" }, { "$numberInt" : "85" }, { "$numberInt" : "86" }, { "$numberInt" : "87" }, { "$numberInt" : "88" }, { "$numberInt" : "89" }, { "$numberInt" : "90" }, { "$numberInt" : "91" }, { "$numberInt" : "92" }, { "$numberInt" : "93" }, { "$numberInt" : "94" }, { "$numberInt" : "95" }, { "$numberInt" : "96" }, { "$numberInt" : "97" }, { "$numberInt" : "98" }, { "$numberInt" : "99" }, { "$numberInt" : "100" }, { "$numberInt" : "101" }, { "$numberInt" : "102" }, { "$numberInt" : "103" }, { "$numberInt" : "104" }, { "$numberInt" : "105" }, { "$numberInt" : "106" }, { "$numberInt" : "107" }, { "$numberInt" : "108" }, { "$numberInt" : "109" }, { "$numberInt" : "110" }, { "$numberInt" : "111" }, { "$numberInt" : "112" }, { "$numberInt" : "113" }, { "$numberInt" : "114" }, { "$numberInt" : "115" }, { "$numberInt" : "116" }, { "$numberInt" : "117" }, { "$numberInt" : "118" }, { "$numberInt" : "119" }, { "$numberInt" : "120" }, { "$numberInt" : "121" }, { "$numberInt" : "122" }, { "$numberInt" : "123" }, { "$numberInt" : "124" }, { "$numberInt" : "125" }, { "$numberInt" : "126" }, { "$numberInt" : "127" }, { "$numberInt" : "128" }, { "$numberInt" : "129" }, { "$numberInt" : "130" }, { "$numberInt" : "131" }, { "$numberInt" : "132" }, { "$numberInt" : "133" }, { "$numberInt" : "134" }, { "$numberInt" : "135" }, { "$numberInt" : "136" }, { "$numberInt" : "137" }, { "$numberInt" : "138" }, { "$numberInt" : "139" }, { "$numberInt" : "140" }, { "$numberInt" : "141" }, { "$numberInt" : "142" }, { "$numberInt" : "143" }, { "$numberInt" : "144" }, { "$numberInt" : "145" }, { "$numberInt" : "146" }, { "$numberInt" : "147" }, { "$numberInt" : "148" }, { "$numberInt" : "149" }, { "$numberInt" : "150" }, { "$numberInt" : "151" }, { "$numberInt" : "152" }, { "$numberInt" : "153" }, { "$numberInt" : "154" }, { "$numberInt" : "155" }, { "$numberInt" : "156" }, { "$numberInt" : "157" }, { "$numberInt" : "158" }, { "$numberInt" : "159" }, { "$numberInt" : "160" }, { "$numberInt" : "161" }, { "$numberInt" : "162" }, { "$numberInt" : "163" }, { "$numberInt" : "164" }, { "$numberInt" : "165" }, { "$numberInt" : "166" }, { "$numberInt" : "167" } ] }'::documentdb_core.bson) AND (shard_key_value OPERATOR(pg_catalog.=) '11500'::bigint))
         Node: host=localhost port=58070 dbname=regression
         ->  Bitmap Heap Scan on documentdb_data.documents_11500_1150003 collection
               Output: document
               Recheck Cond: (collection.document OPERATOR(documentdb_api_catalog.@!&) '{ "ikey" : [ { "$numberInt" : "0" }, { "$numberInt" : "1" }, { "$numberInt" : "2" }, { "$numberInt" : "3" }, { "$numberInt" : "4" }, { "$numberInt" : "5" }, { "$numberInt" : "6" }, { "$numberInt" : "7" }, { "$numberInt" : "8" }, { "$numberInt" : "9" }, { "$numberInt" : "10" }, { "$numberInt" : "11" }, { "$numberInt" : "12" }, { "$numberInt" : "13" }, { "$numberInt" : "14" }, { "$numberInt" : "15" }, { "$numberInt" : "16" }, { "$numberInt" : "17" }, { "$numberInt" : "18" }, { "$numberInt" : "19" }, { "$numberInt" : "20" }, { "$numberInt" : "21" }, { "$numberInt" : "22" }, { "$numberInt" : "23" }, { "$numberInt" : "24" }, { "$numberInt" : "25" }, { "$numberInt" : "26" }, { "$numberInt" : "27" }, { "$numberInt" : "28" }, { "$numberInt" : "29" }, { "$numberInt" : "30" }, { "$numberInt" : "31" }, { "$numberInt" : "32" }, { "$numberInt" : "33" }, { "$numberInt" : "34" }, { "$numberInt" : "35" }, { "$numberInt" : "36" }, { "$numberInt" : "37" }, { "$numberInt" : "38" }, { "$numberInt" : "39" }, { "$numberInt" : "40" }, { "$numberInt" : "41" }, { "$numberInt" : "42" }, { "$numberInt" : "43" }, { "$numberInt" : "44" }, { "$numberInt" : "45" }, { "$numberInt" : "46" }, { "$numberInt" : "47" }, { "$numberInt" : "48" }, { "$numberInt" : "49" }, { "$numberInt" : "50" }, { "$numberInt" : "51" }, { "$numberInt" : "52" }, { "$numberInt" : "53" }, { "$numberInt" : "54" }, { "$numberInt" : "55" }, { "$numberInt" : "56" }, { "$numberInt" : "57" }, { "$numberInt" : "58" }, { "$numberInt" : "59" }, { "$numberInt" : "60" }, { "$numberInt" : "61" }, { "$numberInt" : "62" }, { "$numberInt" : "63" }, { "$numberInt" : "64" }, { "$numberInt" : "65" }, { "$numberInt" : "66" }, { "$numberInt" : "67" }, { "$numberInt" : "68" }, { "$numberInt" : "69" }, { "$numberInt" : "70" }, { "$numberInt" : "71" }, { "$numberInt" : "72" }, { "$numberInt" : "73" }, { "$numberInt" : "74" }, { "$numberInt" : "75" }, { "$numberInt" : "76" }, { "$numberInt" : "77" }, { "$numberInt" : "78" }, { "$numberInt" : "79" }, { "$numberInt" : "80" }, { "$numberInt" : "81" }, { "$numberInt" : "82" }, { "$numberInt" : "83" }, { "$numberInt" : "84" }, { "$numberInt" : "85" }, { "$numberInt" : "86" }, { "$numberInt" : "87" }, { "$numberInt" : "88" }, { "$numberInt" : "89" }, { "$numberInt" : "90" }, { "$numberInt" : "91" }, { "$numberInt" : "92" }, { "$numberInt" : "93" }, { "$numberInt" : "94" }, { "$numberInt" : "95" }, { "$numberInt" : "96" }, { "$numberInt" : "97" }, { "$numberInt" : "98" }, { "$numberInt" : "99" }, { "$numberInt" : "100" }, { "$numberInt" : "101" }, { "$numberInt" : "102" }, { "$numberInt" : "103" }, { "$numberInt" : "104" }, { "$numberInt" : "105" }, { "$numberInt" : "106" }, { "$numberInt" : "107" }, { "$numberInt" : "108" }, { "$numberInt" : "109" }, { "$numberInt" : "110" }, { "$numberInt" : "111" }, { "$numberInt" : "112" }, { "$numberInt" : "113" }, { "$numberInt" : "114" }, { "$numberInt" : "115" }, { "$numberInt" : "116" }, { "$numberInt" : "117" }, { "$numberInt" : "118" }, { "$numberInt" : "119" }, { "$numberInt" : "120" }, { "$numberInt" : "121" }, { "$numberInt" : "122" }, { "$numberInt" : "123" }, { "$numberInt" : "124" }, { "$numberInt" : "125" }, { "$numberInt" : "126" }, { "$numberInt" : "127" }, { "$numberInt" : "128" }, { "$numberInt" : "129" }, { "$numberInt" : "130" }, { "$numberInt" : "131" }, { "$numberInt" : "132" }, { "$numberInt" : "133" }, { "$numberInt" : "134" }, { "$numberInt" : "135" }, { "$numberInt" : "136" }, { "$numberInt" : "137" }, { "$numberInt" : "138" }, { "$numberInt" : "139" }, { "$numberInt" : "140" }, { "$numberInt" : "141" }, { "$numberInt" : "142" }, { "$numberInt" : "143" }, { "$numberInt" : "144" }, { "$numberInt" : "145" }, { "$numberInt" : "146" }, { "$numberInt" : "147" }, { "$numberInt" : "148" }, { "$numberInt" : "149" }, { "$numberInt" : "150" }, { "$numberInt" : "151" }, { "$numberInt" : "152" }, { "$numberInt" : "153" }, { "$numberInt" : "154" }, { "$numberInt" : "155" }, { "$numberInt" : "156" }, { "$numberInt" : "157" }, { "$numberInt" : "158" }, { "$numberInt" : "159" }, { "$numberInt" : "160" }, { "$numberInt" : "161" }, { "$numberInt" : "162" }, { "$numberInt" : "163" }, { "$numberInt" : "164" }, { "$numberInt" : "165" }, { "$numberInt" : "166" }, { "$numberInt" : "167" } ] }'::documentdb_core.bson)
               ->  Bitmap Index Scan on ikey_1
                     Index Cond: (collection.document OPERATOR(documentdb_api_catalog.@!&) '{ "ikey" : [ { "$numberInt" : "0" }, { "$numberInt" : "1" }, { "$numberInt" : "2" }, { "$numberInt" : "3" }, { "$numberInt" : "4" }, { "$numberInt" : "5" }, { "$numberInt" : "6" }, { "$numberInt" : "7" }, { "$numberInt" : "8" }, { "$numberInt" : "9" }, { "$numberInt" : "10" }, { "$numberInt" : "11" }, { "$numberInt" : "12" }, { "$numberInt" : "13" }, { "$numberInt" : "14" }, { "$numberInt" : "15" }, { "$numberInt" : "16" }, { "$numberInt" : "17" }, { "$numberInt" : "18" }, { "$numberInt" : "19" }, { "$numberInt" : "20" }, { "$numberInt" : "21" }, { "$numberInt" : "22" }, { "$numberInt" : "23" }, { "$numberInt" : "24" }, { "$numberInt" : "25" }, { "$numberInt" : "26" }, { "$numberInt" : "27" }, { "$numberInt" : "28" }, { "$numberInt" : "29" }, { "$numberInt" : "30" }, { "$numberInt" : "31" }, { "$numberInt" : "32" }, { "$numberInt" : "33" }, { "$numberInt" : "34" }, { "$numberInt" : "35" }, { "$numberInt" : "36" }, { "$numberInt" : "37" }, { "$numberInt" : "38" }, { "$numberInt" : "39" }, { "$numberInt" : "40" }, { "$numberInt" : "41" }, { "$numberInt" : "42" }, { "$numberInt" : "43" }, { "$numberInt" : "44" }, { "$numberInt" : "45" }, { "$numberInt" : "46" }, { "$numberInt" : "47" }, { "$numberInt" : "48" }, { "$numberInt" : "49" }, { "$numberInt" : "50" }, { "$numberInt" : "51" }, { "$numberInt" : "52" }, { "$numberInt" : "53" }, { "$numberInt" : "54" }, { "$numberInt" : "55" }, { "$numberInt" : "56" }, { "$numberInt" : "57" }, { "$numberInt" : "58" }, { "$numberInt" : "59" }, { "$numberInt" : "60" }, { "$numberInt" : "61" }, { "$numberInt" : "62" }, { "$numberInt" : "63" }, { "$numberInt" : "64" }, { "$numberInt" : "65" }, { "$numberInt" : "66" }, { "$numberInt" : "67" }, { "$numberInt" : "68" }, { "$numberInt" : "69" }, { "$numberInt" : "70" }, { "$numberInt" : "71" }, { "$numberInt" : "72" }, { "$numberInt" : "73" }, { "$numberInt" : "74" }, { "$numberInt" : "75" }, { "$numberInt" : "76" }, { "$numberInt" : "77" }, { "$numberInt" : "78" }, { "$numberInt" : "79" }, { "$numberInt" : "80" }, { "$numberInt" : "81" }, { "$numberInt" : "82" }, { "$numberInt" : "83" }, { "$numberInt" : "84" }, { "$numberInt" : "85" }, { "$numberInt" : "86" }, { "$numberInt" : "87" }, { "$numberInt" : "88" }, { "$numberInt" : "89" }, { "$numberInt" : "90" }, { "$numberInt" : "91" }, { "$numberInt" : "92" }, { "$numberInt" : "93" }, { "$numberInt" : "94" }, { "$numberInt" : "95" }, { "$numberInt" : "96" }, { "$numberInt" : "97" }, { "$numberInt" : "98" }, { "$numberInt" : "99" }, { "$numberInt" : "100" }, { "$numberInt" : "101" }, { "$numberInt" : "102" }, { "$numberInt" : "103" }, { "$numberInt" : "104" }, { "$numberInt" : "105" }, { "$numberInt" : "106" }, { "$numberInt" : "107" }, { "$numberInt" : "108" }, { "$numberInt" : "109" }, { "$numberInt" : "110" }, { "$numberInt" : "111" }, { "$numberInt" : "112" }, { "$numberInt" : "113" }, { "$numberInt" : "114" }, { "$numberInt" : "115" }, { "$numberInt" : "116" }, { "$numberInt" : "117" }, { "$numberInt" : "118" }, { "$numberInt" : "119" }, { "$numberInt" : "120" }, { "$numberInt" : "121" }, { "$numberInt" : "122" }, { "$numberInt" : "123" }, { "$numberInt" : "124" }, { "$numberInt" : "125" }, { "$numberInt" : "126" }, { "$numberInt" : "127" }, { "$numberInt" : "128" }, { "$numberInt" : "129" }, { "$numberInt" : "130" }, { "$numberInt" : "131" }, { "$numberInt" : "132" }, { "$numberInt" : "133" }, { "$numberInt" : "134" }, { "$numberInt" : "135" }, { "$numberInt" : "136" }, { "$numberInt" : "137" }, { "$numberInt" : "138" }, { "$numberInt" : "139" }, { "$numberInt" : "140" }, { "$numberInt" : "141" }, { "$numberInt" : "142" }, { "$numberInt" : "143" }, { "$numberInt" : "144" }, { "$numberInt" : "145" }, { "$numberInt" : "146" }, { "$numberInt" : "147" }, { "$numberInt" : "148" }, { "$numberInt" : "149" }, { "$numberInt" : "150" }, { "$numberInt" : "151" }, { "$numberInt" : "152" }, { "$numberInt" : "153" }, { "$numberInt" : "154" }, { "$numberInt" : "155" }, { "$numberInt" : "156" }, { "$numberInt" : "157" }, { "$numberInt" : "158" }, { "$numberInt" : "159" }, { "$numberInt" : "160" }, { "$numberInt" : "161" }, { "$numberInt" : "162" }, { "$numberInt" : "163" }, { "$numberInt" : "164" }, { "$numberInt" : "165" }, { "$numberInt" : "166" }, { "$numberInt" : "167" } ] }'::documentdb_core.bson)
(12 rows)

/* $bitsAllClear (all terms truncated) */
SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$bitsAnyClear": { "$binary" : { "base64": "dGhpcyBpcyBhIHRlc3Qgc3RyaW5n", "subType" : "01" } } } }';
                                                                                                 document                                                                                                 
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "1" }, "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "00" } }, "item" : "A" }
 { "_id" : { "$numberInt" : "2" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6IDEsICJiIjogMyB9", "subType" : "01" } } }
 { "_id" : { "$numberInt" : "3" }, "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "04" } } }
 { "_id" : { "$numberInt" : "4" }, "ikey" : { "$binary" : { "base64" : "YWJvYm9yYQ==", "subType" : "05" } } }
 { "_id" : { "$numberInt" : "5" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6IDEsICJiIjogMyB9", "subType" : "06" } } }
 { "_id" : { "$numberInt" : "6" }, "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "07" } }, "item" : "F", "customKey" : { "$numberInt" : "6" } }
 { "_id" : { "$numberInt" : "7" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6ICIxMjM0NSIsICJiIjogMTIzMTIzMTIzMjExMjMxIH0=", "subType" : "01" } }, "item" : "G", "customKey" : { "$numberInt" : "6" } }
 { "_id" : { "$numberInt" : "9" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6ICIxMjM0NSIsICJiIjogMTIzMTIzMTIzMjExMjMxIH0=", "subType" : "04" } }, "item" : "H", "customKey" : { "$numberInt" : "8" } }
(8 rows)

SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$bitsAnyClear": { "$binary" : { "base64": "YWJvYm9yYQ==", "subType" : "05" } } } }';
                                                                                                 document                                                                                                 
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "1" }, "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "00" } }, "item" : "A" }
 { "_id" : { "$numberInt" : "2" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6IDEsICJiIjogMyB9", "subType" : "01" } } }
 { "_id" : { "$numberInt" : "3" }, "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "04" } } }
 { "_id" : { "$numberInt" : "5" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6IDEsICJiIjogMyB9", "subType" : "06" } } }
 { "_id" : { "$numberInt" : "6" }, "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "07" } }, "item" : "F", "customKey" : { "$numberInt" : "6" } }
 { "_id" : { "$numberInt" : "7" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6ICIxMjM0NSIsICJiIjogMTIzMTIzMTIzMjExMjMxIH0=", "subType" : "01" } }, "item" : "G", "customKey" : { "$numberInt" : "6" } }
 { "_id" : { "$numberInt" : "8" }, "ikey" : { "$binary" : { "base64" : "dGhpcyBpcyBhIHRlc3Qgc3RyaW5n", "subType" : "00" } } }
 { "_id" : { "$numberInt" : "9" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6ICIxMjM0NSIsICJiIjogMTIzMTIzMTIzMjExMjMxIH0=", "subType" : "04" } }, "item" : "H", "customKey" : { "$numberInt" : "8" } }
 { "_id" : { "$numberInt" : "10" }, "ikey" : { "$binary" : { "base64" : "dGhpcyBpcyBhIHRlc3Qgc3RyaW5n", "subType" : "01" } }, "item" : "H", "customKey" : { "$numberInt" : "9" } }
(9 rows)

SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$bitsAnyClear": { "$binary" : { "base64": "////////////////////////////", "subType" : "02" } } } }';
                                                                                                 document                                                                                                 
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "1" }, "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "00" } }, "item" : "A" }
 { "_id" : { "$numberInt" : "2" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6IDEsICJiIjogMyB9", "subType" : "01" } } }
 { "_id" : { "$numberInt" : "3" }, "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "04" } } }
 { "_id" : { "$numberInt" : "4" }, "ikey" : { "$binary" : { "base64" : "YWJvYm9yYQ==", "subType" : "05" } } }
 { "_id" : { "$numberInt" : "5" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6IDEsICJiIjogMyB9", "subType" : "06" } } }
 { "_id" : { "$numberInt" : "6" }, "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "07" } }, "item" : "F", "customKey" : { "$numberInt" : "6" } }
 { "_id" : { "$numberInt" : "7" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6ICIxMjM0NSIsICJiIjogMTIzMTIzMTIzMjExMjMxIH0=", "subType" : "01" } }, "item" : "G", "customKey" : { "$numberInt" : "6" } }
 { "_id" : { "$numberInt" : "8" }, "ikey" : { "$binary" : { "base64" : "dGhpcyBpcyBhIHRlc3Qgc3RyaW5n", "subType" : "00" } } }
 { "_id" : { "$numberInt" : "9" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6ICIxMjM0NSIsICJiIjogMTIzMTIzMTIzMjExMjMxIH0=", "subType" : "04" } }, "item" : "H", "customKey" : { "$numberInt" : "8" } }
 { "_id" : { "$numberInt" : "10" }, "ikey" : { "$binary" : { "base64" : "dGhpcyBpcyBhIHRlc3Qgc3RyaW5n", "subType" : "01" } }, "item" : "H", "customKey" : { "$numberInt" : "9" } }
(10 rows)

EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$bitsAnyClear": { "$binary" : { "base64": "dGhpcyBpcyBhIHRlc3Qgc3RyaW5n", "subType" : "01" } } } }';
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 QUERY PLAN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
---------------------------------------------------------------------
 Custom Scan (Citus Adaptive)
   Output: remote_scan.document
   Task Count: 1
   Tasks Shown: All
   ->  Task
         Query: SELECT document FROM documentdb_data.documents_11500_1150003 collection WHERE (documentdb_api_catalog.bson_dollar_bits_any_clear(document, '{ "ikey" : [ { "$numberInt" : "2" }, { "$numberInt" : "4" }, { "$numberInt" : "5" }, { "$numberInt" : "6" }, { "$numberInt" : "11" }, { "$numberInt" : "13" }, { "$numberInt" : "14" }, { "$numberInt" : "16" }, { "$numberInt" : "19" }, { "$numberInt" : "21" }, { "$numberInt" : "22" }, { "$numberInt" : "24" }, { "$numberInt" : "25" }, { "$numberInt" : "28" }, { "$numberInt" : "29" }, { "$numberInt" : "30" }, { "$numberInt" : "37" }, { "$numberInt" : "40" }, { "$numberInt" : "43" }, { "$numberInt" : "45" }, { "$numberInt" : "46" }, { "$numberInt" : "48" }, { "$numberInt" : "49" }, { "$numberInt" : "52" }, { "$numberInt" : "53" }, { "$numberInt" : "54" }, { "$numberInt" : "61" }, { "$numberInt" : "64" }, { "$numberInt" : "69" }, { "$numberInt" : "70" }, { "$numberInt" : "77" }, { "$numberInt" : "82" }, { "$numberInt" : "84" }, { "$numberInt" : "85" }, { "$numberInt" : "86" }, { "$numberInt" : "88" }, { "$numberInt" : "90" }, { "$numberInt" : "93" }, { "$numberInt" : "94" }, { "$numberInt" : "96" }, { "$numberInt" : "97" }, { "$numberInt" : "100" }, { "$numberInt" : "101" }, { "$numberInt" : "102" }, { "$numberInt" : "106" }, { "$numberInt" : "108" }, { "$numberInt" : "109" }, { "$numberInt" : "110" }, { "$numberInt" : "117" }, { "$numberInt" : "120" }, { "$numberInt" : "121" }, { "$numberInt" : "124" }, { "$numberInt" : "125" }, { "$numberInt" : "126" }, { "$numberInt" : "130" }, { "$numberInt" : "132" }, { "$numberInt" : "133" }, { "$numberInt" : "134" }, { "$numberInt" : "137" }, { "$numberInt" : "140" }, { "$numberInt" : "141" }, { "$numberInt" : "142" }, { "$numberInt" : "144" }, { "$numberInt" : "147" }, { "$numberInt" : "149" }, { "$numberInt" : "150" }, { "$numberInt" : "153" }, { "$numberInt" : "154" }, { "$numberInt" : "155" }, { "$numberInt" : "157" }, { "$numberInt" : "158" }, { "$numberInt" : "160" }, { "$numberInt" : "161" }, { "$numberInt" : "162" }, { "$numberInt" : "165" }, { "$numberInt" : "166" } ] }'::documentdb_core.bson) AND (shard_key_value OPERATOR(pg_catalog.=) '11500'::bigint))
         Node: host=localhost port=58070 dbname=regression
         ->  Bitmap Heap Scan on documentdb_data.documents_11500_1150003 collection
               Output: document
               Recheck Cond: (collection.document OPERATOR(documentdb_api_catalog.@!|) '{ "ikey" : [ { "$numberInt" : "2" }, { "$numberInt" : "4" }, { "$numberInt" : "5" }, { "$numberInt" : "6" }, { "$numberInt" : "11" }, { "$numberInt" : "13" }, { "$numberInt" : "14" }, { "$numberInt" : "16" }, { "$numberInt" : "19" }, { "$numberInt" : "21" }, { "$numberInt" : "22" }, { "$numberInt" : "24" }, { "$numberInt" : "25" }, { "$numberInt" : "28" }, { "$numberInt" : "29" }, { "$numberInt" : "30" }, { "$numberInt" : "37" }, { "$numberInt" : "40" }, { "$numberInt" : "43" }, { "$numberInt" : "45" }, { "$numberInt" : "46" }, { "$numberInt" : "48" }, { "$numberInt" : "49" }, { "$numberInt" : "52" }, { "$numberInt" : "53" }, { "$numberInt" : "54" }, { "$numberInt" : "61" }, { "$numberInt" : "64" }, { "$numberInt" : "69" }, { "$numberInt" : "70" }, { "$numberInt" : "77" }, { "$numberInt" : "82" }, { "$numberInt" : "84" }, { "$numberInt" : "85" }, { "$numberInt" : "86" }, { "$numberInt" : "88" }, { "$numberInt" : "90" }, { "$numberInt" : "93" }, { "$numberInt" : "94" }, { "$numberInt" : "96" }, { "$numberInt" : "97" }, { "$numberInt" : "100" }, { "$numberInt" : "101" }, { "$numberInt" : "102" }, { "$numberInt" : "106" }, { "$numberInt" : "108" }, { "$numberInt" : "109" }, { "$numberInt" : "110" }, { "$numberInt" : "117" }, { "$numberInt" : "120" }, { "$numberInt" : "121" }, { "$numberInt" : "124" }, { "$numberInt" : "125" }, { "$numberInt" : "126" }, { "$numberInt" : "130" }, { "$numberInt" : "132" }, { "$numberInt" : "133" }, { "$numberInt" : "134" }, { "$numberInt" : "137" }, { "$numberInt" : "140" }, { "$numberInt" : "141" }, { "$numberInt" : "142" }, { "$numberInt" : "144" }, { "$numberInt" : "147" }, { "$numberInt" : "149" }, { "$numberInt" : "150" }, { "$numberInt" : "153" }, { "$numberInt" : "154" }, { "$numberInt" : "155" }, { "$numberInt" : "157" }, { "$numberInt" : "158" }, { "$numberInt" : "160" }, { "$numberInt" : "161" }, { "$numberInt" : "162" }, { "$numberInt" : "165" }, { "$numberInt" : "166" } ] }'::documentdb_core.bson)
               ->  Bitmap Index Scan on ikey_1
                     Index Cond: (collection.document OPERATOR(documentdb_api_catalog.@!|) '{ "ikey" : [ { "$numberInt" : "2" }, { "$numberInt" : "4" }, { "$numberInt" : "5" }, { "$numberInt" : "6" }, { "$numberInt" : "11" }, { "$numberInt" : "13" }, { "$numberInt" : "14" }, { "$numberInt" : "16" }, { "$numberInt" : "19" }, { "$numberInt" : "21" }, { "$numberInt" : "22" }, { "$numberInt" : "24" }, { "$numberInt" : "25" }, { "$numberInt" : "28" }, { "$numberInt" : "29" }, { "$numberInt" : "30" }, { "$numberInt" : "37" }, { "$numberInt" : "40" }, { "$numberInt" : "43" }, { "$numberInt" : "45" }, { "$numberInt" : "46" }, { "$numberInt" : "48" }, { "$numberInt" : "49" }, { "$numberInt" : "52" }, { "$numberInt" : "53" }, { "$numberInt" : "54" }, { "$numberInt" : "61" }, { "$numberInt" : "64" }, { "$numberInt" : "69" }, { "$numberInt" : "70" }, { "$numberInt" : "77" }, { "$numberInt" : "82" }, { "$numberInt" : "84" }, { "$numberInt" : "85" }, { "$numberInt" : "86" }, { "$numberInt" : "88" }, { "$numberInt" : "90" }, { "$numberInt" : "93" }, { "$numberInt" : "94" }, { "$numberInt" : "96" }, { "$numberInt" : "97" }, { "$numberInt" : "100" }, { "$numberInt" : "101" }, { "$numberInt" : "102" }, { "$numberInt" : "106" }, { "$numberInt" : "108" }, { "$numberInt" : "109" }, { "$numberInt" : "110" }, { "$numberInt" : "117" }, { "$numberInt" : "120" }, { "$numberInt" : "121" }, { "$numberInt" : "124" }, { "$numberInt" : "125" }, { "$numberInt" : "126" }, { "$numberInt" : "130" }, { "$numberInt" : "132" }, { "$numberInt" : "133" }, { "$numberInt" : "134" }, { "$numberInt" : "137" }, { "$numberInt" : "140" }, { "$numberInt" : "141" }, { "$numberInt" : "142" }, { "$numberInt" : "144" }, { "$numberInt" : "147" }, { "$numberInt" : "149" }, { "$numberInt" : "150" }, { "$numberInt" : "153" }, { "$numberInt" : "154" }, { "$numberInt" : "155" }, { "$numberInt" : "157" }, { "$numberInt" : "158" }, { "$numberInt" : "160" }, { "$numberInt" : "161" }, { "$numberInt" : "162" }, { "$numberInt" : "165" }, { "$numberInt" : "166" } ] }'::documentdb_core.bson)
(12 rows)

EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$bitsAnyClear": { "$binary" : { "base64": "YWJvYm9yYQ==", "subType" : "05" } } } }';
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        QUERY PLAN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
---------------------------------------------------------------------
 Custom Scan (Citus Adaptive)
   Output: remote_scan.document
   Task Count: 1
   Tasks Shown: All
   ->  Task
         Query: SELECT document FROM documentdb_data.documents_11500_1150003 collection WHERE (documentdb_api_catalog.bson_dollar_bits_any_clear(document, '{ "ikey" : [ { "$numberInt" : "0" }, { "$numberInt" : "5" }, { "$numberInt" : "6" }, { "$numberInt" : "9" }, { "$numberInt" : "13" }, { "$numberInt" : "14" }, { "$numberInt" : "16" }, { "$numberInt" : "17" }, { "$numberInt" : "18" }, { "$numberInt" : "19" }, { "$numberInt" : "21" }, { "$numberInt" : "22" }, { "$numberInt" : "25" }, { "$numberInt" : "29" }, { "$numberInt" : "30" }, { "$numberInt" : "32" }, { "$numberInt" : "33" }, { "$numberInt" : "34" }, { "$numberInt" : "35" }, { "$numberInt" : "37" }, { "$numberInt" : "38" }, { "$numberInt" : "41" }, { "$numberInt" : "44" }, { "$numberInt" : "45" }, { "$numberInt" : "46" }, { "$numberInt" : "48" }, { "$numberInt" : "53" }, { "$numberInt" : "54" } ] }'::documentdb_core.bson) AND (shard_key_value OPERATOR(pg_catalog.=) '11500'::bigint))
         Node: host=localhost port=58070 dbname=regression
         ->  Bitmap Heap Scan on documentdb_data.documents_11500_1150003 collection
               Output: document
               Recheck Cond: (collection.document OPERATOR(documentdb_api_catalog.@!|) '{ "ikey" : [ { "$numberInt" : "0" }, { "$numberInt" : "5" }, { "$numberInt" : "6" }, { "$numberInt" : "9" }, { "$numberInt" : "13" }, { "$numberInt" : "14" }, { "$numberInt" : "16" }, { "$numberInt" : "17" }, { "$numberInt" : "18" }, { "$numberInt" : "19" }, { "$numberInt" : "21" }, { "$numberInt" : "22" }, { "$numberInt" : "25" }, { "$numberInt" : "29" }, { "$numberInt" : "30" }, { "$numberInt" : "32" }, { "$numberInt" : "33" }, { "$numberInt" : "34" }, { "$numberInt" : "35" }, { "$numberInt" : "37" }, { "$numberInt" : "38" }, { "$numberInt" : "41" }, { "$numberInt" : "44" }, { "$numberInt" : "45" }, { "$numberInt" : "46" }, { "$numberInt" : "48" }, { "$numberInt" : "53" }, { "$numberInt" : "54" } ] }'::documentdb_core.bson)
               ->  Bitmap Index Scan on ikey_1
                     Index Cond: (collection.document OPERATOR(documentdb_api_catalog.@!|) '{ "ikey" : [ { "$numberInt" : "0" }, { "$numberInt" : "5" }, { "$numberInt" : "6" }, { "$numberInt" : "9" }, { "$numberInt" : "13" }, { "$numberInt" : "14" }, { "$numberInt" : "16" }, { "$numberInt" : "17" }, { "$numberInt" : "18" }, { "$numberInt" : "19" }, { "$numberInt" : "21" }, { "$numberInt" : "22" }, { "$numberInt" : "25" }, { "$numberInt" : "29" }, { "$numberInt" : "30" }, { "$numberInt" : "32" }, { "$numberInt" : "33" }, { "$numberInt" : "34" }, { "$numberInt" : "35" }, { "$numberInt" : "37" }, { "$numberInt" : "38" }, { "$numberInt" : "41" }, { "$numberInt" : "44" }, { "$numberInt" : "45" }, { "$numberInt" : "46" }, { "$numberInt" : "48" }, { "$numberInt" : "53" }, { "$numberInt" : "54" } ] }'::documentdb_core.bson)
(12 rows)

EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$bitsAnyClear": { "$binary" : { "base64": "////////////////////////////", "subType" : "02" } } } }';
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             QUERY PLAN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
---------------------------------------------------------------------
 Custom Scan (Citus Adaptive)
   Output: remote_scan.document
   Task Count: 1
   Tasks Shown: All
   ->  Task
         Query: SELECT document FROM documentdb_data.documents_11500_1150003 collection WHERE (documentdb_api_catalog.bson_dollar_bits_any_clear(document, '{ "ikey" : [ { "$numberInt" : "0" }, { "$numberInt" : "1" }, { "$numberInt" : "2" }, { "$numberInt" : "3" }, { "$numberInt" : "4" }, { "$numberInt" : "5" }, { "$numberInt" : "6" }, { "$numberInt" : "7" }, { "$numberInt" : "8" }, { "$numberInt" : "9" }, { "$numberInt" : "10" }, { "$numberInt" : "11" }, { "$numberInt" : "12" }, { "$numberInt" : "13" }, { "$numberInt" : "14" }, { "$numberInt" : "15" }, { "$numberInt" : "16" }, { "$numberInt" : "17" }, { "$numberInt" : "18" }, { "$numberInt" : "19" }, { "$numberInt" : "20" }, { "$numberInt" : "21" }, { "$numberInt" : "22" }, { "$numberInt" : "23" }, { "$numberInt" : "24" }, { "$numberInt" : "25" }, { "$numberInt" : "26" }, { "$numberInt" : "27" }, { "$numberInt" : "28" }, { "$numberInt" : "29" }, { "$numberInt" : "30" }, { "$numberInt" : "31" }, { "$numberInt" : "32" }, { "$numberInt" : "33" }, { "$numberInt" : "34" }, { "$numberInt" : "35" }, { "$numberInt" : "36" }, { "$numberInt" : "37" }, { "$numberInt" : "38" }, { "$numberInt" : "39" }, { "$numberInt" : "40" }, { "$numberInt" : "41" }, { "$numberInt" : "42" }, { "$numberInt" : "43" }, { "$numberInt" : "44" }, { "$numberInt" : "45" }, { "$numberInt" : "46" }, { "$numberInt" : "47" }, { "$numberInt" : "48" }, { "$numberInt" : "49" }, { "$numberInt" : "50" }, { "$numberInt" : "51" }, { "$numberInt" : "52" }, { "$numberInt" : "53" }, { "$numberInt" : "54" }, { "$numberInt" : "55" }, { "$numberInt" : "56" }, { "$numberInt" : "57" }, { "$numberInt" : "58" }, { "$numberInt" : "59" }, { "$numberInt" : "60" }, { "$numberInt" : "61" }, { "$numberInt" : "62" }, { "$numberInt" : "63" }, { "$numberInt" : "64" }, { "$numberInt" : "65" }, { "$numberInt" : "66" }, { "$numberInt" : "67" }, { "$numberInt" : "68" }, { "$numberInt" : "69" }, { "$numberInt" : "70" }, { "$numberInt" : "71" }, { "$numberInt" : "72" }, { "$numberInt" : "73" }, { "$numberInt" : "74" }, { "$numberInt" : "75" }, { "$numberInt" : "76" }, { "$numberInt" : "77" }, { "$numberInt" : "78" }, { "$numberInt" : "79" }, { "$numberInt" : "80" }, { "$numberInt" : "81" }, { "$numberInt" : "82" }, { "$numberInt" : "83" }, { "$numberInt" : "84" }, { "$numberInt" : "85" }, { "$numberInt" : "86" }, { "$numberInt" : "87" }, { "$numberInt" : "88" }, { "$numberInt" : "89" }, { "$numberInt" : "90" }, { "$numberInt" : "91" }, { "$numberInt" : "92" }, { "$numberInt" : "93" }, { "$numberInt" : "94" }, { "$numberInt" : "95" }, { "$numberInt" : "96" }, { "$numberInt" : "97" }, { "$numberInt" : "98" }, { "$numberInt" : "99" }, { "$numberInt" : "100" }, { "$numberInt" : "101" }, { "$numberInt" : "102" }, { "$numberInt" : "103" }, { "$numberInt" : "104" }, { "$numberInt" : "105" }, { "$numberInt" : "106" }, { "$numberInt" : "107" }, { "$numberInt" : "108" }, { "$numberInt" : "109" }, { "$numberInt" : "110" }, { "$numberInt" : "111" }, { "$numberInt" : "112" }, { "$numberInt" : "113" }, { "$numberInt" : "114" }, { "$numberInt" : "115" }, { "$numberInt" : "116" }, { "$numberInt" : "117" }, { "$numberInt" : "118" }, { "$numberInt" : "119" }, { "$numberInt" : "120" }, { "$numberInt" : "121" }, { "$numberInt" : "122" }, { "$numberInt" : "123" }, { "$numberInt" : "124" }, { "$numberInt" : "125" }, { "$numberInt" : "126" }, { "$numberInt" : "127" }, { "$numberInt" : "128" }, { "$numberInt" : "129" }, { "$numberInt" : "130" }, { "$numberInt" : "131" }, { "$numberInt" : "132" }, { "$numberInt" : "133" }, { "$numberInt" : "134" }, { "$numberInt" : "135" }, { "$numberInt" : "136" }, { "$numberInt" : "137" }, { "$numberInt" : "138" }, { "$numberInt" : "139" }, { "$numberInt" : "140" }, { "$numberInt" : "141" }, { "$numberInt" : "142" }, { "$numberInt" : "143" }, { "$numberInt" : "144" }, { "$numberInt" : "145" }, { "$numberInt" : "146" }, { "$numberInt" : "147" }, { "$numberInt" : "148" }, { "$numberInt" : "149" }, { "$numberInt" : "150" }, { "$numberInt" : "151" }, { "$numberInt" : "152" }, { "$numberInt" : "153" }, { "$numberInt" : "154" }, { "$numberInt" : "155" }, { "$numberInt" : "156" }, { "$numberInt" : "157" }, { "$numberInt" : "158" }, { "$numberInt" : "159" }, { "$numberInt" : "160" }, { "$numberInt" : "161" }, { "$numberInt" : "162" }, { "$numberInt" : "163" }, { "$numberInt" : "164" }, { "$numberInt" : "165" }, { "$numberInt" : "166" }, { "$numberInt" : "167" } ] }'::documentdb_core.bson) AND (shard_key_value OPERATOR(pg_catalog.=) '11500'::bigint))
         Node: host=localhost port=58070 dbname=regression
         ->  Bitmap Heap Scan on documentdb_data.documents_11500_1150003 collection
               Output: document
               Recheck Cond: (collection.document OPERATOR(documentdb_api_catalog.@!|) '{ "ikey" : [ { "$numberInt" : "0" }, { "$numberInt" : "1" }, { "$numberInt" : "2" }, { "$numberInt" : "3" }, { "$numberInt" : "4" }, { "$numberInt" : "5" }, { "$numberInt" : "6" }, { "$numberInt" : "7" }, { "$numberInt" : "8" }, { "$numberInt" : "9" }, { "$numberInt" : "10" }, { "$numberInt" : "11" }, { "$numberInt" : "12" }, { "$numberInt" : "13" }, { "$numberInt" : "14" }, { "$numberInt" : "15" }, { "$numberInt" : "16" }, { "$numberInt" : "17" }, { "$numberInt" : "18" }, { "$numberInt" : "19" }, { "$numberInt" : "20" }, { "$numberInt" : "21" }, { "$numberInt" : "22" }, { "$numberInt" : "23" }, { "$numberInt" : "24" }, { "$numberInt" : "25" }, { "$numberInt" : "26" }, { "$numberInt" : "27" }, { "$numberInt" : "28" }, { "$numberInt" : "29" }, { "$numberInt" : "30" }, { "$numberInt" : "31" }, { "$numberInt" : "32" }, { "$numberInt" : "33" }, { "$numberInt" : "34" }, { "$numberInt" : "35" }, { "$numberInt" : "36" }, { "$numberInt" : "37" }, { "$numberInt" : "38" }, { "$numberInt" : "39" }, { "$numberInt" : "40" }, { "$numberInt" : "41" }, { "$numberInt" : "42" }, { "$numberInt" : "43" }, { "$numberInt" : "44" }, { "$numberInt" : "45" }, { "$numberInt" : "46" }, { "$numberInt" : "47" }, { "$numberInt" : "48" }, { "$numberInt" : "49" }, { "$numberInt" : "50" }, { "$numberInt" : "51" }, { "$numberInt" : "52" }, { "$numberInt" : "53" }, { "$numberInt" : "54" }, { "$numberInt" : "55" }, { "$numberInt" : "56" }, { "$numberInt" : "57" }, { "$numberInt" : "58" }, { "$numberInt" : "59" }, { "$numberInt" : "60" }, { "$numberInt" : "61" }, { "$numberInt" : "62" }, { "$numberInt" : "63" }, { "$numberInt" : "64" }, { "$numberInt" : "65" }, { "$numberInt" : "66" }, { "$numberInt" : "67" }, { "$numberInt" : "68" }, { "$numberInt" : "69" }, { "$numberInt" : "70" }, { "$numberInt" : "71" }, { "$numberInt" : "72" }, { "$numberInt" : "73" }, { "$numberInt" : "74" }, { "$numberInt" : "75" }, { "$numberInt" : "76" }, { "$numberInt" : "77" }, { "$numberInt" : "78" }, { "$numberInt" : "79" }, { "$numberInt" : "80" }, { "$numberInt" : "81" }, { "$numberInt" : "82" }, { "$numberInt" : "83" }, { "$numberInt" : "84" }, { "$numberInt" : "85" }, { "$numberInt" : "86" }, { "$numberInt" : "87" }, { "$numberInt" : "88" }, { "$numberInt" : "89" }, { "$numberInt" : "90" }, { "$numberInt" : "91" }, { "$numberInt" : "92" }, { "$numberInt" : "93" }, { "$numberInt" : "94" }, { "$numberInt" : "95" }, { "$numberInt" : "96" }, { "$numberInt" : "97" }, { "$numberInt" : "98" }, { "$numberInt" : "99" }, { "$numberInt" : "100" }, { "$numberInt" : "101" }, { "$numberInt" : "102" }, { "$numberInt" : "103" }, { "$numberInt" : "104" }, { "$numberInt" : "105" }, { "$numberInt" : "106" }, { "$numberInt" : "107" }, { "$numberInt" : "108" }, { "$numberInt" : "109" }, { "$numberInt" : "110" }, { "$numberInt" : "111" }, { "$numberInt" : "112" }, { "$numberInt" : "113" }, { "$numberInt" : "114" }, { "$numberInt" : "115" }, { "$numberInt" : "116" }, { "$numberInt" : "117" }, { "$numberInt" : "118" }, { "$numberInt" : "119" }, { "$numberInt" : "120" }, { "$numberInt" : "121" }, { "$numberInt" : "122" }, { "$numberInt" : "123" }, { "$numberInt" : "124" }, { "$numberInt" : "125" }, { "$numberInt" : "126" }, { "$numberInt" : "127" }, { "$numberInt" : "128" }, { "$numberInt" : "129" }, { "$numberInt" : "130" }, { "$numberInt" : "131" }, { "$numberInt" : "132" }, { "$numberInt" : "133" }, { "$numberInt" : "134" }, { "$numberInt" : "135" }, { "$numberInt" : "136" }, { "$numberInt" : "137" }, { "$numberInt" : "138" }, { "$numberInt" : "139" }, { "$numberInt" : "140" }, { "$numberInt" : "141" }, { "$numberInt" : "142" }, { "$numberInt" : "143" }, { "$numberInt" : "144" }, { "$numberInt" : "145" }, { "$numberInt" : "146" }, { "$numberInt" : "147" }, { "$numberInt" : "148" }, { "$numberInt" : "149" }, { "$numberInt" : "150" }, { "$numberInt" : "151" }, { "$numberInt" : "152" }, { "$numberInt" : "153" }, { "$numberInt" : "154" }, { "$numberInt" : "155" }, { "$numberInt" : "156" }, { "$numberInt" : "157" }, { "$numberInt" : "158" }, { "$numberInt" : "159" }, { "$numberInt" : "160" }, { "$numberInt" : "161" }, { "$numberInt" : "162" }, { "$numberInt" : "163" }, { "$numberInt" : "164" }, { "$numberInt" : "165" }, { "$numberInt" : "166" }, { "$numberInt" : "167" } ] }'::documentdb_core.bson)
               ->  Bitmap Index Scan on ikey_1
                     Index Cond: (collection.document OPERATOR(documentdb_api_catalog.@!|) '{ "ikey" : [ { "$numberInt" : "0" }, { "$numberInt" : "1" }, { "$numberInt" : "2" }, { "$numberInt" : "3" }, { "$numberInt" : "4" }, { "$numberInt" : "5" }, { "$numberInt" : "6" }, { "$numberInt" : "7" }, { "$numberInt" : "8" }, { "$numberInt" : "9" }, { "$numberInt" : "10" }, { "$numberInt" : "11" }, { "$numberInt" : "12" }, { "$numberInt" : "13" }, { "$numberInt" : "14" }, { "$numberInt" : "15" }, { "$numberInt" : "16" }, { "$numberInt" : "17" }, { "$numberInt" : "18" }, { "$numberInt" : "19" }, { "$numberInt" : "20" }, { "$numberInt" : "21" }, { "$numberInt" : "22" }, { "$numberInt" : "23" }, { "$numberInt" : "24" }, { "$numberInt" : "25" }, { "$numberInt" : "26" }, { "$numberInt" : "27" }, { "$numberInt" : "28" }, { "$numberInt" : "29" }, { "$numberInt" : "30" }, { "$numberInt" : "31" }, { "$numberInt" : "32" }, { "$numberInt" : "33" }, { "$numberInt" : "34" }, { "$numberInt" : "35" }, { "$numberInt" : "36" }, { "$numberInt" : "37" }, { "$numberInt" : "38" }, { "$numberInt" : "39" }, { "$numberInt" : "40" }, { "$numberInt" : "41" }, { "$numberInt" : "42" }, { "$numberInt" : "43" }, { "$numberInt" : "44" }, { "$numberInt" : "45" }, { "$numberInt" : "46" }, { "$numberInt" : "47" }, { "$numberInt" : "48" }, { "$numberInt" : "49" }, { "$numberInt" : "50" }, { "$numberInt" : "51" }, { "$numberInt" : "52" }, { "$numberInt" : "53" }, { "$numberInt" : "54" }, { "$numberInt" : "55" }, { "$numberInt" : "56" }, { "$numberInt" : "57" }, { "$numberInt" : "58" }, { "$numberInt" : "59" }, { "$numberInt" : "60" }, { "$numberInt" : "61" }, { "$numberInt" : "62" }, { "$numberInt" : "63" }, { "$numberInt" : "64" }, { "$numberInt" : "65" }, { "$numberInt" : "66" }, { "$numberInt" : "67" }, { "$numberInt" : "68" }, { "$numberInt" : "69" }, { "$numberInt" : "70" }, { "$numberInt" : "71" }, { "$numberInt" : "72" }, { "$numberInt" : "73" }, { "$numberInt" : "74" }, { "$numberInt" : "75" }, { "$numberInt" : "76" }, { "$numberInt" : "77" }, { "$numberInt" : "78" }, { "$numberInt" : "79" }, { "$numberInt" : "80" }, { "$numberInt" : "81" }, { "$numberInt" : "82" }, { "$numberInt" : "83" }, { "$numberInt" : "84" }, { "$numberInt" : "85" }, { "$numberInt" : "86" }, { "$numberInt" : "87" }, { "$numberInt" : "88" }, { "$numberInt" : "89" }, { "$numberInt" : "90" }, { "$numberInt" : "91" }, { "$numberInt" : "92" }, { "$numberInt" : "93" }, { "$numberInt" : "94" }, { "$numberInt" : "95" }, { "$numberInt" : "96" }, { "$numberInt" : "97" }, { "$numberInt" : "98" }, { "$numberInt" : "99" }, { "$numberInt" : "100" }, { "$numberInt" : "101" }, { "$numberInt" : "102" }, { "$numberInt" : "103" }, { "$numberInt" : "104" }, { "$numberInt" : "105" }, { "$numberInt" : "106" }, { "$numberInt" : "107" }, { "$numberInt" : "108" }, { "$numberInt" : "109" }, { "$numberInt" : "110" }, { "$numberInt" : "111" }, { "$numberInt" : "112" }, { "$numberInt" : "113" }, { "$numberInt" : "114" }, { "$numberInt" : "115" }, { "$numberInt" : "116" }, { "$numberInt" : "117" }, { "$numberInt" : "118" }, { "$numberInt" : "119" }, { "$numberInt" : "120" }, { "$numberInt" : "121" }, { "$numberInt" : "122" }, { "$numberInt" : "123" }, { "$numberInt" : "124" }, { "$numberInt" : "125" }, { "$numberInt" : "126" }, { "$numberInt" : "127" }, { "$numberInt" : "128" }, { "$numberInt" : "129" }, { "$numberInt" : "130" }, { "$numberInt" : "131" }, { "$numberInt" : "132" }, { "$numberInt" : "133" }, { "$numberInt" : "134" }, { "$numberInt" : "135" }, { "$numberInt" : "136" }, { "$numberInt" : "137" }, { "$numberInt" : "138" }, { "$numberInt" : "139" }, { "$numberInt" : "140" }, { "$numberInt" : "141" }, { "$numberInt" : "142" }, { "$numberInt" : "143" }, { "$numberInt" : "144" }, { "$numberInt" : "145" }, { "$numberInt" : "146" }, { "$numberInt" : "147" }, { "$numberInt" : "148" }, { "$numberInt" : "149" }, { "$numberInt" : "150" }, { "$numberInt" : "151" }, { "$numberInt" : "152" }, { "$numberInt" : "153" }, { "$numberInt" : "154" }, { "$numberInt" : "155" }, { "$numberInt" : "156" }, { "$numberInt" : "157" }, { "$numberInt" : "158" }, { "$numberInt" : "159" }, { "$numberInt" : "160" }, { "$numberInt" : "161" }, { "$numberInt" : "162" }, { "$numberInt" : "163" }, { "$numberInt" : "164" }, { "$numberInt" : "165" }, { "$numberInt" : "166" }, { "$numberInt" : "167" } ] }'::documentdb_core.bson)
(12 rows)

/* $bitsAllSet (all terms truncated) */
SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$bitsAllSet": { "$binary" : { "base64": "dGhpcyBpcyBhIHRlc3Qgc3RyaW5n", "subType" : "01" } } } }';
                                                                                     document                                                                                      
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "8" }, "ikey" : { "$binary" : { "base64" : "dGhpcyBpcyBhIHRlc3Qgc3RyaW5n", "subType" : "00" } } }
 { "_id" : { "$numberInt" : "10" }, "ikey" : { "$binary" : { "base64" : "dGhpcyBpcyBhIHRlc3Qgc3RyaW5n", "subType" : "01" } }, "item" : "H", "customKey" : { "$numberInt" : "9" } }
(2 rows)

SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$bitsAllSet": { "$binary": { "base64": "YWJvYm9yYQ==", "subType": "05"}} } }';
                                                   document                                                   
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "4" }, "ikey" : { "$binary" : { "base64" : "YWJvYm9yYQ==", "subType" : "05" } } }
(1 row)

SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$bitsAllSet": 1 } }';
                                                                                                 document                                                                                                 
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "1" }, "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "00" } }, "item" : "A" }
 { "_id" : { "$numberInt" : "2" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6IDEsICJiIjogMyB9", "subType" : "01" } } }
 { "_id" : { "$numberInt" : "3" }, "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "04" } } }
 { "_id" : { "$numberInt" : "4" }, "ikey" : { "$binary" : { "base64" : "YWJvYm9yYQ==", "subType" : "05" } } }
 { "_id" : { "$numberInt" : "5" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6IDEsICJiIjogMyB9", "subType" : "06" } } }
 { "_id" : { "$numberInt" : "6" }, "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "07" } }, "item" : "F", "customKey" : { "$numberInt" : "6" } }
 { "_id" : { "$numberInt" : "7" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6ICIxMjM0NSIsICJiIjogMTIzMTIzMTIzMjExMjMxIH0=", "subType" : "01" } }, "item" : "G", "customKey" : { "$numberInt" : "6" } }
 { "_id" : { "$numberInt" : "9" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6ICIxMjM0NSIsICJiIjogMTIzMTIzMTIzMjExMjMxIH0=", "subType" : "04" } }, "item" : "H", "customKey" : { "$numberInt" : "8" } }
(8 rows)

SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$bitsAllSet": 32 } }';
                                                                                                 document                                                                                                 
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "1" }, "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "00" } }, "item" : "A" }
 { "_id" : { "$numberInt" : "2" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6IDEsICJiIjogMyB9", "subType" : "01" } } }
 { "_id" : { "$numberInt" : "3" }, "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "04" } } }
 { "_id" : { "$numberInt" : "4" }, "ikey" : { "$binary" : { "base64" : "YWJvYm9yYQ==", "subType" : "05" } } }
 { "_id" : { "$numberInt" : "5" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6IDEsICJiIjogMyB9", "subType" : "06" } } }
 { "_id" : { "$numberInt" : "6" }, "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "07" } }, "item" : "F", "customKey" : { "$numberInt" : "6" } }
 { "_id" : { "$numberInt" : "7" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6ICIxMjM0NSIsICJiIjogMTIzMTIzMTIzMjExMjMxIH0=", "subType" : "01" } }, "item" : "G", "customKey" : { "$numberInt" : "6" } }
 { "_id" : { "$numberInt" : "8" }, "ikey" : { "$binary" : { "base64" : "dGhpcyBpcyBhIHRlc3Qgc3RyaW5n", "subType" : "00" } } }
 { "_id" : { "$numberInt" : "9" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6ICIxMjM0NSIsICJiIjogMTIzMTIzMTIzMjExMjMxIH0=", "subType" : "04" } }, "item" : "H", "customKey" : { "$numberInt" : "8" } }
 { "_id" : { "$numberInt" : "10" }, "ikey" : { "$binary" : { "base64" : "dGhpcyBpcyBhIHRlc3Qgc3RyaW5n", "subType" : "01" } }, "item" : "H", "customKey" : { "$numberInt" : "9" } }
(10 rows)

SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$bitsAllSet": 54 } }';
 document 
---------------------------------------------------------------------
(0 rows)

SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$bitsAllSet": { "$binary": { "base64": "////////////////////////////", "subType": "02"} } } }';
 document 
---------------------------------------------------------------------
(0 rows)

EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$bitsAllSet": { "$binary" : { "base64": "dGhpcyBpcyBhIHRlc3Qgc3RyaW5n", "subType" : "01" } } } }';
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                QUERY PLAN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
---------------------------------------------------------------------
 Custom Scan (Citus Adaptive)
   Output: remote_scan.document
   Task Count: 1
   Tasks Shown: All
   ->  Task
         Query: SELECT document FROM documentdb_data.documents_11500_1150003 collection WHERE (documentdb_api_catalog.bson_dollar_bits_all_set(document, '{ "ikey" : [ { "$numberInt" : "2" }, { "$numberInt" : "4" }, { "$numberInt" : "5" }, { "$numberInt" : "6" }, { "$numberInt" : "11" }, { "$numberInt" : "13" }, { "$numberInt" : "14" }, { "$numberInt" : "16" }, { "$numberInt" : "19" }, { "$numberInt" : "21" }, { "$numberInt" : "22" }, { "$numberInt" : "24" }, { "$numberInt" : "25" }, { "$numberInt" : "28" }, { "$numberInt" : "29" }, { "$numberInt" : "30" }, { "$numberInt" : "37" }, { "$numberInt" : "40" }, { "$numberInt" : "43" }, { "$numberInt" : "45" }, { "$numberInt" : "46" }, { "$numberInt" : "48" }, { "$numberInt" : "49" }, { "$numberInt" : "52" }, { "$numberInt" : "53" }, { "$numberInt" : "54" }, { "$numberInt" : "61" }, { "$numberInt" : "64" }, { "$numberInt" : "69" }, { "$numberInt" : "70" }, { "$numberInt" : "77" }, { "$numberInt" : "82" }, { "$numberInt" : "84" }, { "$numberInt" : "85" }, { "$numberInt" : "86" }, { "$numberInt" : "88" }, { "$numberInt" : "90" }, { "$numberInt" : "93" }, { "$numberInt" : "94" }, { "$numberInt" : "96" }, { "$numberInt" : "97" }, { "$numberInt" : "100" }, { "$numberInt" : "101" }, { "$numberInt" : "102" }, { "$numberInt" : "106" }, { "$numberInt" : "108" }, { "$numberInt" : "109" }, { "$numberInt" : "110" }, { "$numberInt" : "117" }, { "$numberInt" : "120" }, { "$numberInt" : "121" }, { "$numberInt" : "124" }, { "$numberInt" : "125" }, { "$numberInt" : "126" }, { "$numberInt" : "130" }, { "$numberInt" : "132" }, { "$numberInt" : "133" }, { "$numberInt" : "134" }, { "$numberInt" : "137" }, { "$numberInt" : "140" }, { "$numberInt" : "141" }, { "$numberInt" : "142" }, { "$numberInt" : "144" }, { "$numberInt" : "147" }, { "$numberInt" : "149" }, { "$numberInt" : "150" }, { "$numberInt" : "153" }, { "$numberInt" : "154" }, { "$numberInt" : "155" }, { "$numberInt" : "157" }, { "$numberInt" : "158" }, { "$numberInt" : "160" }, { "$numberInt" : "161" }, { "$numberInt" : "162" }, { "$numberInt" : "165" }, { "$numberInt" : "166" } ] }'::documentdb_core.bson) AND (shard_key_value OPERATOR(pg_catalog.=) '11500'::bigint))
         Node: host=localhost port=58070 dbname=regression
         ->  Bitmap Heap Scan on documentdb_data.documents_11500_1150003 collection
               Output: document
               Recheck Cond: (collection.document OPERATOR(documentdb_api_catalog.@&) '{ "ikey" : [ { "$numberInt" : "2" }, { "$numberInt" : "4" }, { "$numberInt" : "5" }, { "$numberInt" : "6" }, { "$numberInt" : "11" }, { "$numberInt" : "13" }, { "$numberInt" : "14" }, { "$numberInt" : "16" }, { "$numberInt" : "19" }, { "$numberInt" : "21" }, { "$numberInt" : "22" }, { "$numberInt" : "24" }, { "$numberInt" : "25" }, { "$numberInt" : "28" }, { "$numberInt" : "29" }, { "$numberInt" : "30" }, { "$numberInt" : "37" }, { "$numberInt" : "40" }, { "$numberInt" : "43" }, { "$numberInt" : "45" }, { "$numberInt" : "46" }, { "$numberInt" : "48" }, { "$numberInt" : "49" }, { "$numberInt" : "52" }, { "$numberInt" : "53" }, { "$numberInt" : "54" }, { "$numberInt" : "61" }, { "$numberInt" : "64" }, { "$numberInt" : "69" }, { "$numberInt" : "70" }, { "$numberInt" : "77" }, { "$numberInt" : "82" }, { "$numberInt" : "84" }, { "$numberInt" : "85" }, { "$numberInt" : "86" }, { "$numberInt" : "88" }, { "$numberInt" : "90" }, { "$numberInt" : "93" }, { "$numberInt" : "94" }, { "$numberInt" : "96" }, { "$numberInt" : "97" }, { "$numberInt" : "100" }, { "$numberInt" : "101" }, { "$numberInt" : "102" }, { "$numberInt" : "106" }, { "$numberInt" : "108" }, { "$numberInt" : "109" }, { "$numberInt" : "110" }, { "$numberInt" : "117" }, { "$numberInt" : "120" }, { "$numberInt" : "121" }, { "$numberInt" : "124" }, { "$numberInt" : "125" }, { "$numberInt" : "126" }, { "$numberInt" : "130" }, { "$numberInt" : "132" }, { "$numberInt" : "133" }, { "$numberInt" : "134" }, { "$numberInt" : "137" }, { "$numberInt" : "140" }, { "$numberInt" : "141" }, { "$numberInt" : "142" }, { "$numberInt" : "144" }, { "$numberInt" : "147" }, { "$numberInt" : "149" }, { "$numberInt" : "150" }, { "$numberInt" : "153" }, { "$numberInt" : "154" }, { "$numberInt" : "155" }, { "$numberInt" : "157" }, { "$numberInt" : "158" }, { "$numberInt" : "160" }, { "$numberInt" : "161" }, { "$numberInt" : "162" }, { "$numberInt" : "165" }, { "$numberInt" : "166" } ] }'::documentdb_core.bson)
               ->  Bitmap Index Scan on ikey_1
                     Index Cond: (collection.document OPERATOR(documentdb_api_catalog.@&) '{ "ikey" : [ { "$numberInt" : "2" }, { "$numberInt" : "4" }, { "$numberInt" : "5" }, { "$numberInt" : "6" }, { "$numberInt" : "11" }, { "$numberInt" : "13" }, { "$numberInt" : "14" }, { "$numberInt" : "16" }, { "$numberInt" : "19" }, { "$numberInt" : "21" }, { "$numberInt" : "22" }, { "$numberInt" : "24" }, { "$numberInt" : "25" }, { "$numberInt" : "28" }, { "$numberInt" : "29" }, { "$numberInt" : "30" }, { "$numberInt" : "37" }, { "$numberInt" : "40" }, { "$numberInt" : "43" }, { "$numberInt" : "45" }, { "$numberInt" : "46" }, { "$numberInt" : "48" }, { "$numberInt" : "49" }, { "$numberInt" : "52" }, { "$numberInt" : "53" }, { "$numberInt" : "54" }, { "$numberInt" : "61" }, { "$numberInt" : "64" }, { "$numberInt" : "69" }, { "$numberInt" : "70" }, { "$numberInt" : "77" }, { "$numberInt" : "82" }, { "$numberInt" : "84" }, { "$numberInt" : "85" }, { "$numberInt" : "86" }, { "$numberInt" : "88" }, { "$numberInt" : "90" }, { "$numberInt" : "93" }, { "$numberInt" : "94" }, { "$numberInt" : "96" }, { "$numberInt" : "97" }, { "$numberInt" : "100" }, { "$numberInt" : "101" }, { "$numberInt" : "102" }, { "$numberInt" : "106" }, { "$numberInt" : "108" }, { "$numberInt" : "109" }, { "$numberInt" : "110" }, { "$numberInt" : "117" }, { "$numberInt" : "120" }, { "$numberInt" : "121" }, { "$numberInt" : "124" }, { "$numberInt" : "125" }, { "$numberInt" : "126" }, { "$numberInt" : "130" }, { "$numberInt" : "132" }, { "$numberInt" : "133" }, { "$numberInt" : "134" }, { "$numberInt" : "137" }, { "$numberInt" : "140" }, { "$numberInt" : "141" }, { "$numberInt" : "142" }, { "$numberInt" : "144" }, { "$numberInt" : "147" }, { "$numberInt" : "149" }, { "$numberInt" : "150" }, { "$numberInt" : "153" }, { "$numberInt" : "154" }, { "$numberInt" : "155" }, { "$numberInt" : "157" }, { "$numberInt" : "158" }, { "$numberInt" : "160" }, { "$numberInt" : "161" }, { "$numberInt" : "162" }, { "$numberInt" : "165" }, { "$numberInt" : "166" } ] }'::documentdb_core.bson)
(12 rows)

EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$bitsAllSet": { "$binary": { "base64": "YWJvYm9yYQ==", "subType": "05"}} } }';
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       QUERY PLAN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
---------------------------------------------------------------------
 Custom Scan (Citus Adaptive)
   Output: remote_scan.document
   Task Count: 1
   Tasks Shown: All
   ->  Task
         Query: SELECT document FROM documentdb_data.documents_11500_1150003 collection WHERE (documentdb_api_catalog.bson_dollar_bits_all_set(document, '{ "ikey" : [ { "$numberInt" : "0" }, { "$numberInt" : "5" }, { "$numberInt" : "6" }, { "$numberInt" : "9" }, { "$numberInt" : "13" }, { "$numberInt" : "14" }, { "$numberInt" : "16" }, { "$numberInt" : "17" }, { "$numberInt" : "18" }, { "$numberInt" : "19" }, { "$numberInt" : "21" }, { "$numberInt" : "22" }, { "$numberInt" : "25" }, { "$numberInt" : "29" }, { "$numberInt" : "30" }, { "$numberInt" : "32" }, { "$numberInt" : "33" }, { "$numberInt" : "34" }, { "$numberInt" : "35" }, { "$numberInt" : "37" }, { "$numberInt" : "38" }, { "$numberInt" : "41" }, { "$numberInt" : "44" }, { "$numberInt" : "45" }, { "$numberInt" : "46" }, { "$numberInt" : "48" }, { "$numberInt" : "53" }, { "$numberInt" : "54" } ] }'::documentdb_core.bson) AND (shard_key_value OPERATOR(pg_catalog.=) '11500'::bigint))
         Node: host=localhost port=58070 dbname=regression
         ->  Bitmap Heap Scan on documentdb_data.documents_11500_1150003 collection
               Output: document
               Recheck Cond: (collection.document OPERATOR(documentdb_api_catalog.@&) '{ "ikey" : [ { "$numberInt" : "0" }, { "$numberInt" : "5" }, { "$numberInt" : "6" }, { "$numberInt" : "9" }, { "$numberInt" : "13" }, { "$numberInt" : "14" }, { "$numberInt" : "16" }, { "$numberInt" : "17" }, { "$numberInt" : "18" }, { "$numberInt" : "19" }, { "$numberInt" : "21" }, { "$numberInt" : "22" }, { "$numberInt" : "25" }, { "$numberInt" : "29" }, { "$numberInt" : "30" }, { "$numberInt" : "32" }, { "$numberInt" : "33" }, { "$numberInt" : "34" }, { "$numberInt" : "35" }, { "$numberInt" : "37" }, { "$numberInt" : "38" }, { "$numberInt" : "41" }, { "$numberInt" : "44" }, { "$numberInt" : "45" }, { "$numberInt" : "46" }, { "$numberInt" : "48" }, { "$numberInt" : "53" }, { "$numberInt" : "54" } ] }'::documentdb_core.bson)
               ->  Bitmap Index Scan on ikey_1
                     Index Cond: (collection.document OPERATOR(documentdb_api_catalog.@&) '{ "ikey" : [ { "$numberInt" : "0" }, { "$numberInt" : "5" }, { "$numberInt" : "6" }, { "$numberInt" : "9" }, { "$numberInt" : "13" }, { "$numberInt" : "14" }, { "$numberInt" : "16" }, { "$numberInt" : "17" }, { "$numberInt" : "18" }, { "$numberInt" : "19" }, { "$numberInt" : "21" }, { "$numberInt" : "22" }, { "$numberInt" : "25" }, { "$numberInt" : "29" }, { "$numberInt" : "30" }, { "$numberInt" : "32" }, { "$numberInt" : "33" }, { "$numberInt" : "34" }, { "$numberInt" : "35" }, { "$numberInt" : "37" }, { "$numberInt" : "38" }, { "$numberInt" : "41" }, { "$numberInt" : "44" }, { "$numberInt" : "45" }, { "$numberInt" : "46" }, { "$numberInt" : "48" }, { "$numberInt" : "53" }, { "$numberInt" : "54" } ] }'::documentdb_core.bson)
(12 rows)

EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$bitsAllSet": 1 } }';
                                                                                                                                       QUERY PLAN                                                                                                                                       
---------------------------------------------------------------------
 Custom Scan (Citus Adaptive)
   Output: remote_scan.document
   Task Count: 1
   Tasks Shown: All
   ->  Task
         Query: SELECT document FROM documentdb_data.documents_11500_1150003 collection WHERE (documentdb_api_catalog.bson_dollar_bits_all_set(document, '{ "ikey" : [ { "$numberInt" : "0" } ] }'::documentdb_core.bson) AND (shard_key_value OPERATOR(pg_catalog.=) '11500'::bigint))
         Node: host=localhost port=58070 dbname=regression
         ->  Bitmap Heap Scan on documentdb_data.documents_11500_1150003 collection
               Output: document
               Recheck Cond: (collection.document OPERATOR(documentdb_api_catalog.@&) '{ "ikey" : [ { "$numberInt" : "0" } ] }'::documentdb_core.bson)
               ->  Bitmap Index Scan on ikey_1
                     Index Cond: (collection.document OPERATOR(documentdb_api_catalog.@&) '{ "ikey" : [ { "$numberInt" : "0" } ] }'::documentdb_core.bson)
(12 rows)

EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$bitsAllSet": 32 } }';
                                                                                                                                       QUERY PLAN                                                                                                                                       
---------------------------------------------------------------------
 Custom Scan (Citus Adaptive)
   Output: remote_scan.document
   Task Count: 1
   Tasks Shown: All
   ->  Task
         Query: SELECT document FROM documentdb_data.documents_11500_1150003 collection WHERE (documentdb_api_catalog.bson_dollar_bits_all_set(document, '{ "ikey" : [ { "$numberInt" : "5" } ] }'::documentdb_core.bson) AND (shard_key_value OPERATOR(pg_catalog.=) '11500'::bigint))
         Node: host=localhost port=58070 dbname=regression
         ->  Bitmap Heap Scan on documentdb_data.documents_11500_1150003 collection
               Output: document
               Recheck Cond: (collection.document OPERATOR(documentdb_api_catalog.@&) '{ "ikey" : [ { "$numberInt" : "5" } ] }'::documentdb_core.bson)
               ->  Bitmap Index Scan on ikey_1
                     Index Cond: (collection.document OPERATOR(documentdb_api_catalog.@&) '{ "ikey" : [ { "$numberInt" : "5" } ] }'::documentdb_core.bson)
(12 rows)

EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$bitsAllSet": 54 } }';
                                                                                                                                                                           QUERY PLAN                                                                                                                                                                           
---------------------------------------------------------------------
 Custom Scan (Citus Adaptive)
   Output: remote_scan.document
   Task Count: 1
   Tasks Shown: All
   ->  Task
         Query: SELECT document FROM documentdb_data.documents_11500_1150003 collection WHERE (documentdb_api_catalog.bson_dollar_bits_all_set(document, '{ "ikey" : [ { "$numberInt" : "1" }, { "$numberInt" : "2" }, { "$numberInt" : "4" }, { "$numberInt" : "5" } ] }'::documentdb_core.bson) AND (shard_key_value OPERATOR(pg_catalog.=) '11500'::bigint))
         Node: host=localhost port=58070 dbname=regression
         ->  Bitmap Heap Scan on documentdb_data.documents_11500_1150003 collection
               Output: document
               Recheck Cond: (collection.document OPERATOR(documentdb_api_catalog.@&) '{ "ikey" : [ { "$numberInt" : "1" }, { "$numberInt" : "2" }, { "$numberInt" : "4" }, { "$numberInt" : "5" } ] }'::documentdb_core.bson)
               ->  Bitmap Index Scan on ikey_1
                     Index Cond: (collection.document OPERATOR(documentdb_api_catalog.@&) '{ "ikey" : [ { "$numberInt" : "1" }, { "$numberInt" : "2" }, { "$numberInt" : "4" }, { "$numberInt" : "5" } ] }'::documentdb_core.bson)
(12 rows)

EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$bitsAllSet": { "$binary": { "base64": "////////////////////////////", "subType": "02"} } } }';
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            QUERY PLAN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
---------------------------------------------------------------------
 Custom Scan (Citus Adaptive)
   Output: remote_scan.document
   Task Count: 1
   Tasks Shown: All
   ->  Task
         Query: SELECT document FROM documentdb_data.documents_11500_1150003 collection WHERE (documentdb_api_catalog.bson_dollar_bits_all_set(document, '{ "ikey" : [ { "$numberInt" : "0" }, { "$numberInt" : "1" }, { "$numberInt" : "2" }, { "$numberInt" : "3" }, { "$numberInt" : "4" }, { "$numberInt" : "5" }, { "$numberInt" : "6" }, { "$numberInt" : "7" }, { "$numberInt" : "8" }, { "$numberInt" : "9" }, { "$numberInt" : "10" }, { "$numberInt" : "11" }, { "$numberInt" : "12" }, { "$numberInt" : "13" }, { "$numberInt" : "14" }, { "$numberInt" : "15" }, { "$numberInt" : "16" }, { "$numberInt" : "17" }, { "$numberInt" : "18" }, { "$numberInt" : "19" }, { "$numberInt" : "20" }, { "$numberInt" : "21" }, { "$numberInt" : "22" }, { "$numberInt" : "23" }, { "$numberInt" : "24" }, { "$numberInt" : "25" }, { "$numberInt" : "26" }, { "$numberInt" : "27" }, { "$numberInt" : "28" }, { "$numberInt" : "29" }, { "$numberInt" : "30" }, { "$numberInt" : "31" }, { "$numberInt" : "32" }, { "$numberInt" : "33" }, { "$numberInt" : "34" }, { "$numberInt" : "35" }, { "$numberInt" : "36" }, { "$numberInt" : "37" }, { "$numberInt" : "38" }, { "$numberInt" : "39" }, { "$numberInt" : "40" }, { "$numberInt" : "41" }, { "$numberInt" : "42" }, { "$numberInt" : "43" }, { "$numberInt" : "44" }, { "$numberInt" : "45" }, { "$numberInt" : "46" }, { "$numberInt" : "47" }, { "$numberInt" : "48" }, { "$numberInt" : "49" }, { "$numberInt" : "50" }, { "$numberInt" : "51" }, { "$numberInt" : "52" }, { "$numberInt" : "53" }, { "$numberInt" : "54" }, { "$numberInt" : "55" }, { "$numberInt" : "56" }, { "$numberInt" : "57" }, { "$numberInt" : "58" }, { "$numberInt" : "59" }, { "$numberInt" : "60" }, { "$numberInt" : "61" }, { "$numberInt" : "62" }, { "$numberInt" : "63" }, { "$numberInt" : "64" }, { "$numberInt" : "65" }, { "$numberInt" : "66" }, { "$numberInt" : "67" }, { "$numberInt" : "68" }, { "$numberInt" : "69" }, { "$numberInt" : "70" }, { "$numberInt" : "71" }, { "$numberInt" : "72" }, { "$numberInt" : "73" }, { "$numberInt" : "74" }, { "$numberInt" : "75" }, { "$numberInt" : "76" }, { "$numberInt" : "77" }, { "$numberInt" : "78" }, { "$numberInt" : "79" }, { "$numberInt" : "80" }, { "$numberInt" : "81" }, { "$numberInt" : "82" }, { "$numberInt" : "83" }, { "$numberInt" : "84" }, { "$numberInt" : "85" }, { "$numberInt" : "86" }, { "$numberInt" : "87" }, { "$numberInt" : "88" }, { "$numberInt" : "89" }, { "$numberInt" : "90" }, { "$numberInt" : "91" }, { "$numberInt" : "92" }, { "$numberInt" : "93" }, { "$numberInt" : "94" }, { "$numberInt" : "95" }, { "$numberInt" : "96" }, { "$numberInt" : "97" }, { "$numberInt" : "98" }, { "$numberInt" : "99" }, { "$numberInt" : "100" }, { "$numberInt" : "101" }, { "$numberInt" : "102" }, { "$numberInt" : "103" }, { "$numberInt" : "104" }, { "$numberInt" : "105" }, { "$numberInt" : "106" }, { "$numberInt" : "107" }, { "$numberInt" : "108" }, { "$numberInt" : "109" }, { "$numberInt" : "110" }, { "$numberInt" : "111" }, { "$numberInt" : "112" }, { "$numberInt" : "113" }, { "$numberInt" : "114" }, { "$numberInt" : "115" }, { "$numberInt" : "116" }, { "$numberInt" : "117" }, { "$numberInt" : "118" }, { "$numberInt" : "119" }, { "$numberInt" : "120" }, { "$numberInt" : "121" }, { "$numberInt" : "122" }, { "$numberInt" : "123" }, { "$numberInt" : "124" }, { "$numberInt" : "125" }, { "$numberInt" : "126" }, { "$numberInt" : "127" }, { "$numberInt" : "128" }, { "$numberInt" : "129" }, { "$numberInt" : "130" }, { "$numberInt" : "131" }, { "$numberInt" : "132" }, { "$numberInt" : "133" }, { "$numberInt" : "134" }, { "$numberInt" : "135" }, { "$numberInt" : "136" }, { "$numberInt" : "137" }, { "$numberInt" : "138" }, { "$numberInt" : "139" }, { "$numberInt" : "140" }, { "$numberInt" : "141" }, { "$numberInt" : "142" }, { "$numberInt" : "143" }, { "$numberInt" : "144" }, { "$numberInt" : "145" }, { "$numberInt" : "146" }, { "$numberInt" : "147" }, { "$numberInt" : "148" }, { "$numberInt" : "149" }, { "$numberInt" : "150" }, { "$numberInt" : "151" }, { "$numberInt" : "152" }, { "$numberInt" : "153" }, { "$numberInt" : "154" }, { "$numberInt" : "155" }, { "$numberInt" : "156" }, { "$numberInt" : "157" }, { "$numberInt" : "158" }, { "$numberInt" : "159" }, { "$numberInt" : "160" }, { "$numberInt" : "161" }, { "$numberInt" : "162" }, { "$numberInt" : "163" }, { "$numberInt" : "164" }, { "$numberInt" : "165" }, { "$numberInt" : "166" }, { "$numberInt" : "167" } ] }'::documentdb_core.bson) AND (shard_key_value OPERATOR(pg_catalog.=) '11500'::bigint))
         Node: host=localhost port=58070 dbname=regression
         ->  Bitmap Heap Scan on documentdb_data.documents_11500_1150003 collection
               Output: document
               Recheck Cond: (collection.document OPERATOR(documentdb_api_catalog.@&) '{ "ikey" : [ { "$numberInt" : "0" }, { "$numberInt" : "1" }, { "$numberInt" : "2" }, { "$numberInt" : "3" }, { "$numberInt" : "4" }, { "$numberInt" : "5" }, { "$numberInt" : "6" }, { "$numberInt" : "7" }, { "$numberInt" : "8" }, { "$numberInt" : "9" }, { "$numberInt" : "10" }, { "$numberInt" : "11" }, { "$numberInt" : "12" }, { "$numberInt" : "13" }, { "$numberInt" : "14" }, { "$numberInt" : "15" }, { "$numberInt" : "16" }, { "$numberInt" : "17" }, { "$numberInt" : "18" }, { "$numberInt" : "19" }, { "$numberInt" : "20" }, { "$numberInt" : "21" }, { "$numberInt" : "22" }, { "$numberInt" : "23" }, { "$numberInt" : "24" }, { "$numberInt" : "25" }, { "$numberInt" : "26" }, { "$numberInt" : "27" }, { "$numberInt" : "28" }, { "$numberInt" : "29" }, { "$numberInt" : "30" }, { "$numberInt" : "31" }, { "$numberInt" : "32" }, { "$numberInt" : "33" }, { "$numberInt" : "34" }, { "$numberInt" : "35" }, { "$numberInt" : "36" }, { "$numberInt" : "37" }, { "$numberInt" : "38" }, { "$numberInt" : "39" }, { "$numberInt" : "40" }, { "$numberInt" : "41" }, { "$numberInt" : "42" }, { "$numberInt" : "43" }, { "$numberInt" : "44" }, { "$numberInt" : "45" }, { "$numberInt" : "46" }, { "$numberInt" : "47" }, { "$numberInt" : "48" }, { "$numberInt" : "49" }, { "$numberInt" : "50" }, { "$numberInt" : "51" }, { "$numberInt" : "52" }, { "$numberInt" : "53" }, { "$numberInt" : "54" }, { "$numberInt" : "55" }, { "$numberInt" : "56" }, { "$numberInt" : "57" }, { "$numberInt" : "58" }, { "$numberInt" : "59" }, { "$numberInt" : "60" }, { "$numberInt" : "61" }, { "$numberInt" : "62" }, { "$numberInt" : "63" }, { "$numberInt" : "64" }, { "$numberInt" : "65" }, { "$numberInt" : "66" }, { "$numberInt" : "67" }, { "$numberInt" : "68" }, { "$numberInt" : "69" }, { "$numberInt" : "70" }, { "$numberInt" : "71" }, { "$numberInt" : "72" }, { "$numberInt" : "73" }, { "$numberInt" : "74" }, { "$numberInt" : "75" }, { "$numberInt" : "76" }, { "$numberInt" : "77" }, { "$numberInt" : "78" }, { "$numberInt" : "79" }, { "$numberInt" : "80" }, { "$numberInt" : "81" }, { "$numberInt" : "82" }, { "$numberInt" : "83" }, { "$numberInt" : "84" }, { "$numberInt" : "85" }, { "$numberInt" : "86" }, { "$numberInt" : "87" }, { "$numberInt" : "88" }, { "$numberInt" : "89" }, { "$numberInt" : "90" }, { "$numberInt" : "91" }, { "$numberInt" : "92" }, { "$numberInt" : "93" }, { "$numberInt" : "94" }, { "$numberInt" : "95" }, { "$numberInt" : "96" }, { "$numberInt" : "97" }, { "$numberInt" : "98" }, { "$numberInt" : "99" }, { "$numberInt" : "100" }, { "$numberInt" : "101" }, { "$numberInt" : "102" }, { "$numberInt" : "103" }, { "$numberInt" : "104" }, { "$numberInt" : "105" }, { "$numberInt" : "106" }, { "$numberInt" : "107" }, { "$numberInt" : "108" }, { "$numberInt" : "109" }, { "$numberInt" : "110" }, { "$numberInt" : "111" }, { "$numberInt" : "112" }, { "$numberInt" : "113" }, { "$numberInt" : "114" }, { "$numberInt" : "115" }, { "$numberInt" : "116" }, { "$numberInt" : "117" }, { "$numberInt" : "118" }, { "$numberInt" : "119" }, { "$numberInt" : "120" }, { "$numberInt" : "121" }, { "$numberInt" : "122" }, { "$numberInt" : "123" }, { "$numberInt" : "124" }, { "$numberInt" : "125" }, { "$numberInt" : "126" }, { "$numberInt" : "127" }, { "$numberInt" : "128" }, { "$numberInt" : "129" }, { "$numberInt" : "130" }, { "$numberInt" : "131" }, { "$numberInt" : "132" }, { "$numberInt" : "133" }, { "$numberInt" : "134" }, { "$numberInt" : "135" }, { "$numberInt" : "136" }, { "$numberInt" : "137" }, { "$numberInt" : "138" }, { "$numberInt" : "139" }, { "$numberInt" : "140" }, { "$numberInt" : "141" }, { "$numberInt" : "142" }, { "$numberInt" : "143" }, { "$numberInt" : "144" }, { "$numberInt" : "145" }, { "$numberInt" : "146" }, { "$numberInt" : "147" }, { "$numberInt" : "148" }, { "$numberInt" : "149" }, { "$numberInt" : "150" }, { "$numberInt" : "151" }, { "$numberInt" : "152" }, { "$numberInt" : "153" }, { "$numberInt" : "154" }, { "$numberInt" : "155" }, { "$numberInt" : "156" }, { "$numberInt" : "157" }, { "$numberInt" : "158" }, { "$numberInt" : "159" }, { "$numberInt" : "160" }, { "$numberInt" : "161" }, { "$numberInt" : "162" }, { "$numberInt" : "163" }, { "$numberInt" : "164" }, { "$numberInt" : "165" }, { "$numberInt" : "166" }, { "$numberInt" : "167" } ] }'::documentdb_core.bson)
               ->  Bitmap Index Scan on ikey_1
                     Index Cond: (collection.document OPERATOR(documentdb_api_catalog.@&) '{ "ikey" : [ { "$numberInt" : "0" }, { "$numberInt" : "1" }, { "$numberInt" : "2" }, { "$numberInt" : "3" }, { "$numberInt" : "4" }, { "$numberInt" : "5" }, { "$numberInt" : "6" }, { "$numberInt" : "7" }, { "$numberInt" : "8" }, { "$numberInt" : "9" }, { "$numberInt" : "10" }, { "$numberInt" : "11" }, { "$numberInt" : "12" }, { "$numberInt" : "13" }, { "$numberInt" : "14" }, { "$numberInt" : "15" }, { "$numberInt" : "16" }, { "$numberInt" : "17" }, { "$numberInt" : "18" }, { "$numberInt" : "19" }, { "$numberInt" : "20" }, { "$numberInt" : "21" }, { "$numberInt" : "22" }, { "$numberInt" : "23" }, { "$numberInt" : "24" }, { "$numberInt" : "25" }, { "$numberInt" : "26" }, { "$numberInt" : "27" }, { "$numberInt" : "28" }, { "$numberInt" : "29" }, { "$numberInt" : "30" }, { "$numberInt" : "31" }, { "$numberInt" : "32" }, { "$numberInt" : "33" }, { "$numberInt" : "34" }, { "$numberInt" : "35" }, { "$numberInt" : "36" }, { "$numberInt" : "37" }, { "$numberInt" : "38" }, { "$numberInt" : "39" }, { "$numberInt" : "40" }, { "$numberInt" : "41" }, { "$numberInt" : "42" }, { "$numberInt" : "43" }, { "$numberInt" : "44" }, { "$numberInt" : "45" }, { "$numberInt" : "46" }, { "$numberInt" : "47" }, { "$numberInt" : "48" }, { "$numberInt" : "49" }, { "$numberInt" : "50" }, { "$numberInt" : "51" }, { "$numberInt" : "52" }, { "$numberInt" : "53" }, { "$numberInt" : "54" }, { "$numberInt" : "55" }, { "$numberInt" : "56" }, { "$numberInt" : "57" }, { "$numberInt" : "58" }, { "$numberInt" : "59" }, { "$numberInt" : "60" }, { "$numberInt" : "61" }, { "$numberInt" : "62" }, { "$numberInt" : "63" }, { "$numberInt" : "64" }, { "$numberInt" : "65" }, { "$numberInt" : "66" }, { "$numberInt" : "67" }, { "$numberInt" : "68" }, { "$numberInt" : "69" }, { "$numberInt" : "70" }, { "$numberInt" : "71" }, { "$numberInt" : "72" }, { "$numberInt" : "73" }, { "$numberInt" : "74" }, { "$numberInt" : "75" }, { "$numberInt" : "76" }, { "$numberInt" : "77" }, { "$numberInt" : "78" }, { "$numberInt" : "79" }, { "$numberInt" : "80" }, { "$numberInt" : "81" }, { "$numberInt" : "82" }, { "$numberInt" : "83" }, { "$numberInt" : "84" }, { "$numberInt" : "85" }, { "$numberInt" : "86" }, { "$numberInt" : "87" }, { "$numberInt" : "88" }, { "$numberInt" : "89" }, { "$numberInt" : "90" }, { "$numberInt" : "91" }, { "$numberInt" : "92" }, { "$numberInt" : "93" }, { "$numberInt" : "94" }, { "$numberInt" : "95" }, { "$numberInt" : "96" }, { "$numberInt" : "97" }, { "$numberInt" : "98" }, { "$numberInt" : "99" }, { "$numberInt" : "100" }, { "$numberInt" : "101" }, { "$numberInt" : "102" }, { "$numberInt" : "103" }, { "$numberInt" : "104" }, { "$numberInt" : "105" }, { "$numberInt" : "106" }, { "$numberInt" : "107" }, { "$numberInt" : "108" }, { "$numberInt" : "109" }, { "$numberInt" : "110" }, { "$numberInt" : "111" }, { "$numberInt" : "112" }, { "$numberInt" : "113" }, { "$numberInt" : "114" }, { "$numberInt" : "115" }, { "$numberInt" : "116" }, { "$numberInt" : "117" }, { "$numberInt" : "118" }, { "$numberInt" : "119" }, { "$numberInt" : "120" }, { "$numberInt" : "121" }, { "$numberInt" : "122" }, { "$numberInt" : "123" }, { "$numberInt" : "124" }, { "$numberInt" : "125" }, { "$numberInt" : "126" }, { "$numberInt" : "127" }, { "$numberInt" : "128" }, { "$numberInt" : "129" }, { "$numberInt" : "130" }, { "$numberInt" : "131" }, { "$numberInt" : "132" }, { "$numberInt" : "133" }, { "$numberInt" : "134" }, { "$numberInt" : "135" }, { "$numberInt" : "136" }, { "$numberInt" : "137" }, { "$numberInt" : "138" }, { "$numberInt" : "139" }, { "$numberInt" : "140" }, { "$numberInt" : "141" }, { "$numberInt" : "142" }, { "$numberInt" : "143" }, { "$numberInt" : "144" }, { "$numberInt" : "145" }, { "$numberInt" : "146" }, { "$numberInt" : "147" }, { "$numberInt" : "148" }, { "$numberInt" : "149" }, { "$numberInt" : "150" }, { "$numberInt" : "151" }, { "$numberInt" : "152" }, { "$numberInt" : "153" }, { "$numberInt" : "154" }, { "$numberInt" : "155" }, { "$numberInt" : "156" }, { "$numberInt" : "157" }, { "$numberInt" : "158" }, { "$numberInt" : "159" }, { "$numberInt" : "160" }, { "$numberInt" : "161" }, { "$numberInt" : "162" }, { "$numberInt" : "163" }, { "$numberInt" : "164" }, { "$numberInt" : "165" }, { "$numberInt" : "166" }, { "$numberInt" : "167" } ] }'::documentdb_core.bson)
(12 rows)

/* $bitsAnySet (all terms truncated) */
SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$bitsAnySet": { "$binary" : { "base64": "dGhpcyBpcyBhIHRlc3Qgc3RyaW5n", "subType" : "01" } } } }';
                                                                                                 document                                                                                                 
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "1" }, "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "00" } }, "item" : "A" }
 { "_id" : { "$numberInt" : "2" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6IDEsICJiIjogMyB9", "subType" : "01" } } }
 { "_id" : { "$numberInt" : "3" }, "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "04" } } }
 { "_id" : { "$numberInt" : "4" }, "ikey" : { "$binary" : { "base64" : "YWJvYm9yYQ==", "subType" : "05" } } }
 { "_id" : { "$numberInt" : "5" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6IDEsICJiIjogMyB9", "subType" : "06" } } }
 { "_id" : { "$numberInt" : "6" }, "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "07" } }, "item" : "F", "customKey" : { "$numberInt" : "6" } }
 { "_id" : { "$numberInt" : "7" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6ICIxMjM0NSIsICJiIjogMTIzMTIzMTIzMjExMjMxIH0=", "subType" : "01" } }, "item" : "G", "customKey" : { "$numberInt" : "6" } }
 { "_id" : { "$numberInt" : "8" }, "ikey" : { "$binary" : { "base64" : "dGhpcyBpcyBhIHRlc3Qgc3RyaW5n", "subType" : "00" } } }
 { "_id" : { "$numberInt" : "9" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6ICIxMjM0NSIsICJiIjogMTIzMTIzMTIzMjExMjMxIH0=", "subType" : "04" } }, "item" : "H", "customKey" : { "$numberInt" : "8" } }
 { "_id" : { "$numberInt" : "10" }, "ikey" : { "$binary" : { "base64" : "dGhpcyBpcyBhIHRlc3Qgc3RyaW5n", "subType" : "01" } }, "item" : "H", "customKey" : { "$numberInt" : "9" } }
(10 rows)

SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$bitsAnySet": { "$binary" : { "base64": "YWJvYm9yYQ==", "subType" : "05" } } } }';
                                                                                                 document                                                                                                 
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "1" }, "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "00" } }, "item" : "A" }
 { "_id" : { "$numberInt" : "2" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6IDEsICJiIjogMyB9", "subType" : "01" } } }
 { "_id" : { "$numberInt" : "3" }, "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "04" } } }
 { "_id" : { "$numberInt" : "4" }, "ikey" : { "$binary" : { "base64" : "YWJvYm9yYQ==", "subType" : "05" } } }
 { "_id" : { "$numberInt" : "5" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6IDEsICJiIjogMyB9", "subType" : "06" } } }
 { "_id" : { "$numberInt" : "6" }, "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "07" } }, "item" : "F", "customKey" : { "$numberInt" : "6" } }
 { "_id" : { "$numberInt" : "7" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6ICIxMjM0NSIsICJiIjogMTIzMTIzMTIzMjExMjMxIH0=", "subType" : "01" } }, "item" : "G", "customKey" : { "$numberInt" : "6" } }
 { "_id" : { "$numberInt" : "8" }, "ikey" : { "$binary" : { "base64" : "dGhpcyBpcyBhIHRlc3Qgc3RyaW5n", "subType" : "00" } } }
 { "_id" : { "$numberInt" : "9" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6ICIxMjM0NSIsICJiIjogMTIzMTIzMTIzMjExMjMxIH0=", "subType" : "04" } }, "item" : "H", "customKey" : { "$numberInt" : "8" } }
 { "_id" : { "$numberInt" : "10" }, "ikey" : { "$binary" : { "base64" : "dGhpcyBpcyBhIHRlc3Qgc3RyaW5n", "subType" : "01" } }, "item" : "H", "customKey" : { "$numberInt" : "9" } }
(10 rows)

SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$bitsAnySet": { "$binary" : { "base64": "////////////////////////////", "subType" : "02" } } } }';
                                                                                                 document                                                                                                 
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "1" }, "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "00" } }, "item" : "A" }
 { "_id" : { "$numberInt" : "2" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6IDEsICJiIjogMyB9", "subType" : "01" } } }
 { "_id" : { "$numberInt" : "3" }, "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "04" } } }
 { "_id" : { "$numberInt" : "4" }, "ikey" : { "$binary" : { "base64" : "YWJvYm9yYQ==", "subType" : "05" } } }
 { "_id" : { "$numberInt" : "5" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6IDEsICJiIjogMyB9", "subType" : "06" } } }
 { "_id" : { "$numberInt" : "6" }, "ikey" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "07" } }, "item" : "F", "customKey" : { "$numberInt" : "6" } }
 { "_id" : { "$numberInt" : "7" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6ICIxMjM0NSIsICJiIjogMTIzMTIzMTIzMjExMjMxIH0=", "subType" : "01" } }, "item" : "G", "customKey" : { "$numberInt" : "6" } }
 { "_id" : { "$numberInt" : "8" }, "ikey" : { "$binary" : { "base64" : "dGhpcyBpcyBhIHRlc3Qgc3RyaW5n", "subType" : "00" } } }
 { "_id" : { "$numberInt" : "9" }, "ikey" : { "$binary" : { "base64" : "eyAiYSI6ICIxMjM0NSIsICJiIjogMTIzMTIzMTIzMjExMjMxIH0=", "subType" : "04" } }, "item" : "H", "customKey" : { "$numberInt" : "8" } }
 { "_id" : { "$numberInt" : "10" }, "ikey" : { "$binary" : { "base64" : "dGhpcyBpcyBhIHRlc3Qgc3RyaW5n", "subType" : "01" } }, "item" : "H", "customKey" : { "$numberInt" : "9" } }
(10 rows)

SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$bitsAnySet": 0 } }';
 document 
---------------------------------------------------------------------
(0 rows)

EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$bitsAnySet": { "$binary" : { "base64": "dGhpcyBpcyBhIHRlc3Qgc3RyaW5n", "subType" : "01" } } } }';
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                QUERY PLAN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
---------------------------------------------------------------------
 Custom Scan (Citus Adaptive)
   Output: remote_scan.document
   Task Count: 1
   Tasks Shown: All
   ->  Task
         Query: SELECT document FROM documentdb_data.documents_11500_1150003 collection WHERE (documentdb_api_catalog.bson_dollar_bits_any_set(document, '{ "ikey" : [ { "$numberInt" : "2" }, { "$numberInt" : "4" }, { "$numberInt" : "5" }, { "$numberInt" : "6" }, { "$numberInt" : "11" }, { "$numberInt" : "13" }, { "$numberInt" : "14" }, { "$numberInt" : "16" }, { "$numberInt" : "19" }, { "$numberInt" : "21" }, { "$numberInt" : "22" }, { "$numberInt" : "24" }, { "$numberInt" : "25" }, { "$numberInt" : "28" }, { "$numberInt" : "29" }, { "$numberInt" : "30" }, { "$numberInt" : "37" }, { "$numberInt" : "40" }, { "$numberInt" : "43" }, { "$numberInt" : "45" }, { "$numberInt" : "46" }, { "$numberInt" : "48" }, { "$numberInt" : "49" }, { "$numberInt" : "52" }, { "$numberInt" : "53" }, { "$numberInt" : "54" }, { "$numberInt" : "61" }, { "$numberInt" : "64" }, { "$numberInt" : "69" }, { "$numberInt" : "70" }, { "$numberInt" : "77" }, { "$numberInt" : "82" }, { "$numberInt" : "84" }, { "$numberInt" : "85" }, { "$numberInt" : "86" }, { "$numberInt" : "88" }, { "$numberInt" : "90" }, { "$numberInt" : "93" }, { "$numberInt" : "94" }, { "$numberInt" : "96" }, { "$numberInt" : "97" }, { "$numberInt" : "100" }, { "$numberInt" : "101" }, { "$numberInt" : "102" }, { "$numberInt" : "106" }, { "$numberInt" : "108" }, { "$numberInt" : "109" }, { "$numberInt" : "110" }, { "$numberInt" : "117" }, { "$numberInt" : "120" }, { "$numberInt" : "121" }, { "$numberInt" : "124" }, { "$numberInt" : "125" }, { "$numberInt" : "126" }, { "$numberInt" : "130" }, { "$numberInt" : "132" }, { "$numberInt" : "133" }, { "$numberInt" : "134" }, { "$numberInt" : "137" }, { "$numberInt" : "140" }, { "$numberInt" : "141" }, { "$numberInt" : "142" }, { "$numberInt" : "144" }, { "$numberInt" : "147" }, { "$numberInt" : "149" }, { "$numberInt" : "150" }, { "$numberInt" : "153" }, { "$numberInt" : "154" }, { "$numberInt" : "155" }, { "$numberInt" : "157" }, { "$numberInt" : "158" }, { "$numberInt" : "160" }, { "$numberInt" : "161" }, { "$numberInt" : "162" }, { "$numberInt" : "165" }, { "$numberInt" : "166" } ] }'::documentdb_core.bson) AND (shard_key_value OPERATOR(pg_catalog.=) '11500'::bigint))
         Node: host=localhost port=58070 dbname=regression
         ->  Bitmap Heap Scan on documentdb_data.documents_11500_1150003 collection
               Output: document
               Recheck Cond: (collection.document OPERATOR(documentdb_api_catalog.@|) '{ "ikey" : [ { "$numberInt" : "2" }, { "$numberInt" : "4" }, { "$numberInt" : "5" }, { "$numberInt" : "6" }, { "$numberInt" : "11" }, { "$numberInt" : "13" }, { "$numberInt" : "14" }, { "$numberInt" : "16" }, { "$numberInt" : "19" }, { "$numberInt" : "21" }, { "$numberInt" : "22" }, { "$numberInt" : "24" }, { "$numberInt" : "25" }, { "$numberInt" : "28" }, { "$numberInt" : "29" }, { "$numberInt" : "30" }, { "$numberInt" : "37" }, { "$numberInt" : "40" }, { "$numberInt" : "43" }, { "$numberInt" : "45" }, { "$numberInt" : "46" }, { "$numberInt" : "48" }, { "$numberInt" : "49" }, { "$numberInt" : "52" }, { "$numberInt" : "53" }, { "$numberInt" : "54" }, { "$numberInt" : "61" }, { "$numberInt" : "64" }, { "$numberInt" : "69" }, { "$numberInt" : "70" }, { "$numberInt" : "77" }, { "$numberInt" : "82" }, { "$numberInt" : "84" }, { "$numberInt" : "85" }, { "$numberInt" : "86" }, { "$numberInt" : "88" }, { "$numberInt" : "90" }, { "$numberInt" : "93" }, { "$numberInt" : "94" }, { "$numberInt" : "96" }, { "$numberInt" : "97" }, { "$numberInt" : "100" }, { "$numberInt" : "101" }, { "$numberInt" : "102" }, { "$numberInt" : "106" }, { "$numberInt" : "108" }, { "$numberInt" : "109" }, { "$numberInt" : "110" }, { "$numberInt" : "117" }, { "$numberInt" : "120" }, { "$numberInt" : "121" }, { "$numberInt" : "124" }, { "$numberInt" : "125" }, { "$numberInt" : "126" }, { "$numberInt" : "130" }, { "$numberInt" : "132" }, { "$numberInt" : "133" }, { "$numberInt" : "134" }, { "$numberInt" : "137" }, { "$numberInt" : "140" }, { "$numberInt" : "141" }, { "$numberInt" : "142" }, { "$numberInt" : "144" }, { "$numberInt" : "147" }, { "$numberInt" : "149" }, { "$numberInt" : "150" }, { "$numberInt" : "153" }, { "$numberInt" : "154" }, { "$numberInt" : "155" }, { "$numberInt" : "157" }, { "$numberInt" : "158" }, { "$numberInt" : "160" }, { "$numberInt" : "161" }, { "$numberInt" : "162" }, { "$numberInt" : "165" }, { "$numberInt" : "166" } ] }'::documentdb_core.bson)
               ->  Bitmap Index Scan on ikey_1
                     Index Cond: (collection.document OPERATOR(documentdb_api_catalog.@|) '{ "ikey" : [ { "$numberInt" : "2" }, { "$numberInt" : "4" }, { "$numberInt" : "5" }, { "$numberInt" : "6" }, { "$numberInt" : "11" }, { "$numberInt" : "13" }, { "$numberInt" : "14" }, { "$numberInt" : "16" }, { "$numberInt" : "19" }, { "$numberInt" : "21" }, { "$numberInt" : "22" }, { "$numberInt" : "24" }, { "$numberInt" : "25" }, { "$numberInt" : "28" }, { "$numberInt" : "29" }, { "$numberInt" : "30" }, { "$numberInt" : "37" }, { "$numberInt" : "40" }, { "$numberInt" : "43" }, { "$numberInt" : "45" }, { "$numberInt" : "46" }, { "$numberInt" : "48" }, { "$numberInt" : "49" }, { "$numberInt" : "52" }, { "$numberInt" : "53" }, { "$numberInt" : "54" }, { "$numberInt" : "61" }, { "$numberInt" : "64" }, { "$numberInt" : "69" }, { "$numberInt" : "70" }, { "$numberInt" : "77" }, { "$numberInt" : "82" }, { "$numberInt" : "84" }, { "$numberInt" : "85" }, { "$numberInt" : "86" }, { "$numberInt" : "88" }, { "$numberInt" : "90" }, { "$numberInt" : "93" }, { "$numberInt" : "94" }, { "$numberInt" : "96" }, { "$numberInt" : "97" }, { "$numberInt" : "100" }, { "$numberInt" : "101" }, { "$numberInt" : "102" }, { "$numberInt" : "106" }, { "$numberInt" : "108" }, { "$numberInt" : "109" }, { "$numberInt" : "110" }, { "$numberInt" : "117" }, { "$numberInt" : "120" }, { "$numberInt" : "121" }, { "$numberInt" : "124" }, { "$numberInt" : "125" }, { "$numberInt" : "126" }, { "$numberInt" : "130" }, { "$numberInt" : "132" }, { "$numberInt" : "133" }, { "$numberInt" : "134" }, { "$numberInt" : "137" }, { "$numberInt" : "140" }, { "$numberInt" : "141" }, { "$numberInt" : "142" }, { "$numberInt" : "144" }, { "$numberInt" : "147" }, { "$numberInt" : "149" }, { "$numberInt" : "150" }, { "$numberInt" : "153" }, { "$numberInt" : "154" }, { "$numberInt" : "155" }, { "$numberInt" : "157" }, { "$numberInt" : "158" }, { "$numberInt" : "160" }, { "$numberInt" : "161" }, { "$numberInt" : "162" }, { "$numberInt" : "165" }, { "$numberInt" : "166" } ] }'::documentdb_core.bson)
(12 rows)

EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$bitsAnySet": { "$binary" : { "base64": "YWJvYm9yYQ==", "subType" : "05" } } } }';
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       QUERY PLAN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
---------------------------------------------------------------------
 Custom Scan (Citus Adaptive)
   Output: remote_scan.document
   Task Count: 1
   Tasks Shown: All
   ->  Task
         Query: SELECT document FROM documentdb_data.documents_11500_1150003 collection WHERE (documentdb_api_catalog.bson_dollar_bits_any_set(document, '{ "ikey" : [ { "$numberInt" : "0" }, { "$numberInt" : "5" }, { "$numberInt" : "6" }, { "$numberInt" : "9" }, { "$numberInt" : "13" }, { "$numberInt" : "14" }, { "$numberInt" : "16" }, { "$numberInt" : "17" }, { "$numberInt" : "18" }, { "$numberInt" : "19" }, { "$numberInt" : "21" }, { "$numberInt" : "22" }, { "$numberInt" : "25" }, { "$numberInt" : "29" }, { "$numberInt" : "30" }, { "$numberInt" : "32" }, { "$numberInt" : "33" }, { "$numberInt" : "34" }, { "$numberInt" : "35" }, { "$numberInt" : "37" }, { "$numberInt" : "38" }, { "$numberInt" : "41" }, { "$numberInt" : "44" }, { "$numberInt" : "45" }, { "$numberInt" : "46" }, { "$numberInt" : "48" }, { "$numberInt" : "53" }, { "$numberInt" : "54" } ] }'::documentdb_core.bson) AND (shard_key_value OPERATOR(pg_catalog.=) '11500'::bigint))
         Node: host=localhost port=58070 dbname=regression
         ->  Bitmap Heap Scan on documentdb_data.documents_11500_1150003 collection
               Output: document
               Recheck Cond: (collection.document OPERATOR(documentdb_api_catalog.@|) '{ "ikey" : [ { "$numberInt" : "0" }, { "$numberInt" : "5" }, { "$numberInt" : "6" }, { "$numberInt" : "9" }, { "$numberInt" : "13" }, { "$numberInt" : "14" }, { "$numberInt" : "16" }, { "$numberInt" : "17" }, { "$numberInt" : "18" }, { "$numberInt" : "19" }, { "$numberInt" : "21" }, { "$numberInt" : "22" }, { "$numberInt" : "25" }, { "$numberInt" : "29" }, { "$numberInt" : "30" }, { "$numberInt" : "32" }, { "$numberInt" : "33" }, { "$numberInt" : "34" }, { "$numberInt" : "35" }, { "$numberInt" : "37" }, { "$numberInt" : "38" }, { "$numberInt" : "41" }, { "$numberInt" : "44" }, { "$numberInt" : "45" }, { "$numberInt" : "46" }, { "$numberInt" : "48" }, { "$numberInt" : "53" }, { "$numberInt" : "54" } ] }'::documentdb_core.bson)
               ->  Bitmap Index Scan on ikey_1
                     Index Cond: (collection.document OPERATOR(documentdb_api_catalog.@|) '{ "ikey" : [ { "$numberInt" : "0" }, { "$numberInt" : "5" }, { "$numberInt" : "6" }, { "$numberInt" : "9" }, { "$numberInt" : "13" }, { "$numberInt" : "14" }, { "$numberInt" : "16" }, { "$numberInt" : "17" }, { "$numberInt" : "18" }, { "$numberInt" : "19" }, { "$numberInt" : "21" }, { "$numberInt" : "22" }, { "$numberInt" : "25" }, { "$numberInt" : "29" }, { "$numberInt" : "30" }, { "$numberInt" : "32" }, { "$numberInt" : "33" }, { "$numberInt" : "34" }, { "$numberInt" : "35" }, { "$numberInt" : "37" }, { "$numberInt" : "38" }, { "$numberInt" : "41" }, { "$numberInt" : "44" }, { "$numberInt" : "45" }, { "$numberInt" : "46" }, { "$numberInt" : "48" }, { "$numberInt" : "53" }, { "$numberInt" : "54" } ] }'::documentdb_core.bson)
(12 rows)

EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$bitsAnySet": { "$binary" : { "base64": "////////////////////////////", "subType" : "02" } } } }';
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            QUERY PLAN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
---------------------------------------------------------------------
 Custom Scan (Citus Adaptive)
   Output: remote_scan.document
   Task Count: 1
   Tasks Shown: All
   ->  Task
         Query: SELECT document FROM documentdb_data.documents_11500_1150003 collection WHERE (documentdb_api_catalog.bson_dollar_bits_any_set(document, '{ "ikey" : [ { "$numberInt" : "0" }, { "$numberInt" : "1" }, { "$numberInt" : "2" }, { "$numberInt" : "3" }, { "$numberInt" : "4" }, { "$numberInt" : "5" }, { "$numberInt" : "6" }, { "$numberInt" : "7" }, { "$numberInt" : "8" }, { "$numberInt" : "9" }, { "$numberInt" : "10" }, { "$numberInt" : "11" }, { "$numberInt" : "12" }, { "$numberInt" : "13" }, { "$numberInt" : "14" }, { "$numberInt" : "15" }, { "$numberInt" : "16" }, { "$numberInt" : "17" }, { "$numberInt" : "18" }, { "$numberInt" : "19" }, { "$numberInt" : "20" }, { "$numberInt" : "21" }, { "$numberInt" : "22" }, { "$numberInt" : "23" }, { "$numberInt" : "24" }, { "$numberInt" : "25" }, { "$numberInt" : "26" }, { "$numberInt" : "27" }, { "$numberInt" : "28" }, { "$numberInt" : "29" }, { "$numberInt" : "30" }, { "$numberInt" : "31" }, { "$numberInt" : "32" }, { "$numberInt" : "33" }, { "$numberInt" : "34" }, { "$numberInt" : "35" }, { "$numberInt" : "36" }, { "$numberInt" : "37" }, { "$numberInt" : "38" }, { "$numberInt" : "39" }, { "$numberInt" : "40" }, { "$numberInt" : "41" }, { "$numberInt" : "42" }, { "$numberInt" : "43" }, { "$numberInt" : "44" }, { "$numberInt" : "45" }, { "$numberInt" : "46" }, { "$numberInt" : "47" }, { "$numberInt" : "48" }, { "$numberInt" : "49" }, { "$numberInt" : "50" }, { "$numberInt" : "51" }, { "$numberInt" : "52" }, { "$numberInt" : "53" }, { "$numberInt" : "54" }, { "$numberInt" : "55" }, { "$numberInt" : "56" }, { "$numberInt" : "57" }, { "$numberInt" : "58" }, { "$numberInt" : "59" }, { "$numberInt" : "60" }, { "$numberInt" : "61" }, { "$numberInt" : "62" }, { "$numberInt" : "63" }, { "$numberInt" : "64" }, { "$numberInt" : "65" }, { "$numberInt" : "66" }, { "$numberInt" : "67" }, { "$numberInt" : "68" }, { "$numberInt" : "69" }, { "$numberInt" : "70" }, { "$numberInt" : "71" }, { "$numberInt" : "72" }, { "$numberInt" : "73" }, { "$numberInt" : "74" }, { "$numberInt" : "75" }, { "$numberInt" : "76" }, { "$numberInt" : "77" }, { "$numberInt" : "78" }, { "$numberInt" : "79" }, { "$numberInt" : "80" }, { "$numberInt" : "81" }, { "$numberInt" : "82" }, { "$numberInt" : "83" }, { "$numberInt" : "84" }, { "$numberInt" : "85" }, { "$numberInt" : "86" }, { "$numberInt" : "87" }, { "$numberInt" : "88" }, { "$numberInt" : "89" }, { "$numberInt" : "90" }, { "$numberInt" : "91" }, { "$numberInt" : "92" }, { "$numberInt" : "93" }, { "$numberInt" : "94" }, { "$numberInt" : "95" }, { "$numberInt" : "96" }, { "$numberInt" : "97" }, { "$numberInt" : "98" }, { "$numberInt" : "99" }, { "$numberInt" : "100" }, { "$numberInt" : "101" }, { "$numberInt" : "102" }, { "$numberInt" : "103" }, { "$numberInt" : "104" }, { "$numberInt" : "105" }, { "$numberInt" : "106" }, { "$numberInt" : "107" }, { "$numberInt" : "108" }, { "$numberInt" : "109" }, { "$numberInt" : "110" }, { "$numberInt" : "111" }, { "$numberInt" : "112" }, { "$numberInt" : "113" }, { "$numberInt" : "114" }, { "$numberInt" : "115" }, { "$numberInt" : "116" }, { "$numberInt" : "117" }, { "$numberInt" : "118" }, { "$numberInt" : "119" }, { "$numberInt" : "120" }, { "$numberInt" : "121" }, { "$numberInt" : "122" }, { "$numberInt" : "123" }, { "$numberInt" : "124" }, { "$numberInt" : "125" }, { "$numberInt" : "126" }, { "$numberInt" : "127" }, { "$numberInt" : "128" }, { "$numberInt" : "129" }, { "$numberInt" : "130" }, { "$numberInt" : "131" }, { "$numberInt" : "132" }, { "$numberInt" : "133" }, { "$numberInt" : "134" }, { "$numberInt" : "135" }, { "$numberInt" : "136" }, { "$numberInt" : "137" }, { "$numberInt" : "138" }, { "$numberInt" : "139" }, { "$numberInt" : "140" }, { "$numberInt" : "141" }, { "$numberInt" : "142" }, { "$numberInt" : "143" }, { "$numberInt" : "144" }, { "$numberInt" : "145" }, { "$numberInt" : "146" }, { "$numberInt" : "147" }, { "$numberInt" : "148" }, { "$numberInt" : "149" }, { "$numberInt" : "150" }, { "$numberInt" : "151" }, { "$numberInt" : "152" }, { "$numberInt" : "153" }, { "$numberInt" : "154" }, { "$numberInt" : "155" }, { "$numberInt" : "156" }, { "$numberInt" : "157" }, { "$numberInt" : "158" }, { "$numberInt" : "159" }, { "$numberInt" : "160" }, { "$numberInt" : "161" }, { "$numberInt" : "162" }, { "$numberInt" : "163" }, { "$numberInt" : "164" }, { "$numberInt" : "165" }, { "$numberInt" : "166" }, { "$numberInt" : "167" } ] }'::documentdb_core.bson) AND (shard_key_value OPERATOR(pg_catalog.=) '11500'::bigint))
         Node: host=localhost port=58070 dbname=regression
         ->  Bitmap Heap Scan on documentdb_data.documents_11500_1150003 collection
               Output: document
               Recheck Cond: (collection.document OPERATOR(documentdb_api_catalog.@|) '{ "ikey" : [ { "$numberInt" : "0" }, { "$numberInt" : "1" }, { "$numberInt" : "2" }, { "$numberInt" : "3" }, { "$numberInt" : "4" }, { "$numberInt" : "5" }, { "$numberInt" : "6" }, { "$numberInt" : "7" }, { "$numberInt" : "8" }, { "$numberInt" : "9" }, { "$numberInt" : "10" }, { "$numberInt" : "11" }, { "$numberInt" : "12" }, { "$numberInt" : "13" }, { "$numberInt" : "14" }, { "$numberInt" : "15" }, { "$numberInt" : "16" }, { "$numberInt" : "17" }, { "$numberInt" : "18" }, { "$numberInt" : "19" }, { "$numberInt" : "20" }, { "$numberInt" : "21" }, { "$numberInt" : "22" }, { "$numberInt" : "23" }, { "$numberInt" : "24" }, { "$numberInt" : "25" }, { "$numberInt" : "26" }, { "$numberInt" : "27" }, { "$numberInt" : "28" }, { "$numberInt" : "29" }, { "$numberInt" : "30" }, { "$numberInt" : "31" }, { "$numberInt" : "32" }, { "$numberInt" : "33" }, { "$numberInt" : "34" }, { "$numberInt" : "35" }, { "$numberInt" : "36" }, { "$numberInt" : "37" }, { "$numberInt" : "38" }, { "$numberInt" : "39" }, { "$numberInt" : "40" }, { "$numberInt" : "41" }, { "$numberInt" : "42" }, { "$numberInt" : "43" }, { "$numberInt" : "44" }, { "$numberInt" : "45" }, { "$numberInt" : "46" }, { "$numberInt" : "47" }, { "$numberInt" : "48" }, { "$numberInt" : "49" }, { "$numberInt" : "50" }, { "$numberInt" : "51" }, { "$numberInt" : "52" }, { "$numberInt" : "53" }, { "$numberInt" : "54" }, { "$numberInt" : "55" }, { "$numberInt" : "56" }, { "$numberInt" : "57" }, { "$numberInt" : "58" }, { "$numberInt" : "59" }, { "$numberInt" : "60" }, { "$numberInt" : "61" }, { "$numberInt" : "62" }, { "$numberInt" : "63" }, { "$numberInt" : "64" }, { "$numberInt" : "65" }, { "$numberInt" : "66" }, { "$numberInt" : "67" }, { "$numberInt" : "68" }, { "$numberInt" : "69" }, { "$numberInt" : "70" }, { "$numberInt" : "71" }, { "$numberInt" : "72" }, { "$numberInt" : "73" }, { "$numberInt" : "74" }, { "$numberInt" : "75" }, { "$numberInt" : "76" }, { "$numberInt" : "77" }, { "$numberInt" : "78" }, { "$numberInt" : "79" }, { "$numberInt" : "80" }, { "$numberInt" : "81" }, { "$numberInt" : "82" }, { "$numberInt" : "83" }, { "$numberInt" : "84" }, { "$numberInt" : "85" }, { "$numberInt" : "86" }, { "$numberInt" : "87" }, { "$numberInt" : "88" }, { "$numberInt" : "89" }, { "$numberInt" : "90" }, { "$numberInt" : "91" }, { "$numberInt" : "92" }, { "$numberInt" : "93" }, { "$numberInt" : "94" }, { "$numberInt" : "95" }, { "$numberInt" : "96" }, { "$numberInt" : "97" }, { "$numberInt" : "98" }, { "$numberInt" : "99" }, { "$numberInt" : "100" }, { "$numberInt" : "101" }, { "$numberInt" : "102" }, { "$numberInt" : "103" }, { "$numberInt" : "104" }, { "$numberInt" : "105" }, { "$numberInt" : "106" }, { "$numberInt" : "107" }, { "$numberInt" : "108" }, { "$numberInt" : "109" }, { "$numberInt" : "110" }, { "$numberInt" : "111" }, { "$numberInt" : "112" }, { "$numberInt" : "113" }, { "$numberInt" : "114" }, { "$numberInt" : "115" }, { "$numberInt" : "116" }, { "$numberInt" : "117" }, { "$numberInt" : "118" }, { "$numberInt" : "119" }, { "$numberInt" : "120" }, { "$numberInt" : "121" }, { "$numberInt" : "122" }, { "$numberInt" : "123" }, { "$numberInt" : "124" }, { "$numberInt" : "125" }, { "$numberInt" : "126" }, { "$numberInt" : "127" }, { "$numberInt" : "128" }, { "$numberInt" : "129" }, { "$numberInt" : "130" }, { "$numberInt" : "131" }, { "$numberInt" : "132" }, { "$numberInt" : "133" }, { "$numberInt" : "134" }, { "$numberInt" : "135" }, { "$numberInt" : "136" }, { "$numberInt" : "137" }, { "$numberInt" : "138" }, { "$numberInt" : "139" }, { "$numberInt" : "140" }, { "$numberInt" : "141" }, { "$numberInt" : "142" }, { "$numberInt" : "143" }, { "$numberInt" : "144" }, { "$numberInt" : "145" }, { "$numberInt" : "146" }, { "$numberInt" : "147" }, { "$numberInt" : "148" }, { "$numberInt" : "149" }, { "$numberInt" : "150" }, { "$numberInt" : "151" }, { "$numberInt" : "152" }, { "$numberInt" : "153" }, { "$numberInt" : "154" }, { "$numberInt" : "155" }, { "$numberInt" : "156" }, { "$numberInt" : "157" }, { "$numberInt" : "158" }, { "$numberInt" : "159" }, { "$numberInt" : "160" }, { "$numberInt" : "161" }, { "$numberInt" : "162" }, { "$numberInt" : "163" }, { "$numberInt" : "164" }, { "$numberInt" : "165" }, { "$numberInt" : "166" }, { "$numberInt" : "167" } ] }'::documentdb_core.bson)
               ->  Bitmap Index Scan on ikey_1
                     Index Cond: (collection.document OPERATOR(documentdb_api_catalog.@|) '{ "ikey" : [ { "$numberInt" : "0" }, { "$numberInt" : "1" }, { "$numberInt" : "2" }, { "$numberInt" : "3" }, { "$numberInt" : "4" }, { "$numberInt" : "5" }, { "$numberInt" : "6" }, { "$numberInt" : "7" }, { "$numberInt" : "8" }, { "$numberInt" : "9" }, { "$numberInt" : "10" }, { "$numberInt" : "11" }, { "$numberInt" : "12" }, { "$numberInt" : "13" }, { "$numberInt" : "14" }, { "$numberInt" : "15" }, { "$numberInt" : "16" }, { "$numberInt" : "17" }, { "$numberInt" : "18" }, { "$numberInt" : "19" }, { "$numberInt" : "20" }, { "$numberInt" : "21" }, { "$numberInt" : "22" }, { "$numberInt" : "23" }, { "$numberInt" : "24" }, { "$numberInt" : "25" }, { "$numberInt" : "26" }, { "$numberInt" : "27" }, { "$numberInt" : "28" }, { "$numberInt" : "29" }, { "$numberInt" : "30" }, { "$numberInt" : "31" }, { "$numberInt" : "32" }, { "$numberInt" : "33" }, { "$numberInt" : "34" }, { "$numberInt" : "35" }, { "$numberInt" : "36" }, { "$numberInt" : "37" }, { "$numberInt" : "38" }, { "$numberInt" : "39" }, { "$numberInt" : "40" }, { "$numberInt" : "41" }, { "$numberInt" : "42" }, { "$numberInt" : "43" }, { "$numberInt" : "44" }, { "$numberInt" : "45" }, { "$numberInt" : "46" }, { "$numberInt" : "47" }, { "$numberInt" : "48" }, { "$numberInt" : "49" }, { "$numberInt" : "50" }, { "$numberInt" : "51" }, { "$numberInt" : "52" }, { "$numberInt" : "53" }, { "$numberInt" : "54" }, { "$numberInt" : "55" }, { "$numberInt" : "56" }, { "$numberInt" : "57" }, { "$numberInt" : "58" }, { "$numberInt" : "59" }, { "$numberInt" : "60" }, { "$numberInt" : "61" }, { "$numberInt" : "62" }, { "$numberInt" : "63" }, { "$numberInt" : "64" }, { "$numberInt" : "65" }, { "$numberInt" : "66" }, { "$numberInt" : "67" }, { "$numberInt" : "68" }, { "$numberInt" : "69" }, { "$numberInt" : "70" }, { "$numberInt" : "71" }, { "$numberInt" : "72" }, { "$numberInt" : "73" }, { "$numberInt" : "74" }, { "$numberInt" : "75" }, { "$numberInt" : "76" }, { "$numberInt" : "77" }, { "$numberInt" : "78" }, { "$numberInt" : "79" }, { "$numberInt" : "80" }, { "$numberInt" : "81" }, { "$numberInt" : "82" }, { "$numberInt" : "83" }, { "$numberInt" : "84" }, { "$numberInt" : "85" }, { "$numberInt" : "86" }, { "$numberInt" : "87" }, { "$numberInt" : "88" }, { "$numberInt" : "89" }, { "$numberInt" : "90" }, { "$numberInt" : "91" }, { "$numberInt" : "92" }, { "$numberInt" : "93" }, { "$numberInt" : "94" }, { "$numberInt" : "95" }, { "$numberInt" : "96" }, { "$numberInt" : "97" }, { "$numberInt" : "98" }, { "$numberInt" : "99" }, { "$numberInt" : "100" }, { "$numberInt" : "101" }, { "$numberInt" : "102" }, { "$numberInt" : "103" }, { "$numberInt" : "104" }, { "$numberInt" : "105" }, { "$numberInt" : "106" }, { "$numberInt" : "107" }, { "$numberInt" : "108" }, { "$numberInt" : "109" }, { "$numberInt" : "110" }, { "$numberInt" : "111" }, { "$numberInt" : "112" }, { "$numberInt" : "113" }, { "$numberInt" : "114" }, { "$numberInt" : "115" }, { "$numberInt" : "116" }, { "$numberInt" : "117" }, { "$numberInt" : "118" }, { "$numberInt" : "119" }, { "$numberInt" : "120" }, { "$numberInt" : "121" }, { "$numberInt" : "122" }, { "$numberInt" : "123" }, { "$numberInt" : "124" }, { "$numberInt" : "125" }, { "$numberInt" : "126" }, { "$numberInt" : "127" }, { "$numberInt" : "128" }, { "$numberInt" : "129" }, { "$numberInt" : "130" }, { "$numberInt" : "131" }, { "$numberInt" : "132" }, { "$numberInt" : "133" }, { "$numberInt" : "134" }, { "$numberInt" : "135" }, { "$numberInt" : "136" }, { "$numberInt" : "137" }, { "$numberInt" : "138" }, { "$numberInt" : "139" }, { "$numberInt" : "140" }, { "$numberInt" : "141" }, { "$numberInt" : "142" }, { "$numberInt" : "143" }, { "$numberInt" : "144" }, { "$numberInt" : "145" }, { "$numberInt" : "146" }, { "$numberInt" : "147" }, { "$numberInt" : "148" }, { "$numberInt" : "149" }, { "$numberInt" : "150" }, { "$numberInt" : "151" }, { "$numberInt" : "152" }, { "$numberInt" : "153" }, { "$numberInt" : "154" }, { "$numberInt" : "155" }, { "$numberInt" : "156" }, { "$numberInt" : "157" }, { "$numberInt" : "158" }, { "$numberInt" : "159" }, { "$numberInt" : "160" }, { "$numberInt" : "161" }, { "$numberInt" : "162" }, { "$numberInt" : "163" }, { "$numberInt" : "164" }, { "$numberInt" : "165" }, { "$numberInt" : "166" }, { "$numberInt" : "167" } ] }'::documentdb_core.bson)
(12 rows)

EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests') WHERE document @@ '{ "ikey": { "$bitsAnySet": 0 } }';
                                                                                                                            QUERY PLAN                                                                                                                            
---------------------------------------------------------------------
 Custom Scan (Citus Adaptive)
   Output: remote_scan.document
   Task Count: 1
   Tasks Shown: All
   ->  Task
         Query: SELECT document FROM documentdb_data.documents_11500_1150003 collection WHERE (documentdb_api_catalog.bson_dollar_bits_any_set(document, '{ "ikey" : [  ] }'::documentdb_core.bson) AND (shard_key_value OPERATOR(pg_catalog.=) '11500'::bigint))
         Node: host=localhost port=58070 dbname=regression
         ->  Bitmap Heap Scan on documentdb_data.documents_11500_1150003 collection
               Output: document
               Recheck Cond: (collection.document OPERATOR(documentdb_api_catalog.@|) '{ "ikey" : [  ] }'::documentdb_core.bson)
               ->  Bitmap Index Scan on ikey_1
                     Index Cond: (collection.document OPERATOR(documentdb_api_catalog.@|) '{ "ikey" : [  ] }'::documentdb_core.bson)
(12 rows)

-- insert binary BSON data in nested documents/arrays with different leaf types
SET documentdb.enableIndexTermTruncationOnNestedObjects to ON;
SET documentdb.indexTermLimitOverride to 100;
/* create index on key 'ikey2' */
SELECT documentdb_api_internal.create_indexes_non_concurrently('db', '{ "createIndexes": "index_truncation_binary_tests_2", "indexes": [ { "key": { "ikey2" : 1 }, "name": "ikey_2", "enableLargeIndexKeys": true } ] }');
NOTICE:  creating collection
                                                                                                   create_indexes_non_concurrently                                                                                                   
---------------------------------------------------------------------
 { "raw" : { "defaultShard" : { "numIndexesBefore" : { "$numberInt" : "1" }, "numIndexesAfter" : { "$numberInt" : "2" }, "createdCollectionAutomatically" : true, "ok" : { "$numberInt" : "1" } } }, "ok" : { "$numberInt" : "1" } }
(1 row)

\d documentdb_data.documents_11501
                   Table "documentdb_data.documents_11501"
     Column      |           Type           | Collation | Nullable | Default 
---------------------------------------------------------------------
 shard_key_value | bigint                   |           | not null | 
 object_id       | bson                     |           | not null | 
 document        | bson                     |           | not null | 
 creation_time   | timestamp with time zone |           |          | 
Indexes:
    "collection_pk_11501" PRIMARY KEY, btree (shard_key_value, object_id)
    "documents_rum_index_11503" documentdb_rum (document bson_rum_single_path_ops (path=ikey2, tl='100'))
Check constraints:
    "shard_key_value_check" CHECK (shard_key_value = '11501'::bigint)

SELECT documentdb_api.insert_one('db', 'index_truncation_binary_tests_2', '{ "_id": 1, "test": "a", "ikey2": { "abcdefg": { "bcdef": { "cdefg": { "dhig": { "$binary" : { "base64": "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "00" } } } } } }, "item": "A" }');
                              insert_one                              
---------------------------------------------------------------------
 { "n" : { "$numberInt" : "1" }, "ok" : { "$numberDouble" : "1.0" } }
(1 row)

SELECT documentdb_api.insert_one('db', 'index_truncation_binary_tests_2', '{ "_id": 2, "test": "b", "ikey2": [[[[[[{ "$binary" : { "base64": "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "00" } }]]]]]], "item": "A" }');
                              insert_one                              
---------------------------------------------------------------------
 { "n" : { "$numberInt" : "1" }, "ok" : { "$numberDouble" : "1.0" } }
(1 row)

SELECT documentdb_api.insert_one('db', 'index_truncation_binary_tests_2', '{ "_id": 3, "test": "c", "ikey2": [["a"]], "item": "A" }');
                              insert_one                              
---------------------------------------------------------------------
 { "n" : { "$numberInt" : "1" }, "ok" : { "$numberDouble" : "1.0" } }
(1 row)

SELECT documentdb_api.insert_one('db', 'index_truncation_binary_tests_2', '{ "_id": 4, "test": "d", "ikey2": { "abcdefg": { "bcdef": { "cdefg": { "dhig": { "f": { "d": "abcdefghijklmnoasadasdsadasdsadsadasdsadasdaspqrstuvxzabcdefghzasaasaasaasasasasas" } } } } } }, "item": "A" }');
                              insert_one                              
---------------------------------------------------------------------
 { "n" : { "$numberInt" : "1" }, "ok" : { "$numberDouble" : "1.0" } }
(1 row)

SELECT documentdb_api.insert_one('db', 'index_truncation_binary_tests_2', '{ "_id": 5, "test": "e", "ikey2": { "abcdeasasfg": { "bcassasdef": { "cdefsssg": { "dhsssig": { "ssssb": { "csssss": 2 } } } } } }, "item": "A" }');
                              insert_one                              
---------------------------------------------------------------------
 { "n" : { "$numberInt" : "1" }, "ok" : { "$numberDouble" : "1.0" } }
(1 row)

SELECT documentdb_api.insert_one('db', 'index_truncation_binary_tests_2', '{ "_id": 6, "test": "f", "ikey2": { "abcdeasasfg": { "bcassasdef": { "cdefsssg": { "dhsssig": { "ssssb": { "c": [[[{ "$binary" : { "base64": "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "00" } }]]] } } } } } }, "item": "A" }');
                              insert_one                              
---------------------------------------------------------------------
 { "n" : { "$numberInt" : "1" }, "ok" : { "$numberDouble" : "1.0" } }
(1 row)

SELECT documentdb_api.insert_one('db', 'index_truncation_binary_tests_2', '{ "_id": 7, "test": "g", "ikey2": [[[[[[{ "a": { "b": { "c": { "$binary" : { "base64": "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "00" } } } } } ]]]]]], "item": "A" }');
                              insert_one                              
---------------------------------------------------------------------
 { "n" : { "$numberInt" : "1" }, "ok" : { "$numberDouble" : "1.0" } }
(1 row)

/* check for index terms */
SELECT did, length(bson_dollar_project(term, '{ "t": 0 }')::bytea), term FROM ( SELECT documentdb_distributed_test_helpers.gin_bson_get_single_path_generated_terms(document, 'ikey2', false, true, true, 100) term, document-> '_id' as did from documentdb_data.documents_11501) docs;
               did               | length |                                                                                        term                                                                                        
---------------------------------------------------------------------
 { "" : { "$numberInt" : "1" } } |     97 | { "$" : { "abcdefg" : { "bcdef" : { "cdefg" : { "dhig" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmE=", "subType" : "00" } } } } } }, "t" : true }
 { "" : { "$numberInt" : "1" } } |      8 | { "" : true, "t" : false }
 { "" : { "$numberInt" : "1" } } |      7 | { "" : { "$maxKey" : 1 }, "t" : true }
 { "" : { "$numberInt" : "2" } } |     93 | { "$" : [ [ [ [ [ [ { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2I=", "subType" : "00" } } ] ] ] ] ] ], "t" : true }
 { "" : { "$numberInt" : "2" } } |     91 | { "$" : [ [ [ [ [ { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "00" } } ] ] ] ] ], "t" : true }
 { "" : { "$numberInt" : "2" } } |      8 | { "" : true, "t" : false }
 { "" : { "$numberInt" : "2" } } |      7 | { "" : { "$maxKey" : 1 }, "t" : true }
 { "" : { "$numberInt" : "3" } } |     30 | { "$" : [ [ "a" ] ], "t" : false }
 { "" : { "$numberInt" : "3" } } |     22 | { "$" : [ "a" ], "t" : false }
 { "" : { "$numberInt" : "3" } } |      8 | { "" : true, "t" : false }
 { "" : { "$numberInt" : "4" } } |     97 | { "$" : { "abcdefg" : { "bcdef" : { "cdefg" : { "dhig" : { "f" : { "d" : "abcdefghijklmnoasad" } } } } } }, "t" : true }
 { "" : { "$numberInt" : "4" } } |      8 | { "" : true, "t" : false }
 { "" : { "$numberInt" : "4" } } |      7 | { "" : { "$maxKey" : 1 }, "t" : true }
 { "" : { "$numberInt" : "5" } } |     84 | { "$" : { "abcdeasasfg" : { "bcassasdef" : { "cdefsssg" : { "dhsssig" : { "ssssb" : { "$maxKey" : 1 } } } } } }, "t" : true }
 { "" : { "$numberInt" : "5" } } |      8 | { "" : true, "t" : false }
 { "" : { "$numberInt" : "5" } } |      7 | { "" : { "$maxKey" : 1 }, "t" : true }
 { "" : { "$numberInt" : "6" } } |     84 | { "$" : { "abcdeasasfg" : { "bcassasdef" : { "cdefsssg" : { "dhsssig" : { "ssssb" : { "$maxKey" : 1 } } } } } }, "t" : true }
 { "" : { "$numberInt" : "6" } } |      8 | { "" : true, "t" : false }
 { "" : { "$numberInt" : "6" } } |      7 | { "" : { "$maxKey" : 1 }, "t" : true }
 { "" : { "$numberInt" : "7" } } |     80 | { "$" : [ [ [ [ [ [ { "a" : { "b" : { "c" : { "$maxKey" : 1 } } } } ] ] ] ] ] ], "t" : true }
 { "" : { "$numberInt" : "7" } } |     94 | { "$" : [ [ [ [ [ { "a" : { "b" : { "c" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMyw=", "subType" : "00" } } } } } ] ] ] ] ], "t" : true }
 { "" : { "$numberInt" : "7" } } |      8 | { "" : true, "t" : false }
 { "" : { "$numberInt" : "7" } } |      7 | { "" : { "$maxKey" : 1 }, "t" : true }
(23 rows)

/* testing for equality and index usage */
SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests_2') WHERE document @@ '{ "ikey2": { "abcdefg": { "bcdef": { "cdefg": { "dhig": { "$binary" : { "base64": "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "00" } } } } } }, "item": "A" }';
                                                                                                                  document                                                                                                                  
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "1" }, "test" : "a", "ikey2" : { "abcdefg" : { "bcdef" : { "cdefg" : { "dhig" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "00" } } } } } }, "item" : "A" }
(1 row)

SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests_2') WHERE document @@ '{ "ikey2": [[[[[[{ "$binary" : { "base64": "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "00" } }]]]]]], "item": "A" }';
                                                                                                 document                                                                                                  
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "2" }, "test" : "b", "ikey2" : [ [ [ [ [ [ { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "00" } } ] ] ] ] ] ], "item" : "A" }
(1 row)

SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests_2') WHERE document @@ '{ "ikey2": [["a"]], "item": "A" }';
                                       document                                        
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "3" }, "test" : "c", "ikey2" : [ [ "a" ] ], "item" : "A" }
(1 row)

SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests_2') WHERE document @@ '{ "ikey2": { "abcdefg": { "bcdef": { "cdefg": { "dhig": { "f": { "d": "abcdefghijklmnoasadasdsadasdsadsadasdsadasdaspqrstuvxzabcdefghzasaasaasaasasasasas" } } } } } }, "item": "A" }';
                                                                                                                  document                                                                                                                   
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "4" }, "test" : "d", "ikey2" : { "abcdefg" : { "bcdef" : { "cdefg" : { "dhig" : { "f" : { "d" : "abcdefghijklmnoasadasdsadasdsadsadasdsadasdaspqrstuvxzabcdefghzasaasaasaasasasasas" } } } } } }, "item" : "A" }
(1 row)

SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests_2') WHERE document @@ '{ "ikey2": { "abcdeasasfg": { "bcassasdef": { "cdefsssg": { "dhsssig": { "ssssb": { "csssss": 2 } } } } } }, "item": "A" }';
                                                                                               document                                                                                                
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "5" }, "test" : "e", "ikey2" : { "abcdeasasfg" : { "bcassasdef" : { "cdefsssg" : { "dhsssig" : { "ssssb" : { "csssss" : { "$numberInt" : "2" } } } } } } }, "item" : "A" }
(1 row)

SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests_2') WHERE document @@ '{ "ikey2": { "abcdeasasfg": { "bcassasdef": { "cdefsssg": { "dhsssig": { "ssssb": { "c": [[[{ "$binary" : { "base64": "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "00" } }]]] } } } } } }, "item": "A" }';
                                                                                                                                           document                                                                                                                                            
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "6" }, "test" : "f", "ikey2" : { "abcdeasasfg" : { "bcassasdef" : { "cdefsssg" : { "dhsssig" : { "ssssb" : { "c" : [ [ [ { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "00" } } ] ] ] } } } } } }, "item" : "A" }
(1 row)

SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests_2') WHERE document @@ '{ "ikey2": [[[[[[{ "a": { "b": { "c": { "$binary" : { "base64": "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "00" } } } } } ]]]]]], "item": "A" }';
                                                                                                                document                                                                                                                 
---------------------------------------------------------------------
 { "_id" : { "$numberInt" : "7" }, "test" : "g", "ikey2" : [ [ [ [ [ [ { "a" : { "b" : { "c" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "00" } } } } } ] ] ] ] ] ], "item" : "A" }
(1 row)

EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests_2') WHERE document @@ '{ "ikey2": { "abcdefg": { "bcdef": { "cdefg": { "dhig": { "$binary" : { "base64": "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "00" } } } } } }, "item": "A" }';
                                                                                                                                                                                                                                                       QUERY PLAN                                                                                                                                                                                                                                                        
---------------------------------------------------------------------
 Custom Scan (Citus Adaptive)
   Output: remote_scan.document
   Task Count: 1
   Tasks Shown: All
   ->  Task
         Query: SELECT document FROM documentdb_data.documents_11501_1150018 collection WHERE ((document OPERATOR(documentdb_api_catalog.#=) '{ "ikey2" : { "abcdefg" : { "bcdef" : { "cdefg" : { "dhig" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "00" } } } } } } }'::documentdb_core.bsonquery) AND (document OPERATOR(documentdb_api_catalog.#=) '{ "item" : "A" }'::documentdb_core.bsonquery) AND (shard_key_value OPERATOR(pg_catalog.=) '11501'::bigint))
         Node: host=localhost port=58070 dbname=regression
         ->  Bitmap Heap Scan on documentdb_data.documents_11501_1150018 collection
               Output: document
               Recheck Cond: (collection.document OPERATOR(documentdb_api_catalog.@=) '{ "ikey2" : { "abcdefg" : { "bcdef" : { "cdefg" : { "dhig" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "00" } } } } } } }'::documentdb_core.bson)
               Filter: (collection.document OPERATOR(documentdb_api_catalog.@=) '{ "item" : "A" }'::documentdb_core.bson)
               ->  Bitmap Index Scan on ikey_2
                     Index Cond: (collection.document OPERATOR(documentdb_api_catalog.@=) '{ "ikey2" : { "abcdefg" : { "bcdef" : { "cdefg" : { "dhig" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "00" } } } } } } }'::documentdb_core.bson)
(13 rows)

EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests_2') WHERE document @@ '{ "ikey2": [[[[[[{ "$binary" : { "base64": "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "00" } }]]]]]], "item": "A" }';
                                                                                                                                                                                                                                       QUERY PLAN                                                                                                                                                                                                                                       
---------------------------------------------------------------------
 Custom Scan (Citus Adaptive)
   Output: remote_scan.document
   Task Count: 1
   Tasks Shown: All
   ->  Task
         Query: SELECT document FROM documentdb_data.documents_11501_1150018 collection WHERE ((document OPERATOR(documentdb_api_catalog.#=) '{ "ikey2" : [ [ [ [ [ [ { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "00" } } ] ] ] ] ] ] }'::documentdb_core.bsonquery) AND (document OPERATOR(documentdb_api_catalog.#=) '{ "item" : "A" }'::documentdb_core.bsonquery) AND (shard_key_value OPERATOR(pg_catalog.=) '11501'::bigint))
         Node: host=localhost port=58070 dbname=regression
         ->  Bitmap Heap Scan on documentdb_data.documents_11501_1150018 collection
               Output: document
               Recheck Cond: (collection.document OPERATOR(documentdb_api_catalog.@=) '{ "ikey2" : [ [ [ [ [ [ { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "00" } } ] ] ] ] ] ] }'::documentdb_core.bson)
               Filter: (collection.document OPERATOR(documentdb_api_catalog.@=) '{ "item" : "A" }'::documentdb_core.bson)
               ->  Bitmap Index Scan on ikey_2
                     Index Cond: (collection.document OPERATOR(documentdb_api_catalog.@=) '{ "ikey2" : [ [ [ [ [ [ { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "00" } } ] ] ] ] ] ] }'::documentdb_core.bson)
(13 rows)

EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests_2') WHERE document @@ '{ "ikey2": [["a"]], "item": "A" }';
                                                                                                                                                                             QUERY PLAN                                                                                                                                                                             
---------------------------------------------------------------------
 Custom Scan (Citus Adaptive)
   Output: remote_scan.document
   Task Count: 1
   Tasks Shown: All
   ->  Task
         Query: SELECT document FROM documentdb_data.documents_11501_1150018 collection WHERE ((document OPERATOR(documentdb_api_catalog.#=) '{ "ikey2" : [ [ "a" ] ] }'::documentdb_core.bsonquery) AND (document OPERATOR(documentdb_api_catalog.#=) '{ "item" : "A" }'::documentdb_core.bsonquery) AND (shard_key_value OPERATOR(pg_catalog.=) '11501'::bigint))
         Node: host=localhost port=58070 dbname=regression
         ->  Bitmap Heap Scan on documentdb_data.documents_11501_1150018 collection
               Output: document
               Recheck Cond: (collection.document OPERATOR(documentdb_api_catalog.@=) '{ "ikey2" : [ [ "a" ] ] }'::documentdb_core.bson)
               Filter: (collection.document OPERATOR(documentdb_api_catalog.@=) '{ "item" : "A" }'::documentdb_core.bson)
               ->  Bitmap Index Scan on ikey_2
                     Index Cond: (collection.document OPERATOR(documentdb_api_catalog.@=) '{ "ikey2" : [ [ "a" ] ] }'::documentdb_core.bson)
(13 rows)

EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests_2') WHERE document @@ '{ "ikey2": { "abcdefg": { "bcdef": { "cdefg": { "dhig": { "f": { "d": "abcdefghijklmnoasadasdsadasdsadsadasdsadasdaspqrstuvxzabcdefghzasaasaasaasasasasas" } } } } } }, "item": "A" }';
                                                                                                                                                                                                                                                        QUERY PLAN                                                                                                                                                                                                                                                        
---------------------------------------------------------------------
 Custom Scan (Citus Adaptive)
   Output: remote_scan.document
   Task Count: 1
   Tasks Shown: All
   ->  Task
         Query: SELECT document FROM documentdb_data.documents_11501_1150018 collection WHERE ((document OPERATOR(documentdb_api_catalog.#=) '{ "ikey2" : { "abcdefg" : { "bcdef" : { "cdefg" : { "dhig" : { "f" : { "d" : "abcdefghijklmnoasadasdsadasdsadsadasdsadasdaspqrstuvxzabcdefghzasaasaasaasasasasas" } } } } } } }'::documentdb_core.bsonquery) AND (document OPERATOR(documentdb_api_catalog.#=) '{ "item" : "A" }'::documentdb_core.bsonquery) AND (shard_key_value OPERATOR(pg_catalog.=) '11501'::bigint))
         Node: host=localhost port=58070 dbname=regression
         ->  Bitmap Heap Scan on documentdb_data.documents_11501_1150018 collection
               Output: document
               Recheck Cond: (collection.document OPERATOR(documentdb_api_catalog.@=) '{ "ikey2" : { "abcdefg" : { "bcdef" : { "cdefg" : { "dhig" : { "f" : { "d" : "abcdefghijklmnoasadasdsadasdsadsadasdsadasdaspqrstuvxzabcdefghzasaasaasaasasasasas" } } } } } } }'::documentdb_core.bson)
               Filter: (collection.document OPERATOR(documentdb_api_catalog.@=) '{ "item" : "A" }'::documentdb_core.bson)
               ->  Bitmap Index Scan on ikey_2
                     Index Cond: (collection.document OPERATOR(documentdb_api_catalog.@=) '{ "ikey2" : { "abcdefg" : { "bcdef" : { "cdefg" : { "dhig" : { "f" : { "d" : "abcdefghijklmnoasadasdsadasdsadsadasdsadasdaspqrstuvxzabcdefghzasaasaasaasasasasas" } } } } } } }'::documentdb_core.bson)
(13 rows)

EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests_2') WHERE document @@ '{ "ikey2": { "abcdeasasfg": { "bcassasdef": { "cdefsssg": { "dhsssig": { "ssssb": { "csssss": 2 } } } } } }, "item": "A" }';
                                                                                                                                                                                                                                     QUERY PLAN                                                                                                                                                                                                                                     
---------------------------------------------------------------------
 Custom Scan (Citus Adaptive)
   Output: remote_scan.document
   Task Count: 1
   Tasks Shown: All
   ->  Task
         Query: SELECT document FROM documentdb_data.documents_11501_1150018 collection WHERE ((document OPERATOR(documentdb_api_catalog.#=) '{ "ikey2" : { "abcdeasasfg" : { "bcassasdef" : { "cdefsssg" : { "dhsssig" : { "ssssb" : { "csssss" : { "$numberInt" : "2" } } } } } } } }'::documentdb_core.bsonquery) AND (document OPERATOR(documentdb_api_catalog.#=) '{ "item" : "A" }'::documentdb_core.bsonquery) AND (shard_key_value OPERATOR(pg_catalog.=) '11501'::bigint))
         Node: host=localhost port=58070 dbname=regression
         ->  Bitmap Heap Scan on documentdb_data.documents_11501_1150018 collection
               Output: document
               Recheck Cond: (collection.document OPERATOR(documentdb_api_catalog.@=) '{ "ikey2" : { "abcdeasasfg" : { "bcassasdef" : { "cdefsssg" : { "dhsssig" : { "ssssb" : { "csssss" : { "$numberInt" : "2" } } } } } } } }'::documentdb_core.bson)
               Filter: (collection.document OPERATOR(documentdb_api_catalog.@=) '{ "item" : "A" }'::documentdb_core.bson)
               ->  Bitmap Index Scan on ikey_2
                     Index Cond: (collection.document OPERATOR(documentdb_api_catalog.@=) '{ "ikey2" : { "abcdeasasfg" : { "bcassasdef" : { "cdefsssg" : { "dhsssig" : { "ssssb" : { "csssss" : { "$numberInt" : "2" } } } } } } } }'::documentdb_core.bson)
(13 rows)

EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests_2') WHERE document @@ '{ "ikey2": { "abcdeasasfg": { "bcassasdef": { "cdefsssg": { "dhsssig": { "ssssb": { "c": [[[{ "$binary" : { "base64": "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "00" } }]]] } } } } } }, "item": "A" }';
                                                                                                                                                                                                                                                                                 QUERY PLAN                                                                                                                                                                                                                                                                                 
---------------------------------------------------------------------
 Custom Scan (Citus Adaptive)
   Output: remote_scan.document
   Task Count: 1
   Tasks Shown: All
   ->  Task
         Query: SELECT document FROM documentdb_data.documents_11501_1150018 collection WHERE ((document OPERATOR(documentdb_api_catalog.#=) '{ "ikey2" : { "abcdeasasfg" : { "bcassasdef" : { "cdefsssg" : { "dhsssig" : { "ssssb" : { "c" : [ [ [ { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "00" } } ] ] ] } } } } } } }'::documentdb_core.bsonquery) AND (document OPERATOR(documentdb_api_catalog.#=) '{ "item" : "A" }'::documentdb_core.bsonquery) AND (shard_key_value OPERATOR(pg_catalog.=) '11501'::bigint))
         Node: host=localhost port=58070 dbname=regression
         ->  Bitmap Heap Scan on documentdb_data.documents_11501_1150018 collection
               Output: document
               Recheck Cond: (collection.document OPERATOR(documentdb_api_catalog.@=) '{ "ikey2" : { "abcdeasasfg" : { "bcassasdef" : { "cdefsssg" : { "dhsssig" : { "ssssb" : { "c" : [ [ [ { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "00" } } ] ] ] } } } } } } }'::documentdb_core.bson)
               Filter: (collection.document OPERATOR(documentdb_api_catalog.@=) '{ "item" : "A" }'::documentdb_core.bson)
               ->  Bitmap Index Scan on ikey_2
                     Index Cond: (collection.document OPERATOR(documentdb_api_catalog.@=) '{ "ikey2" : { "abcdeasasfg" : { "bcassasdef" : { "cdefsssg" : { "dhsssig" : { "ssssb" : { "c" : [ [ [ { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "00" } } ] ] ] } } } } } } }'::documentdb_core.bson)
(13 rows)

EXPLAIN (COSTS OFF, VERBOSE ON) SELECT document FROM documentdb_api.collection('db', 'index_truncation_binary_tests_2') WHERE document @@ '{ "ikey2": [[[[[[{ "a": { "b": { "c": { "$binary" : { "base64": "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "00" } } } } } ]]]]]], "item": "A" }';
                                                                                                                                                                                                                                                      QUERY PLAN                                                                                                                                                                                                                                                      
---------------------------------------------------------------------
 Custom Scan (Citus Adaptive)
   Output: remote_scan.document
   Task Count: 1
   Tasks Shown: All
   ->  Task
         Query: SELECT document FROM documentdb_data.documents_11501_1150018 collection WHERE ((document OPERATOR(documentdb_api_catalog.#=) '{ "ikey2" : [ [ [ [ [ [ { "a" : { "b" : { "c" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "00" } } } } } ] ] ] ] ] ] }'::documentdb_core.bsonquery) AND (document OPERATOR(documentdb_api_catalog.#=) '{ "item" : "A" }'::documentdb_core.bsonquery) AND (shard_key_value OPERATOR(pg_catalog.=) '11501'::bigint))
         Node: host=localhost port=58070 dbname=regression
         ->  Bitmap Heap Scan on documentdb_data.documents_11501_1150018 collection
               Output: document
               Recheck Cond: (collection.document OPERATOR(documentdb_api_catalog.@=) '{ "ikey2" : [ [ [ [ [ [ { "a" : { "b" : { "c" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "00" } } } } } ] ] ] ] ] ] }'::documentdb_core.bson)
               Filter: (collection.document OPERATOR(documentdb_api_catalog.@=) '{ "item" : "A" }'::documentdb_core.bson)
               ->  Bitmap Index Scan on ikey_2
                     Index Cond: (collection.document OPERATOR(documentdb_api_catalog.@=) '{ "ikey2" : [ [ [ [ [ [ { "a" : { "b" : { "c" : { "$binary" : { "base64" : "eyAiZXhhbXBsZSI6IDEyMywgInZhbHVlIjogImFib2JvcmEiIH0=", "subType" : "00" } } } } } ] ] ] ] ] ] }'::documentdb_core.bson)
(13 rows)


\c colocation_test
CALL TEST_reset();
SELECT yb_xcluster_ddl_replication.get_replication_role();
 get_replication_role 
----------------------
 source
(1 row)

-- Verify that temporary objects are allowed but not captured.
CREATE TEMP TABLE temp_foo(i int PRIMARY KEY);
-- Verify that colocated tables are allowed.
CREATE TABLE coloc_foo(i int PRIMARY KEY);
SELECT yb_data FROM TEST_filtered_ddl_queue() ORDER BY ddl_end_time;
                                                                                                                                                                                                                                                            yb_data                                                                                                                                                                                                                                                            
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 {"user": "yugabyte", "query": "CREATE TABLE coloc_foo(i int PRIMARY KEY)", "schema": "public", "version": 1, "variables": {"TimeZone": "America/Los_Angeles", "DateStyle": "Postgres, MDY", "IntervalStyle": "postgres_verbose", "default_tablespace": "", "check_function_bodies": "on", "standard_conforming_strings": "on", "yb_use_hash_splitting_by_default": "on"}, "command_tag": "CREATE TABLE", "new_rel_map": [{"rel_name": "coloc_foo", "relfile_oid": "***", "colocation_id": "***", "rel_namespace": "public"}]}
(1 row)

-- Verify that non-colocated table is captured.
CREATE TABLE non_coloc_foo(i int PRIMARY KEY) WITH (COLOCATION = false);
SELECT yb_data FROM TEST_filtered_ddl_queue() ORDER BY ddl_end_time;
                                                                                                                                                                                                                                                                 yb_data                                                                                                                                                                                                                                                                 
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 {"user": "yugabyte", "query": "CREATE TABLE coloc_foo(i int PRIMARY KEY)", "schema": "public", "version": 1, "variables": {"TimeZone": "America/Los_Angeles", "DateStyle": "Postgres, MDY", "IntervalStyle": "postgres_verbose", "default_tablespace": "", "check_function_bodies": "on", "standard_conforming_strings": "on", "yb_use_hash_splitting_by_default": "on"}, "command_tag": "CREATE TABLE", "new_rel_map": [{"rel_name": "coloc_foo", "relfile_oid": "***", "colocation_id": "***", "rel_namespace": "public"}]}
 {"user": "yugabyte", "query": "CREATE TABLE non_coloc_foo(i int PRIMARY KEY) WITH (COLOCATION = false)", "schema": "public", "version": 1, "variables": {"TimeZone": "America/Los_Angeles", "DateStyle": "Postgres, MDY", "IntervalStyle": "postgres_verbose", "default_tablespace": "", "check_function_bodies": "on", "standard_conforming_strings": "on", "yb_use_hash_splitting_by_default": "on"}, "command_tag": "CREATE TABLE", "new_rel_map": [{"rel_name": "non_coloc_foo", "relfile_oid": "***", "rel_namespace": "public"}]}
(2 rows)

SELECT yb_data FROM yb_xcluster_ddl_replication.replicated_ddls ORDER BY ddl_end_time;
                                       yb_data                                        
--------------------------------------------------------------------------------------
 {"query": "CREATE TABLE coloc_foo(i int PRIMARY KEY)"}
 {"query": "CREATE TABLE non_coloc_foo(i int PRIMARY KEY) WITH (COLOCATION = false)"}
(2 rows)

select * from TEST_verify_replicated_ddls();
 test_verify_replicated_ddls 
-----------------------------
 t
(1 row)


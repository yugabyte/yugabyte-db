--
-- See yb_saop_merge_schedule for details about the test.
--
\getenv abs_srcdir PG_ABS_SRCDIR
\set filename :abs_srcdir '/yb_commands/explainrun_saop_merge.sql'
\i :filename
\getenv abs_srcdir PG_ABS_SRCDIR
\set filename :abs_srcdir '/yb_commands/explainrun.sql'
\i :filename
-- A helper script to explain and run a query.  Use in regress tests by
-- defining :explain, :query, and optionally :hint#.
\set explain1 ':explain :hint1 :query;'
\set explain2 ':explain1 :explain :hint2 :query;'
\set explain3 ':explain2 :explain :hint3 :query;'
\set explain4 ':explain3 :explain :hint4 :query;'
\set explain5 ':explain4 :explain :hint5 :query;'
\set explain1run1 ':explain1; :hint1 :query;'
\set explain2run2 ':explain2; :hint1 :query; :hint2 :query;'
\set explain3run3 ':explain3; :hint1 :query; :hint2 :query; :hint3 :query;'
\set explain4run4 ':explain4; :hint1 :query; :hint2 :query; :hint3 :query; :hint4 :query;'
\set explain5run5 ':explain5; :hint1 :query; :hint2 :query; :hint3 :query; :hint4 :query; :hint5 :query;'
-- Default to no hints.
\set hint1 ''
\set hint2 ''
\set hint3 ''
\set hint4 ''
\set hint5 ''
\set explain 'EXPLAIN (ANALYZE, DIST, VERBOSE, COSTS OFF, SUMMARY OFF, TIMING OFF)'
\set off '/*+Set(yb_max_saop_merge_streams 0)*/'
\set on '/*+Set(yb_max_saop_merge_streams 64)*/'
\set hint1 ':off'
\set hint2 ':on'
-- No order
-- SAOP merge should not be used.
\set query 'SELECT * FROM r5n WHERE r1 IN (0, 1, 2, 3) LIMIT 5'
:explain2
                           QUERY PLAN                            
-----------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: n, r5, r3, r1, r2, r4
   ->  Seq Scan on public.r5n (actual rows=5 loops=1)
         Output: n, r5, r3, r1, r2, r4
         Storage Filter: (r5n.r1 = ANY ('{0,1,2,3}'::integer[]))
         Storage Table Read Requests: 1
         Storage Table Read Ops: 6
         Storage Table Rows Scanned: 21
(8 rows)

                           QUERY PLAN                            
-----------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: n, r5, r3, r1, r2, r4
   ->  Seq Scan on public.r5n (actual rows=5 loops=1)
         Output: n, r5, r3, r1, r2, r4
         Storage Filter: (r5n.r1 = ANY ('{0,1,2,3}'::integer[]))
         Storage Table Read Requests: 1
         Storage Table Read Ops: 6
         Storage Table Rows Scanned: 21
(8 rows)

-- No limit
\set query 'SELECT * FROM r5n WHERE r1 IN (0, 1, 2, 3) ORDER BY r2, r3, r4'
:explain2
                                QUERY PLAN                                
--------------------------------------------------------------------------
 Sort (actual rows=1983 loops=1)
   Output: n, r5, r3, r1, r2, r4
   Sort Key: r5n.r2, r5n.r3, r5n.r4
   Sort Method: quicksort
   ->  Index Scan using r5n_pkey on public.r5n (actual rows=1983 loops=1)
         Output: n, r5, r3, r1, r2, r4
         Index Cond: (r5n.r1 = ANY ('{0,1,2,3}'::integer[]))
         Storage Table Read Requests: 2
         Storage Table Read Ops: 8
         Storage Table Rows Scanned: 1983
(10 rows)

                             QUERY PLAN                             
--------------------------------------------------------------------
 Index Scan using r5n_pkey on public.r5n (actual rows=1983 loops=1)
   Output: n, r5, r3, r1, r2, r4
   Index Cond: (r5n.r1 = ANY ('{0,1,2,3}'::integer[]))
   Merge Sort Key: r5n.r2, r5n.r3, r5n.r4
   Merge Stream Key: r5n.r1
   Merge Streams: 4
   Merge Cond: (r5n.r1 = ANY ('{0,1,2,3}'::integer[]))
   Storage Table Read Requests: 5
   Storage Table Read Ops: 8
   Storage Table Rows Scanned: 1983
(10 rows)

-- Forward scan
\set query 'SELECT * FROM r5n WHERE r1 IN (0, 1, 2, 3) ORDER BY r2, r3, r4, n LIMIT 5'
:explain2run2
                                   QUERY PLAN                                   
--------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: n, r5, r3, r1, r2, r4
   ->  Sort (actual rows=5 loops=1)
         Output: n, r5, r3, r1, r2, r4
         Sort Key: r5n.r2, r5n.r3, r5n.r4, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=1983 loops=1)
               Output: n, r5, r3, r1, r2, r4
               Index Cond: (r5n.r1 = ANY ('{0,1,2,3}'::integer[]))
               Storage Table Read Requests: 2
               Storage Table Read Ops: 8
               Storage Table Rows Scanned: 1983
(12 rows)

                                 QUERY PLAN                                  
-----------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: n, r5, r3, r1, r2, r4
   ->  Incremental Sort (actual rows=5 loops=1)
         Output: n, r5, r3, r1, r2, r4
         Sort Key: r5n.r2, r5n.r3, r5n.r4, r5n.n
         Presorted Key: r5n.r2, r5n.r3, r5n.r4
         Full-sort Groups: 1  Sort Method: quicksort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=8 loops=1)
               Output: n, r5, r3, r1, r2, r4
               Index Cond: (r5n.r1 = ANY ('{0,1,2,3}'::integer[]))
               Merge Sort Key: r5n.r2, r5n.r3, r5n.r4
               Merge Stream Key: r5n.r1
               Merge Streams: 4
               Merge Cond: (r5n.r1 = ANY ('{0,1,2,3}'::integer[]))
               Storage Table Read Requests: 1
               Storage Table Read Ops: 4
               Storage Table Rows Scanned: 20
(17 rows)

   n   | r5 | r3 | r1 | r2 | r4 
-------+----+----+----+----+----
 30002 |  3 |  0 |  2 |  0 |  0
 52001 |  5 |  0 |  1 |  0 |  2
 62001 |  6 |  0 |  1 |  0 |  2
 14003 |  1 |  0 |  3 |  0 |  4
 24002 |  2 |  0 |  2 |  0 |  4
(5 rows)

   n   | r5 | r3 | r1 | r2 | r4 
-------+----+----+----+----+----
 30002 |  3 |  0 |  2 |  0 |  0
 52001 |  5 |  0 |  1 |  0 |  2
 62001 |  6 |  0 |  1 |  0 |  2
 14003 |  1 |  0 |  3 |  0 |  4
 24002 |  2 |  0 |  2 |  0 |  4
(5 rows)

-- Backward scan
\set query 'SELECT * FROM r5n WHERE r1 IN (0, 1, 2, 3) ORDER BY r2 DESC, r3 DESC, r4 DESC, n LIMIT 5'
:explain2run2
                                   QUERY PLAN                                   
--------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: n, r5, r3, r1, r2, r4
   ->  Sort (actual rows=5 loops=1)
         Output: n, r5, r3, r1, r2, r4
         Sort Key: r5n.r2 DESC, r5n.r3 DESC, r5n.r4 DESC, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=1983 loops=1)
               Output: n, r5, r3, r1, r2, r4
               Index Cond: (r5n.r1 = ANY ('{0,1,2,3}'::integer[]))
               Storage Table Read Requests: 2
               Storage Table Read Ops: 8
               Storage Table Rows Scanned: 1983
(12 rows)

                                      QUERY PLAN                                      
--------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: n, r5, r3, r1, r2, r4
   ->  Incremental Sort (actual rows=5 loops=1)
         Output: n, r5, r3, r1, r2, r4
         Sort Key: r5n.r2 DESC, r5n.r3 DESC, r5n.r4 DESC, r5n.n
         Presorted Key: r5n.r2, r5n.r3, r5n.r4
         Full-sort Groups: 1  Sort Method: quicksort
         ->  Index Scan Backward using r5n_pkey on public.r5n (actual rows=6 loops=1)
               Output: n, r5, r3, r1, r2, r4
               Index Cond: (r5n.r1 = ANY ('{0,1,2,3}'::integer[]))
               Merge Sort Key: r5n.r2 DESC, r5n.r3 DESC, r5n.r4 DESC
               Merge Stream Key: r5n.r1
               Merge Streams: 4
               Merge Cond: (r5n.r1 = ANY ('{0,1,2,3}'::integer[]))
               Storage Table Read Requests: 1
               Storage Table Read Ops: 4
               Storage Table Rows Scanned: 20
(17 rows)

   n   | r5 | r3 | r1 | r2 | r4 
-------+----+----+----+----+----
 48991 |  4 |  9 |  1 |  9 |  8
 48993 |  4 |  9 |  3 |  9 |  8
 27992 |  2 |  9 |  2 |  9 |  7
 37991 |  3 |  9 |  1 |  9 |  7
 87991 |  8 |  9 |  1 |  9 |  7
(5 rows)

   n   | r5 | r3 | r1 | r2 | r4 
-------+----+----+----+----+----
 48991 |  4 |  9 |  1 |  9 |  8
 48993 |  4 |  9 |  3 |  9 |  8
 27992 |  2 |  9 |  2 |  9 |  7
 37991 |  3 |  9 |  1 |  9 |  7
 87991 |  8 |  9 |  1 |  9 |  7
(5 rows)

-- Partial forward scan
\set query 'SELECT * FROM r5n WHERE r1 IN (0, 1, 2, 3) ORDER BY r2, r3 DESC, r4, n LIMIT 5'
:explain2run2
                                   QUERY PLAN                                   
--------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: n, r5, r3, r1, r2, r4
   ->  Sort (actual rows=5 loops=1)
         Output: n, r5, r3, r1, r2, r4
         Sort Key: r5n.r2, r5n.r3 DESC, r5n.r4, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=1983 loops=1)
               Output: n, r5, r3, r1, r2, r4
               Index Cond: (r5n.r1 = ANY ('{0,1,2,3}'::integer[]))
               Storage Table Read Requests: 2
               Storage Table Read Ops: 8
               Storage Table Rows Scanned: 1983
(12 rows)

                                  QUERY PLAN                                   
-------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: n, r5, r3, r1, r2, r4
   ->  Incremental Sort (actual rows=5 loops=1)
         Output: n, r5, r3, r1, r2, r4
         Sort Key: r5n.r2, r5n.r3 DESC, r5n.r4, r5n.n
         Presorted Key: r5n.r2
         Full-sort Groups: 1  Sort Method: top-N heapsort
         Pre-sorted Groups: 1  Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=193 loops=1)
               Output: n, r5, r3, r1, r2, r4
               Index Cond: (r5n.r1 = ANY ('{0,1,2,3}'::integer[]))
               Merge Sort Key: r5n.r2
               Merge Stream Key: r5n.r1
               Merge Streams: 4
               Merge Cond: (r5n.r1 = ANY ('{0,1,2,3}'::integer[]))
               Storage Table Read Requests: 2
               Storage Table Read Ops: 8
               Storage Table Rows Scanned: 1579
(18 rows)

   n   | r5 | r3 | r1 | r2 | r4 
-------+----+----+----+----+----
 10900 |  1 |  9 |  0 |  0 |  0
 40902 |  4 |  9 |  2 |  0 |  0
 71903 |  7 |  9 |  3 |  0 |  1
  2900 |  0 |  9 |  0 |  0 |  2
 32901 |  3 |  9 |  1 |  0 |  2
(5 rows)

   n   | r5 | r3 | r1 | r2 | r4 
-------+----+----+----+----+----
 10900 |  1 |  9 |  0 |  0 |  0
 40902 |  4 |  9 |  2 |  0 |  0
 71903 |  7 |  9 |  3 |  0 |  1
  2900 |  0 |  9 |  0 |  0 |  2
 32901 |  3 |  9 |  1 |  0 |  2
(5 rows)

-- Partial backward scan
\set query 'SELECT * FROM r5n WHERE r1 IN (0, 1, 2, 3) ORDER BY r2 DESC, r3, r4 DESC, n LIMIT 5'
:explain2run2
                                   QUERY PLAN                                   
--------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: n, r5, r3, r1, r2, r4
   ->  Sort (actual rows=5 loops=1)
         Output: n, r5, r3, r1, r2, r4
         Sort Key: r5n.r2 DESC, r5n.r3, r5n.r4 DESC, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=1983 loops=1)
               Output: n, r5, r3, r1, r2, r4
               Index Cond: (r5n.r1 = ANY ('{0,1,2,3}'::integer[]))
               Storage Table Read Requests: 2
               Storage Table Read Ops: 8
               Storage Table Rows Scanned: 1983
(12 rows)

                                       QUERY PLAN                                       
----------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: n, r5, r3, r1, r2, r4
   ->  Incremental Sort (actual rows=5 loops=1)
         Output: n, r5, r3, r1, r2, r4
         Sort Key: r5n.r2 DESC, r5n.r3, r5n.r4 DESC, r5n.n
         Presorted Key: r5n.r2
         Full-sort Groups: 1  Sort Method: top-N heapsort
         Pre-sorted Groups: 1  Sort Method: top-N heapsort
         ->  Index Scan Backward using r5n_pkey on public.r5n (actual rows=177 loops=1)
               Output: n, r5, r3, r1, r2, r4
               Index Cond: (r5n.r1 = ANY ('{0,1,2,3}'::integer[]))
               Merge Sort Key: r5n.r2 DESC
               Merge Stream Key: r5n.r1
               Merge Streams: 4
               Merge Cond: (r5n.r1 = ANY ('{0,1,2,3}'::integer[]))
               Storage Table Read Requests: 2
               Storage Table Read Ops: 8
               Storage Table Rows Scanned: 1860
(18 rows)

   n   | r5 | r3 | r1 | r2 | r4 
-------+----+----+----+----+----
  7092 |  0 |  0 |  2 |  9 |  7
 77091 |  7 |  0 |  1 |  9 |  7
 46090 |  4 |  0 |  0 |  9 |  6
 46091 |  4 |  0 |  1 |  9 |  6
 76093 |  7 |  0 |  3 |  9 |  6
(5 rows)

   n   | r5 | r3 | r1 | r2 | r4 
-------+----+----+----+----+----
  7092 |  0 |  0 |  2 |  9 |  7
 77091 |  7 |  0 |  1 |  9 |  7
 46090 |  4 |  0 |  0 |  9 |  6
 46091 |  4 |  0 |  1 |  9 |  6
 76093 |  7 |  0 |  3 |  9 |  6
(5 rows)

-- Targets
\set query 'SELECT r5, 1, r5 FROM r5n WHERE r1 IN (0, 1, 2, 3) ORDER BY r2 DESC, r3, r4 DESC, n LIMIT 5'
:explain2run2
                                   QUERY PLAN                                   
--------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r5, 1, r5, r2, r3, r4, n
   ->  Sort (actual rows=5 loops=1)
         Output: r5, 1, r5, r2, r3, r4, n
         Sort Key: r5n.r2 DESC, r5n.r3, r5n.r4 DESC, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=1983 loops=1)
               Output: r5, 1, r5, r2, r3, r4, n
               Index Cond: (r5n.r1 = ANY ('{0,1,2,3}'::integer[]))
               Storage Table Read Requests: 2
               Storage Table Read Ops: 8
               Storage Table Rows Scanned: 1983
(12 rows)

                                       QUERY PLAN                                       
----------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r5, 1, r5, r2, r3, r4, n
   ->  Incremental Sort (actual rows=5 loops=1)
         Output: r5, 1, r5, r2, r3, r4, n
         Sort Key: r5n.r2 DESC, r5n.r3, r5n.r4 DESC, r5n.n
         Presorted Key: r5n.r2
         Full-sort Groups: 1  Sort Method: top-N heapsort
         Pre-sorted Groups: 1  Sort Method: top-N heapsort
         ->  Index Scan Backward using r5n_pkey on public.r5n (actual rows=177 loops=1)
               Output: r5, 1, r5, r2, r3, r4, n
               Index Cond: (r5n.r1 = ANY ('{0,1,2,3}'::integer[]))
               Merge Sort Key: r5n.r2 DESC
               Merge Stream Key: r5n.r1
               Merge Streams: 4
               Merge Cond: (r5n.r1 = ANY ('{0,1,2,3}'::integer[]))
               Storage Table Read Requests: 2
               Storage Table Read Ops: 8
               Storage Table Rows Scanned: 1860
(18 rows)

 r5 | ?column? | r5 
----+----------+----
  0 |        1 |  0
  7 |        1 |  7
  4 |        1 |  4
  4 |        1 |  4
  7 |        1 |  7
(5 rows)

 r5 | ?column? | r5 
----+----------+----
  0 |        1 |  0
  7 |        1 |  7
  4 |        1 |  4
  4 |        1 |  4
  7 |        1 |  7
(5 rows)

-- DISTINCT
\set query 'SELECT DISTINCT r2, r3 FROM r5n WHERE r1 IN (0, 1, 2, 3) ORDER BY r2, r3 LIMIT 5'
:explain2run2
                                          QUERY PLAN                                          
----------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r2, r3
   ->  Sort (actual rows=5 loops=1)
         Output: r2, r3
         Sort Key: r5n.r2, r5n.r3
         Sort Method: top-N heapsort
         ->  HashAggregate (actual rows=100 loops=1)
               Output: r2, r3
               Group Key: r5n.r2, r5n.r3
               ->  Distinct Index Scan using r5n_pkey on public.r5n (actual rows=400 loops=1)
                     Output: r2, r3
                     Index Cond: (r5n.r1 = ANY ('{0,1,2,3}'::integer[]))
                     Distinct Keys: r5n.r1, r5n.r2, r5n.r3
                     Storage Table Read Requests: 2
                     Storage Table Read Ops: 8
                     Storage Table Rows Scanned: 400
(16 rows)

                                      QUERY PLAN                                       
---------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r2, r3
   ->  Unique (actual rows=5 loops=1)
         Output: r2, r3
         ->  Distinct Index Scan using r5n_pkey on public.r5n (actual rows=17 loops=1)
               Output: r2, r3
               Index Cond: (r5n.r1 = ANY ('{0,1,2,3}'::integer[]))
               Merge Sort Key: r5n.r2, r5n.r3
               Merge Stream Key: r5n.r1
               Merge Streams: 4
               Merge Cond: (r5n.r1 = ANY ('{0,1,2,3}'::integer[]))
               Distinct Keys: r5n.r1, r5n.r2, r5n.r3
               Storage Table Read Requests: 1
               Storage Table Read Ops: 4
               Storage Table Rows Scanned: 20
(15 rows)

 r2 | r3 
----+----
  0 |  0
  0 |  1
  0 |  2
  0 |  3
  0 |  4
(5 rows)

 r2 | r3 
----+----
  0 |  0
  0 |  1
  0 |  2
  0 |  3
  0 |  4
(5 rows)

-- GROUP BY
\set query 'SELECT COUNT(*), r2, r3 FROM r5n WHERE r1 IN (0, 1, 2, 3) GROUP BY r2, r3 ORDER BY r2, r3 LIMIT 5'
:explain2run2
                                      QUERY PLAN                                      
--------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: (count(*)), r2, r3
   ->  Sort (actual rows=5 loops=1)
         Output: (count(*)), r2, r3
         Sort Key: r5n.r2, r5n.r3
         Sort Method: top-N heapsort
         ->  HashAggregate (actual rows=100 loops=1)
               Output: count(*), r2, r3
               Group Key: r5n.r2, r5n.r3
               ->  Index Scan using r5n_pkey on public.r5n (actual rows=1983 loops=1)
                     Output: r2, r3
                     Index Cond: (r5n.r1 = ANY ('{0,1,2,3}'::integer[]))
                     Storage Table Read Requests: 2
                     Storage Table Read Ops: 8
                     Storage Table Rows Scanned: 1983
(15 rows)

                                  QUERY PLAN                                   
-------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: (count(*)), r2, r3
   ->  GroupAggregate (actual rows=5 loops=1)
         Output: count(*), r2, r3
         Group Key: r5n.r2, r5n.r3
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=107 loops=1)
               Output: r2, r3
               Index Cond: (r5n.r1 = ANY ('{0,1,2,3}'::integer[]))
               Merge Sort Key: r5n.r2, r5n.r3
               Merge Stream Key: r5n.r1
               Merge Streams: 4
               Merge Cond: (r5n.r1 = ANY ('{0,1,2,3}'::integer[]))
               Storage Table Read Requests: 1
               Storage Table Read Ops: 5
               Storage Table Rows Scanned: 1579
(15 rows)

 count | r2 | r3 
-------+----+----
    20 |  0 |  0
    25 |  0 |  1
    20 |  0 |  2
    20 |  0 |  3
    21 |  0 |  4
(5 rows)

 count | r2 | r3 
-------+----+----
    20 |  0 |  0
    25 |  0 |  1
    20 |  0 |  2
    20 |  0 |  3
    21 |  0 |  4
(5 rows)

-- sort, IN
-- SAOP merge should not be used.
\set query 'SELECT r1, n, r2, r3 FROM r5n WHERE r2 IN (0, 1, 2) ORDER BY r1, n LIMIT 5'
:explain2
                                  QUERY PLAN                                   
-------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r1, n, r2, r3
   ->  Incremental Sort (actual rows=5 loops=1)
         Output: r1, n, r2, r3
         Sort Key: r5n.r1, r5n.n
         Presorted Key: r5n.r1
         Full-sort Groups: 1  Sort Method: top-N heapsort
         Pre-sorted Groups: 1  Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=149 loops=1)
               Output: r1, n, r2, r3
               Index Cond: (r5n.r2 = ANY ('{0,1,2}'::bigint[]))
               Storage Table Read Requests: 3
               Storage Table Read Ops: 3
               Storage Table Rows Scanned: 291
(14 rows)

                                  QUERY PLAN                                   
-------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r1, n, r2, r3
   ->  Incremental Sort (actual rows=5 loops=1)
         Output: r1, n, r2, r3
         Sort Key: r5n.r1, r5n.n
         Presorted Key: r5n.r1
         Full-sort Groups: 1  Sort Method: top-N heapsort
         Pre-sorted Groups: 1  Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=149 loops=1)
               Output: r1, n, r2, r3
               Index Cond: (r5n.r2 = ANY ('{0,1,2}'::bigint[]))
               Storage Table Read Requests: 3
               Storage Table Read Ops: 3
               Storage Table Rows Scanned: 291
(14 rows)

-- _, IN, sort...
-- SAOP merge should not be used.
\set query 'SELECT r3, r4, r5, n, r2, r1 FROM r5n WHERE r2 IN (0, 1, 2) ORDER BY r3, r4, r5, n LIMIT 5'
:explain2
                                   QUERY PLAN                                   
--------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r3, r4, r5, n, r2, r1
   ->  Sort (actual rows=5 loops=1)
         Output: r3, r4, r5, n, r2, r1
         Sort Key: r5n.r3, r5n.r4, r5n.r5, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=1539 loops=1)
               Output: r3, r4, r5, n, r2, r1
               Index Cond: (r5n.r2 = ANY ('{0,1,2}'::bigint[]))
               Storage Table Read Requests: 3
               Storage Table Read Ops: 9
               Storage Table Rows Scanned: 1539
(12 rows)

                                   QUERY PLAN                                   
--------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r3, r4, r5, n, r2, r1
   ->  Sort (actual rows=5 loops=1)
         Output: r3, r4, r5, n, r2, r1
         Sort Key: r5n.r3, r5n.r4, r5n.r5, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=1539 loops=1)
               Output: r3, r4, r5, n, r2, r1
               Index Cond: (r5n.r2 = ANY ('{0,1,2}'::bigint[]))
               Storage Table Read Requests: 3
               Storage Table Read Ops: 9
               Storage Table Rows Scanned: 1539
(12 rows)

-- IN, sort, _, sort...
\set query 'SELECT r2, r4, r5, n, r1, r3 FROM r5n WHERE r1 IN (0, 1, 2) ORDER BY r2, r4, r5, n LIMIT 5'
:explain2run2
                                   QUERY PLAN                                   
--------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r2, r4, r5, n, r1, r3
   ->  Sort (actual rows=5 loops=1)
         Output: r2, r4, r5, n, r1, r3
         Sort Key: r5n.r2, r5n.r4, r5n.r5, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=1489 loops=1)
               Output: r2, r4, r5, n, r1, r3
               Index Cond: (r5n.r1 = ANY ('{0,1,2}'::integer[]))
               Storage Table Read Requests: 2
               Storage Table Read Ops: 7
               Storage Table Rows Scanned: 1489
(12 rows)

                                  QUERY PLAN                                   
-------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r2, r4, r5, n, r1, r3
   ->  Incremental Sort (actual rows=5 loops=1)
         Output: r2, r4, r5, n, r1, r3
         Sort Key: r5n.r2, r5n.r4, r5n.r5, r5n.n
         Presorted Key: r5n.r2
         Full-sort Groups: 1  Sort Method: top-N heapsort
         Pre-sorted Groups: 1  Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=140 loops=1)
               Output: r2, r4, r5, n, r1, r3
               Index Cond: (r5n.r1 = ANY ('{0,1,2}'::integer[]))
               Merge Sort Key: r5n.r2
               Merge Stream Key: r5n.r1
               Merge Streams: 3
               Merge Cond: (r5n.r1 = ANY ('{0,1,2}'::integer[]))
               Storage Table Read Requests: 2
               Storage Table Read Ops: 6
               Storage Table Rows Scanned: 1085
(18 rows)

 r2 | r4 | r5 |   n   | r1 | r3 
----+----+----+-------+----+----
  0 |  0 |  0 |   402 |  2 |  4
  0 |  0 |  1 | 10500 |  0 |  5
  0 |  0 |  1 | 10900 |  0 |  9
  0 |  0 |  3 | 30002 |  2 |  0
  0 |  0 |  3 | 30400 |  0 |  4
(5 rows)

 r2 | r4 | r5 |   n   | r1 | r3 
----+----+----+-------+----+----
  0 |  0 |  0 |   402 |  2 |  4
  0 |  0 |  1 | 10500 |  0 |  5
  0 |  0 |  1 | 10900 |  0 |  9
  0 |  0 |  3 | 30002 |  2 |  0
  0 |  0 |  3 | 30400 |  0 |  4
(5 rows)

-- IN, IN, sort...
\set query 'SELECT r3, r4, r5, n, r1, r2 FROM r5n WHERE r1 IN (0, 1, 2) AND r2 IN (3, 4, 5) ORDER BY r3, r4, r5, n LIMIT 5'
:explain2run2
                                                 QUERY PLAN                                                 
------------------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r3, r4, r5, n, r1, r2
   ->  Sort (actual rows=5 loops=1)
         Output: r3, r4, r5, n, r1, r2
         Sort Key: r5n.r3, r5n.r4, r5n.r5, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=445 loops=1)
               Output: r3, r4, r5, n, r1, r2
               Index Cond: ((r5n.r1 = ANY ('{0,1,2}'::integer[])) AND (r5n.r2 = ANY ('{3,4,5}'::bigint[])))
               Storage Table Read Requests: 2
               Storage Table Read Ops: 7
               Storage Table Rows Scanned: 445
(12 rows)

                                                 QUERY PLAN                                                 
------------------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r3, r4, r5, n, r1, r2
   ->  Incremental Sort (actual rows=5 loops=1)
         Output: r3, r4, r5, n, r1, r2
         Sort Key: r5n.r3, r5n.r4, r5n.r5, r5n.n
         Presorted Key: r5n.r3, r5n.r4, r5n.r5
         Full-sort Groups: 1  Sort Method: quicksort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=6 loops=1)
               Output: r3, r4, r5, n, r1, r2
               Index Cond: ((r5n.r1 = ANY ('{0,1,2}'::integer[])) AND (r5n.r2 = ANY ('{3,4,5}'::bigint[])))
               Merge Sort Key: r5n.r3, r5n.r4, r5n.r5
               Merge Stream Key: r5n.r1, r5n.r2
               Merge Streams: 9
               Merge Cond: ((r5n.r1 = ANY ('{0,1,2}'::integer[])) AND (r5n.r2 = ANY ('{3,4,5}'::bigint[])))
               Storage Table Read Requests: 1
               Storage Table Read Ops: 9
               Storage Table Rows Scanned: 45
(17 rows)

 r3 | r4 | r5 |   n   | r1 | r2 
----+----+----+-------+----+----
  0 |  0 |  4 | 40030 |  0 |  3
  0 |  0 |  5 | 50052 |  2 |  5
  0 |  0 |  6 | 60041 |  1 |  4
  0 |  0 |  6 | 60050 |  0 |  5
  0 |  0 |  6 | 60051 |  1 |  5
(5 rows)

 r3 | r4 | r5 |   n   | r1 | r2 
----+----+----+-------+----+----
  0 |  0 |  4 | 40030 |  0 |  3
  0 |  0 |  5 | 50052 |  2 |  5
  0 |  0 |  6 | 60041 |  1 |  4
  0 |  0 |  6 | 60050 |  0 |  5
  0 |  0 |  6 | 60051 |  1 |  5
(5 rows)

-- IN/=, sort...
-- SAOP merge should not be used.
\set query 'SELECT r1, r2, r3, r4, r5, n FROM r5n WHERE r1 = 2 AND r1 IN (0, 2, 4, 6, 8) ORDER BY r2, r3, r4, r5, n LIMIT 5'
:explain2run2
                                       QUERY PLAN                                       
----------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r1, r2, r3, r4, r5, n
   ->  Incremental Sort (actual rows=5 loops=1)
         Output: r1, r2, r3, r4, r5, n
         Sort Key: r5n.r2, r5n.r3, r5n.r4, r5n.r5, r5n.n
         Presorted Key: r5n.r2, r5n.r3, r5n.r4, r5n.r5
         Full-sort Groups: 1  Sort Method: quicksort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=6 loops=1)
               Output: r1, r2, r3, r4, r5, n
               Index Cond: ((r5n.r1 = ANY ('{0,2,4,6,8}'::integer[])) AND (r5n.r1 = 2))
               Storage Table Read Requests: 2
               Storage Table Read Ops: 2
               Storage Table Rows Scanned: 116
(13 rows)

                                       QUERY PLAN                                       
----------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r1, r2, r3, r4, r5, n
   ->  Incremental Sort (actual rows=5 loops=1)
         Output: r1, r2, r3, r4, r5, n
         Sort Key: r5n.r2, r5n.r3, r5n.r4, r5n.r5, r5n.n
         Presorted Key: r5n.r2, r5n.r3, r5n.r4, r5n.r5
         Full-sort Groups: 1  Sort Method: quicksort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=6 loops=1)
               Output: r1, r2, r3, r4, r5, n
               Index Cond: ((r5n.r1 = ANY ('{0,2,4,6,8}'::integer[])) AND (r5n.r1 = 2))
               Storage Table Read Requests: 2
               Storage Table Read Ops: 2
               Storage Table Rows Scanned: 116
(13 rows)

 r1 | r2 | r3 | r4 | r5 |   n   
----+----+----+----+----+-------
  2 |  0 |  0 |  0 |  3 | 30002
  2 |  0 |  0 |  4 |  2 | 24002
  2 |  0 |  0 |  4 |  3 | 34002
  2 |  0 |  0 |  6 |  9 | 96002
  2 |  0 |  0 |  8 |  2 | 28002
(5 rows)

 r1 | r2 | r3 | r4 | r5 |   n   
----+----+----+----+----+-------
  2 |  0 |  0 |  0 |  3 | 30002
  2 |  0 |  0 |  4 |  2 | 24002
  2 |  0 |  0 |  4 |  3 | 34002
  2 |  0 |  0 |  6 |  9 | 96002
  2 |  0 |  0 |  8 |  2 | 28002
(5 rows)

-- IN, IN/sort, IN, sort...
\set query 'SELECT r2, r4, r5, n, r1, r3 FROM r5n WHERE r1 IN (1, 2, 3, 4) AND r2 IN (1, 9) AND r3 IN (5, 6, 7, 8) ORDER BY r2, r4, r5, n LIMIT 5'
:explain2run2
                                                                       QUERY PLAN                                                                       
--------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r2, r4, r5, n, r1, r3
   ->  Sort (actual rows=5 loops=1)
         Output: r2, r4, r5, n, r1, r3
         Sort Key: r5n.r2, r5n.r4, r5n.r5, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=170 loops=1)
               Output: r2, r4, r5, n, r1, r3
               Index Cond: ((r5n.r1 = ANY ('{1,2,3,4}'::integer[])) AND (r5n.r2 = ANY ('{1,9}'::bigint[])) AND (r5n.r3 = ANY ('{5,6,7,8}'::integer[])))
               Storage Table Read Requests: 2
               Storage Table Read Ops: 7
               Storage Table Rows Scanned: 170
(12 rows)

                                                                       QUERY PLAN                                                                       
--------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r2, r4, r5, n, r1, r3
   ->  Incremental Sort (actual rows=5 loops=1)
         Output: r2, r4, r5, n, r1, r3
         Sort Key: r5n.r2, r5n.r4, r5n.r5, r5n.n
         Presorted Key: r5n.r2, r5n.r4, r5n.r5
         Full-sort Groups: 1  Sort Method: quicksort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=6 loops=1)
               Output: r2, r4, r5, n, r1, r3
               Index Cond: ((r5n.r1 = ANY ('{1,2,3,4}'::integer[])) AND (r5n.r2 = ANY ('{1,9}'::bigint[])) AND (r5n.r3 = ANY ('{5,6,7,8}'::integer[])))
               Merge Sort Key: r5n.r2, r5n.r4, r5n.r5
               Merge Stream Key: r5n.r1, r5n.r3
               Merge Streams: 16
               Merge Cond: ((r5n.r1 = ANY ('{1,2,3,4}'::integer[])) AND (r5n.r3 = ANY ('{5,6,7,8}'::integer[])))
               Storage Table Read Requests: 1
               Storage Table Read Ops: 16
               Storage Table Rows Scanned: 80
(17 rows)

 r2 | r4 | r5 |   n   | r1 | r3 
----+----+----+-------+----+----
  1 |  0 |  0 |   613 |  3 |  6
  1 |  0 |  1 | 10711 |  1 |  7
  1 |  0 |  2 | 20614 |  4 |  6
  1 |  0 |  2 | 20812 |  2 |  8
  1 |  0 |  3 | 30714 |  4 |  7
(5 rows)

 r2 | r4 | r5 |   n   | r1 | r3 
----+----+----+-------+----+----
  1 |  0 |  0 |   613 |  3 |  6
  1 |  0 |  1 | 10711 |  1 |  7
  1 |  0 |  2 | 20614 |  4 |  6
  1 |  0 |  2 | 20812 |  2 |  8
  1 |  0 |  3 | 30714 |  4 |  7
(5 rows)

-- IN, =, IN, sort...
\set query 'SELECT r2, r4, r5, n, r1, r3 FROM r5n WHERE r1 IN (1, 2, 3, 4) AND r2 = 7 AND r3 IN (5, 6, 7, 8) ORDER BY r4, r5, n LIMIT 5'
:explain2run2
                                                            QUERY PLAN                                                            
----------------------------------------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r2, r4, r5, n, r1, r3
   ->  Sort (actual rows=5 loops=1)
         Output: r2, r4, r5, n, r1, r3
         Sort Key: r5n.r4, r5n.r5, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=88 loops=1)
               Output: r2, r4, r5, n, r1, r3
               Index Cond: ((r5n.r1 = ANY ('{1,2,3,4}'::integer[])) AND (r5n.r2 = 7) AND (r5n.r3 = ANY ('{5,6,7,8}'::integer[])))
               Storage Table Read Requests: 2
               Storage Table Read Ops: 7
               Storage Table Rows Scanned: 88
(12 rows)

                                                            QUERY PLAN                                                            
----------------------------------------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r2, r4, r5, n, r1, r3
   ->  Incremental Sort (actual rows=5 loops=1)
         Output: r2, r4, r5, n, r1, r3
         Sort Key: r5n.r4, r5n.r5, r5n.n
         Presorted Key: r5n.r4, r5n.r5
         Full-sort Groups: 1  Sort Method: quicksort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=6 loops=1)
               Output: r2, r4, r5, n, r1, r3
               Index Cond: ((r5n.r1 = ANY ('{1,2,3,4}'::integer[])) AND (r5n.r2 = 7) AND (r5n.r3 = ANY ('{5,6,7,8}'::integer[])))
               Merge Sort Key: r5n.r4, r5n.r5
               Merge Stream Key: r5n.r1, r5n.r3
               Merge Streams: 16
               Merge Cond: ((r5n.r1 = ANY ('{1,2,3,4}'::integer[])) AND (r5n.r3 = ANY ('{5,6,7,8}'::integer[])))
               Storage Table Read Requests: 1
               Storage Table Read Ops: 16
               Storage Table Rows Scanned: 73
(17 rows)

 r2 | r4 | r5 |   n   | r1 | r3 
----+----+----+-------+----+----
  7 |  0 |  2 | 20872 |  2 |  8
  7 |  0 |  4 | 40574 |  4 |  5
  7 |  0 |  5 | 50574 |  4 |  5
  7 |  0 |  5 | 50673 |  3 |  6
  7 |  0 |  5 | 50674 |  4 |  6
(5 rows)

 r2 | r4 | r5 |   n   | r1 | r3 
----+----+----+-------+----+----
  7 |  0 |  2 | 20872 |  2 |  8
  7 |  0 |  4 | 40574 |  4 |  5
  7 |  0 |  5 | 50574 |  4 |  5
  7 |  0 |  5 | 50673 |  3 |  6
  7 |  0 |  5 | 50674 |  4 |  6
(5 rows)

-- IN, =/sort, IN, sort...
\set query 'SELECT r2, r4, r5, n, r1, r3 FROM r5n WHERE r1 IN (1, 2, 3, 4) AND r2 = 7 AND r3 IN (5, 6, 7, 8) ORDER BY r2, r4, r5, n LIMIT 5'
:explain2run2
                                                            QUERY PLAN                                                            
----------------------------------------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r2, r4, r5, n, r1, r3
   ->  Sort (actual rows=5 loops=1)
         Output: r2, r4, r5, n, r1, r3
         Sort Key: r5n.r4, r5n.r5, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=88 loops=1)
               Output: r2, r4, r5, n, r1, r3
               Index Cond: ((r5n.r1 = ANY ('{1,2,3,4}'::integer[])) AND (r5n.r2 = 7) AND (r5n.r3 = ANY ('{5,6,7,8}'::integer[])))
               Storage Table Read Requests: 2
               Storage Table Read Ops: 7
               Storage Table Rows Scanned: 88
(12 rows)

                                                            QUERY PLAN                                                            
----------------------------------------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r2, r4, r5, n, r1, r3
   ->  Incremental Sort (actual rows=5 loops=1)
         Output: r2, r4, r5, n, r1, r3
         Sort Key: r5n.r4, r5n.r5, r5n.n
         Presorted Key: r5n.r4, r5n.r5
         Full-sort Groups: 1  Sort Method: quicksort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=6 loops=1)
               Output: r2, r4, r5, n, r1, r3
               Index Cond: ((r5n.r1 = ANY ('{1,2,3,4}'::integer[])) AND (r5n.r2 = 7) AND (r5n.r3 = ANY ('{5,6,7,8}'::integer[])))
               Merge Sort Key: r5n.r4, r5n.r5
               Merge Stream Key: r5n.r1, r5n.r3
               Merge Streams: 16
               Merge Cond: ((r5n.r1 = ANY ('{1,2,3,4}'::integer[])) AND (r5n.r3 = ANY ('{5,6,7,8}'::integer[])))
               Storage Table Read Requests: 1
               Storage Table Read Ops: 16
               Storage Table Rows Scanned: 73
(17 rows)

 r2 | r4 | r5 |   n   | r1 | r3 
----+----+----+-------+----+----
  7 |  0 |  2 | 20872 |  2 |  8
  7 |  0 |  4 | 40574 |  4 |  5
  7 |  0 |  5 | 50574 |  4 |  5
  7 |  0 |  5 | 50673 |  3 |  6
  7 |  0 |  5 | 50674 |  4 |  6
(5 rows)

 r2 | r4 | r5 |   n   | r1 | r3 
----+----+----+-------+----+----
  7 |  0 |  2 | 20872 |  2 |  8
  7 |  0 |  4 | 40574 |  4 |  5
  7 |  0 |  5 | 50574 |  4 |  5
  7 |  0 |  5 | 50673 |  3 |  6
  7 |  0 |  5 | 50674 |  4 |  6
(5 rows)

-- IN, =/sort, IN, sort... (out-of-order sort)
\set query 'SELECT r2, r4, r5, n, r1, r3 FROM r5n WHERE r1 IN (1, 2, 3, 4) AND r2 = 7 AND r3 IN (5, 6, 7, 8) ORDER BY r4, r5, r2, n LIMIT 5'
:explain2run2
                                                            QUERY PLAN                                                            
----------------------------------------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r2, r4, r5, n, r1, r3
   ->  Sort (actual rows=5 loops=1)
         Output: r2, r4, r5, n, r1, r3
         Sort Key: r5n.r4, r5n.r5, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=88 loops=1)
               Output: r2, r4, r5, n, r1, r3
               Index Cond: ((r5n.r1 = ANY ('{1,2,3,4}'::integer[])) AND (r5n.r2 = 7) AND (r5n.r3 = ANY ('{5,6,7,8}'::integer[])))
               Storage Table Read Requests: 2
               Storage Table Read Ops: 7
               Storage Table Rows Scanned: 88
(12 rows)

                                                            QUERY PLAN                                                            
----------------------------------------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r2, r4, r5, n, r1, r3
   ->  Incremental Sort (actual rows=5 loops=1)
         Output: r2, r4, r5, n, r1, r3
         Sort Key: r5n.r4, r5n.r5, r5n.n
         Presorted Key: r5n.r4, r5n.r5
         Full-sort Groups: 1  Sort Method: quicksort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=6 loops=1)
               Output: r2, r4, r5, n, r1, r3
               Index Cond: ((r5n.r1 = ANY ('{1,2,3,4}'::integer[])) AND (r5n.r2 = 7) AND (r5n.r3 = ANY ('{5,6,7,8}'::integer[])))
               Merge Sort Key: r5n.r4, r5n.r5
               Merge Stream Key: r5n.r1, r5n.r3
               Merge Streams: 16
               Merge Cond: ((r5n.r1 = ANY ('{1,2,3,4}'::integer[])) AND (r5n.r3 = ANY ('{5,6,7,8}'::integer[])))
               Storage Table Read Requests: 1
               Storage Table Read Ops: 16
               Storage Table Rows Scanned: 73
(17 rows)

 r2 | r4 | r5 |   n   | r1 | r3 
----+----+----+-------+----+----
  7 |  0 |  2 | 20872 |  2 |  8
  7 |  0 |  4 | 40574 |  4 |  5
  7 |  0 |  5 | 50574 |  4 |  5
  7 |  0 |  5 | 50673 |  3 |  6
  7 |  0 |  5 | 50674 |  4 |  6
(5 rows)

 r2 | r4 | r5 |   n   | r1 | r3 
----+----+----+-------+----+----
  7 |  0 |  2 | 20872 |  2 |  8
  7 |  0 |  4 | 40574 |  4 |  5
  7 |  0 |  5 | 50574 |  4 |  5
  7 |  0 |  5 | 50673 |  3 |  6
  7 |  0 |  5 | 50674 |  4 |  6
(5 rows)

-- IN, =/sort, IN/sort, sort...
\set query 'SELECT r2, r3, r4, r5, n, r1 FROM r5n WHERE r1 IN (1, 2, 3, 4) AND r2 = 7 AND r3 IN (5, 6, 7, 8) ORDER BY r2, r3, r4, r5, n LIMIT 5'
:explain2run2
                                                            QUERY PLAN                                                            
----------------------------------------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r2, r3, r4, r5, n, r1
   ->  Sort (actual rows=5 loops=1)
         Output: r2, r3, r4, r5, n, r1
         Sort Key: r5n.r3, r5n.r4, r5n.r5, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=88 loops=1)
               Output: r2, r3, r4, r5, n, r1
               Index Cond: ((r5n.r1 = ANY ('{1,2,3,4}'::integer[])) AND (r5n.r2 = 7) AND (r5n.r3 = ANY ('{5,6,7,8}'::integer[])))
               Storage Table Read Requests: 2
               Storage Table Read Ops: 7
               Storage Table Rows Scanned: 88
(12 rows)

                                                            QUERY PLAN                                                            
----------------------------------------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r2, r3, r4, r5, n, r1
   ->  Incremental Sort (actual rows=5 loops=1)
         Output: r2, r3, r4, r5, n, r1
         Sort Key: r5n.r3, r5n.r4, r5n.r5, r5n.n
         Presorted Key: r5n.r3, r5n.r4, r5n.r5
         Full-sort Groups: 1  Sort Method: quicksort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=6 loops=1)
               Output: r2, r3, r4, r5, n, r1
               Index Cond: ((r5n.r1 = ANY ('{1,2,3,4}'::integer[])) AND (r5n.r2 = 7) AND (r5n.r3 = ANY ('{5,6,7,8}'::integer[])))
               Merge Sort Key: r5n.r3, r5n.r4, r5n.r5
               Merge Stream Key: r5n.r1
               Merge Streams: 4
               Merge Cond: (r5n.r1 = ANY ('{1,2,3,4}'::integer[]))
               Storage Table Read Requests: 1
               Storage Table Read Ops: 4
               Storage Table Rows Scanned: 20
(17 rows)

 r2 | r3 | r4 | r5 |   n   | r1 
----+----+----+----+-------+----
  7 |  5 |  0 |  4 | 40574 |  4
  7 |  5 |  0 |  5 | 50574 |  4
  7 |  5 |  0 |  7 | 70574 |  4
  7 |  5 |  2 |  0 |  2572 |  2
  7 |  5 |  2 |  0 |  2574 |  4
(5 rows)

 r2 | r3 | r4 | r5 |   n   | r1 
----+----+----+----+-------+----
  7 |  5 |  0 |  4 | 40574 |  4
  7 |  5 |  0 |  5 | 50574 |  4
  7 |  5 |  0 |  7 | 70574 |  4
  7 |  5 |  2 |  0 |  2572 |  2
  7 |  5 |  2 |  0 |  2574 |  4
(5 rows)

-- IN, IN/=/IN, sort...
\set query 'SELECT r2, r3, r4, r5, n, r1 FROM r5n WHERE r1 IN (0, 1, 2, 3, 4, 5, 6) AND r2 IN (0, 1, 2) AND r2 = 2 AND r2 IN (1, 2, 3) ORDER BY r3, r4, r5, n LIMIT 5'
:explain2run2
                                                                                  QUERY PLAN                                                                                  
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r2, r3, r4, r5, n, r1
   ->  Sort (actual rows=5 loops=1)
         Output: r2, r3, r4, r5, n, r1
         Sort Key: r5n.r3, r5n.r4, r5n.r5, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=338 loops=1)
               Output: r2, r3, r4, r5, n, r1
               Index Cond: ((r5n.r1 = ANY ('{0,1,2,3,4,5,6}'::integer[])) AND (r5n.r2 = ANY ('{0,1,2}'::bigint[])) AND (r5n.r2 = ANY ('{1,2,3}'::bigint[])) AND (r5n.r2 = 2))
               Storage Table Read Requests: 2
               Storage Table Read Ops: 8
               Storage Table Rows Scanned: 338
(12 rows)

                                                                                  QUERY PLAN                                                                                  
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r2, r3, r4, r5, n, r1
   ->  Incremental Sort (actual rows=5 loops=1)
         Output: r2, r3, r4, r5, n, r1
         Sort Key: r5n.r3, r5n.r4, r5n.r5, r5n.n
         Presorted Key: r5n.r3, r5n.r4, r5n.r5
         Full-sort Groups: 1  Sort Method: quicksort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=6 loops=1)
               Output: r2, r3, r4, r5, n, r1
               Index Cond: ((r5n.r1 = ANY ('{0,1,2,3,4,5,6}'::integer[])) AND (r5n.r2 = ANY ('{0,1,2}'::bigint[])) AND (r5n.r2 = ANY ('{1,2,3}'::bigint[])) AND (r5n.r2 = 2))
               Merge Sort Key: r5n.r3, r5n.r4, r5n.r5
               Merge Stream Key: r5n.r1
               Merge Streams: 7
               Merge Cond: (r5n.r1 = ANY ('{0,1,2,3,4,5,6}'::integer[]))
               Storage Table Read Requests: 1
               Storage Table Read Ops: 7
               Storage Table Rows Scanned: 35
(17 rows)

 r2 | r3 | r4 | r5 |   n   | r1 
----+----+----+----+-------+----
  2 |  0 |  0 |  0 |    23 |  3
  2 |  0 |  0 |  4 | 40021 |  1
  2 |  0 |  0 |  5 | 50023 |  3
  2 |  0 |  0 |  6 | 60022 |  2
  2 |  0 |  0 |  6 | 60023 |  3
(5 rows)

 r2 | r3 | r4 | r5 |   n   | r1 
----+----+----+----+-------+----
  2 |  0 |  0 |  0 |    23 |  3
  2 |  0 |  0 |  4 | 40021 |  1
  2 |  0 |  0 |  5 | 50023 |  3
  2 |  0 |  0 |  6 | 60022 |  2
  2 |  0 |  0 |  6 | 60023 |  3
(5 rows)

-- IN/=/IN, IN, sort...
\set query 'SELECT r1, r3, r4, r5, n, r2 FROM r5n WHERE r2 IN (0, 1, 2, 3, 4, 5, 6) AND r1 IN (0, 1, 2) AND r1 = 2 AND r1 IN (1, 2, 3) ORDER BY r3, r4, r5, n LIMIT 5'
:explain2run2
                                                                                  QUERY PLAN                                                                                   
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r1, r3, r4, r5, n, r2
   ->  Sort (actual rows=5 loops=1)
         Output: r1, r3, r4, r5, n, r2
         Sort Key: r5n.r3, r5n.r4, r5n.r5, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=364 loops=1)
               Output: r1, r3, r4, r5, n, r2
               Index Cond: ((r5n.r1 = ANY ('{0,1,2}'::integer[])) AND (r5n.r1 = ANY ('{1,2,3}'::integer[])) AND (r5n.r1 = 2) AND (r5n.r2 = ANY ('{0,1,2,3,4,5,6}'::bigint[])))
               Storage Table Read Requests: 1
               Storage Table Read Ops: 5
               Storage Table Rows Scanned: 364
(12 rows)

                                                                                  QUERY PLAN                                                                                   
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r1, r3, r4, r5, n, r2
   ->  Incremental Sort (actual rows=5 loops=1)
         Output: r1, r3, r4, r5, n, r2
         Sort Key: r5n.r3, r5n.r4, r5n.r5, r5n.n
         Presorted Key: r5n.r3, r5n.r4, r5n.r5
         Full-sort Groups: 1  Sort Method: quicksort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=6 loops=1)
               Output: r1, r3, r4, r5, n, r2
               Index Cond: ((r5n.r1 = ANY ('{0,1,2}'::integer[])) AND (r5n.r1 = ANY ('{1,2,3}'::integer[])) AND (r5n.r1 = 2) AND (r5n.r2 = ANY ('{0,1,2,3,4,5,6}'::bigint[])))
               Merge Sort Key: r5n.r3, r5n.r4, r5n.r5
               Merge Stream Key: r5n.r2
               Merge Streams: 7
               Merge Cond: (r5n.r2 = ANY ('{0,1,2,3,4,5,6}'::bigint[]))
               Storage Table Read Requests: 1
               Storage Table Read Ops: 7
               Storage Table Rows Scanned: 35
(17 rows)

 r1 | r3 | r4 | r5 |   n   | r2 
----+----+----+----+-------+----
  2 |  0 |  0 |  3 | 30002 |  0
  2 |  0 |  0 |  5 | 50052 |  5
  2 |  0 |  0 |  6 | 60022 |  2
  2 |  0 |  0 |  7 | 70032 |  3
  2 |  0 |  1 |  7 | 71032 |  3
(5 rows)

 r1 | r3 | r4 | r5 |   n   | r2 
----+----+----+----+-------+----
  2 |  0 |  0 |  3 | 30002 |  0
  2 |  0 |  0 |  5 | 50052 |  5
  2 |  0 |  0 |  6 | 60022 |  2
  2 |  0 |  0 |  7 | 70032 |  3
  2 |  0 |  1 |  7 | 71032 |  3
(5 rows)

-- =, IN/IN, sort...
\set query 'SELECT r1, r3, r4, r5, n, r2 FROM r5n WHERE r1 = 7 AND r2 IN (1, 2, 3, 4) AND r2 IN (0, 2, 4, 6, 8) ORDER BY r3, r4, r5, n LIMIT 5'
:explain2run2
                                                            QUERY PLAN                                                            
----------------------------------------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r1, r3, r4, r5, n, r2
   ->  Sort (actual rows=5 loops=1)
         Output: r1, r3, r4, r5, n, r2
         Sort Key: r5n.r3, r5n.r4, r5n.r5, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=96 loops=1)
               Output: r1, r3, r4, r5, n, r2
               Index Cond: ((r5n.r1 = 7) AND (r5n.r2 = ANY ('{1,2,3,4}'::bigint[])) AND (r5n.r2 = ANY ('{0,2,4,6,8}'::bigint[])))
               Rows Removed by Index Recheck: 151
               Storage Table Read Requests: 1
               Storage Table Read Ops: 1
               Storage Table Rows Scanned: 247
(13 rows)

                                                            QUERY PLAN                                                            
----------------------------------------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r1, r3, r4, r5, n, r2
   ->  Incremental Sort (actual rows=5 loops=1)
         Output: r1, r3, r4, r5, n, r2
         Sort Key: r5n.r3, r5n.r4, r5n.r5, r5n.n
         Presorted Key: r5n.r3, r5n.r4, r5n.r5
         Full-sort Groups: 1  Sort Method: quicksort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=6 loops=1)
               Output: r1, r3, r4, r5, n, r2
               Index Cond: ((r5n.r1 = 7) AND (r5n.r2 = ANY ('{1,2,3,4}'::bigint[])) AND (r5n.r2 = ANY ('{0,2,4,6,8}'::bigint[])))
               Rows Removed by Index Recheck: 5
               Merge Sort Key: r5n.r3, r5n.r4, r5n.r5
               Merge Stream Key: r5n.r2
               Merge Streams: 4
               Merge Cond: (r5n.r2 = ANY ('{1,2,3,4}'::bigint[]))
               Storage Table Read Requests: 1
               Storage Table Read Ops: 4
               Storage Table Rows Scanned: 20
(18 rows)

 r1 | r3 | r4 | r5 |   n   | r2 
----+----+----+----+-------+----
  7 |  0 |  1 |  9 | 91027 |  2
  7 |  0 |  2 |  0 |  2027 |  2
  7 |  0 |  2 |  2 | 22047 |  4
  7 |  0 |  2 |  9 | 92027 |  2
  7 |  0 |  4 |  8 | 84027 |  2
(5 rows)

 r1 | r3 | r4 | r5 |   n   | r2 
----+----+----+----+-------+----
  7 |  0 |  1 |  9 | 91027 |  2
  7 |  0 |  2 |  0 |  2027 |  2
  7 |  0 |  2 |  2 | 22047 |  4
  7 |  0 |  2 |  9 | 92027 |  2
  7 |  0 |  4 |  8 | 84027 |  2
(5 rows)

-- =, not-IN/IN, sort...
\set query 'SELECT r1, r3, r4, r5, n, r2 FROM r5n WHERE r1 = 7 AND r2 IN (1, 2, 3, 4) AND r2 NOT IN (0, 2, 4, 6, 8) ORDER BY r3, r4, r5, n LIMIT 5'
:explain2run2
                                     QUERY PLAN                                      
-------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r1, r3, r4, r5, n, r2
   ->  Sort (actual rows=5 loops=1)
         Output: r1, r3, r4, r5, n, r2
         Sort Key: r5n.r3, r5n.r4, r5n.r5, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=99 loops=1)
               Output: r1, r3, r4, r5, n, r2
               Index Cond: ((r5n.r1 = 7) AND (r5n.r2 = ANY ('{1,2,3,4}'::bigint[])))
               Storage Filter: (r5n.r2 <> ALL ('{0,2,4,6,8}'::bigint[]))
               Storage Table Read Requests: 1
               Storage Table Read Ops: 1
               Storage Table Rows Scanned: 195
(13 rows)

                                     QUERY PLAN                                      
-------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r1, r3, r4, r5, n, r2
   ->  Incremental Sort (actual rows=5 loops=1)
         Output: r1, r3, r4, r5, n, r2
         Sort Key: r5n.r3, r5n.r4, r5n.r5, r5n.n
         Presorted Key: r5n.r3, r5n.r4, r5n.r5
         Full-sort Groups: 1  Sort Method: quicksort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=6 loops=1)
               Output: r1, r3, r4, r5, n, r2
               Index Cond: ((r5n.r1 = 7) AND (r5n.r2 = ANY ('{1,2,3,4}'::bigint[])))
               Merge Sort Key: r5n.r3, r5n.r4, r5n.r5
               Merge Stream Key: r5n.r2
               Merge Streams: 4
               Merge Cond: (r5n.r2 = ANY ('{1,2,3,4}'::bigint[]))
               Storage Filter: (r5n.r2 <> ALL ('{0,2,4,6,8}'::bigint[]))
               Storage Table Read Requests: 1
               Storage Table Read Ops: 4
               Storage Table Rows Scanned: 106
(18 rows)

 r1 | r3 | r4 | r5 |   n   | r2 
----+----+----+----+-------+----
  7 |  0 |  0 |  1 | 10037 |  3
  7 |  0 |  3 |  2 | 23017 |  1
  7 |  0 |  3 |  4 | 43037 |  3
  7 |  0 |  3 |  6 | 63037 |  3
  7 |  0 |  4 |  0 |  4037 |  3
(5 rows)

 r1 | r3 | r4 | r5 |   n   | r2 
----+----+----+----+-------+----
  7 |  0 |  0 |  1 | 10037 |  3
  7 |  0 |  3 |  2 | 23017 |  1
  7 |  0 |  3 |  4 | 43037 |  3
  7 |  0 |  3 |  6 | 63037 |  3
  7 |  0 |  4 |  0 |  4037 |  3
(5 rows)

-- IN/>/<, sort...
\set query 'SELECT r2, r3, r4, r5, n, r1 FROM r5n WHERE r1 > 1 AND r1 IN (0, 2, 4, 6, 8) AND r1 < 7 ORDER BY r2, r3, r4, r5, n LIMIT 5'
:explain2run2
                                               QUERY PLAN                                                
---------------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r2, r3, r4, r5, n, r1
   ->  Sort (actual rows=5 loops=1)
         Output: r2, r3, r4, r5, n, r1
         Sort Key: r5n.r2, r5n.r3, r5n.r4, r5n.r5, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=1546 loops=1)
               Output: r2, r3, r4, r5, n, r1
               Index Cond: ((r5n.r1 > 1) AND (r5n.r1 = ANY ('{0,2,4,6,8}'::integer[])) AND (r5n.r1 < 7))
               Rows Removed by Index Recheck: 1014
               Storage Table Read Requests: 3
               Storage Table Read Ops: 9
               Storage Table Rows Scanned: 2560
(13 rows)

                                               QUERY PLAN                                                
---------------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r2, r3, r4, r5, n, r1
   ->  Incremental Sort (actual rows=5 loops=1)
         Output: r2, r3, r4, r5, n, r1
         Sort Key: r5n.r2, r5n.r3, r5n.r4, r5n.r5, r5n.n
         Presorted Key: r5n.r2, r5n.r3, r5n.r4, r5n.r5
         Full-sort Groups: 1  Sort Method: quicksort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=6 loops=1)
               Output: r2, r3, r4, r5, n, r1
               Index Cond: ((r5n.r1 > 1) AND (r5n.r1 = ANY ('{0,2,4,6,8}'::integer[])) AND (r5n.r1 < 7))
               Rows Removed by Index Recheck: 1
               Merge Sort Key: r5n.r2, r5n.r3, r5n.r4, r5n.r5
               Merge Stream Key: r5n.r1
               Merge Streams: 5
               Merge Cond: (r5n.r1 = ANY ('{0,2,4,6,8}'::integer[]))
               Storage Table Read Requests: 1
               Storage Table Read Ops: 5
               Storage Table Rows Scanned: 25
(18 rows)

 r2 | r3 | r4 | r5 |   n   | r1 
----+----+----+----+-------+----
  0 |  0 |  0 |  0 |     6 |  6
  0 |  0 |  0 |  3 | 30002 |  2
  0 |  0 |  1 |  3 | 31004 |  4
  0 |  0 |  4 |  1 | 14006 |  6
  0 |  0 |  4 |  2 | 24002 |  2
(5 rows)

 r2 | r3 | r4 | r5 |   n   | r1 
----+----+----+----+-------+----
  0 |  0 |  0 |  0 |     6 |  6
  0 |  0 |  0 |  3 | 30002 |  2
  0 |  0 |  1 |  3 | 31004 |  4
  0 |  0 |  4 |  1 | 14006 |  6
  0 |  0 |  4 |  2 | 24002 |  2
(5 rows)

-- Not-IN, sort...
-- SAOP merge should not be used.
\set query 'SELECT r2, r3, r4, r5, n, r1 FROM r5n WHERE r1 NOT IN (0, 2, 4, 6, 8) ORDER BY r2, r3, r4, r5, n LIMIT 5'
:explain2
                                QUERY PLAN                                
--------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r2, r3, r4, r5, n, r1
   ->  Sort (actual rows=5 loops=1)
         Output: r2, r3, r4, r5, n, r1
         Sort Key: r5n.r2, r5n.r3, r5n.r4, r5n.r5, r5n.n
         Sort Method: top-N heapsort
         ->  Seq Scan on public.r5n (actual rows=2488 loops=1)
               Output: r2, r3, r4, r5, n, r1
               Storage Filter: (r5n.r1 <> ALL ('{0,2,4,6,8}'::integer[]))
               Storage Table Read Requests: 3
               Storage Table Read Ops: 9
               Storage Table Rows Scanned: 5048
(12 rows)

                                QUERY PLAN                                
--------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r2, r3, r4, r5, n, r1
   ->  Sort (actual rows=5 loops=1)
         Output: r2, r3, r4, r5, n, r1
         Sort Key: r5n.r2, r5n.r3, r5n.r4, r5n.r5, r5n.n
         Sort Method: top-N heapsort
         ->  Seq Scan on public.r5n (actual rows=2488 loops=1)
               Output: r2, r3, r4, r5, n, r1
               Storage Filter: (r5n.r1 <> ALL ('{0,2,4,6,8}'::integer[]))
               Storage Table Read Requests: 3
               Storage Table Read Ops: 9
               Storage Table Rows Scanned: 5048
(12 rows)

-- =ANY, sort...
\set query 'SELECT r2, r3, r4, r5, n, r1 FROM r5n WHERE r1 = ANY (ARRAY[[[0], [2]], [[4], [6]], [[8], [10]]]) ORDER BY r2, r3, r4, r5, n LIMIT 5'
:explain2run2
                                        QUERY PLAN                                        
------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r2, r3, r4, r5, n, r1
   ->  Sort (actual rows=5 loops=1)
         Output: r2, r3, r4, r5, n, r1
         Sort Key: r5n.r2, r5n.r3, r5n.r4, r5n.r5, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=2560 loops=1)
               Output: r2, r3, r4, r5, n, r1
               Index Cond: (r5n.r1 = ANY ('{{{0},{2}},{{4},{6}},{{8},{10}}}'::integer[]))
               Storage Table Read Requests: 3
               Storage Table Read Ops: 9
               Storage Table Rows Scanned: 2560
(12 rows)

                                        QUERY PLAN                                        
------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r2, r3, r4, r5, n, r1
   ->  Incremental Sort (actual rows=5 loops=1)
         Output: r2, r3, r4, r5, n, r1
         Sort Key: r5n.r2, r5n.r3, r5n.r4, r5n.r5, r5n.n
         Presorted Key: r5n.r2, r5n.r3, r5n.r4, r5n.r5
         Full-sort Groups: 1  Sort Method: quicksort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=6 loops=1)
               Output: r2, r3, r4, r5, n, r1
               Index Cond: (r5n.r1 = ANY ('{{{0},{2}},{{4},{6}},{{8},{10}}}'::integer[]))
               Merge Sort Key: r5n.r2, r5n.r3, r5n.r4, r5n.r5
               Merge Stream Key: r5n.r1
               Merge Streams: 6
               Merge Cond: (r5n.r1 = ANY ('{{{0},{2}},{{4},{6}},{{8},{10}}}'::integer[]))
               Storage Table Read Requests: 1
               Storage Table Read Ops: 6
               Storage Table Rows Scanned: 25
(17 rows)

 r2 | r3 | r4 | r5 |   n   | r1 
----+----+----+----+-------+----
  0 |  0 |  0 |  0 |     6 |  6
  0 |  0 |  0 |  0 |     8 |  8
  0 |  0 |  0 |  3 | 30002 |  2
  0 |  0 |  1 |  3 | 31004 |  4
  0 |  0 |  4 |  1 | 14006 |  6
(5 rows)

 r2 | r3 | r4 | r5 |   n   | r1 
----+----+----+----+-------+----
  0 |  0 |  0 |  0 |     6 |  6
  0 |  0 |  0 |  0 |     8 |  8
  0 |  0 |  0 |  3 | 30002 |  2
  0 |  0 |  1 |  3 | 31004 |  4
  0 |  0 |  4 |  1 | 14006 |  6
(5 rows)

-- >ANY, sort...
-- SAOP merge should not be used.
\set query 'SELECT r2, r3, r4, r5, n, r1 FROM r5n WHERE r1 > ANY (ARRAY[0, 2, 4, 6, 8]) ORDER BY r2, r3, r4, r5, n LIMIT 5'
:explain2
                                   QUERY PLAN                                   
--------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r2, r3, r4, r5, n, r1
   ->  Sort (actual rows=5 loops=1)
         Output: r2, r3, r4, r5, n, r1
         Sort Key: r5n.r2, r5n.r3, r5n.r4, r5n.r5, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=4571 loops=1)
               Output: r2, r3, r4, r5, n, r1
               Index Cond: (r5n.r1 > ANY ('{0,2,4,6,8}'::integer[]))
               Rows Removed by Index Recheck: 477
               Storage Table Read Requests: 5
               Storage Table Read Ops: 11
               Storage Table Rows Scanned: 5048
(13 rows)

                                   QUERY PLAN                                   
--------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r2, r3, r4, r5, n, r1
   ->  Sort (actual rows=5 loops=1)
         Output: r2, r3, r4, r5, n, r1
         Sort Key: r5n.r2, r5n.r3, r5n.r4, r5n.r5, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=4571 loops=1)
               Output: r2, r3, r4, r5, n, r1
               Index Cond: (r5n.r1 > ANY ('{0,2,4,6,8}'::integer[]))
               Rows Removed by Index Recheck: 477
               Storage Table Read Requests: 5
               Storage Table Read Ops: 11
               Storage Table Rows Scanned: 5048
(13 rows)

-- >=ALL, sort...
-- SAOP merge should not be used.
\set query 'SELECT r2, r3, r4, r5, n, r1 FROM r5n WHERE r1 >= ALL (ARRAY[0, 2, 4, 6, 8]) ORDER BY r2, r3, r4, r5, n LIMIT 5'
:explain2
                                QUERY PLAN                                
--------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r2, r3, r4, r5, n, r1
   ->  Sort (actual rows=5 loops=1)
         Output: r2, r3, r4, r5, n, r1
         Sort Key: r5n.r2, r5n.r3, r5n.r4, r5n.r5, r5n.n
         Sort Method: top-N heapsort
         ->  Seq Scan on public.r5n (actual rows=1034 loops=1)
               Output: r2, r3, r4, r5, n, r1
               Storage Filter: (r5n.r1 >= ALL ('{0,2,4,6,8}'::integer[]))
               Storage Table Read Requests: 3
               Storage Table Read Ops: 9
               Storage Table Rows Scanned: 5048
(12 rows)

                                QUERY PLAN                                
--------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r2, r3, r4, r5, n, r1
   ->  Sort (actual rows=5 loops=1)
         Output: r2, r3, r4, r5, n, r1
         Sort Key: r5n.r2, r5n.r3, r5n.r4, r5n.r5, r5n.n
         Sort Method: top-N heapsort
         ->  Seq Scan on public.r5n (actual rows=1034 loops=1)
               Output: r2, r3, r4, r5, n, r1
               Storage Filter: (r5n.r1 >= ALL ('{0,2,4,6,8}'::integer[]))
               Storage Table Read Requests: 3
               Storage Table Read Ops: 9
               Storage Table Rows Scanned: 5048
(12 rows)

-- IN, sort, =, sort
\set query 'SELECT r3, r2, r4, n, r1 FROM r5n WHERE r1 IN (0, 1, 2, 3, 4, 5) AND r3 = 2 ORDER BY r2, r4, n LIMIT 5'
:explain2run2
                                        QUERY PLAN                                        
------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r3, r2, r4, n, r1
   ->  Sort (actual rows=5 loops=1)
         Output: r3, r2, r4, n, r1
         Sort Key: r5n.r2, r5n.r4, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=302 loops=1)
               Output: r3, r2, r4, n, r1
               Index Cond: ((r5n.r1 = ANY ('{0,1,2,3,4,5}'::integer[])) AND (r5n.r3 = 2))
               Storage Table Read Requests: 2
               Storage Table Read Ops: 8
               Storage Table Rows Scanned: 302
(12 rows)

                                        QUERY PLAN                                        
------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r3, r2, r4, n, r1
   ->  Incremental Sort (actual rows=5 loops=1)
         Output: r3, r2, r4, n, r1
         Sort Key: r5n.r2, r5n.r4, r5n.n
         Presorted Key: r5n.r2, r5n.r4
         Full-sort Groups: 1  Sort Method: quicksort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=7 loops=1)
               Output: r3, r2, r4, n, r1
               Index Cond: ((r5n.r1 = ANY ('{0,1,2,3,4,5}'::integer[])) AND (r5n.r3 = 2))
               Merge Sort Key: r5n.r2, r5n.r4
               Merge Stream Key: r5n.r1
               Merge Streams: 6
               Merge Cond: (r5n.r1 = ANY ('{0,1,2,3,4,5}'::integer[]))
               Storage Table Read Requests: 1
               Storage Table Read Ops: 6
               Storage Table Rows Scanned: 30
(17 rows)

 r3 | r2 | r4 |   n   | r1 
----+----+----+-------+----
  2 |  0 |  0 |   203 |  3
  2 |  0 |  0 | 90205 |  5
  2 |  0 |  1 | 11203 |  3
  2 |  0 |  1 | 31204 |  4
  2 |  0 |  1 | 41202 |  2
(5 rows)

 r3 | r2 | r4 |   n   | r1 
----+----+----+-------+----
  2 |  0 |  0 |   203 |  3
  2 |  0 |  0 | 90205 |  5
  2 |  0 |  1 | 11203 |  3
  2 |  0 |  1 | 31204 |  4
  2 |  0 |  1 | 41202 |  2
(5 rows)

-- =, sort, IN, sort
-- SAOP merge should not be used.
\set query 'SELECT r1, r2, r4, n, r3 FROM r5n WHERE r1 = 2 AND r3 IN (0, 1, 2, 3, 4, 5) ORDER BY r2, r4, n LIMIT 5'
:explain2
                                        QUERY PLAN                                        
------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r1, r2, r4, n, r3
   ->  Incremental Sort (actual rows=5 loops=1)
         Output: r1, r2, r4, n, r3
         Sort Key: r5n.r2, r5n.r4, r5n.n
         Presorted Key: r5n.r2
         Full-sort Groups: 1  Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=33 loops=1)
               Output: r1, r2, r4, n, r3
               Index Cond: ((r5n.r1 = 2) AND (r5n.r3 = ANY ('{0,1,2,3,4,5}'::integer[])))
               Storage Table Read Requests: 2
               Storage Table Read Ops: 2
               Storage Table Rows Scanned: 70
(13 rows)

                                        QUERY PLAN                                        
------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r1, r2, r4, n, r3
   ->  Incremental Sort (actual rows=5 loops=1)
         Output: r1, r2, r4, n, r3
         Sort Key: r5n.r2, r5n.r4, r5n.n
         Presorted Key: r5n.r2, r5n.r4
         Full-sort Groups: 1  Sort Method: quicksort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=7 loops=1)
               Output: r1, r2, r4, n, r3
               Index Cond: ((r5n.r1 = 2) AND (r5n.r3 = ANY ('{0,1,2,3,4,5}'::integer[])))
               Merge Sort Key: r5n.r2, r5n.r4
               Merge Stream Key: r5n.r3
               Merge Streams: 6
               Merge Cond: (r5n.r3 = ANY ('{0,1,2,3,4,5}'::integer[]))
               Storage Table Read Requests: 1
               Storage Table Read Ops: 6
               Storage Table Rows Scanned: 30
(17 rows)

-- IN, sort, IN, sort...
\set query 'SELECT r2, r4, r5, n, r1, r3 FROM r5n WHERE r1 IN (0, 1, 2) AND r3 IN (3, 4, 5) ORDER BY r2, r4, r5, n LIMIT 5'
:explain2run2
                                                 QUERY PLAN                                                  
-------------------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r2, r4, r5, n, r1, r3
   ->  Sort (actual rows=5 loops=1)
         Output: r2, r4, r5, n, r1, r3
         Sort Key: r5n.r2, r5n.r4, r5n.r5, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=427 loops=1)
               Output: r2, r4, r5, n, r1, r3
               Index Cond: ((r5n.r1 = ANY ('{0,1,2}'::integer[])) AND (r5n.r3 = ANY ('{3,4,5}'::integer[])))
               Storage Table Read Requests: 2
               Storage Table Read Ops: 7
               Storage Table Rows Scanned: 427
(12 rows)

                                                 QUERY PLAN                                                  
-------------------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r2, r4, r5, n, r1, r3
   ->  Incremental Sort (actual rows=5 loops=1)
         Output: r2, r4, r5, n, r1, r3
         Sort Key: r5n.r2, r5n.r4, r5n.r5, r5n.n
         Presorted Key: r5n.r2, r5n.r4, r5n.r5
         Full-sort Groups: 1  Sort Method: quicksort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=6 loops=1)
               Output: r2, r4, r5, n, r1, r3
               Index Cond: ((r5n.r1 = ANY ('{0,1,2}'::integer[])) AND (r5n.r3 = ANY ('{3,4,5}'::integer[])))
               Merge Sort Key: r5n.r2, r5n.r4, r5n.r5
               Merge Stream Key: r5n.r1, r5n.r3
               Merge Streams: 9
               Merge Cond: ((r5n.r1 = ANY ('{0,1,2}'::integer[])) AND (r5n.r3 = ANY ('{3,4,5}'::integer[])))
               Storage Table Read Requests: 1
               Storage Table Read Ops: 9
               Storage Table Rows Scanned: 45
(17 rows)

 r2 | r4 | r5 |   n   | r1 | r3 
----+----+----+-------+----+----
  0 |  0 |  0 |   402 |  2 |  4
  0 |  0 |  1 | 10500 |  0 |  5
  0 |  0 |  3 | 30400 |  0 |  4
  0 |  0 |  7 | 70402 |  2 |  4
  0 |  1 |  0 |  1402 |  2 |  4
(5 rows)

 r2 | r4 | r5 |   n   | r1 | r3 
----+----+----+-------+----+----
  0 |  0 |  0 |   402 |  2 |  4
  0 |  0 |  1 | 10500 |  0 |  5
  0 |  0 |  3 | 30400 |  0 |  4
  0 |  0 |  7 | 70402 |  2 |  4
  0 |  1 |  0 |  1402 |  2 |  4
(5 rows)

-- IN, sort, IN/sort, sort...
\set query 'SELECT r2, r3, r4, r5, n, r1 FROM r5n WHERE r1 IN (0, 1, 2) AND r3 IN (3, 4, 5) ORDER BY r2, r3, r4, r5, n LIMIT 5'
:explain2run2
                                                 QUERY PLAN                                                  
-------------------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r2, r3, r4, r5, n, r1
   ->  Sort (actual rows=5 loops=1)
         Output: r2, r3, r4, r5, n, r1
         Sort Key: r5n.r2, r5n.r3, r5n.r4, r5n.r5, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=427 loops=1)
               Output: r2, r3, r4, r5, n, r1
               Index Cond: ((r5n.r1 = ANY ('{0,1,2}'::integer[])) AND (r5n.r3 = ANY ('{3,4,5}'::integer[])))
               Storage Table Read Requests: 2
               Storage Table Read Ops: 7
               Storage Table Rows Scanned: 427
(12 rows)

                                                 QUERY PLAN                                                  
-------------------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r2, r3, r4, r5, n, r1
   ->  Incremental Sort (actual rows=5 loops=1)
         Output: r2, r3, r4, r5, n, r1
         Sort Key: r5n.r2, r5n.r3, r5n.r4, r5n.r5, r5n.n
         Presorted Key: r5n.r2, r5n.r3, r5n.r4, r5n.r5
         Full-sort Groups: 1  Sort Method: quicksort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=6 loops=1)
               Output: r2, r3, r4, r5, n, r1
               Index Cond: ((r5n.r1 = ANY ('{0,1,2}'::integer[])) AND (r5n.r3 = ANY ('{3,4,5}'::integer[])))
               Merge Sort Key: r5n.r2, r5n.r3, r5n.r4, r5n.r5
               Merge Stream Key: r5n.r1
               Merge Streams: 3
               Merge Cond: (r5n.r1 = ANY ('{0,1,2}'::integer[]))
               Storage Table Read Requests: 1
               Storage Table Read Ops: 3
               Storage Table Rows Scanned: 15
(17 rows)

 r2 | r3 | r4 | r5 |   n   | r1 
----+----+----+----+-------+----
  0 |  3 |  1 |  4 | 41301 |  1
  0 |  3 |  1 |  5 | 51300 |  0
  0 |  3 |  1 |  8 | 81302 |  2
  0 |  3 |  2 |  3 | 32301 |  1
  0 |  3 |  2 |  3 | 32302 |  2
(5 rows)

 r2 | r3 | r4 | r5 |   n   | r1 
----+----+----+----+-------+----
  0 |  3 |  1 |  4 | 41301 |  1
  0 |  3 |  1 |  5 | 51300 |  0
  0 |  3 |  1 |  8 | 81302 |  2
  0 |  3 |  2 |  3 | 32301 |  1
  0 |  3 |  2 |  3 | 32302 |  2
(5 rows)

-- IN equivalence to first key non-sort column
-- TODO(#29030): this should use SAOP merge.
\set query 'SELECT r3, r4, r5, n, r1, r2 FROM r5n WHERE r2 IN (7, 8, 9) AND r2 = r1 ORDER BY r3, r4, r5, n LIMIT 5'
:explain2run2
                                  QUERY PLAN                                   
-------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r3, r4, r5, n, r1, r2
   ->  Sort (actual rows=5 loops=1)
         Output: r3, r4, r5, n, r1, r2
         Sort Key: r5n.r3, r5n.r4, r5n.r5, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=146 loops=1)
               Output: r3, r4, r5, n, r1, r2
               Index Cond: (r5n.r2 = ANY ('{7,8,9}'::bigint[]))
               Storage Filter: (r5n.r2 = r5n.r1)
               Storage Table Read Requests: 2
               Storage Table Read Ops: 8
               Storage Table Rows Scanned: 1496
(13 rows)

                                  QUERY PLAN                                   
-------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r3, r4, r5, n, r1, r2
   ->  Sort (actual rows=5 loops=1)
         Output: r3, r4, r5, n, r1, r2
         Sort Key: r5n.r3, r5n.r4, r5n.r5, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=146 loops=1)
               Output: r3, r4, r5, n, r1, r2
               Index Cond: (r5n.r2 = ANY ('{7,8,9}'::bigint[]))
               Storage Filter: (r5n.r2 = r5n.r1)
               Storage Table Read Requests: 2
               Storage Table Read Ops: 8
               Storage Table Rows Scanned: 1496
(13 rows)

 r3 | r4 | r5 |   n   | r1 | r2 
----+----+----+-------+----+----
  0 |  0 |  0 |    99 |  9 |  9
  0 |  0 |  9 | 90077 |  7 |  7
  0 |  1 |  8 | 81077 |  7 |  7
  0 |  2 |  5 | 52077 |  7 |  7
  0 |  4 |  1 | 14099 |  9 |  9
(5 rows)

 r3 | r4 | r5 |   n   | r1 | r2 
----+----+----+-------+----+----
  0 |  0 |  0 |    99 |  9 |  9
  0 |  0 |  9 | 90077 |  7 |  7
  0 |  1 |  8 | 81077 |  7 |  7
  0 |  2 |  5 | 52077 |  7 |  7
  0 |  4 |  1 | 14099 |  9 |  9
(5 rows)

-- IN equivalence to first key sort column
\set query 'SELECT r1, r3, r4, r5, n, r2 FROM r5n WHERE r1 IN (1, 2, 3, 4, 5, 6, 7, 8, 9) AND r2 IN (6, 0, 5) AND r1 = r3 ORDER BY r3, r4, r5, n LIMIT 5'
:explain2run2
                                                       QUERY PLAN                                                       
------------------------------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r1, r3, r4, r5, n, r2
   ->  Incremental Sort (actual rows=5 loops=1)
         Output: r1, r3, r4, r5, n, r2
         Sort Key: r5n.r1, r5n.r4, r5n.r5, r5n.n
         Presorted Key: r5n.r1
         Full-sort Groups: 1  Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=14 loops=1)
               Output: r1, r3, r4, r5, n, r2
               Index Cond: ((r5n.r1 = ANY ('{1,2,3,4,5,6,7,8,9}'::integer[])) AND (r5n.r2 = ANY ('{6,0,5}'::bigint[])))
               Storage Filter: (r5n.r1 = r5n.r3)
               Storage Table Read Requests: 3
               Storage Table Read Ops: 3
               Storage Table Rows Scanned: 198
(14 rows)

                                                       QUERY PLAN                                                       
------------------------------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r1, r3, r4, r5, n, r2
   ->  Incremental Sort (actual rows=5 loops=1)
         Output: r1, r3, r4, r5, n, r2
         Sort Key: r5n.r1, r5n.r4, r5n.r5, r5n.n
         Presorted Key: r5n.r1, r5n.r4, r5n.r5
         Full-sort Groups: 1  Sort Method: quicksort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=6 loops=1)
               Output: r1, r3, r4, r5, n, r2
               Index Cond: ((r5n.r1 = ANY ('{1,2,3,4,5,6,7,8,9}'::integer[])) AND (r5n.r2 = ANY ('{6,0,5}'::bigint[])))
               Merge Sort Key: r5n.r3, r5n.r4, r5n.r5
               Merge Stream Key: r5n.r1, r5n.r2
               Merge Streams: 27
               Merge Cond: ((r5n.r1 = ANY ('{1,2,3,4,5,6,7,8,9}'::integer[])) AND (r5n.r2 = ANY ('{6,0,5}'::bigint[])))
               Storage Filter: (r5n.r1 = r5n.r3)
               Storage Table Read Requests: 1
               Storage Table Read Ops: 27
               Storage Table Rows Scanned: 1070
(18 rows)

 r1 | r3 | r4 | r5 |   n   | r2 
----+----+----+----+-------+----
  1 |  1 |  0 |  3 | 30161 |  6
  1 |  1 |  1 |  3 | 31101 |  0
  1 |  1 |  3 |  1 | 13101 |  0
  1 |  1 |  4 |  1 | 14151 |  5
  1 |  1 |  4 |  1 | 14161 |  6
(5 rows)

 r1 | r3 | r4 | r5 |   n   | r2 
----+----+----+----+-------+----
  1 |  1 |  0 |  3 | 30161 |  6
  1 |  1 |  1 |  3 | 31101 |  0
  1 |  1 |  3 |  1 | 13101 |  0
  1 |  1 |  4 |  1 | 14151 |  5
  1 |  1 |  4 |  1 | 14161 |  6
(5 rows)

-- IN equivalence to first key sort column (v2)
\set query 'SELECT r1, r3, r4, r5, n, r2 FROM r5n WHERE r1 IN (1, 2, 3, 4, 5, 6, 7, 8, 9) AND r2 IN (6, 0, 5) AND r1 = r3 ORDER BY r1, r4, r5, n LIMIT 5'
:explain2run2
                                                       QUERY PLAN                                                       
------------------------------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r1, r3, r4, r5, n, r2
   ->  Incremental Sort (actual rows=5 loops=1)
         Output: r1, r3, r4, r5, n, r2
         Sort Key: r5n.r1, r5n.r4, r5n.r5, r5n.n
         Presorted Key: r5n.r1
         Full-sort Groups: 1  Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=14 loops=1)
               Output: r1, r3, r4, r5, n, r2
               Index Cond: ((r5n.r1 = ANY ('{1,2,3,4,5,6,7,8,9}'::integer[])) AND (r5n.r2 = ANY ('{6,0,5}'::bigint[])))
               Storage Filter: (r5n.r1 = r5n.r3)
               Storage Table Read Requests: 3
               Storage Table Read Ops: 3
               Storage Table Rows Scanned: 198
(14 rows)

                                                       QUERY PLAN                                                       
------------------------------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r1, r3, r4, r5, n, r2
   ->  Incremental Sort (actual rows=5 loops=1)
         Output: r1, r3, r4, r5, n, r2
         Sort Key: r5n.r1, r5n.r4, r5n.r5, r5n.n
         Presorted Key: r5n.r1, r5n.r4, r5n.r5
         Full-sort Groups: 1  Sort Method: quicksort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=6 loops=1)
               Output: r1, r3, r4, r5, n, r2
               Index Cond: ((r5n.r1 = ANY ('{1,2,3,4,5,6,7,8,9}'::integer[])) AND (r5n.r2 = ANY ('{6,0,5}'::bigint[])))
               Merge Sort Key: r5n.r3, r5n.r4, r5n.r5
               Merge Stream Key: r5n.r1, r5n.r2
               Merge Streams: 27
               Merge Cond: ((r5n.r1 = ANY ('{1,2,3,4,5,6,7,8,9}'::integer[])) AND (r5n.r2 = ANY ('{6,0,5}'::bigint[])))
               Storage Filter: (r5n.r1 = r5n.r3)
               Storage Table Read Requests: 1
               Storage Table Read Ops: 27
               Storage Table Rows Scanned: 1070
(18 rows)

 r1 | r3 | r4 | r5 |   n   | r2 
----+----+----+----+-------+----
  1 |  1 |  0 |  3 | 30161 |  6
  1 |  1 |  1 |  3 | 31101 |  0
  1 |  1 |  3 |  1 | 13101 |  0
  1 |  1 |  4 |  1 | 14151 |  5
  1 |  1 |  4 |  1 | 14161 |  6
(5 rows)

 r1 | r3 | r4 | r5 |   n   | r2 
----+----+----+----+-------+----
  1 |  1 |  0 |  3 | 30161 |  6
  1 |  1 |  1 |  3 | 31101 |  0
  1 |  1 |  3 |  1 | 13101 |  0
  1 |  1 |  4 |  1 | 14151 |  5
  1 |  1 |  4 |  1 | 14161 |  6
(5 rows)

-- IN equivalence to last key sort column
\set query 'SELECT r3, r4, r1, r5, n, r2 FROM r5n WHERE r1 IN (1, 2, 3, 4, 5, 6, 7, 8, 9) AND r2 IN (6, 0, 5) AND r1 = r5 ORDER BY r3, r4, r5, n LIMIT 5'
:explain2run2
                                                       QUERY PLAN                                                       
------------------------------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r3, r4, r1, r5, n, r2
   ->  Sort (actual rows=5 loops=1)
         Output: r3, r4, r1, r5, n, r2
         Sort Key: r5n.r3, r5n.r4, r5n.r5, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=135 loops=1)
               Output: r3, r4, r1, r5, n, r2
               Index Cond: ((r5n.r1 = ANY ('{1,2,3,4,5,6,7,8,9}'::integer[])) AND (r5n.r2 = ANY ('{6,0,5}'::bigint[])))
               Storage Filter: ((r5n.r1)::double precision = r5n.r5)
               Storage Table Read Requests: 2
               Storage Table Read Ops: 7
               Storage Table Rows Scanned: 1364
(13 rows)

                                                       QUERY PLAN                                                       
------------------------------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r3, r4, r1, r5, n, r2
   ->  Incremental Sort (actual rows=5 loops=1)
         Output: r3, r4, r1, r5, n, r2
         Sort Key: r5n.r3, r5n.r4, r5n.r5, r5n.n
         Presorted Key: r5n.r3, r5n.r4, r5n.r5
         Full-sort Groups: 1  Sort Method: quicksort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=6 loops=1)
               Output: r3, r4, r1, r5, n, r2
               Index Cond: ((r5n.r1 = ANY ('{1,2,3,4,5,6,7,8,9}'::integer[])) AND (r5n.r2 = ANY ('{6,0,5}'::bigint[])))
               Merge Sort Key: r5n.r3, r5n.r4, r5n.r5
               Merge Stream Key: r5n.r1, r5n.r2
               Merge Streams: 27
               Merge Cond: ((r5n.r1 = ANY ('{1,2,3,4,5,6,7,8,9}'::integer[])) AND (r5n.r2 = ANY ('{6,0,5}'::bigint[])))
               Storage Filter: ((r5n.r1)::double precision = r5n.r5)
               Storage Table Read Requests: 1
               Storage Table Read Ops: 27
               Storage Table Rows Scanned: 1131
(18 rows)

 r3 | r4 | r1 | r5 |   n   | r2 
----+----+----+----+-------+----
  0 |  0 |  7 |  7 | 70057 |  5
  0 |  1 |  7 |  7 | 71067 |  6
  0 |  2 |  4 |  4 | 42064 |  6
  0 |  3 |  6 |  6 | 63056 |  5
  0 |  4 |  2 |  2 | 24002 |  0
(5 rows)

 r3 | r4 | r1 | r5 |   n   | r2 
----+----+----+----+-------+----
  0 |  0 |  7 |  7 | 70057 |  5
  0 |  1 |  7 |  7 | 71067 |  6
  0 |  2 |  4 |  4 | 42064 |  6
  0 |  3 |  6 |  6 | 63056 |  5
  0 |  4 |  2 |  2 | 24002 |  0
(5 rows)

-- IN equivalence to last key non-sort column
\set query 'SELECT r3, r4, n, r1, r5, r2 FROM r5n WHERE r1 IN (1, 2, 3, 4, 5, 6, 7, 8, 9) AND r2 IN (6, 0, 5) AND r1 = r5 ORDER BY r3, r4, n LIMIT 5'
:explain2run2
                                                       QUERY PLAN                                                       
------------------------------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r3, r4, n, r1, r5, r2
   ->  Sort (actual rows=5 loops=1)
         Output: r3, r4, n, r1, r5, r2
         Sort Key: r5n.r3, r5n.r4, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=135 loops=1)
               Output: r3, r4, n, r1, r5, r2
               Index Cond: ((r5n.r1 = ANY ('{1,2,3,4,5,6,7,8,9}'::integer[])) AND (r5n.r2 = ANY ('{6,0,5}'::bigint[])))
               Storage Filter: ((r5n.r1)::double precision = r5n.r5)
               Storage Table Read Requests: 2
               Storage Table Read Ops: 7
               Storage Table Rows Scanned: 1364
(13 rows)

                                                       QUERY PLAN                                                       
------------------------------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r3, r4, n, r1, r5, r2
   ->  Incremental Sort (actual rows=5 loops=1)
         Output: r3, r4, n, r1, r5, r2
         Sort Key: r5n.r3, r5n.r4, r5n.n
         Presorted Key: r5n.r3, r5n.r4
         Full-sort Groups: 1  Sort Method: quicksort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=10 loops=1)
               Output: r3, r4, n, r1, r5, r2
               Index Cond: ((r5n.r1 = ANY ('{1,2,3,4,5,6,7,8,9}'::integer[])) AND (r5n.r2 = ANY ('{6,0,5}'::bigint[])))
               Merge Sort Key: r5n.r3, r5n.r4
               Merge Stream Key: r5n.r1, r5n.r2
               Merge Streams: 27
               Merge Cond: ((r5n.r1 = ANY ('{1,2,3,4,5,6,7,8,9}'::integer[])) AND (r5n.r2 = ANY ('{6,0,5}'::bigint[])))
               Storage Filter: ((r5n.r1)::double precision = r5n.r5)
               Storage Table Read Requests: 1
               Storage Table Read Ops: 27
               Storage Table Rows Scanned: 1131
(18 rows)

 r3 | r4 |   n   | r1 | r5 | r2 
----+----+-------+----+----+----
  0 |  0 | 70057 |  7 |  7 |  5
  0 |  1 | 71067 |  7 |  7 |  6
  0 |  2 | 42064 |  4 |  4 |  6
  0 |  3 | 63056 |  6 |  6 |  5
  0 |  4 | 24002 |  2 |  2 |  0
(5 rows)

 r3 | r4 |   n   | r1 | r5 | r2 
----+----+-------+----+----+----
  0 |  0 | 70057 |  7 |  7 |  5
  0 |  1 | 71067 |  7 |  7 |  6
  0 |  2 | 42064 |  4 |  4 |  6
  0 |  3 | 63056 |  6 |  6 |  5
  0 |  4 | 24002 |  2 |  2 |  0
(5 rows)

-- IN equivalence to last non-key sort column
\set query 'SELECT r3, r4, r5, r1, n, r2 FROM r5n WHERE r1 IN (1, 2, 3, 4, 5, 6, 7, 8, 9) AND r2 IN (6, 0, 5) AND r1 = n ORDER BY r3, r4, r5, n LIMIT 5'
:explain2run2
                                                       QUERY PLAN                                                       
------------------------------------------------------------------------------------------------------------------------
 Limit (actual rows=2 loops=1)
   Output: r3, r4, r5, r1, n, r2
   ->  Sort (actual rows=2 loops=1)
         Output: r3, r4, r5, r1, n, r2
         Sort Key: r5n.r3, r5n.r4, r5n.r5, r5n.r1
         Sort Method: quicksort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=2 loops=1)
               Output: r3, r4, r5, r1, n, r2
               Index Cond: ((r5n.r1 = ANY ('{1,2,3,4,5,6,7,8,9}'::integer[])) AND (r5n.r2 = ANY ('{6,0,5}'::bigint[])))
               Storage Filter: (r5n.r1 = r5n.n)
               Storage Table Read Requests: 2
               Storage Table Read Ops: 7
               Storage Table Rows Scanned: 1364
(13 rows)

                                                       QUERY PLAN                                                       
------------------------------------------------------------------------------------------------------------------------
 Limit (actual rows=2 loops=1)
   Output: r3, r4, r5, r1, n, r2
   ->  Incremental Sort (actual rows=2 loops=1)
         Output: r3, r4, r5, r1, n, r2
         Sort Key: r5n.r3, r5n.r4, r5n.r5, r5n.r1
         Presorted Key: r5n.r3, r5n.r4, r5n.r5
         Full-sort Groups: 1  Sort Method: quicksort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=2 loops=1)
               Output: r3, r4, r5, r1, n, r2
               Index Cond: ((r5n.r1 = ANY ('{1,2,3,4,5,6,7,8,9}'::integer[])) AND (r5n.r2 = ANY ('{6,0,5}'::bigint[])))
               Merge Sort Key: r5n.r3, r5n.r4, r5n.r5
               Merge Stream Key: r5n.r1, r5n.r2
               Merge Streams: 27
               Merge Cond: ((r5n.r1 = ANY ('{1,2,3,4,5,6,7,8,9}'::integer[])) AND (r5n.r2 = ANY ('{6,0,5}'::bigint[])))
               Storage Filter: (r5n.r1 = r5n.n)
               Storage Table Read Requests: 1
               Storage Table Read Ops: 27
               Storage Table Rows Scanned: 1364
(18 rows)

 r3 | r4 | r5 | r1 | n | r2 
----+----+----+----+---+----
  0 |  0 |  0 |  6 | 6 |  0
  0 |  0 |  0 |  8 | 8 |  0
(2 rows)

 r3 | r4 | r5 | r1 | n | r2 
----+----+----+----+---+----
  0 |  0 |  0 |  6 | 6 |  0
  0 |  0 |  0 |  8 | 8 |  0
(2 rows)

-- =-var equivalence prefix
-- SAOP merge should not be used.
\set query 'SELECT r4, r5, n, r3, r1, r2 FROM r5n WHERE r3 IN (7, 8, 9) AND r1 = r2 ORDER BY r4, r5, n LIMIT 5'
:explain2
                                  QUERY PLAN                                   
-------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r4, r5, n, r3, r1, r2
   ->  Sort (actual rows=5 loops=1)
         Output: r4, r5, n, r3, r1, r2
         Sort Key: r5n.r4, r5n.r5, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=125 loops=1)
               Output: r4, r5, n, r3, r1, r2
               Index Cond: (r5n.r3 = ANY ('{7,8,9}'::integer[]))
               Storage Filter: (r5n.r1 = r5n.r2)
               Storage Table Read Requests: 2
               Storage Table Read Ops: 8
               Storage Table Rows Scanned: 1514
(13 rows)

                                  QUERY PLAN                                   
-------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r4, r5, n, r3, r1, r2
   ->  Sort (actual rows=5 loops=1)
         Output: r4, r5, n, r3, r1, r2
         Sort Key: r5n.r4, r5n.r5, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=125 loops=1)
               Output: r4, r5, n, r3, r1, r2
               Index Cond: (r5n.r3 = ANY ('{7,8,9}'::integer[]))
               Storage Filter: (r5n.r1 = r5n.r2)
               Storage Table Read Requests: 2
               Storage Table Read Ops: 8
               Storage Table Rows Scanned: 1514
(13 rows)

-- =-var equivalence suffix
-- SAOP merge should not be used.
\set query 'SELECT r4, r5, n, r1, r2, r3 FROM r5n WHERE r1 IN (7, 8, 9) AND r2 = r3 ORDER BY r4, r5, n LIMIT 5'
:explain2
                                  QUERY PLAN                                   
-------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r4, r5, n, r1, r2, r3
   ->  Sort (actual rows=5 loops=1)
         Output: r4, r5, n, r1, r2, r3
         Sort Key: r5n.r4, r5n.r5, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=145 loops=1)
               Output: r4, r5, n, r1, r2, r3
               Index Cond: (r5n.r1 = ANY ('{7,8,9}'::integer[]))
               Storage Filter: (r5n.r2 = r5n.r3)
               Storage Table Read Requests: 1
               Storage Table Read Ops: 1
               Storage Table Rows Scanned: 1515
(13 rows)

                                  QUERY PLAN                                   
-------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r4, r5, n, r1, r2, r3
   ->  Sort (actual rows=5 loops=1)
         Output: r4, r5, n, r1, r2, r3
         Sort Key: r5n.r4, r5n.r5, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=145 loops=1)
               Output: r4, r5, n, r1, r2, r3
               Index Cond: (r5n.r1 = ANY ('{7,8,9}'::integer[]))
               Storage Filter: (r5n.r2 = r5n.r3)
               Storage Table Read Requests: 1
               Storage Table Read Ops: 1
               Storage Table Rows Scanned: 1515
(13 rows)

-- OR clause
\set query 'SELECT r3, r4, r5, n, r1, r2 FROM r5n WHERE r2 IN (0, 1, 2, 3, 4, 5, 6) AND r1 IN (0, 1, 2) AND (r1 = 2 OR r1 IN (1, 2, 3)) ORDER BY r3, r4, r5, n LIMIT 5'
:explain2run2
                                                     QUERY PLAN                                                     
--------------------------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r3, r4, r5, n, r1, r2
   ->  Sort (actual rows=5 loops=1)
         Output: r3, r4, r5, n, r1, r2
         Sort Key: r5n.r3, r5n.r4, r5n.r5, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=714 loops=1)
               Output: r3, r4, r5, n, r1, r2
               Index Cond: ((r5n.r1 = ANY ('{0,1,2}'::integer[])) AND (r5n.r2 = ANY ('{0,1,2,3,4,5,6}'::bigint[])))
               Storage Filter: ((r5n.r1 = 2) OR (r5n.r1 = ANY ('{1,2,3}'::integer[])))
               Storage Table Read Requests: 2
               Storage Table Read Ops: 7
               Storage Table Rows Scanned: 1050
(13 rows)

                                                     QUERY PLAN                                                     
--------------------------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r3, r4, r5, n, r1, r2
   ->  Incremental Sort (actual rows=5 loops=1)
         Output: r3, r4, r5, n, r1, r2
         Sort Key: r5n.r3, r5n.r4, r5n.r5, r5n.n
         Presorted Key: r5n.r3, r5n.r4, r5n.r5
         Full-sort Groups: 1  Sort Method: quicksort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=7 loops=1)
               Output: r3, r4, r5, n, r1, r2
               Index Cond: ((r5n.r1 = ANY ('{0,1,2}'::integer[])) AND (r5n.r2 = ANY ('{0,1,2,3,4,5,6}'::bigint[])))
               Merge Sort Key: r5n.r3, r5n.r4, r5n.r5
               Merge Stream Key: r5n.r1, r5n.r2
               Merge Streams: 21
               Merge Cond: ((r5n.r1 = ANY ('{0,1,2}'::integer[])) AND (r5n.r2 = ANY ('{0,1,2,3,4,5,6}'::bigint[])))
               Storage Filter: ((r5n.r1 = 2) OR (r5n.r1 = ANY ('{1,2,3}'::integer[])))
               Storage Table Read Requests: 1
               Storage Table Read Ops: 21
               Storage Table Rows Scanned: 406
(18 rows)

 r3 | r4 | r5 |   n   | r1 | r2 
----+----+----+-------+----+----
  0 |  0 |  3 | 30002 |  2 |  0
  0 |  0 |  4 | 40021 |  1 |  2
  0 |  0 |  5 | 50052 |  2 |  5
  0 |  0 |  6 | 60022 |  2 |  2
  0 |  0 |  6 | 60041 |  1 |  4
(5 rows)

 r3 | r4 | r5 |   n   | r1 | r2 
----+----+----+-------+----+----
  0 |  0 |  3 | 30002 |  2 |  0
  0 |  0 |  4 | 40021 |  1 |  2
  0 |  0 |  5 | 50052 |  2 |  5
  0 |  0 |  6 | 60022 |  2 |  2
  0 |  0 |  6 | 60041 |  1 |  4
(5 rows)

-- Another OR clause
-- SAOP merge should not be used.
\set query 'SELECT r3, r4, r5, n, r2, r1 FROM r5n WHERE r2 IN (0, 1, 2, 3, 4, 5, 6) AND (r1 IN (0, 1, 2) OR r1 = 2 OR r1 IN (1, 2, 3)) ORDER BY r3, r4, r5, n LIMIT 5'
:explain2
                                                           QUERY PLAN                                                           
--------------------------------------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r3, r4, r5, n, r2, r1
   ->  Sort (actual rows=5 loops=1)
         Output: r3, r4, r5, n, r2, r1
         Sort Key: r5n.r3, r5n.r4, r5n.r5, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=1399 loops=1)
               Output: r3, r4, r5, n, r2, r1
               Index Cond: (r5n.r2 = ANY ('{0,1,2,3,4,5,6}'::bigint[]))
               Storage Filter: ((r5n.r1 = ANY ('{0,1,2}'::integer[])) OR (r5n.r1 = 2) OR (r5n.r1 = ANY ('{1,2,3}'::integer[])))
               Storage Table Read Requests: 2
               Storage Table Read Ops: 8
               Storage Table Rows Scanned: 3552
(13 rows)

                                                           QUERY PLAN                                                           
--------------------------------------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r3, r4, r5, n, r2, r1
   ->  Sort (actual rows=5 loops=1)
         Output: r3, r4, r5, n, r2, r1
         Sort Key: r5n.r3, r5n.r4, r5n.r5, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=1399 loops=1)
               Output: r3, r4, r5, n, r2, r1
               Index Cond: (r5n.r2 = ANY ('{0,1,2,3,4,5,6}'::bigint[]))
               Storage Filter: ((r5n.r1 = ANY ('{0,1,2}'::integer[])) OR (r5n.r1 = 2) OR (r5n.r1 = ANY ('{1,2,3}'::integer[])))
               Storage Table Read Requests: 2
               Storage Table Read Ops: 8
               Storage Table Rows Scanned: 3552
(13 rows)

-- Cross-type SAOP: compatible type
\set query 'SELECT r2, r3, r4, r5, n, r1 FROM r5n WHERE r1 = ANY (ARRAY[0, 2, 4, 6, 8]::int8[]) ORDER BY r2, r3, r4, r5, n LIMIT 5'
:explain2run2
                                   QUERY PLAN                                   
--------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r2, r3, r4, r5, n, r1
   ->  Sort (actual rows=5 loops=1)
         Output: r2, r3, r4, r5, n, r1
         Sort Key: r5n.r2, r5n.r3, r5n.r4, r5n.r5, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=2560 loops=1)
               Output: r2, r3, r4, r5, n, r1
               Index Cond: (r5n.r1 = ANY ('{0,2,4,6,8}'::bigint[]))
               Storage Table Read Requests: 3
               Storage Table Read Ops: 9
               Storage Table Rows Scanned: 2560
(12 rows)

                                 QUERY PLAN                                  
-----------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r2, r3, r4, r5, n, r1
   ->  Incremental Sort (actual rows=5 loops=1)
         Output: r2, r3, r4, r5, n, r1
         Sort Key: r5n.r2, r5n.r3, r5n.r4, r5n.r5, r5n.n
         Presorted Key: r5n.r2, r5n.r3, r5n.r4, r5n.r5
         Full-sort Groups: 1  Sort Method: quicksort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=6 loops=1)
               Output: r2, r3, r4, r5, n, r1
               Index Cond: (r5n.r1 = ANY ('{0,2,4,6,8}'::bigint[]))
               Merge Sort Key: r5n.r2, r5n.r3, r5n.r4, r5n.r5
               Merge Stream Key: r5n.r1
               Merge Streams: 5
               Merge Cond: (r5n.r1 = ANY ('{0,2,4,6,8}'::bigint[]))
               Storage Table Read Requests: 1
               Storage Table Read Ops: 5
               Storage Table Rows Scanned: 25
(17 rows)

 r2 | r3 | r4 | r5 |   n   | r1 
----+----+----+----+-------+----
  0 |  0 |  0 |  0 |     6 |  6
  0 |  0 |  0 |  0 |     8 |  8
  0 |  0 |  0 |  3 | 30002 |  2
  0 |  0 |  1 |  3 | 31004 |  4
  0 |  0 |  4 |  1 | 14006 |  6
(5 rows)

 r2 | r3 | r4 | r5 |   n   | r1 
----+----+----+----+-------+----
  0 |  0 |  0 |  0 |     6 |  6
  0 |  0 |  0 |  0 |     8 |  8
  0 |  0 |  0 |  3 | 30002 |  2
  0 |  0 |  1 |  3 | 31004 |  4
  0 |  0 |  4 |  1 | 14006 |  6
(5 rows)

-- Cross-type SAOP: incompatible type
-- SAOP merge should not be used.
\set query 'SELECT r2, r3, r4, r5, n, r1 FROM r5n WHERE r1 = ANY (ARRAY[0, 2, 4, 6, 8]::float[]) ORDER BY r2, r3, r4, r5, n LIMIT 5'
:explain2
                                              QUERY PLAN                                              
------------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r2, r3, r4, r5, n, r1
   ->  Sort (actual rows=5 loops=1)
         Output: r2, r3, r4, r5, n, r1
         Sort Key: r5n.r2, r5n.r3, r5n.r4, r5n.r5, r5n.n
         Sort Method: top-N heapsort
         ->  Seq Scan on public.r5n (actual rows=2560 loops=1)
               Output: r2, r3, r4, r5, n, r1
               Storage Filter: ((r5n.r1)::double precision = ANY ('{0,2,4,6,8}'::double precision[]))
               Storage Table Read Requests: 3
               Storage Table Read Ops: 9
               Storage Table Rows Scanned: 5048
(12 rows)

                                              QUERY PLAN                                              
------------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r2, r3, r4, r5, n, r1
   ->  Sort (actual rows=5 loops=1)
         Output: r2, r3, r4, r5, n, r1
         Sort Key: r5n.r2, r5n.r3, r5n.r4, r5n.r5, r5n.n
         Sort Method: top-N heapsort
         ->  Seq Scan on public.r5n (actual rows=2560 loops=1)
               Output: r2, r3, r4, r5, n, r1
               Storage Filter: ((r5n.r1)::double precision = ANY ('{0,2,4,6,8}'::double precision[]))
               Storage Table Read Requests: 3
               Storage Table Read Ops: 9
               Storage Table Rows Scanned: 5048
(12 rows)

-- Typecasted LHS
-- SAOP merge should not be used.
\set query 'SELECT r2, r3, r4, r5, n, r1 FROM r5n WHERE r1::text = ANY (ARRAY[0, 2, 4, 6, 8]::text[]) ORDER BY r2, r3, r4, r5, n LIMIT 5'
:explain2
                              QUERY PLAN                              
----------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r2, r3, r4, r5, n, r1
   ->  Sort (actual rows=5 loops=1)
         Output: r2, r3, r4, r5, n, r1
         Sort Key: r5n.r2, r5n.r3, r5n.r4, r5n.r5, r5n.n
         Sort Method: top-N heapsort
         ->  Seq Scan on public.r5n (actual rows=2560 loops=1)
               Output: r2, r3, r4, r5, n, r1
               Filter: ((r5n.r1)::text = ANY ('{0,2,4,6,8}'::text[]))
               Rows Removed by Filter: 2488
               Storage Table Read Requests: 5
               Storage Table Read Ops: 11
               Storage Table Rows Scanned: 5048
(13 rows)

                              QUERY PLAN                              
----------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r2, r3, r4, r5, n, r1
   ->  Sort (actual rows=5 loops=1)
         Output: r2, r3, r4, r5, n, r1
         Sort Key: r5n.r2, r5n.r3, r5n.r4, r5n.r5, r5n.n
         Sort Method: top-N heapsort
         ->  Seq Scan on public.r5n (actual rows=2560 loops=1)
               Output: r2, r3, r4, r5, n, r1
               Filter: ((r5n.r1)::text = ANY ('{0,2,4,6,8}'::text[]))
               Rows Removed by Filter: 2488
               Storage Table Read Requests: 5
               Storage Table Read Ops: 11
               Storage Table Rows Scanned: 5048
(13 rows)

-- ArrayExpr containing FuncExpr
-- SAOP merge should not be used.
\set query 'SELECT r2, r3, r4, r5, n, r1 FROM r5n WHERE r1 IN (0, 1, random()::int) ORDER BY r2, r3, r4, r5, n LIMIT 5'
:explain2
                               QUERY PLAN                                
-------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r2, r3, r4, r5, n, r1
   ->  Sort (actual rows=5 loops=1)
         Output: r2, r3, r4, r5, n, r1
         Sort Key: r5n.r2, r5n.r3, r5n.r4, r5n.r5, r5n.n
         Sort Method: top-N heapsort
         ->  Seq Scan on public.r5n (actual rows=969 loops=1)
               Output: r2, r3, r4, r5, n, r1
               Filter: (r5n.r1 = ANY (ARRAY[0, 1, (random())::integer]))
               Rows Removed by Filter: 4079
               Storage Table Read Requests: 5
               Storage Table Read Ops: 11
               Storage Table Rows Scanned: 5048
(13 rows)

                               QUERY PLAN                                
-------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r2, r3, r4, r5, n, r1
   ->  Sort (actual rows=5 loops=1)
         Output: r2, r3, r4, r5, n, r1
         Sort Key: r5n.r2, r5n.r3, r5n.r4, r5n.r5, r5n.n
         Sort Method: top-N heapsort
         ->  Seq Scan on public.r5n (actual rows=969 loops=1)
               Output: r2, r3, r4, r5, n, r1
               Filter: (r5n.r1 = ANY (ARRAY[0, 1, (random())::integer]))
               Rows Removed by Filter: 4079
               Storage Table Read Requests: 5
               Storage Table Read Ops: 11
               Storage Table Rows Scanned: 5048
(13 rows)

-- ArrayExpr containing OpExpr
-- SAOP merge should not be used.
\set query 'SELECT r2, r3, r4, r5, n, r1 FROM r5n WHERE r1 IN (1, 100 + random()::int) ORDER BY r2, r3, r4, r5, n LIMIT 5'
:explain2
                                  QUERY PLAN                                  
------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r2, r3, r4, r5, n, r1
   ->  Sort (actual rows=5 loops=1)
         Output: r2, r3, r4, r5, n, r1
         Sort Key: r5n.r2, r5n.r3, r5n.r4, r5n.r5, r5n.n
         Sort Method: top-N heapsort
         ->  Seq Scan on public.r5n (actual rows=492 loops=1)
               Output: r2, r3, r4, r5, n, r1
               Filter: (r5n.r1 = ANY (ARRAY[1, (100 + (random())::integer)]))
               Rows Removed by Filter: 4556
               Storage Table Read Requests: 5
               Storage Table Read Ops: 11
               Storage Table Rows Scanned: 5048
(13 rows)

                                  QUERY PLAN                                  
------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r2, r3, r4, r5, n, r1
   ->  Sort (actual rows=5 loops=1)
         Output: r2, r3, r4, r5, n, r1
         Sort Key: r5n.r2, r5n.r3, r5n.r4, r5n.r5, r5n.n
         Sort Method: top-N heapsort
         ->  Seq Scan on public.r5n (actual rows=492 loops=1)
               Output: r2, r3, r4, r5, n, r1
               Filter: (r5n.r1 = ANY (ARRAY[1, (100 + (random())::integer)]))
               Rows Removed by Filter: 4556
               Storage Table Read Requests: 5
               Storage Table Read Ops: 11
               Storage Table Rows Scanned: 5048
(13 rows)

-- ArrayExpr containing Param
-- SAOP merge should not be used.
\set query 'SELECT r2, r3, r4, r5, n, r1 FROM r5n WHERE r1 IN (1, (SELECT count(*) FROM r5n)) ORDER BY r2, r3, r4, r5, n LIMIT 5'
:explain2
                                     QUERY PLAN                                      
-------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r5n_1.r2, r5n_1.r3, r5n_1.r4, r5n_1.r5, r5n_1.n, r5n_1.r1
   InitPlan 1 (returns $0)
     ->  Finalize Aggregate (actual rows=1 loops=1)
           Output: count(*)
           ->  Index Only Scan using r5n_pkey on public.r5n (actual rows=7 loops=1)
                 Heap Fetches: 0
                 Storage Table Read Requests: 2
                 Storage Table Read Ops: 8
                 Storage Table Rows Scanned: 5048
                 Partial Aggregate: true
   ->  Sort (actual rows=5 loops=1)
         Output: r5n_1.r2, r5n_1.r3, r5n_1.r4, r5n_1.r5, r5n_1.n, r5n_1.r1
         Sort Key: r5n_1.r2, r5n_1.r3, r5n_1.r4, r5n_1.r5, r5n_1.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n r5n_1 (actual rows=492 loops=1)
               Output: r5n_1.r2, r5n_1.r3, r5n_1.r4, r5n_1.r5, r5n_1.n, r5n_1.r1
               Index Cond: (r5n_1.r1 = ANY (ARRAY['1'::bigint, $0]))
               Storage Table Read Requests: 2
               Storage Table Read Ops: 7
               Storage Table Rows Scanned: 492
(21 rows)

                                     QUERY PLAN                                      
-------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r5n_1.r2, r5n_1.r3, r5n_1.r4, r5n_1.r5, r5n_1.n, r5n_1.r1
   InitPlan 1 (returns $0)
     ->  Finalize Aggregate (actual rows=1 loops=1)
           Output: count(*)
           ->  Index Only Scan using r5n_pkey on public.r5n (actual rows=7 loops=1)
                 Heap Fetches: 0
                 Storage Table Read Requests: 2
                 Storage Table Read Ops: 8
                 Storage Table Rows Scanned: 5048
                 Partial Aggregate: true
   ->  Sort (actual rows=5 loops=1)
         Output: r5n_1.r2, r5n_1.r3, r5n_1.r4, r5n_1.r5, r5n_1.n, r5n_1.r1
         Sort Key: r5n_1.r2, r5n_1.r3, r5n_1.r4, r5n_1.r5, r5n_1.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n r5n_1 (actual rows=492 loops=1)
               Output: r5n_1.r2, r5n_1.r3, r5n_1.r4, r5n_1.r5, r5n_1.n, r5n_1.r1
               Index Cond: (r5n_1.r1 = ANY (ARRAY['1'::bigint, $0]))
               Storage Table Read Requests: 2
               Storage Table Read Ops: 7
               Storage Table Rows Scanned: 492
(21 rows)

-- Row IN without constant table
-- TODO(#29032): this should use SAOP merge.
\set query 'SELECT r3, r4, r5, n, r1, r2 FROM r5n WHERE (r1, r2) IN ((1, 2), (3, 4)) ORDER BY r3, r4, r5, n LIMIT 5'
:explain2run2
                                   QUERY PLAN                                   
--------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r3, r4, r5, n, r1, r2
   ->  Sort (actual rows=5 loops=1)
         Output: r3, r4, r5, n, r1, r2
         Sort Key: r5n.r3, r5n.r4, r5n.r5, r5n.n
         Sort Method: top-N heapsort
         ->  YB Bitmap Table Scan on public.r5n (actual rows=83 loops=1)
               Output: r3, r4, r5, n, r1, r2
               Storage Table Read Requests: 1
               Storage Table Read Ops: 2
               Storage Table Rows Scanned: 83
               ->  BitmapOr (actual rows=83 loops=1)
                     ->  Bitmap Index Scan on r5n_pkey (actual rows=44 loops=1)
                           Index Cond: ((r5n.r1 = 1) AND (r5n.r2 = 2))
                           Storage Table Read Requests: 1
                           Storage Table Read Ops: 1
                           Storage Table Rows Scanned: 44
                     ->  Bitmap Index Scan on r5n_pkey (actual rows=39 loops=1)
                           Index Cond: ((r5n.r1 = 3) AND (r5n.r2 = 4))
                           Storage Table Read Requests: 1
                           Storage Table Read Ops: 1
                           Storage Table Rows Scanned: 39
(22 rows)

                                   QUERY PLAN                                   
--------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r3, r4, r5, n, r1, r2
   ->  Sort (actual rows=5 loops=1)
         Output: r3, r4, r5, n, r1, r2
         Sort Key: r5n.r3, r5n.r4, r5n.r5, r5n.n
         Sort Method: top-N heapsort
         ->  YB Bitmap Table Scan on public.r5n (actual rows=83 loops=1)
               Output: r3, r4, r5, n, r1, r2
               Storage Table Read Requests: 1
               Storage Table Read Ops: 2
               Storage Table Rows Scanned: 83
               ->  BitmapOr (actual rows=83 loops=1)
                     ->  Bitmap Index Scan on r5n_pkey (actual rows=44 loops=1)
                           Index Cond: ((r5n.r1 = 1) AND (r5n.r2 = 2))
                           Storage Table Read Requests: 1
                           Storage Table Read Ops: 1
                           Storage Table Rows Scanned: 44
                     ->  Bitmap Index Scan on r5n_pkey (actual rows=39 loops=1)
                           Index Cond: ((r5n.r1 = 3) AND (r5n.r2 = 4))
                           Storage Table Read Requests: 1
                           Storage Table Read Ops: 1
                           Storage Table Rows Scanned: 39
(22 rows)

 r3 | r4 | r5 |   n   | r1 | r2 
----+----+----+-------+----+----
  0 |  0 |  4 | 40021 |  1 |  2
  0 |  2 |  1 | 12043 |  3 |  4
  0 |  4 |  4 | 44043 |  3 |  4
  0 |  5 |  3 | 35043 |  3 |  4
  0 |  8 |  5 | 58043 |  3 |  4
(5 rows)

 r3 | r4 | r5 |   n   | r1 | r2 
----+----+----+-------+----+----
  0 |  0 |  4 | 40021 |  1 |  2
  0 |  2 |  1 | 12043 |  3 |  4
  0 |  4 |  4 | 44043 |  3 |  4
  0 |  5 |  3 | 35043 |  3 |  4
  0 |  8 |  5 | 58043 |  3 |  4
(5 rows)

-- Row IN with constant table
-- TODO(#29032): this should use SAOP merge.
\set query 'SELECT r3, r4, r5, n, r1, r2 FROM r5n WHERE row(r1, r2) IN (values (1, 2), (3, 4)) ORDER BY r3, r4, r5, n LIMIT 5'
:explain2run2
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 QUERY PLAN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r5n.r3, r5n.r4, r5n.r5, r5n.n, r5n.r1, r5n.r2
   ->  Sort (actual rows=5 loops=1)
         Output: r5n.r3, r5n.r4, r5n.r5, r5n.n, r5n.r1, r5n.r2
         Sort Key: r5n.r3, r5n.r4, r5n.r5, r5n.n
         Sort Method: top-N heapsort
         ->  YB Batched Nested Loop Join (actual rows=83 loops=1)
               Output: r5n.r3, r5n.r4, r5n.r5, r5n.n, r5n.r1, r5n.r2
               Join Filter: ((r5n.r1 = "*VALUES*".column1) AND (r5n.r2 = "*VALUES*".column2))
               ->  Unique (actual rows=2 loops=1)
                     Output: "*VALUES*".column1, "*VALUES*".column2
                     ->  Sort (actual rows=2 loops=1)
                           Output: "*VALUES*".column1, "*VALUES*".column2
                           Sort Key: "*VALUES*".column1, "*VALUES*".column2
                           Sort Method: quicksort
                           ->  Values Scan on "*VALUES*" (actual rows=2 loops=1)
                                 Output: "*VALUES*".column1, "*VALUES*".column2
               ->  Index Scan using r5n_pkey on public.r5n (actual rows=83 loops=1)
                     Output: r5n.r3, r5n.r4, r5n.r5, r5n.n, r5n.r1, r5n.r2
                     Index Cond: (ROW(r5n.r1, r5n.r2) = ANY (ARRAY[ROW("*VALUES*".column1, "*VALUES*".column2), ROW($1, $1025), ROW($2, $1026), ROW($3, $1027), ROW($4, $1028), ROW($5, $1029), ROW($6, $1030), ROW($7, $1031), ROW($8, $1032), ROW($9, $1033), ROW($10, $1034), ROW($11, $1035), ROW($12, $1036), ROW($13, $1037), ROW($14, $1038), ROW($15, $1039), ROW($16, $1040), ROW($17, $1041), ROW($18, $1042), ROW($19, $1043), ROW($20, $1044), ROW($21, $1045), ROW($22, $1046), ROW($23, $1047), ROW($24, $1048), ROW($25, $1049), ROW($26, $1050), ROW($27, $1051), ROW($28, $1052), ROW($29, $1053), ROW($30, $1054), ROW($31, $1055), ROW($32, $1056), ROW($33, $1057), ROW($34, $1058), ROW($35, $1059), ROW($36, $1060), ROW($37, $1061), ROW($38, $1062), ROW($39, $1063), ROW($40, $1064), ROW($41, $1065), ROW($42, $1066), ROW($43, $1067), ROW($44, $1068), ROW($45, $1069), ROW($46, $1070), ROW($47, $1071), ROW($48, $1072), ROW($49, $1073), ROW($50, $1074), ROW($51, $1075), ROW($52, $1076), ROW($53, $1077), ROW($54, $1078), ROW($55, $1079), ROW($56, $1080), ROW($57, $1081), ROW($58, $1082), ROW($59, $1083), ROW($60, $1084), ROW($61, $1085), ROW($62, $1086), ROW($63, $1087), ROW($64, $1088), ROW($65, $1089), ROW($66, $1090), ROW($67, $1091), ROW($68, $1092), ROW($69, $1093), ROW($70, $1094), ROW($71, $1095), ROW($72, $1096), ROW($73, $1097), ROW($74, $1098), ROW($75, $1099), ROW($76, $1100), ROW($77, $1101), ROW($78, $1102), ROW($79, $1103), ROW($80, $1104), ROW($81, $1105), ROW($82, $1106), ROW($83, $1107), ROW($84, $1108), ROW($85, $1109), ROW($86, $1110), ROW($87, $1111), ROW($88, $1112), ROW($89, $1113), ROW($90, $1114), ROW($91, $1115), ROW($92, $1116), ROW($93, $1117), ROW($94, $1118), ROW($95, $1119), ROW($96, $1120), ROW($97, $1121), ROW($98, $1122), ROW($99, $1123), ROW($100, $1124), ROW($101, $1125), ROW($102, $1126), ROW($103, $1127), ROW($104, $1128), ROW($105, $1129), ROW($106, $1130), ROW($107, $1131), ROW($108, $1132), ROW($109, $1133), ROW($110, $1134), ROW($111, $1135), ROW($112, $1136), ROW($113, $1137), ROW($114, $1138), ROW($115, $1139), ROW($116, $1140), ROW($117, $1141), ROW($118, $1142), ROW($119, $1143), ROW($120, $1144), ROW($121, $1145), ROW($122, $1146), ROW($123, $1147), ROW($124, $1148), ROW($125, $1149), ROW($126, $1150), ROW($127, $1151), ROW($128, $1152), ROW($129, $1153), ROW($130, $1154), ROW($131, $1155), ROW($132, $1156), ROW($133, $1157), ROW($134, $1158), ROW($135, $1159), ROW($136, $1160), ROW($137, $1161), ROW($138, $1162), ROW($139, $1163), ROW($140, $1164), ROW($141, $1165), ROW($142, $1166), ROW($143, $1167), ROW($144, $1168), ROW($145, $1169), ROW($146, $1170), ROW($147, $1171), ROW($148, $1172), ROW($149, $1173), ROW($150, $1174), ROW($151, $1175), ROW($152, $1176), ROW($153, $1177), ROW($154, $1178), ROW($155, $1179), ROW($156, $1180), ROW($157, $1181), ROW($158, $1182), ROW($159, $1183), ROW($160, $1184), ROW($161, $1185), ROW($162, $1186), ROW($163, $1187), ROW($164, $1188), ROW($165, $1189), ROW($166, $1190), ROW($167, $1191), ROW($168, $1192), ROW($169, $1193), ROW($170, $1194), ROW($171, $1195), ROW($172, $1196), ROW($173, $1197), ROW($174, $1198), ROW($175, $1199), ROW($176, $1200), ROW($177, $1201), ROW($178, $1202), ROW($179, $1203), ROW($180, $1204), ROW($181, $1205), ROW($182, $1206), ROW($183, $1207), ROW($184, $1208), ROW($185, $1209), ROW($186, $1210), ROW($187, $1211), ROW($188, $1212), ROW($189, $1213), ROW($190, $1214), ROW($191, $1215), ROW($192, $1216), ROW($193, $1217), ROW($194, $1218), ROW($195, $1219), ROW($196, $1220), ROW($197, $1221), ROW($198, $1222), ROW($199, $1223), ROW($200, $1224), ROW($201, $1225), ROW($202, $1226), ROW($203, $1227), ROW($204, $1228), ROW($205, $1229), ROW($206, $1230), ROW($207, $1231), ROW($208, $1232), ROW($209, $1233), ROW($210, $1234), ROW($211, $1235), ROW($212, $1236), ROW($213, $1237), ROW($214, $1238), ROW($215, $1239), ROW($216, $1240), ROW($217, $1241), ROW($218, $1242), ROW($219, $1243), ROW($220, $1244), ROW($221, $1245), ROW($222, $1246), ROW($223, $1247), ROW($224, $1248), ROW($225, $1249), ROW($226, $1250), ROW($227, $1251), ROW($228, $1252), ROW($229, $1253), ROW($230, $1254), ROW($231, $1255), ROW($232, $1256), ROW($233, $1257), ROW($234, $1258), ROW($235, $1259), ROW($236, $1260), ROW($237, $1261), ROW($238, $1262), ROW($239, $1263), ROW($240, $1264), ROW($241, $1265), ROW($242, $1266), ROW($243, $1267), ROW($244, $1268), ROW($245, $1269), ROW($246, $1270), ROW($247, $1271), ROW($248, $1272), ROW($249, $1273), ROW($250, $1274), ROW($251, $1275), ROW($252, $1276), ROW($253, $1277), ROW($254, $1278), ROW($255, $1279), ROW($256, $1280), ROW($257, $1281), ROW($258, $1282), ROW($259, $1283), ROW($260, $1284), ROW($261, $1285), ROW($262, $1286), ROW($263, $1287), ROW($264, $1288), ROW($265, $1289), ROW($266, $1290), ROW($267, $1291), ROW($268, $1292), ROW($269, $1293), ROW($270, $1294), ROW($271, $1295), ROW($272, $1296), ROW($273, $1297), ROW($274, $1298), ROW($275, $1299), ROW($276, $1300), ROW($277, $1301), ROW($278, $1302), ROW($279, $1303), ROW($280, $1304), ROW($281, $1305), ROW($282, $1306), ROW($283, $1307), ROW($284, $1308), ROW($285, $1309), ROW($286, $1310), ROW($287, $1311), ROW($288, $1312), ROW($289, $1313), ROW($290, $1314), ROW($291, $1315), ROW($292, $1316), ROW($293, $1317), ROW($294, $1318), ROW($295, $1319), ROW($296, $1320), ROW($297, $1321), ROW($298, $1322), ROW($299, $1323), ROW($300, $1324), ROW($301, $1325), ROW($302, $1326), ROW($303, $1327), ROW($304, $1328), ROW($305, $1329), ROW($306, $1330), ROW($307, $1331), ROW($308, $1332), ROW($309, $1333), ROW($310, $1334), ROW($311, $1335), ROW($312, $1336), ROW($313, $1337), ROW($314, $1338), ROW($315, $1339), ROW($316, $1340), ROW($317, $1341), ROW($318, $1342), ROW($319, $1343), ROW($320, $1344), ROW($321, $1345), ROW($322, $1346), ROW($323, $1347), ROW($324, $1348), ROW($325, $1349), ROW($326, $1350), ROW($327, $1351), ROW($328, $1352), ROW($329, $1353), ROW($330, $1354), ROW($331, $1355), ROW($332, $1356), ROW($333, $1357), ROW($334, $1358), ROW($335, $1359), ROW($336, $1360), ROW($337, $1361), ROW($338, $1362), ROW($339, $1363), ROW($340, $1364), ROW($341, $1365), ROW($342, $1366), ROW($343, $1367), ROW($344, $1368), ROW($345, $1369), ROW($346, $1370), ROW($347, $1371), ROW($348, $1372), ROW($349, $1373), ROW($350, $1374), ROW($351, $1375), ROW($352, $1376), ROW($353, $1377), ROW($354, $1378), ROW($355, $1379), ROW($356, $1380), ROW($357, $1381), ROW($358, $1382), ROW($359, $1383), ROW($360, $1384), ROW($361, $1385), ROW($362, $1386), ROW($363, $1387), ROW($364, $1388), ROW($365, $1389), ROW($366, $1390), ROW($367, $1391), ROW($368, $1392), ROW($369, $1393), ROW($370, $1394), ROW($371, $1395), ROW($372, $1396), ROW($373, $1397), ROW($374, $1398), ROW($375, $1399), ROW($376, $1400), ROW($377, $1401), ROW($378, $1402), ROW($379, $1403), ROW($380, $1404), ROW($381, $1405), ROW($382, $1406), ROW($383, $1407), ROW($384, $1408), ROW($385, $1409), ROW($386, $1410), ROW($387, $1411), ROW($388, $1412), ROW($389, $1413), ROW($390, $1414), ROW($391, $1415), ROW($392, $1416), ROW($393, $1417), ROW($394, $1418), ROW($395, $1419), ROW($396, $1420), ROW($397, $1421), ROW($398, $1422), ROW($399, $1423), ROW($400, $1424), ROW($401, $1425), ROW($402, $1426), ROW($403, $1427), ROW($404, $1428), ROW($405, $1429), ROW($406, $1430), ROW($407, $1431), ROW($408, $1432), ROW($409, $1433), ROW($410, $1434), ROW($411, $1435), ROW($412, $1436), ROW($413, $1437), ROW($414, $1438), ROW($415, $1439), ROW($416, $1440), ROW($417, $1441), ROW($418, $1442), ROW($419, $1443), ROW($420, $1444), ROW($421, $1445), ROW($422, $1446), ROW($423, $1447), ROW($424, $1448), ROW($425, $1449), ROW($426, $1450), ROW($427, $1451), ROW($428, $1452), ROW($429, $1453), ROW($430, $1454), ROW($431, $1455), ROW($432, $1456), ROW($433, $1457), ROW($434, $1458), ROW($435, $1459), ROW($436, $1460), ROW($437, $1461), ROW($438, $1462), ROW($439, $1463), ROW($440, $1464), ROW($441, $1465), ROW($442, $1466), ROW($443, $1467), ROW($444, $1468), ROW($445, $1469), ROW($446, $1470), ROW($447, $1471), ROW($448, $1472), ROW($449, $1473), ROW($450, $1474), ROW($451, $1475), ROW($452, $1476), ROW($453, $1477), ROW($454, $1478), ROW($455, $1479), ROW($456, $1480), ROW($457, $1481), ROW($458, $1482), ROW($459, $1483), ROW($460, $1484), ROW($461, $1485), ROW($462, $1486), ROW($463, $1487), ROW($464, $1488), ROW($465, $1489), ROW($466, $1490), ROW($467, $1491), ROW($468, $1492), ROW($469, $1493), ROW($470, $1494), ROW($471, $1495), ROW($472, $1496), ROW($473, $1497), ROW($474, $1498), ROW($475, $1499), ROW($476, $1500), ROW($477, $1501), ROW($478, $1502), ROW($479, $1503), ROW($480, $1504), ROW($481, $1505), ROW($482, $1506), ROW($483, $1507), ROW($484, $1508), ROW($485, $1509), ROW($486, $1510), ROW($487, $1511), ROW($488, $1512), ROW($489, $1513), ROW($490, $1514), ROW($491, $1515), ROW($492, $1516), ROW($493, $1517), ROW($494, $1518), ROW($495, $1519), ROW($496, $1520), ROW($497, $1521), ROW($498, $1522), ROW($499, $1523), ROW($500, $1524), ROW($501, $1525), ROW($502, $1526), ROW($503, $1527), ROW($504, $1528), ROW($505, $1529), ROW($506, $1530), ROW($507, $1531), ROW($508, $1532), ROW($509, $1533), ROW($510, $1534), ROW($511, $1535), ROW($512, $1536), ROW($513, $1537), ROW($514, $1538), ROW($515, $1539), ROW($516, $1540), ROW($517, $1541), ROW($518, $1542), ROW($519, $1543), ROW($520, $1544), ROW($521, $1545), ROW($522, $1546), ROW($523, $1547), ROW($524, $1548), ROW($525, $1549), ROW($526, $1550), ROW($527, $1551), ROW($528, $1552), ROW($529, $1553), ROW($530, $1554), ROW($531, $1555), ROW($532, $1556), ROW($533, $1557), ROW($534, $1558), ROW($535, $1559), ROW($536, $1560), ROW($537, $1561), ROW($538, $1562), ROW($539, $1563), ROW($540, $1564), ROW($541, $1565), ROW($542, $1566), ROW($543, $1567), ROW($544, $1568), ROW($545, $1569), ROW($546, $1570), ROW($547, $1571), ROW($548, $1572), ROW($549, $1573), ROW($550, $1574), ROW($551, $1575), ROW($552, $1576), ROW($553, $1577), ROW($554, $1578), ROW($555, $1579), ROW($556, $1580), ROW($557, $1581), ROW($558, $1582), ROW($559, $1583), ROW($560, $1584), ROW($561, $1585), ROW($562, $1586), ROW($563, $1587), ROW($564, $1588), ROW($565, $1589), ROW($566, $1590), ROW($567, $1591), ROW($568, $1592), ROW($569, $1593), ROW($570, $1594), ROW($571, $1595), ROW($572, $1596), ROW($573, $1597), ROW($574, $1598), ROW($575, $1599), ROW($576, $1600), ROW($577, $1601), ROW($578, $1602), ROW($579, $1603), ROW($580, $1604), ROW($581, $1605), ROW($582, $1606), ROW($583, $1607), ROW($584, $1608), ROW($585, $1609), ROW($586, $1610), ROW($587, $1611), ROW($588, $1612), ROW($589, $1613), ROW($590, $1614), ROW($591, $1615), ROW($592, $1616), ROW($593, $1617), ROW($594, $1618), ROW($595, $1619), ROW($596, $1620), ROW($597, $1621), ROW($598, $1622), ROW($599, $1623), ROW($600, $1624), ROW($601, $1625), ROW($602, $1626), ROW($603, $1627), ROW($604, $1628), ROW($605, $1629), ROW($606, $1630), ROW($607, $1631), ROW($608, $1632), ROW($609, $1633), ROW($610, $1634), ROW($611, $1635), ROW($612, $1636), ROW($613, $1637), ROW($614, $1638), ROW($615, $1639), ROW($616, $1640), ROW($617, $1641), ROW($618, $1642), ROW($619, $1643), ROW($620, $1644), ROW($621, $1645), ROW($622, $1646), ROW($623, $1647), ROW($624, $1648), ROW($625, $1649), ROW($626, $1650), ROW($627, $1651), ROW($628, $1652), ROW($629, $1653), ROW($630, $1654), ROW($631, $1655), ROW($632, $1656), ROW($633, $1657), ROW($634, $1658), ROW($635, $1659), ROW($636, $1660), ROW($637, $1661), ROW($638, $1662), ROW($639, $1663), ROW($640, $1664), ROW($641, $1665), ROW($642, $1666), ROW($643, $1667), ROW($644, $1668), ROW($645, $1669), ROW($646, $1670), ROW($647, $1671), ROW($648, $1672), ROW($649, $1673), ROW($650, $1674), ROW($651, $1675), ROW($652, $1676), ROW($653, $1677), ROW($654, $1678), ROW($655, $1679), ROW($656, $1680), ROW($657, $1681), ROW($658, $1682), ROW($659, $1683), ROW($660, $1684), ROW($661, $1685), ROW($662, $1686), ROW($663, $1687), ROW($664, $1688), ROW($665, $1689), ROW($666, $1690), ROW($667, $1691), ROW($668, $1692), ROW($669, $1693), ROW($670, $1694), ROW($671, $1695), ROW($672, $1696), ROW($673, $1697), ROW($674, $1698), ROW($675, $1699), ROW($676, $1700), ROW($677, $1701), ROW($678, $1702), ROW($679, $1703), ROW($680, $1704), ROW($681, $1705), ROW($682, $1706), ROW($683, $1707), ROW($684, $1708), ROW($685, $1709), ROW($686, $1710), ROW($687, $1711), ROW($688, $1712), ROW($689, $1713), ROW($690, $1714), ROW($691, $1715), ROW($692, $1716), ROW($693, $1717), ROW($694, $1718), ROW($695, $1719), ROW($696, $1720), ROW($697, $1721), ROW($698, $1722), ROW($699, $1723), ROW($700, $1724), ROW($701, $1725), ROW($702, $1726), ROW($703, $1727), ROW($704, $1728), ROW($705, $1729), ROW($706, $1730), ROW($707, $1731), ROW($708, $1732), ROW($709, $1733), ROW($710, $1734), ROW($711, $1735), ROW($712, $1736), ROW($713, $1737), ROW($714, $1738), ROW($715, $1739), ROW($716, $1740), ROW($717, $1741), ROW($718, $1742), ROW($719, $1743), ROW($720, $1744), ROW($721, $1745), ROW($722, $1746), ROW($723, $1747), ROW($724, $1748), ROW($725, $1749), ROW($726, $1750), ROW($727, $1751), ROW($728, $1752), ROW($729, $1753), ROW($730, $1754), ROW($731, $1755), ROW($732, $1756), ROW($733, $1757), ROW($734, $1758), ROW($735, $1759), ROW($736, $1760), ROW($737, $1761), ROW($738, $1762), ROW($739, $1763), ROW($740, $1764), ROW($741, $1765), ROW($742, $1766), ROW($743, $1767), ROW($744, $1768), ROW($745, $1769), ROW($746, $1770), ROW($747, $1771), ROW($748, $1772), ROW($749, $1773), ROW($750, $1774), ROW($751, $1775), ROW($752, $1776), ROW($753, $1777), ROW($754, $1778), ROW($755, $1779), ROW($756, $1780), ROW($757, $1781), ROW($758, $1782), ROW($759, $1783), ROW($760, $1784), ROW($761, $1785), ROW($762, $1786), ROW($763, $1787), ROW($764, $1788), ROW($765, $1789), ROW($766, $1790), ROW($767, $1791), ROW($768, $1792), ROW($769, $1793), ROW($770, $1794), ROW($771, $1795), ROW($772, $1796), ROW($773, $1797), ROW($774, $1798), ROW($775, $1799), ROW($776, $1800), ROW($777, $1801), ROW($778, $1802), ROW($779, $1803), ROW($780, $1804), ROW($781, $1805), ROW($782, $1806), ROW($783, $1807), ROW($784, $1808), ROW($785, $1809), ROW($786, $1810), ROW($787, $1811), ROW($788, $1812), ROW($789, $1813), ROW($790, $1814), ROW($791, $1815), ROW($792, $1816), ROW($793, $1817), ROW($794, $1818), ROW($795, $1819), ROW($796, $1820), ROW($797, $1821), ROW($798, $1822), ROW($799, $1823), ROW($800, $1824), ROW($801, $1825), ROW($802, $1826), ROW($803, $1827), ROW($804, $1828), ROW($805, $1829), ROW($806, $1830), ROW($807, $1831), ROW($808, $1832), ROW($809, $1833), ROW($810, $1834), ROW($811, $1835), ROW($812, $1836), ROW($813, $1837), ROW($814, $1838), ROW($815, $1839), ROW($816, $1840), ROW($817, $1841), ROW($818, $1842), ROW($819, $1843), ROW($820, $1844), ROW($821, $1845), ROW($822, $1846), ROW($823, $1847), ROW($824, $1848), ROW($825, $1849), ROW($826, $1850), ROW($827, $1851), ROW($828, $1852), ROW($829, $1853), ROW($830, $1854), ROW($831, $1855), ROW($832, $1856), ROW($833, $1857), ROW($834, $1858), ROW($835, $1859), ROW($836, $1860), ROW($837, $1861), ROW($838, $1862), ROW($839, $1863), ROW($840, $1864), ROW($841, $1865), ROW($842, $1866), ROW($843, $1867), ROW($844, $1868), ROW($845, $1869), ROW($846, $1870), ROW($847, $1871), ROW($848, $1872), ROW($849, $1873), ROW($850, $1874), ROW($851, $1875), ROW($852, $1876), ROW($853, $1877), ROW($854, $1878), ROW($855, $1879), ROW($856, $1880), ROW($857, $1881), ROW($858, $1882), ROW($859, $1883), ROW($860, $1884), ROW($861, $1885), ROW($862, $1886), ROW($863, $1887), ROW($864, $1888), ROW($865, $1889), ROW($866, $1890), ROW($867, $1891), ROW($868, $1892), ROW($869, $1893), ROW($870, $1894), ROW($871, $1895), ROW($872, $1896), ROW($873, $1897), ROW($874, $1898), ROW($875, $1899), ROW($876, $1900), ROW($877, $1901), ROW($878, $1902), ROW($879, $1903), ROW($880, $1904), ROW($881, $1905), ROW($882, $1906), ROW($883, $1907), ROW($884, $1908), ROW($885, $1909), ROW($886, $1910), ROW($887, $1911), ROW($888, $1912), ROW($889, $1913), ROW($890, $1914), ROW($891, $1915), ROW($892, $1916), ROW($893, $1917), ROW($894, $1918), ROW($895, $1919), ROW($896, $1920), ROW($897, $1921), ROW($898, $1922), ROW($899, $1923), ROW($900, $1924), ROW($901, $1925), ROW($902, $1926), ROW($903, $1927), ROW($904, $1928), ROW($905, $1929), ROW($906, $1930), ROW($907, $1931), ROW($908, $1932), ROW($909, $1933), ROW($910, $1934), ROW($911, $1935), ROW($912, $1936), ROW($913, $1937), ROW($914, $1938), ROW($915, $1939), ROW($916, $1940), ROW($917, $1941), ROW($918, $1942), ROW($919, $1943), ROW($920, $1944), ROW($921, $1945), ROW($922, $1946), ROW($923, $1947), ROW($924, $1948), ROW($925, $1949), ROW($926, $1950), ROW($927, $1951), ROW($928, $1952), ROW($929, $1953), ROW($930, $1954), ROW($931, $1955), ROW($932, $1956), ROW($933, $1957), ROW($934, $1958), ROW($935, $1959), ROW($936, $1960), ROW($937, $1961), ROW($938, $1962), ROW($939, $1963), ROW($940, $1964), ROW($941, $1965), ROW($942, $1966), ROW($943, $1967), ROW($944, $1968), ROW($945, $1969), ROW($946, $1970), ROW($947, $1971), ROW($948, $1972), ROW($949, $1973), ROW($950, $1974), ROW($951, $1975), ROW($952, $1976), ROW($953, $1977), ROW($954, $1978), ROW($955, $1979), ROW($956, $1980), ROW($957, $1981), ROW($958, $1982), ROW($959, $1983), ROW($960, $1984), ROW($961, $1985), ROW($962, $1986), ROW($963, $1987), ROW($964, $1988), ROW($965, $1989), ROW($966, $1990), ROW($967, $1991), ROW($968, $1992), ROW($969, $1993), ROW($970, $1994), ROW($971, $1995), ROW($972, $1996), ROW($973, $1997), ROW($974, $1998), ROW($975, $1999), ROW($976, $2000), ROW($977, $2001), ROW($978, $2002), ROW($979, $2003), ROW($980, $2004), ROW($981, $2005), ROW($982, $2006), ROW($983, $2007), ROW($984, $2008), ROW($985, $2009), ROW($986, $2010), ROW($987, $2011), ROW($988, $2012), ROW($989, $2013), ROW($990, $2014), ROW($991, $2015), ROW($992, $2016), ROW($993, $2017), ROW($994, $2018), ROW($995, $2019), ROW($996, $2020), ROW($997, $2021), ROW($998, $2022), ROW($999, $2023), ROW($1000, $2024), ROW($1001, $2025), ROW($1002, $2026), ROW($1003, $2027), ROW($1004, $2028), ROW($1005, $2029), ROW($1006, $2030), ROW($1007, $2031), ROW($1008, $2032), ROW($1009, $2033), ROW($1010, $2034), ROW($1011, $2035), ROW($1012, $2036), ROW($1013, $2037), ROW($1014, $2038), ROW($1015, $2039), ROW($1016, $2040), ROW($1017, $2041), ROW($1018, $2042), ROW($1019, $2043), ROW($1020, $2044), ROW($1021, $2045), ROW($1022, $2046), ROW($1023, $2047)]))
                     Storage Table Read Requests: 7
                     Storage Table Read Ops: 7
                     Storage Table Rows Scanned: 83
(23 rows)

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 QUERY PLAN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r5n.r3, r5n.r4, r5n.r5, r5n.n, r5n.r1, r5n.r2
   ->  Sort (actual rows=5 loops=1)
         Output: r5n.r3, r5n.r4, r5n.r5, r5n.n, r5n.r1, r5n.r2
         Sort Key: r5n.r3, r5n.r4, r5n.r5, r5n.n
         Sort Method: top-N heapsort
         ->  YB Batched Nested Loop Join (actual rows=83 loops=1)
               Output: r5n.r3, r5n.r4, r5n.r5, r5n.n, r5n.r1, r5n.r2
               Join Filter: ((r5n.r1 = "*VALUES*".column1) AND (r5n.r2 = "*VALUES*".column2))
               ->  Unique (actual rows=2 loops=1)
                     Output: "*VALUES*".column1, "*VALUES*".column2
                     ->  Sort (actual rows=2 loops=1)
                           Output: "*VALUES*".column1, "*VALUES*".column2
                           Sort Key: "*VALUES*".column1, "*VALUES*".column2
                           Sort Method: quicksort
                           ->  Values Scan on "*VALUES*" (actual rows=2 loops=1)
                                 Output: "*VALUES*".column1, "*VALUES*".column2
               ->  Index Scan using r5n_pkey on public.r5n (actual rows=83 loops=1)
                     Output: r5n.r3, r5n.r4, r5n.r5, r5n.n, r5n.r1, r5n.r2
                     Index Cond: (ROW(r5n.r1, r5n.r2) = ANY (ARRAY[ROW("*VALUES*".column1, "*VALUES*".column2), ROW($1, $1025), ROW($2, $1026), ROW($3, $1027), ROW($4, $1028), ROW($5, $1029), ROW($6, $1030), ROW($7, $1031), ROW($8, $1032), ROW($9, $1033), ROW($10, $1034), ROW($11, $1035), ROW($12, $1036), ROW($13, $1037), ROW($14, $1038), ROW($15, $1039), ROW($16, $1040), ROW($17, $1041), ROW($18, $1042), ROW($19, $1043), ROW($20, $1044), ROW($21, $1045), ROW($22, $1046), ROW($23, $1047), ROW($24, $1048), ROW($25, $1049), ROW($26, $1050), ROW($27, $1051), ROW($28, $1052), ROW($29, $1053), ROW($30, $1054), ROW($31, $1055), ROW($32, $1056), ROW($33, $1057), ROW($34, $1058), ROW($35, $1059), ROW($36, $1060), ROW($37, $1061), ROW($38, $1062), ROW($39, $1063), ROW($40, $1064), ROW($41, $1065), ROW($42, $1066), ROW($43, $1067), ROW($44, $1068), ROW($45, $1069), ROW($46, $1070), ROW($47, $1071), ROW($48, $1072), ROW($49, $1073), ROW($50, $1074), ROW($51, $1075), ROW($52, $1076), ROW($53, $1077), ROW($54, $1078), ROW($55, $1079), ROW($56, $1080), ROW($57, $1081), ROW($58, $1082), ROW($59, $1083), ROW($60, $1084), ROW($61, $1085), ROW($62, $1086), ROW($63, $1087), ROW($64, $1088), ROW($65, $1089), ROW($66, $1090), ROW($67, $1091), ROW($68, $1092), ROW($69, $1093), ROW($70, $1094), ROW($71, $1095), ROW($72, $1096), ROW($73, $1097), ROW($74, $1098), ROW($75, $1099), ROW($76, $1100), ROW($77, $1101), ROW($78, $1102), ROW($79, $1103), ROW($80, $1104), ROW($81, $1105), ROW($82, $1106), ROW($83, $1107), ROW($84, $1108), ROW($85, $1109), ROW($86, $1110), ROW($87, $1111), ROW($88, $1112), ROW($89, $1113), ROW($90, $1114), ROW($91, $1115), ROW($92, $1116), ROW($93, $1117), ROW($94, $1118), ROW($95, $1119), ROW($96, $1120), ROW($97, $1121), ROW($98, $1122), ROW($99, $1123), ROW($100, $1124), ROW($101, $1125), ROW($102, $1126), ROW($103, $1127), ROW($104, $1128), ROW($105, $1129), ROW($106, $1130), ROW($107, $1131), ROW($108, $1132), ROW($109, $1133), ROW($110, $1134), ROW($111, $1135), ROW($112, $1136), ROW($113, $1137), ROW($114, $1138), ROW($115, $1139), ROW($116, $1140), ROW($117, $1141), ROW($118, $1142), ROW($119, $1143), ROW($120, $1144), ROW($121, $1145), ROW($122, $1146), ROW($123, $1147), ROW($124, $1148), ROW($125, $1149), ROW($126, $1150), ROW($127, $1151), ROW($128, $1152), ROW($129, $1153), ROW($130, $1154), ROW($131, $1155), ROW($132, $1156), ROW($133, $1157), ROW($134, $1158), ROW($135, $1159), ROW($136, $1160), ROW($137, $1161), ROW($138, $1162), ROW($139, $1163), ROW($140, $1164), ROW($141, $1165), ROW($142, $1166), ROW($143, $1167), ROW($144, $1168), ROW($145, $1169), ROW($146, $1170), ROW($147, $1171), ROW($148, $1172), ROW($149, $1173), ROW($150, $1174), ROW($151, $1175), ROW($152, $1176), ROW($153, $1177), ROW($154, $1178), ROW($155, $1179), ROW($156, $1180), ROW($157, $1181), ROW($158, $1182), ROW($159, $1183), ROW($160, $1184), ROW($161, $1185), ROW($162, $1186), ROW($163, $1187), ROW($164, $1188), ROW($165, $1189), ROW($166, $1190), ROW($167, $1191), ROW($168, $1192), ROW($169, $1193), ROW($170, $1194), ROW($171, $1195), ROW($172, $1196), ROW($173, $1197), ROW($174, $1198), ROW($175, $1199), ROW($176, $1200), ROW($177, $1201), ROW($178, $1202), ROW($179, $1203), ROW($180, $1204), ROW($181, $1205), ROW($182, $1206), ROW($183, $1207), ROW($184, $1208), ROW($185, $1209), ROW($186, $1210), ROW($187, $1211), ROW($188, $1212), ROW($189, $1213), ROW($190, $1214), ROW($191, $1215), ROW($192, $1216), ROW($193, $1217), ROW($194, $1218), ROW($195, $1219), ROW($196, $1220), ROW($197, $1221), ROW($198, $1222), ROW($199, $1223), ROW($200, $1224), ROW($201, $1225), ROW($202, $1226), ROW($203, $1227), ROW($204, $1228), ROW($205, $1229), ROW($206, $1230), ROW($207, $1231), ROW($208, $1232), ROW($209, $1233), ROW($210, $1234), ROW($211, $1235), ROW($212, $1236), ROW($213, $1237), ROW($214, $1238), ROW($215, $1239), ROW($216, $1240), ROW($217, $1241), ROW($218, $1242), ROW($219, $1243), ROW($220, $1244), ROW($221, $1245), ROW($222, $1246), ROW($223, $1247), ROW($224, $1248), ROW($225, $1249), ROW($226, $1250), ROW($227, $1251), ROW($228, $1252), ROW($229, $1253), ROW($230, $1254), ROW($231, $1255), ROW($232, $1256), ROW($233, $1257), ROW($234, $1258), ROW($235, $1259), ROW($236, $1260), ROW($237, $1261), ROW($238, $1262), ROW($239, $1263), ROW($240, $1264), ROW($241, $1265), ROW($242, $1266), ROW($243, $1267), ROW($244, $1268), ROW($245, $1269), ROW($246, $1270), ROW($247, $1271), ROW($248, $1272), ROW($249, $1273), ROW($250, $1274), ROW($251, $1275), ROW($252, $1276), ROW($253, $1277), ROW($254, $1278), ROW($255, $1279), ROW($256, $1280), ROW($257, $1281), ROW($258, $1282), ROW($259, $1283), ROW($260, $1284), ROW($261, $1285), ROW($262, $1286), ROW($263, $1287), ROW($264, $1288), ROW($265, $1289), ROW($266, $1290), ROW($267, $1291), ROW($268, $1292), ROW($269, $1293), ROW($270, $1294), ROW($271, $1295), ROW($272, $1296), ROW($273, $1297), ROW($274, $1298), ROW($275, $1299), ROW($276, $1300), ROW($277, $1301), ROW($278, $1302), ROW($279, $1303), ROW($280, $1304), ROW($281, $1305), ROW($282, $1306), ROW($283, $1307), ROW($284, $1308), ROW($285, $1309), ROW($286, $1310), ROW($287, $1311), ROW($288, $1312), ROW($289, $1313), ROW($290, $1314), ROW($291, $1315), ROW($292, $1316), ROW($293, $1317), ROW($294, $1318), ROW($295, $1319), ROW($296, $1320), ROW($297, $1321), ROW($298, $1322), ROW($299, $1323), ROW($300, $1324), ROW($301, $1325), ROW($302, $1326), ROW($303, $1327), ROW($304, $1328), ROW($305, $1329), ROW($306, $1330), ROW($307, $1331), ROW($308, $1332), ROW($309, $1333), ROW($310, $1334), ROW($311, $1335), ROW($312, $1336), ROW($313, $1337), ROW($314, $1338), ROW($315, $1339), ROW($316, $1340), ROW($317, $1341), ROW($318, $1342), ROW($319, $1343), ROW($320, $1344), ROW($321, $1345), ROW($322, $1346), ROW($323, $1347), ROW($324, $1348), ROW($325, $1349), ROW($326, $1350), ROW($327, $1351), ROW($328, $1352), ROW($329, $1353), ROW($330, $1354), ROW($331, $1355), ROW($332, $1356), ROW($333, $1357), ROW($334, $1358), ROW($335, $1359), ROW($336, $1360), ROW($337, $1361), ROW($338, $1362), ROW($339, $1363), ROW($340, $1364), ROW($341, $1365), ROW($342, $1366), ROW($343, $1367), ROW($344, $1368), ROW($345, $1369), ROW($346, $1370), ROW($347, $1371), ROW($348, $1372), ROW($349, $1373), ROW($350, $1374), ROW($351, $1375), ROW($352, $1376), ROW($353, $1377), ROW($354, $1378), ROW($355, $1379), ROW($356, $1380), ROW($357, $1381), ROW($358, $1382), ROW($359, $1383), ROW($360, $1384), ROW($361, $1385), ROW($362, $1386), ROW($363, $1387), ROW($364, $1388), ROW($365, $1389), ROW($366, $1390), ROW($367, $1391), ROW($368, $1392), ROW($369, $1393), ROW($370, $1394), ROW($371, $1395), ROW($372, $1396), ROW($373, $1397), ROW($374, $1398), ROW($375, $1399), ROW($376, $1400), ROW($377, $1401), ROW($378, $1402), ROW($379, $1403), ROW($380, $1404), ROW($381, $1405), ROW($382, $1406), ROW($383, $1407), ROW($384, $1408), ROW($385, $1409), ROW($386, $1410), ROW($387, $1411), ROW($388, $1412), ROW($389, $1413), ROW($390, $1414), ROW($391, $1415), ROW($392, $1416), ROW($393, $1417), ROW($394, $1418), ROW($395, $1419), ROW($396, $1420), ROW($397, $1421), ROW($398, $1422), ROW($399, $1423), ROW($400, $1424), ROW($401, $1425), ROW($402, $1426), ROW($403, $1427), ROW($404, $1428), ROW($405, $1429), ROW($406, $1430), ROW($407, $1431), ROW($408, $1432), ROW($409, $1433), ROW($410, $1434), ROW($411, $1435), ROW($412, $1436), ROW($413, $1437), ROW($414, $1438), ROW($415, $1439), ROW($416, $1440), ROW($417, $1441), ROW($418, $1442), ROW($419, $1443), ROW($420, $1444), ROW($421, $1445), ROW($422, $1446), ROW($423, $1447), ROW($424, $1448), ROW($425, $1449), ROW($426, $1450), ROW($427, $1451), ROW($428, $1452), ROW($429, $1453), ROW($430, $1454), ROW($431, $1455), ROW($432, $1456), ROW($433, $1457), ROW($434, $1458), ROW($435, $1459), ROW($436, $1460), ROW($437, $1461), ROW($438, $1462), ROW($439, $1463), ROW($440, $1464), ROW($441, $1465), ROW($442, $1466), ROW($443, $1467), ROW($444, $1468), ROW($445, $1469), ROW($446, $1470), ROW($447, $1471), ROW($448, $1472), ROW($449, $1473), ROW($450, $1474), ROW($451, $1475), ROW($452, $1476), ROW($453, $1477), ROW($454, $1478), ROW($455, $1479), ROW($456, $1480), ROW($457, $1481), ROW($458, $1482), ROW($459, $1483), ROW($460, $1484), ROW($461, $1485), ROW($462, $1486), ROW($463, $1487), ROW($464, $1488), ROW($465, $1489), ROW($466, $1490), ROW($467, $1491), ROW($468, $1492), ROW($469, $1493), ROW($470, $1494), ROW($471, $1495), ROW($472, $1496), ROW($473, $1497), ROW($474, $1498), ROW($475, $1499), ROW($476, $1500), ROW($477, $1501), ROW($478, $1502), ROW($479, $1503), ROW($480, $1504), ROW($481, $1505), ROW($482, $1506), ROW($483, $1507), ROW($484, $1508), ROW($485, $1509), ROW($486, $1510), ROW($487, $1511), ROW($488, $1512), ROW($489, $1513), ROW($490, $1514), ROW($491, $1515), ROW($492, $1516), ROW($493, $1517), ROW($494, $1518), ROW($495, $1519), ROW($496, $1520), ROW($497, $1521), ROW($498, $1522), ROW($499, $1523), ROW($500, $1524), ROW($501, $1525), ROW($502, $1526), ROW($503, $1527), ROW($504, $1528), ROW($505, $1529), ROW($506, $1530), ROW($507, $1531), ROW($508, $1532), ROW($509, $1533), ROW($510, $1534), ROW($511, $1535), ROW($512, $1536), ROW($513, $1537), ROW($514, $1538), ROW($515, $1539), ROW($516, $1540), ROW($517, $1541), ROW($518, $1542), ROW($519, $1543), ROW($520, $1544), ROW($521, $1545), ROW($522, $1546), ROW($523, $1547), ROW($524, $1548), ROW($525, $1549), ROW($526, $1550), ROW($527, $1551), ROW($528, $1552), ROW($529, $1553), ROW($530, $1554), ROW($531, $1555), ROW($532, $1556), ROW($533, $1557), ROW($534, $1558), ROW($535, $1559), ROW($536, $1560), ROW($537, $1561), ROW($538, $1562), ROW($539, $1563), ROW($540, $1564), ROW($541, $1565), ROW($542, $1566), ROW($543, $1567), ROW($544, $1568), ROW($545, $1569), ROW($546, $1570), ROW($547, $1571), ROW($548, $1572), ROW($549, $1573), ROW($550, $1574), ROW($551, $1575), ROW($552, $1576), ROW($553, $1577), ROW($554, $1578), ROW($555, $1579), ROW($556, $1580), ROW($557, $1581), ROW($558, $1582), ROW($559, $1583), ROW($560, $1584), ROW($561, $1585), ROW($562, $1586), ROW($563, $1587), ROW($564, $1588), ROW($565, $1589), ROW($566, $1590), ROW($567, $1591), ROW($568, $1592), ROW($569, $1593), ROW($570, $1594), ROW($571, $1595), ROW($572, $1596), ROW($573, $1597), ROW($574, $1598), ROW($575, $1599), ROW($576, $1600), ROW($577, $1601), ROW($578, $1602), ROW($579, $1603), ROW($580, $1604), ROW($581, $1605), ROW($582, $1606), ROW($583, $1607), ROW($584, $1608), ROW($585, $1609), ROW($586, $1610), ROW($587, $1611), ROW($588, $1612), ROW($589, $1613), ROW($590, $1614), ROW($591, $1615), ROW($592, $1616), ROW($593, $1617), ROW($594, $1618), ROW($595, $1619), ROW($596, $1620), ROW($597, $1621), ROW($598, $1622), ROW($599, $1623), ROW($600, $1624), ROW($601, $1625), ROW($602, $1626), ROW($603, $1627), ROW($604, $1628), ROW($605, $1629), ROW($606, $1630), ROW($607, $1631), ROW($608, $1632), ROW($609, $1633), ROW($610, $1634), ROW($611, $1635), ROW($612, $1636), ROW($613, $1637), ROW($614, $1638), ROW($615, $1639), ROW($616, $1640), ROW($617, $1641), ROW($618, $1642), ROW($619, $1643), ROW($620, $1644), ROW($621, $1645), ROW($622, $1646), ROW($623, $1647), ROW($624, $1648), ROW($625, $1649), ROW($626, $1650), ROW($627, $1651), ROW($628, $1652), ROW($629, $1653), ROW($630, $1654), ROW($631, $1655), ROW($632, $1656), ROW($633, $1657), ROW($634, $1658), ROW($635, $1659), ROW($636, $1660), ROW($637, $1661), ROW($638, $1662), ROW($639, $1663), ROW($640, $1664), ROW($641, $1665), ROW($642, $1666), ROW($643, $1667), ROW($644, $1668), ROW($645, $1669), ROW($646, $1670), ROW($647, $1671), ROW($648, $1672), ROW($649, $1673), ROW($650, $1674), ROW($651, $1675), ROW($652, $1676), ROW($653, $1677), ROW($654, $1678), ROW($655, $1679), ROW($656, $1680), ROW($657, $1681), ROW($658, $1682), ROW($659, $1683), ROW($660, $1684), ROW($661, $1685), ROW($662, $1686), ROW($663, $1687), ROW($664, $1688), ROW($665, $1689), ROW($666, $1690), ROW($667, $1691), ROW($668, $1692), ROW($669, $1693), ROW($670, $1694), ROW($671, $1695), ROW($672, $1696), ROW($673, $1697), ROW($674, $1698), ROW($675, $1699), ROW($676, $1700), ROW($677, $1701), ROW($678, $1702), ROW($679, $1703), ROW($680, $1704), ROW($681, $1705), ROW($682, $1706), ROW($683, $1707), ROW($684, $1708), ROW($685, $1709), ROW($686, $1710), ROW($687, $1711), ROW($688, $1712), ROW($689, $1713), ROW($690, $1714), ROW($691, $1715), ROW($692, $1716), ROW($693, $1717), ROW($694, $1718), ROW($695, $1719), ROW($696, $1720), ROW($697, $1721), ROW($698, $1722), ROW($699, $1723), ROW($700, $1724), ROW($701, $1725), ROW($702, $1726), ROW($703, $1727), ROW($704, $1728), ROW($705, $1729), ROW($706, $1730), ROW($707, $1731), ROW($708, $1732), ROW($709, $1733), ROW($710, $1734), ROW($711, $1735), ROW($712, $1736), ROW($713, $1737), ROW($714, $1738), ROW($715, $1739), ROW($716, $1740), ROW($717, $1741), ROW($718, $1742), ROW($719, $1743), ROW($720, $1744), ROW($721, $1745), ROW($722, $1746), ROW($723, $1747), ROW($724, $1748), ROW($725, $1749), ROW($726, $1750), ROW($727, $1751), ROW($728, $1752), ROW($729, $1753), ROW($730, $1754), ROW($731, $1755), ROW($732, $1756), ROW($733, $1757), ROW($734, $1758), ROW($735, $1759), ROW($736, $1760), ROW($737, $1761), ROW($738, $1762), ROW($739, $1763), ROW($740, $1764), ROW($741, $1765), ROW($742, $1766), ROW($743, $1767), ROW($744, $1768), ROW($745, $1769), ROW($746, $1770), ROW($747, $1771), ROW($748, $1772), ROW($749, $1773), ROW($750, $1774), ROW($751, $1775), ROW($752, $1776), ROW($753, $1777), ROW($754, $1778), ROW($755, $1779), ROW($756, $1780), ROW($757, $1781), ROW($758, $1782), ROW($759, $1783), ROW($760, $1784), ROW($761, $1785), ROW($762, $1786), ROW($763, $1787), ROW($764, $1788), ROW($765, $1789), ROW($766, $1790), ROW($767, $1791), ROW($768, $1792), ROW($769, $1793), ROW($770, $1794), ROW($771, $1795), ROW($772, $1796), ROW($773, $1797), ROW($774, $1798), ROW($775, $1799), ROW($776, $1800), ROW($777, $1801), ROW($778, $1802), ROW($779, $1803), ROW($780, $1804), ROW($781, $1805), ROW($782, $1806), ROW($783, $1807), ROW($784, $1808), ROW($785, $1809), ROW($786, $1810), ROW($787, $1811), ROW($788, $1812), ROW($789, $1813), ROW($790, $1814), ROW($791, $1815), ROW($792, $1816), ROW($793, $1817), ROW($794, $1818), ROW($795, $1819), ROW($796, $1820), ROW($797, $1821), ROW($798, $1822), ROW($799, $1823), ROW($800, $1824), ROW($801, $1825), ROW($802, $1826), ROW($803, $1827), ROW($804, $1828), ROW($805, $1829), ROW($806, $1830), ROW($807, $1831), ROW($808, $1832), ROW($809, $1833), ROW($810, $1834), ROW($811, $1835), ROW($812, $1836), ROW($813, $1837), ROW($814, $1838), ROW($815, $1839), ROW($816, $1840), ROW($817, $1841), ROW($818, $1842), ROW($819, $1843), ROW($820, $1844), ROW($821, $1845), ROW($822, $1846), ROW($823, $1847), ROW($824, $1848), ROW($825, $1849), ROW($826, $1850), ROW($827, $1851), ROW($828, $1852), ROW($829, $1853), ROW($830, $1854), ROW($831, $1855), ROW($832, $1856), ROW($833, $1857), ROW($834, $1858), ROW($835, $1859), ROW($836, $1860), ROW($837, $1861), ROW($838, $1862), ROW($839, $1863), ROW($840, $1864), ROW($841, $1865), ROW($842, $1866), ROW($843, $1867), ROW($844, $1868), ROW($845, $1869), ROW($846, $1870), ROW($847, $1871), ROW($848, $1872), ROW($849, $1873), ROW($850, $1874), ROW($851, $1875), ROW($852, $1876), ROW($853, $1877), ROW($854, $1878), ROW($855, $1879), ROW($856, $1880), ROW($857, $1881), ROW($858, $1882), ROW($859, $1883), ROW($860, $1884), ROW($861, $1885), ROW($862, $1886), ROW($863, $1887), ROW($864, $1888), ROW($865, $1889), ROW($866, $1890), ROW($867, $1891), ROW($868, $1892), ROW($869, $1893), ROW($870, $1894), ROW($871, $1895), ROW($872, $1896), ROW($873, $1897), ROW($874, $1898), ROW($875, $1899), ROW($876, $1900), ROW($877, $1901), ROW($878, $1902), ROW($879, $1903), ROW($880, $1904), ROW($881, $1905), ROW($882, $1906), ROW($883, $1907), ROW($884, $1908), ROW($885, $1909), ROW($886, $1910), ROW($887, $1911), ROW($888, $1912), ROW($889, $1913), ROW($890, $1914), ROW($891, $1915), ROW($892, $1916), ROW($893, $1917), ROW($894, $1918), ROW($895, $1919), ROW($896, $1920), ROW($897, $1921), ROW($898, $1922), ROW($899, $1923), ROW($900, $1924), ROW($901, $1925), ROW($902, $1926), ROW($903, $1927), ROW($904, $1928), ROW($905, $1929), ROW($906, $1930), ROW($907, $1931), ROW($908, $1932), ROW($909, $1933), ROW($910, $1934), ROW($911, $1935), ROW($912, $1936), ROW($913, $1937), ROW($914, $1938), ROW($915, $1939), ROW($916, $1940), ROW($917, $1941), ROW($918, $1942), ROW($919, $1943), ROW($920, $1944), ROW($921, $1945), ROW($922, $1946), ROW($923, $1947), ROW($924, $1948), ROW($925, $1949), ROW($926, $1950), ROW($927, $1951), ROW($928, $1952), ROW($929, $1953), ROW($930, $1954), ROW($931, $1955), ROW($932, $1956), ROW($933, $1957), ROW($934, $1958), ROW($935, $1959), ROW($936, $1960), ROW($937, $1961), ROW($938, $1962), ROW($939, $1963), ROW($940, $1964), ROW($941, $1965), ROW($942, $1966), ROW($943, $1967), ROW($944, $1968), ROW($945, $1969), ROW($946, $1970), ROW($947, $1971), ROW($948, $1972), ROW($949, $1973), ROW($950, $1974), ROW($951, $1975), ROW($952, $1976), ROW($953, $1977), ROW($954, $1978), ROW($955, $1979), ROW($956, $1980), ROW($957, $1981), ROW($958, $1982), ROW($959, $1983), ROW($960, $1984), ROW($961, $1985), ROW($962, $1986), ROW($963, $1987), ROW($964, $1988), ROW($965, $1989), ROW($966, $1990), ROW($967, $1991), ROW($968, $1992), ROW($969, $1993), ROW($970, $1994), ROW($971, $1995), ROW($972, $1996), ROW($973, $1997), ROW($974, $1998), ROW($975, $1999), ROW($976, $2000), ROW($977, $2001), ROW($978, $2002), ROW($979, $2003), ROW($980, $2004), ROW($981, $2005), ROW($982, $2006), ROW($983, $2007), ROW($984, $2008), ROW($985, $2009), ROW($986, $2010), ROW($987, $2011), ROW($988, $2012), ROW($989, $2013), ROW($990, $2014), ROW($991, $2015), ROW($992, $2016), ROW($993, $2017), ROW($994, $2018), ROW($995, $2019), ROW($996, $2020), ROW($997, $2021), ROW($998, $2022), ROW($999, $2023), ROW($1000, $2024), ROW($1001, $2025), ROW($1002, $2026), ROW($1003, $2027), ROW($1004, $2028), ROW($1005, $2029), ROW($1006, $2030), ROW($1007, $2031), ROW($1008, $2032), ROW($1009, $2033), ROW($1010, $2034), ROW($1011, $2035), ROW($1012, $2036), ROW($1013, $2037), ROW($1014, $2038), ROW($1015, $2039), ROW($1016, $2040), ROW($1017, $2041), ROW($1018, $2042), ROW($1019, $2043), ROW($1020, $2044), ROW($1021, $2045), ROW($1022, $2046), ROW($1023, $2047)]))
                     Storage Table Read Requests: 7
                     Storage Table Read Ops: 7
                     Storage Table Rows Scanned: 83
(23 rows)

 r3 | r4 | r5 |   n   | r1 | r2 
----+----+----+-------+----+----
  0 |  0 |  4 | 40021 |  1 |  2
  0 |  2 |  1 | 12043 |  3 |  4
  0 |  4 |  4 | 44043 |  3 |  4
  0 |  5 |  3 | 35043 |  3 |  4
  0 |  8 |  5 | 58043 |  3 |  4
(5 rows)

 r3 | r4 | r5 |   n   | r1 | r2 
----+----+----+-------+----+----
  0 |  0 |  4 | 40021 |  1 |  2
  0 |  2 |  1 | 12043 |  3 |  4
  0 |  4 |  4 | 44043 |  3 |  4
  0 |  5 |  3 | 35043 |  3 |  4
  0 |  8 |  5 | 58043 |  3 |  4
(5 rows)

-- Subquery with ORDER inside
\set query 'SELECT r2, r3, r4, n FROM (SELECT r2, r3, r4, n FROM r5n WHERE r1 IN (0, 1, 2, 3) ORDER BY r2, r3, r4, n LIMIT 5) sub'
:explain2run2
                                   QUERY PLAN                                   
--------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r5n.r2, r5n.r3, r5n.r4, r5n.n
   ->  Sort (actual rows=5 loops=1)
         Output: r5n.r2, r5n.r3, r5n.r4, r5n.n
         Sort Key: r5n.r2, r5n.r3, r5n.r4, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=1983 loops=1)
               Output: r5n.r2, r5n.r3, r5n.r4, r5n.n
               Index Cond: (r5n.r1 = ANY ('{0,1,2,3}'::integer[]))
               Storage Table Read Requests: 2
               Storage Table Read Ops: 8
               Storage Table Rows Scanned: 1983
(12 rows)

                                 QUERY PLAN                                  
-----------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r5n.r2, r5n.r3, r5n.r4, r5n.n
   ->  Incremental Sort (actual rows=5 loops=1)
         Output: r5n.r2, r5n.r3, r5n.r4, r5n.n
         Sort Key: r5n.r2, r5n.r3, r5n.r4, r5n.n
         Presorted Key: r5n.r2, r5n.r3, r5n.r4
         Full-sort Groups: 1  Sort Method: quicksort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=8 loops=1)
               Output: r5n.r2, r5n.r3, r5n.r4, r5n.n
               Index Cond: (r5n.r1 = ANY ('{0,1,2,3}'::integer[]))
               Merge Sort Key: r5n.r2, r5n.r3, r5n.r4
               Merge Stream Key: r5n.r1
               Merge Streams: 4
               Merge Cond: (n = ANY ('{0,1,2,3}'::integer[]))
               Storage Table Read Requests: 1
               Storage Table Read Ops: 4
               Storage Table Rows Scanned: 20
(17 rows)

 r2 | r3 | r4 |   n   
----+----+----+-------
  0 |  0 |  0 | 30002
  0 |  0 |  2 | 52001
  0 |  0 |  2 | 62001
  0 |  0 |  4 | 14003
  0 |  0 |  4 | 24002
(5 rows)

 r2 | r3 | r4 |   n   
----+----+----+-------
  0 |  0 |  0 | 30002
  0 |  0 |  2 | 52001
  0 |  0 |  2 | 62001
  0 |  0 |  4 | 14003
  0 |  0 |  4 | 24002
(5 rows)

-- Subquery with ORDER outside
\set query 'SELECT r2, r3, r4, n FROM (SELECT r2, r3, r4, n FROM r5n WHERE r1 IN (0, 1, 2, 3)) sub ORDER BY r2, r3, r4, n LIMIT 5'
:explain2run2
                                   QUERY PLAN                                   
--------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r5n.r2, r5n.r3, r5n.r4, r5n.n
   ->  Sort (actual rows=5 loops=1)
         Output: r5n.r2, r5n.r3, r5n.r4, r5n.n
         Sort Key: r5n.r2, r5n.r3, r5n.r4, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=1983 loops=1)
               Output: r5n.r2, r5n.r3, r5n.r4, r5n.n
               Index Cond: (r5n.r1 = ANY ('{0,1,2,3}'::integer[]))
               Storage Table Read Requests: 2
               Storage Table Read Ops: 8
               Storage Table Rows Scanned: 1983
(12 rows)

                                 QUERY PLAN                                  
-----------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r5n.r2, r5n.r3, r5n.r4, r5n.n
   ->  Incremental Sort (actual rows=5 loops=1)
         Output: r5n.r2, r5n.r3, r5n.r4, r5n.n
         Sort Key: r5n.r2, r5n.r3, r5n.r4, r5n.n
         Presorted Key: r5n.r2, r5n.r3, r5n.r4
         Full-sort Groups: 1  Sort Method: quicksort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=8 loops=1)
               Output: r5n.r2, r5n.r3, r5n.r4, r5n.n
               Index Cond: (r5n.r1 = ANY ('{0,1,2,3}'::integer[]))
               Merge Sort Key: r5n.r2, r5n.r3, r5n.r4
               Merge Stream Key: r5n.r1
               Merge Streams: 4
               Merge Cond: (r5n.r1 = ANY ('{0,1,2,3}'::integer[]))
               Storage Table Read Requests: 1
               Storage Table Read Ops: 4
               Storage Table Rows Scanned: 20
(17 rows)

 r2 | r3 | r4 |   n   
----+----+----+-------
  0 |  0 |  0 | 30002
  0 |  0 |  2 | 52001
  0 |  0 |  2 | 62001
  0 |  0 |  4 | 14003
  0 |  0 |  4 | 24002
(5 rows)

 r2 | r3 | r4 |   n   
----+----+----+-------
  0 |  0 |  0 | 30002
  0 |  0 |  2 | 52001
  0 |  0 |  2 | 62001
  0 |  0 |  4 | 14003
  0 |  0 |  4 | 24002
(5 rows)

-- NULL in IN
-- TODO(#29073) after culling array, number of streams should be 3.
\set query 'SELECT r2, r3, r4, r5, n, r1 FROM r5n WHERE r1 IN (1, 2, null, 3) ORDER BY r2, r3, r4, r5, n LIMIT 5'
:explain2run2
                                   QUERY PLAN                                   
--------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r2, r3, r4, r5, n, r1
   ->  Sort (actual rows=5 loops=1)
         Output: r2, r3, r4, r5, n, r1
         Sort Key: r5n.r2, r5n.r3, r5n.r4, r5n.r5, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=1506 loops=1)
               Output: r2, r3, r4, r5, n, r1
               Index Cond: (r5n.r1 = ANY ('{1,2,NULL,3}'::integer[]))
               Storage Table Read Requests: 2
               Storage Table Read Ops: 7
               Storage Table Rows Scanned: 1506
(12 rows)

                                 QUERY PLAN                                  
-----------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r2, r3, r4, r5, n, r1
   ->  Incremental Sort (actual rows=5 loops=1)
         Output: r2, r3, r4, r5, n, r1
         Sort Key: r5n.r2, r5n.r3, r5n.r4, r5n.r5, r5n.n
         Presorted Key: r5n.r2, r5n.r3, r5n.r4, r5n.r5
         Full-sort Groups: 1  Sort Method: quicksort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=6 loops=1)
               Output: r2, r3, r4, r5, n, r1
               Index Cond: (r5n.r1 = ANY ('{1,2,NULL,3}'::integer[]))
               Merge Sort Key: r5n.r2, r5n.r3, r5n.r4, r5n.r5
               Merge Stream Key: r5n.r1
               Merge Streams: 4
               Merge Cond: (r5n.r1 = ANY ('{1,2,NULL,3}'::integer[]))
               Storage Table Read Requests: 1
               Storage Table Read Ops: 3
               Storage Table Rows Scanned: 15
(17 rows)

 r2 | r3 | r4 | r5 |   n   | r1 
----+----+----+----+-------+----
  0 |  0 |  0 |  3 | 30002 |  2
  0 |  0 |  2 |  5 | 52001 |  1
  0 |  0 |  2 |  6 | 62001 |  1
  0 |  0 |  4 |  1 | 14003 |  3
  0 |  0 |  4 |  2 | 24002 |  2
(5 rows)

 r2 | r3 | r4 | r5 |   n   | r1 
----+----+----+----+-------+----
  0 |  0 |  0 |  3 | 30002 |  2
  0 |  0 |  2 |  5 | 52001 |  1
  0 |  0 |  2 |  6 | 62001 |  1
  0 |  0 |  4 |  1 | 14003 |  3
  0 |  0 |  4 |  2 | 24002 |  2
(5 rows)

-- Only NULLs in IN
-- Third hint is to use SAOP merge as the second hint ends up using sort.
-- TODO(#29073): after culling array, maybe the third hint should not use SAOP
-- merge.
\set query 'SELECT r2, r3, r4, r5, n, r1 FROM r5n WHERE r1 IN (null, null, null) ORDER BY r2, r3, r4, r5, n LIMIT 5'
\set hint3 '/*+Set(enable_sort off) Set(yb_max_saop_merge_streams 64)*/'
:explain3run3
                                 QUERY PLAN                                  
-----------------------------------------------------------------------------
 Limit (actual rows=0 loops=1)
   Output: r2, r3, r4, r5, n, r1
   ->  Sort (actual rows=0 loops=1)
         Output: r2, r3, r4, r5, n, r1
         Sort Key: r5n.r2, r5n.r3, r5n.r4, r5n.r5, r5n.n
         Sort Method: quicksort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=0 loops=1)
               Output: r2, r3, r4, r5, n, r1
               Index Cond: (r5n.r1 = ANY ('{NULL,NULL,NULL}'::smallint[]))
(9 rows)

                                 QUERY PLAN                                  
-----------------------------------------------------------------------------
 Limit (actual rows=0 loops=1)
   Output: r2, r3, r4, r5, n, r1
   ->  Sort (actual rows=0 loops=1)
         Output: r2, r3, r4, r5, n, r1
         Sort Key: r5n.r2, r5n.r3, r5n.r4, r5n.r5, r5n.n
         Sort Method: quicksort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=0 loops=1)
               Output: r2, r3, r4, r5, n, r1
               Index Cond: (r5n.r1 = ANY ('{NULL,NULL,NULL}'::smallint[]))
(9 rows)

                                 QUERY PLAN                                  
-----------------------------------------------------------------------------
 Limit (actual rows=0 loops=1)
   Output: r2, r3, r4, r5, n, r1
   ->  Incremental Sort (actual rows=0 loops=1)
         Output: r2, r3, r4, r5, n, r1
         Sort Key: r5n.r2, r5n.r3, r5n.r4, r5n.r5, r5n.n
         Presorted Key: r5n.r2, r5n.r3, r5n.r4, r5n.r5
         Full-sort Groups: 1  Sort Method: quicksort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=0 loops=1)
               Output: r2, r3, r4, r5, n, r1
               Index Cond: (r5n.r1 = ANY ('{NULL,NULL,NULL}'::smallint[]))
               Merge Sort Key: r5n.r2, r5n.r3, r5n.r4, r5n.r5
               Merge Stream Key: r5n.r1
               Merge Streams: 3
               Merge Cond: (r5n.r1 = ANY ('{NULL,NULL,NULL}'::smallint[]))
(14 rows)

 r2 | r3 | r4 | r5 | n | r1 
----+----+----+----+---+----
(0 rows)

 r2 | r3 | r4 | r5 | n | r1 
----+----+----+----+---+----
(0 rows)

 r2 | r3 | r4 | r5 | n | r1 
----+----+----+----+---+----
(0 rows)

-- Empty array
-- Third hint is to use SAOP merge as the second hint ends up using sort.
\set query 'SELECT r2, r3, r4, r5, n, r1 FROM r5n WHERE r1 = ANY(''{}'') ORDER BY r2, r3, r4, r5, n LIMIT 5'
:explain3run3
                                 QUERY PLAN                                  
-----------------------------------------------------------------------------
 Limit (actual rows=0 loops=1)
   Output: r2, r3, r4, r5, n, r1
   ->  Sort (actual rows=0 loops=1)
         Output: r2, r3, r4, r5, n, r1
         Sort Key: r5n.r2, r5n.r3, r5n.r4, r5n.r5, r5n.n
         Sort Method: quicksort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=0 loops=1)
               Output: r2, r3, r4, r5, n, r1
               Index Cond: (r5n.r1 = ANY ('{}'::smallint[]))
(9 rows)

                                 QUERY PLAN                                  
-----------------------------------------------------------------------------
 Limit (actual rows=0 loops=1)
   Output: r2, r3, r4, r5, n, r1
   ->  Sort (actual rows=0 loops=1)
         Output: r2, r3, r4, r5, n, r1
         Sort Key: r5n.r2, r5n.r3, r5n.r4, r5n.r5, r5n.n
         Sort Method: quicksort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=0 loops=1)
               Output: r2, r3, r4, r5, n, r1
               Index Cond: (r5n.r1 = ANY ('{}'::smallint[]))
(9 rows)

                                 QUERY PLAN                                  
-----------------------------------------------------------------------------
 Limit (actual rows=0 loops=1)
   Output: r2, r3, r4, r5, n, r1
   ->  Incremental Sort (actual rows=0 loops=1)
         Output: r2, r3, r4, r5, n, r1
         Sort Key: r5n.r2, r5n.r3, r5n.r4, r5n.r5, r5n.n
         Presorted Key: r5n.r2, r5n.r3, r5n.r4, r5n.r5
         Full-sort Groups: 1  Sort Method: quicksort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=0 loops=1)
               Output: r2, r3, r4, r5, n, r1
               Index Cond: (r5n.r1 = ANY ('{}'::smallint[]))
               Merge Sort Key: r5n.r2, r5n.r3, r5n.r4, r5n.r5
               Merge Stream Key: r5n.r1
               Merge Streams: 0
               Merge Cond: (r5n.r1 = ANY ('{}'::smallint[]))
(14 rows)

 r2 | r3 | r4 | r5 | n | r1 
----+----+----+----+---+----
(0 rows)

 r2 | r3 | r4 | r5 | n | r1 
----+----+----+----+---+----
(0 rows)

 r2 | r3 | r4 | r5 | n | r1 
----+----+----+----+---+----
(0 rows)

-- Non-const in RHS (like var ref)
-- SAOP merge should not be used.
\set query 'SELECT r2, r3, r4, r5, n, r1 FROM r5n WHERE r1 IN (1, r2, 2) ORDER BY r2, r3, r4, r5, n LIMIT 5'
:explain2
                                        QUERY PLAN                                        
------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r2, r3, r4, r5, n, r1
   ->  Sort (actual rows=5 loops=1)
         Output: r2, r3, r4, r5, n, r1
         Sort Key: r5n.r2, r5n.r3, r5n.r4, r5n.r5, r5n.n
         Sort Method: top-N heapsort
         ->  Seq Scan on public.r5n (actual rows=1394 loops=1)
               Output: r2, r3, r4, r5, n, r1
               Storage Filter: ((r5n.r1 = ANY ('{1,2}'::integer[])) OR (r5n.r1 = r5n.r2))
               Storage Table Read Requests: 2
               Storage Table Read Ops: 8
               Storage Table Rows Scanned: 5048
(12 rows)

                                        QUERY PLAN                                        
------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r2, r3, r4, r5, n, r1
   ->  Sort (actual rows=5 loops=1)
         Output: r2, r3, r4, r5, n, r1
         Sort Key: r5n.r2, r5n.r3, r5n.r4, r5n.r5, r5n.n
         Sort Method: top-N heapsort
         ->  Seq Scan on public.r5n (actual rows=1394 loops=1)
               Output: r2, r3, r4, r5, n, r1
               Storage Filter: ((r5n.r1 = ANY ('{1,2}'::integer[])) OR (r5n.r1 = r5n.r2))
               Storage Table Read Requests: 2
               Storage Table Read Ops: 8
               Storage Table Rows Scanned: 5048
(12 rows)

-- Large number of streams
\set query 'SELECT r4, r5, n, r1, r2, r3 FROM r5n WHERE r1 IN (0, 1, 2, 3) AND r2 IN (0, 1, 2, 3) AND r3 IN (0, 1, 2, 3) ORDER BY r4, r5, n LIMIT 5'
:explain2run2
                                                                         QUERY PLAN                                                                         
------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r4, r5, n, r1, r2, r3
   ->  Sort (actual rows=5 loops=1)
         Output: r4, r5, n, r1, r2, r3
         Sort Key: r5n.r4, r5n.r5, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=351 loops=1)
               Output: r4, r5, n, r1, r2, r3
               Index Cond: ((r5n.r1 = ANY ('{0,1,2,3}'::integer[])) AND (r5n.r2 = ANY ('{0,1,2,3}'::bigint[])) AND (r5n.r3 = ANY ('{0,1,2,3}'::integer[])))
               Storage Table Read Requests: 2
               Storage Table Read Ops: 8
               Storage Table Rows Scanned: 351
(12 rows)

                                                                         QUERY PLAN                                                                         
------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r4, r5, n, r1, r2, r3
   ->  Incremental Sort (actual rows=5 loops=1)
         Output: r4, r5, n, r1, r2, r3
         Sort Key: r5n.r4, r5n.r5, r5n.n
         Presorted Key: r5n.r4, r5n.r5
         Full-sort Groups: 1  Sort Method: quicksort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=6 loops=1)
               Output: r4, r5, n, r1, r2, r3
               Index Cond: ((r5n.r1 = ANY ('{0,1,2,3}'::integer[])) AND (r5n.r2 = ANY ('{0,1,2,3}'::bigint[])) AND (r5n.r3 = ANY ('{0,1,2,3}'::integer[])))
               Merge Sort Key: r5n.r4, r5n.r5
               Merge Stream Key: r5n.r1, r5n.r2, r5n.r3
               Merge Streams: 64
               Merge Cond: ((r5n.r1 = ANY ('{0,1,2,3}'::integer[])) AND (r5n.r2 = ANY ('{0,1,2,3}'::bigint[])) AND (r5n.r3 = ANY ('{0,1,2,3}'::integer[])))
               Storage Table Read Requests: 1
               Storage Table Read Ops: 64
               Storage Table Rows Scanned: 275
(17 rows)

 r4 | r5 |   n   | r1 | r2 | r3 
----+----+-------+----+----+----
  0 |  0 |    23 |  3 |  2 |  0
  0 |  0 |   103 |  3 |  0 |  1
  0 |  0 |   203 |  3 |  0 |  2
  0 |  0 |   310 |  0 |  1 |  3
  0 |  1 | 10210 |  0 |  1 |  2
(5 rows)

 r4 | r5 |   n   | r1 | r2 | r3 
----+----+-------+----+----+----
  0 |  0 |    23 |  3 |  2 |  0
  0 |  0 |   103 |  3 |  0 |  1
  0 |  0 |   203 |  3 |  0 |  2
  0 |  0 |   310 |  0 |  1 |  3
  0 |  1 | 10210 |  0 |  1 |  2
(5 rows)

-- Single IN hitting limit
-- SAOP merge should not be used.
\set on '/*+Set(yb_max_saop_merge_streams 5)*/'
\set query 'SELECT r2, r3, r4, r5, n, r1 FROM r5n WHERE r1 IN (0, 2, 4, 6, 8, 10) ORDER BY r2, r3, r4, r5, n LIMIT 5'
:explain2
                                   QUERY PLAN                                   
--------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r2, r3, r4, r5, n, r1
   ->  Sort (actual rows=5 loops=1)
         Output: r2, r3, r4, r5, n, r1
         Sort Key: r5n.r2, r5n.r3, r5n.r4, r5n.r5, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=2560 loops=1)
               Output: r2, r3, r4, r5, n, r1
               Index Cond: (r5n.r1 = ANY ('{0,2,4,6,8,10}'::integer[]))
               Storage Table Read Requests: 3
               Storage Table Read Ops: 9
               Storage Table Rows Scanned: 2560
(12 rows)

                                   QUERY PLAN                                   
--------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r2, r3, r4, r5, n, r1
   ->  Sort (actual rows=5 loops=1)
         Output: r2, r3, r4, r5, n, r1
         Sort Key: r5n.r2, r5n.r3, r5n.r4, r5n.r5, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=2560 loops=1)
               Output: r2, r3, r4, r5, n, r1
               Index Cond: (r5n.r1 = ANY ('{0,2,4,6,8,10}'::integer[]))
               Storage Table Read Requests: 3
               Storage Table Read Ops: 9
               Storage Table Rows Scanned: 2560
(12 rows)

-- Double IN hitting limit
-- SAOP merge should not be used.
\set query 'SELECT r3, r4, r5, n, r1, r2 FROM r5n WHERE r1 IN (0, 2, 4) AND r2 IN (6, 8) ORDER BY r3, r4, r5, n LIMIT 5'
:explain2
                                                QUERY PLAN                                                
----------------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r3, r4, r5, n, r1, r2
   ->  Sort (actual rows=5 loops=1)
         Output: r3, r4, r5, n, r1, r2
         Sort Key: r5n.r3, r5n.r4, r5n.r5, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=318 loops=1)
               Output: r3, r4, r5, n, r1, r2
               Index Cond: ((r5n.r1 = ANY ('{0,2,4}'::integer[])) AND (r5n.r2 = ANY ('{6,8}'::bigint[])))
               Storage Table Read Requests: 2
               Storage Table Read Ops: 8
               Storage Table Rows Scanned: 318
(12 rows)

                                                QUERY PLAN                                                
----------------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r3, r4, r5, n, r1, r2
   ->  Sort (actual rows=5 loops=1)
         Output: r3, r4, r5, n, r1, r2
         Sort Key: r5n.r3, r5n.r4, r5n.r5, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=318 loops=1)
               Output: r3, r4, r5, n, r1, r2
               Index Cond: ((r5n.r1 = ANY ('{0,2,4}'::integer[])) AND (r5n.r2 = ANY ('{6,8}'::bigint[])))
               Storage Table Read Requests: 2
               Storage Table Read Ops: 8
               Storage Table Rows Scanned: 318
(12 rows)

-- Triple IN hitting limit before realizing limit could be satisfied with 0x
-- multiplier.
-- Third hint is to encourage use of SAOP merge like other similar empty array
-- test cases.
-- SAOP merge should not be used.
\set query 'SELECT r3, r4, r5, n, r1, r2 FROM r5n WHERE r1 IN (0, 2, 4) AND r2 IN (6, 8) AND r3 = ANY(''{}'') ORDER BY r4, r5, n LIMIT 5'
\set hint3 '/*+Set(enable_sort off) Set(yb_max_saop_merge_streams 5)*/'
:explain3
                                                                  QUERY PLAN                                                                   
-----------------------------------------------------------------------------------------------------------------------------------------------
 Limit (actual rows=0 loops=1)
   Output: r3, r4, r5, n, r1, r2
   ->  Sort (actual rows=0 loops=1)
         Output: r3, r4, r5, n, r1, r2
         Sort Key: r5n.r4, r5n.r5, r5n.n
         Sort Method: quicksort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=0 loops=1)
               Output: r3, r4, r5, n, r1, r2
               Index Cond: ((r5n.r1 = ANY ('{0,2,4}'::integer[])) AND (r5n.r2 = ANY ('{6,8}'::bigint[])) AND (r5n.r3 = ANY ('{}'::integer[])))
(9 rows)

                                                                  QUERY PLAN                                                                   
-----------------------------------------------------------------------------------------------------------------------------------------------
 Limit (actual rows=0 loops=1)
   Output: r3, r4, r5, n, r1, r2
   ->  Sort (actual rows=0 loops=1)
         Output: r3, r4, r5, n, r1, r2
         Sort Key: r5n.r4, r5n.r5, r5n.n
         Sort Method: quicksort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=0 loops=1)
               Output: r3, r4, r5, n, r1, r2
               Index Cond: ((r5n.r1 = ANY ('{0,2,4}'::integer[])) AND (r5n.r2 = ANY ('{6,8}'::bigint[])) AND (r5n.r3 = ANY ('{}'::integer[])))
(9 rows)

                                                                  QUERY PLAN                                                                   
-----------------------------------------------------------------------------------------------------------------------------------------------
 Limit (actual rows=0 loops=1)
   Output: r3, r4, r5, n, r1, r2
   ->  Sort (actual rows=0 loops=1)
         Output: r3, r4, r5, n, r1, r2
         Sort Key: r5n.r4, r5n.r5, r5n.n
         Sort Method: quicksort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=0 loops=1)
               Output: r3, r4, r5, n, r1, r2
               Index Cond: ((r5n.r1 = ANY ('{0,2,4}'::integer[])) AND (r5n.r2 = ANY ('{6,8}'::bigint[])) AND (r5n.r3 = ANY ('{}'::integer[])))
(9 rows)

-- Triple IN avoiding limit because of 0x multiplier.
-- Third hint is to use SAOP merge as the second hint ends up using sort.
\set query 'SELECT r3, r4, r5, n, r1, r2 FROM r5n WHERE r1 IN (0, 2, 4) AND r2 = ANY(''{}'') AND r3 IN (6, 8) ORDER BY r4, r5, n LIMIT 5'
:explain3run3
                                                                  QUERY PLAN                                                                   
-----------------------------------------------------------------------------------------------------------------------------------------------
 Limit (actual rows=0 loops=1)
   Output: r3, r4, r5, n, r1, r2
   ->  Sort (actual rows=0 loops=1)
         Output: r3, r4, r5, n, r1, r2
         Sort Key: r5n.r4, r5n.r5, r5n.n
         Sort Method: quicksort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=0 loops=1)
               Output: r3, r4, r5, n, r1, r2
               Index Cond: ((r5n.r1 = ANY ('{0,2,4}'::integer[])) AND (r5n.r2 = ANY ('{}'::bigint[])) AND (r5n.r3 = ANY ('{6,8}'::integer[])))
(9 rows)

                                                                  QUERY PLAN                                                                   
-----------------------------------------------------------------------------------------------------------------------------------------------
 Limit (actual rows=0 loops=1)
   Output: r3, r4, r5, n, r1, r2
   ->  Sort (actual rows=0 loops=1)
         Output: r3, r4, r5, n, r1, r2
         Sort Key: r5n.r4, r5n.r5, r5n.n
         Sort Method: quicksort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=0 loops=1)
               Output: r3, r4, r5, n, r1, r2
               Index Cond: ((r5n.r1 = ANY ('{0,2,4}'::integer[])) AND (r5n.r2 = ANY ('{}'::bigint[])) AND (r5n.r3 = ANY ('{6,8}'::integer[])))
(9 rows)

                                                                  QUERY PLAN                                                                   
-----------------------------------------------------------------------------------------------------------------------------------------------
 Limit (actual rows=0 loops=1)
   Output: r3, r4, r5, n, r1, r2
   ->  Incremental Sort (actual rows=0 loops=1)
         Output: r3, r4, r5, n, r1, r2
         Sort Key: r5n.r4, r5n.r5, r5n.n
         Presorted Key: r5n.r4, r5n.r5
         Full-sort Groups: 1  Sort Method: quicksort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=0 loops=1)
               Output: r3, r4, r5, n, r1, r2
               Index Cond: ((r5n.r1 = ANY ('{0,2,4}'::integer[])) AND (r5n.r2 = ANY ('{}'::bigint[])) AND (r5n.r3 = ANY ('{6,8}'::integer[])))
               Merge Sort Key: r5n.r4, r5n.r5
               Merge Stream Key: r5n.r1, r5n.r2, r5n.r3
               Merge Streams: 0
               Merge Cond: ((r5n.r1 = ANY ('{0,2,4}'::integer[])) AND (r5n.r2 = ANY ('{}'::bigint[])) AND (r5n.r3 = ANY ('{6,8}'::integer[])))
(14 rows)

 r3 | r4 | r5 | n | r1 | r2 
----+----+----+---+----+----
(0 rows)

 r3 | r4 | r5 | n | r1 | r2 
----+----+----+---+----+----
(0 rows)

 r3 | r4 | r5 | n | r1 | r2 
----+----+----+---+----+----
(0 rows)

-- Choose lowest cardinality IN
-- TODO(#20899): this test needs to be reconsidered when fixing this issue.
\set query 'SELECT r2, r3, r4, r5, n, r1 FROM r5n WHERE r1 IN (1, 2, 3, 4, 5, 6) AND r1 IN (3, 4, 5, 6, 7) AND r1 IN (5, 6, 7, 8, 9, 10) ORDER BY r2, r3, r4, r5, n LIMIT 5'
:explain2run2
                                                                               QUERY PLAN                                                                               
------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r2, r3, r4, r5, n, r1
   ->  Sort (actual rows=5 loops=1)
         Output: r2, r3, r4, r5, n, r1
         Sort Key: r5n.r2, r5n.r3, r5n.r4, r5n.r5, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=1033 loops=1)
               Output: r2, r3, r4, r5, n, r1
               Index Cond: ((r5n.r1 = ANY ('{1,2,3,4,5,6}'::integer[])) AND (r5n.r1 = ANY ('{3,4,5,6,7}'::integer[])) AND (r5n.r1 = ANY ('{5,6,7,8,9,10}'::integer[])))
               Rows Removed by Index Recheck: 1515
               Storage Table Read Requests: 3
               Storage Table Read Ops: 3
               Storage Table Rows Scanned: 2548
(13 rows)

                                                                               QUERY PLAN                                                                               
------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r2, r3, r4, r5, n, r1
   ->  Incremental Sort (actual rows=5 loops=1)
         Output: r2, r3, r4, r5, n, r1
         Sort Key: r5n.r2, r5n.r3, r5n.r4, r5n.r5, r5n.n
         Presorted Key: r5n.r2, r5n.r3, r5n.r4, r5n.r5
         Full-sort Groups: 1  Sort Method: quicksort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=6 loops=1)
               Output: r2, r3, r4, r5, n, r1
               Index Cond: ((r5n.r1 = ANY ('{1,2,3,4,5,6}'::integer[])) AND (r5n.r1 = ANY ('{3,4,5,6,7}'::integer[])) AND (r5n.r1 = ANY ('{5,6,7,8,9,10}'::integer[])))
               Rows Removed by Index Recheck: 12
               Merge Sort Key: r5n.r2, r5n.r3, r5n.r4, r5n.r5
               Merge Stream Key: r5n.r1
               Merge Streams: 5
               Merge Cond: (r5n.r1 = ANY ('{3,4,5,6,7}'::integer[]))
               Storage Table Read Requests: 2
               Storage Table Read Ops: 10
               Storage Table Rows Scanned: 2525
(18 rows)

 r2 | r3 | r4 | r5 |   n   | r1 
----+----+----+----+-------+----
  0 |  0 |  0 |  0 |     6 |  6
  0 |  0 |  1 |  8 | 81005 |  5
  0 |  0 |  4 |  1 | 14006 |  6
  0 |  0 |  5 |  5 | 55005 |  5
  0 |  0 |  5 |  7 | 75005 |  5
(5 rows)

 r2 | r3 | r4 | r5 |   n   | r1 
----+----+----+----+-------+----
  0 |  0 |  0 |  0 |     6 |  6
  0 |  0 |  1 |  8 | 81005 |  5
  0 |  0 |  4 |  1 | 14006 |  6
  0 |  0 |  5 |  5 | 55005 |  5
  0 |  0 |  5 |  7 | 75005 |  5
(5 rows)

-- Duplicates in IN
-- TODO(#29073): after culling array, this should use SAOP merge.
\set query 'SELECT r2, r3, r4, r5, n, r1 FROM r5n WHERE r1 IN (1, 1, 1, 2, 3, 3, 4, 5, 5, 5, 1) ORDER BY r2, r3, r4, r5, n LIMIT 5'
:explain2run2
                                   QUERY PLAN                                    
---------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r2, r3, r4, r5, n, r1
   ->  Sort (actual rows=5 loops=1)
         Output: r2, r3, r4, r5, n, r1
         Sort Key: r5n.r2, r5n.r3, r5n.r4, r5n.r5, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=2547 loops=1)
               Output: r2, r3, r4, r5, n, r1
               Index Cond: (r5n.r1 = ANY ('{1,1,1,2,3,3,4,5,5,5,1}'::integer[]))
               Storage Table Read Requests: 2
               Storage Table Read Ops: 8
               Storage Table Rows Scanned: 2547
(12 rows)

                                   QUERY PLAN                                    
---------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r2, r3, r4, r5, n, r1
   ->  Sort (actual rows=5 loops=1)
         Output: r2, r3, r4, r5, n, r1
         Sort Key: r5n.r2, r5n.r3, r5n.r4, r5n.r5, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=2547 loops=1)
               Output: r2, r3, r4, r5, n, r1
               Index Cond: (r5n.r1 = ANY ('{1,1,1,2,3,3,4,5,5,5,1}'::integer[]))
               Storage Table Read Requests: 2
               Storage Table Read Ops: 8
               Storage Table Rows Scanned: 2547
(12 rows)

 r2 | r3 | r4 | r5 |   n   | r1 
----+----+----+----+-------+----
  0 |  0 |  0 |  3 | 30002 |  2
  0 |  0 |  1 |  3 | 31004 |  4
  0 |  0 |  1 |  8 | 81005 |  5
  0 |  0 |  2 |  5 | 52001 |  1
  0 |  0 |  2 |  6 | 62001 |  1
(5 rows)

 r2 | r3 | r4 | r5 |   n   | r1 
----+----+----+----+-------+----
  0 |  0 |  0 |  3 | 30002 |  2
  0 |  0 |  1 |  3 | 31004 |  4
  0 |  0 |  1 |  8 | 81005 |  5
  0 |  0 |  2 |  5 | 52001 |  1
  0 |  0 |  2 |  6 | 62001 |  1
(5 rows)

-- (Reset the limit change)
\set on '/*+Set(yb_max_saop_merge_streams 64)*/'
-- #30096: SAOP merge shouldn't be used in a parallel scan.
\set query 'SELECT * FROM r5n WHERE r1 IN (0, 2, 4) AND r2 IN (6, 8) ORDER BY r3, r4, r5'
\set hint3 '/*+Parallel(r5n 2) Set(yb_enable_parallel_scan_range_sharded true) Set(yb_parallel_range_rows 1) Set(yb_max_saop_merge_streams 0)*/'
\set hint4 '/*+Parallel(r5n 2) Set(yb_enable_parallel_scan_range_sharded true) Set(yb_parallel_range_rows 1) Set(yb_max_saop_merge_streams 64)*/'
:explain4
                                             QUERY PLAN                                             
----------------------------------------------------------------------------------------------------
 Sort (actual rows=318 loops=1)
   Output: n, r5, r3, r1, r2, r4
   Sort Key: r5n.r3, r5n.r4, r5n.r5
   Sort Method: quicksort
   ->  Index Scan using r5n_pkey on public.r5n (actual rows=318 loops=1)
         Output: n, r5, r3, r1, r2, r4
         Index Cond: ((r5n.r1 = ANY ('{0,2,4}'::integer[])) AND (r5n.r2 = ANY ('{6,8}'::bigint[])))
         Storage Table Read Requests: 2
         Storage Table Read Ops: 8
         Storage Table Rows Scanned: 318
(10 rows)

                                          QUERY PLAN                                          
----------------------------------------------------------------------------------------------
 Index Scan using r5n_pkey on public.r5n (actual rows=318 loops=1)
   Output: n, r5, r3, r1, r2, r4
   Index Cond: ((r5n.r1 = ANY ('{0,2,4}'::integer[])) AND (r5n.r2 = ANY ('{6,8}'::bigint[])))
   Merge Sort Key: r5n.r3, r5n.r4, r5n.r5
   Merge Stream Key: r5n.r1, r5n.r2
   Merge Streams: 6
   Merge Cond: ((r5n.r1 = ANY ('{0,2,4}'::integer[])) AND (r5n.r2 = ANY ('{6,8}'::bigint[])))
   Storage Table Read Requests: 1
   Storage Table Read Ops: 6
   Storage Table Rows Scanned: 318
(10 rows)

                                                QUERY PLAN                                                
----------------------------------------------------------------------------------------------------------
 Gather Merge (actual rows=318 loops=1)
   Output: n, r5, r3, r1, r2, r4
   Workers Planned: 2
   Workers Launched: 2
   ->  Sort (actual rows=106 loops=3)
         Output: n, r5, r3, r1, r2, r4
         Sort Key: r5n.r3, r5n.r4, r5n.r5
         Sort Method: quicksort
         Worker 0:  actual rows=0 loops=1
           Sort Method: quicksort  Memory: 25kB
         Worker 1:  actual rows=0 loops=1
           Sort Method: quicksort  Memory: 25kB
         ->  Parallel Index Scan using r5n_pkey on public.r5n (actual rows=106 loops=3)
               Output: n, r5, r3, r1, r2, r4
               Index Cond: ((r5n.r1 = ANY ('{0,2,4}'::integer[])) AND (r5n.r2 = ANY ('{6,8}'::bigint[])))
               Storage Table Read Requests: 3
               Storage Table Read Ops: 3
               Storage Table Rows Scanned: 106
               Worker 0:  actual rows=0 loops=1
               Worker 1:  actual rows=0 loops=1
(20 rows)

                                                QUERY PLAN                                                
----------------------------------------------------------------------------------------------------------
 Gather Merge (actual rows=318 loops=1)
   Output: n, r5, r3, r1, r2, r4
   Workers Planned: 2
   Workers Launched: 2
   ->  Sort (actual rows=106 loops=3)
         Output: n, r5, r3, r1, r2, r4
         Sort Key: r5n.r3, r5n.r4, r5n.r5
         Sort Method: quicksort
         Worker 0:  actual rows=0 loops=1
           Sort Method: quicksort  Memory: 25kB
         Worker 1:  actual rows=0 loops=1
           Sort Method: quicksort  Memory: 25kB
         ->  Parallel Index Scan using r5n_pkey on public.r5n (actual rows=106 loops=3)
               Output: n, r5, r3, r1, r2, r4
               Index Cond: ((r5n.r1 = ANY ('{0,2,4}'::integer[])) AND (r5n.r2 = ANY ('{6,8}'::bigint[])))
               Storage Table Read Requests: 3
               Storage Table Read Ops: 3
               Storage Table Rows Scanned: 106
               Worker 0:  actual rows=0 loops=1
               Worker 1:  actual rows=0 loops=1
(20 rows)

-- Same thing with backwards scan.
\set query 'SELECT * FROM r5n WHERE r1 IN (0, 2, 4) AND r2 IN (6, 8) ORDER BY r3 DESC, r4 DESC, r5 DESC'
:explain4
                                             QUERY PLAN                                             
----------------------------------------------------------------------------------------------------
 Sort (actual rows=318 loops=1)
   Output: n, r5, r3, r1, r2, r4
   Sort Key: r5n.r3 DESC, r5n.r4 DESC, r5n.r5 DESC
   Sort Method: quicksort
   ->  Index Scan using r5n_pkey on public.r5n (actual rows=318 loops=1)
         Output: n, r5, r3, r1, r2, r4
         Index Cond: ((r5n.r1 = ANY ('{0,2,4}'::integer[])) AND (r5n.r2 = ANY ('{6,8}'::bigint[])))
         Storage Table Read Requests: 2
         Storage Table Read Ops: 8
         Storage Table Rows Scanned: 318
(10 rows)

                                          QUERY PLAN                                          
----------------------------------------------------------------------------------------------
 Index Scan Backward using r5n_pkey on public.r5n (actual rows=318 loops=1)
   Output: n, r5, r3, r1, r2, r4
   Index Cond: ((r5n.r1 = ANY ('{0,2,4}'::integer[])) AND (r5n.r2 = ANY ('{6,8}'::bigint[])))
   Merge Sort Key: r5n.r3 DESC, r5n.r4 DESC, r5n.r5 DESC
   Merge Stream Key: r5n.r1, r5n.r2
   Merge Streams: 6
   Merge Cond: ((r5n.r1 = ANY ('{0,2,4}'::integer[])) AND (r5n.r2 = ANY ('{6,8}'::bigint[])))
   Storage Table Read Requests: 1
   Storage Table Read Ops: 6
   Storage Table Rows Scanned: 318
(10 rows)

                                                QUERY PLAN                                                
----------------------------------------------------------------------------------------------------------
 Gather Merge (actual rows=318 loops=1)
   Output: n, r5, r3, r1, r2, r4
   Workers Planned: 2
   Workers Launched: 2
   ->  Sort (actual rows=106 loops=3)
         Output: n, r5, r3, r1, r2, r4
         Sort Key: r5n.r3 DESC, r5n.r4 DESC, r5n.r5 DESC
         Sort Method: quicksort
         Worker 0:  actual rows=0 loops=1
           Sort Method: quicksort  Memory: 25kB
         Worker 1:  actual rows=0 loops=1
           Sort Method: quicksort  Memory: 25kB
         ->  Parallel Index Scan using r5n_pkey on public.r5n (actual rows=106 loops=3)
               Output: n, r5, r3, r1, r2, r4
               Index Cond: ((r5n.r1 = ANY ('{0,2,4}'::integer[])) AND (r5n.r2 = ANY ('{6,8}'::bigint[])))
               Storage Table Read Requests: 3
               Storage Table Read Ops: 3
               Storage Table Rows Scanned: 106
               Worker 0:  actual rows=0 loops=1
               Worker 1:  actual rows=0 loops=1
(20 rows)

                                                QUERY PLAN                                                
----------------------------------------------------------------------------------------------------------
 Gather Merge (actual rows=318 loops=1)
   Output: n, r5, r3, r1, r2, r4
   Workers Planned: 2
   Workers Launched: 2
   ->  Sort (actual rows=106 loops=3)
         Output: n, r5, r3, r1, r2, r4
         Sort Key: r5n.r3 DESC, r5n.r4 DESC, r5n.r5 DESC
         Sort Method: quicksort
         Worker 0:  actual rows=0 loops=1
           Sort Method: quicksort  Memory: 25kB
         Worker 1:  actual rows=0 loops=1
           Sort Method: quicksort  Memory: 25kB
         ->  Parallel Index Scan using r5n_pkey on public.r5n (actual rows=106 loops=3)
               Output: n, r5, r3, r1, r2, r4
               Index Cond: ((r5n.r1 = ANY ('{0,2,4}'::integer[])) AND (r5n.r2 = ANY ('{6,8}'::bigint[])))
               Storage Table Read Requests: 3
               Storage Table Read Ops: 3
               Storage Table Rows Scanned: 106
               Worker 0:  actual rows=0 loops=1
               Worker 1:  actual rows=0 loops=1
(20 rows)

--
-- Secondary index
--
CREATE INDEX NONCONCURRENTLY ON r5n (r2 ASC, r3, r4, r5)
SPLIT AT VALUES (
    (1),
    (2),
    (2, 2),
    (2, 2, 2),
    (2, 2, 2, 2),
    (3));
-- No order
-- SAOP merge should not be used.
\set query 'SELECT * FROM r5n WHERE r2 IN (0, 1, 2, 3) LIMIT 5'
:explain2
                           QUERY PLAN                           
----------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: n, r5, r3, r1, r2, r4
   ->  Seq Scan on public.r5n (actual rows=5 loops=1)
         Output: n, r5, r3, r1, r2, r4
         Storage Filter: (r5n.r2 = ANY ('{0,1,2,3}'::bigint[]))
         Storage Table Read Requests: 1
         Storage Table Read Ops: 6
         Storage Table Rows Scanned: 21
(8 rows)

                           QUERY PLAN                           
----------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: n, r5, r3, r1, r2, r4
   ->  Seq Scan on public.r5n (actual rows=5 loops=1)
         Output: n, r5, r3, r1, r2, r4
         Storage Filter: (r5n.r2 = ANY ('{0,1,2,3}'::bigint[]))
         Storage Table Read Requests: 1
         Storage Table Read Ops: 6
         Storage Table Rows Scanned: 21
(8 rows)

-- No limit
-- TODO(#29078): this likely should use SAOP merge.
\set query 'SELECT * FROM r5n WHERE r2 IN (0, 1, 2, 3) ORDER BY r3, r4, r5'
:explain2
                                QUERY PLAN                                
--------------------------------------------------------------------------
 Sort (actual rows=2045 loops=1)
   Output: n, r5, r3, r1, r2, r4
   Sort Key: r5n.r3, r5n.r4, r5n.r5
   Sort Method: quicksort
   ->  Index Scan using r5n_pkey on public.r5n (actual rows=2045 loops=1)
         Output: n, r5, r3, r1, r2, r4
         Index Cond: (r5n.r2 = ANY ('{0,1,2,3}'::bigint[]))
         Storage Table Read Requests: 3
         Storage Table Read Ops: 9
         Storage Table Rows Scanned: 2045
(10 rows)

                                QUERY PLAN                                
--------------------------------------------------------------------------
 Sort (actual rows=2045 loops=1)
   Output: n, r5, r3, r1, r2, r4
   Sort Key: r5n.r3, r5n.r4, r5n.r5
   Sort Method: quicksort
   ->  Index Scan using r5n_pkey on public.r5n (actual rows=2045 loops=1)
         Output: n, r5, r3, r1, r2, r4
         Index Cond: (r5n.r2 = ANY ('{0,1,2,3}'::bigint[]))
         Storage Table Read Requests: 3
         Storage Table Read Ops: 9
         Storage Table Rows Scanned: 2045
(10 rows)

-- Following queries send various numbers of requests/scan various number of rows
-- due to non-deterministic order of equal rows in merge sort, hide their DIST
\set explain 'EXPLAIN (ANALYZE, VERBOSE, COSTS OFF, SUMMARY OFF, TIMING OFF)'
-- Forward scan
\set query 'SELECT * FROM r5n WHERE r2 IN (0, 1, 2, 3) ORDER BY r3, r4, n LIMIT 5'
:explain2run2
                                   QUERY PLAN                                   
--------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: n, r5, r3, r1, r2, r4
   ->  Sort (actual rows=5 loops=1)
         Output: n, r5, r3, r1, r2, r4
         Sort Key: r5n.r3, r5n.r4, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=2045 loops=1)
               Output: n, r5, r3, r1, r2, r4
               Index Cond: (r5n.r2 = ANY ('{0,1,2,3}'::bigint[]))
(9 rows)

                                       QUERY PLAN                                        
-----------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: n, r5, r3, r1, r2, r4
   ->  Incremental Sort (actual rows=5 loops=1)
         Output: n, r5, r3, r1, r2, r4
         Sort Key: r5n.r3, r5n.r4, r5n.n
         Presorted Key: r5n.r3, r5n.r4
         Full-sort Groups: 1  Sort Method: top-N heapsort
         ->  Index Scan using r5n_r2_r3_r4_r5_idx on public.r5n (actual rows=25 loops=1)
               Output: n, r5, r3, r1, r2, r4
               Index Cond: (r5n.r2 = ANY ('{0,1,2,3}'::bigint[]))
               Merge Sort Key: r5n.r3, r5n.r4
               Merge Stream Key: r5n.r2
               Merge Streams: 4
               Merge Cond: (r5n.r2 = ANY ('{0,1,2,3}'::bigint[]))
(14 rows)

   n   | r5 | r3 | r1 | r2 | r4 
-------+----+----+----+----+----
     6 |  0 |  0 |  6 |  0 |  0
     8 |  0 |  0 |  8 |  0 |  0
    23 |  0 |  0 |  3 |  2 |  0
 10037 |  1 |  0 |  7 |  3 |  0
 20009 |  2 |  0 |  9 |  0 |  0
(5 rows)

   n   | r5 | r3 | r1 | r2 | r4 
-------+----+----+----+----+----
     6 |  0 |  0 |  6 |  0 |  0
     8 |  0 |  0 |  8 |  0 |  0
    23 |  0 |  0 |  3 |  2 |  0
 10037 |  1 |  0 |  7 |  3 |  0
 20009 |  2 |  0 |  9 |  0 |  0
(5 rows)

-- Backward scan
\set query 'SELECT * FROM r5n WHERE r2 IN (0, 1, 2, 3) ORDER BY r3 DESC, r4 DESC, n LIMIT 5'
:explain2run2
                                   QUERY PLAN                                   
--------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: n, r5, r3, r1, r2, r4
   ->  Sort (actual rows=5 loops=1)
         Output: n, r5, r3, r1, r2, r4
         Sort Key: r5n.r3 DESC, r5n.r4 DESC, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=2045 loops=1)
               Output: n, r5, r3, r1, r2, r4
               Index Cond: (r5n.r2 = ANY ('{0,1,2,3}'::bigint[]))
(9 rows)

                                            QUERY PLAN                                            
--------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: n, r5, r3, r1, r2, r4
   ->  Incremental Sort (actual rows=5 loops=1)
         Output: n, r5, r3, r1, r2, r4
         Sort Key: r5n.r3 DESC, r5n.r4 DESC, r5n.n
         Presorted Key: r5n.r3, r5n.r4
         Full-sort Groups: 1  Sort Method: top-N heapsort
         ->  Index Scan Backward using r5n_r2_r3_r4_r5_idx on public.r5n (actual rows=22 loops=1)
               Output: n, r5, r3, r1, r2, r4
               Index Cond: (r5n.r2 = ANY ('{0,1,2,3}'::bigint[]))
               Merge Sort Key: r5n.r3 DESC, r5n.r4 DESC
               Merge Stream Key: r5n.r2
               Merge Streams: 4
               Merge Cond: (r5n.r2 = ANY ('{0,1,2,3}'::bigint[]))
(14 rows)

   n   | r5 | r3 | r1 | r2 | r4 
-------+----+----+----+----+----
  9911 |  0 |  9 |  1 |  1 |  9
  9927 |  0 |  9 |  7 |  2 |  9
 19903 |  1 |  9 |  3 |  0 |  9
 19919 |  1 |  9 |  9 |  1 |  9
 19936 |  1 |  9 |  6 |  3 |  9
(5 rows)

   n   | r5 | r3 | r1 | r2 | r4 
-------+----+----+----+----+----
  9911 |  0 |  9 |  1 |  1 |  9
  9927 |  0 |  9 |  7 |  2 |  9
 19903 |  1 |  9 |  3 |  0 |  9
 19919 |  1 |  9 |  9 |  1 |  9
 19936 |  1 |  9 |  6 |  3 |  9
(5 rows)

-- Targets
\set query 'SELECT r5, 1, r5 FROM r5n WHERE r2 IN (0, 1, 2, 3) ORDER BY r3 DESC, r4 DESC, n LIMIT 5'
:explain2run2
                                   QUERY PLAN                                   
--------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r5, 1, r5, r3, r4, n
   ->  Sort (actual rows=5 loops=1)
         Output: r5, 1, r5, r3, r4, n
         Sort Key: r5n.r3 DESC, r5n.r4 DESC, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=2045 loops=1)
               Output: r5, 1, r5, r3, r4, n
               Index Cond: (r5n.r2 = ANY ('{0,1,2,3}'::bigint[]))
(9 rows)

                                            QUERY PLAN                                            
--------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r5, 1, r5, r3, r4, n
   ->  Incremental Sort (actual rows=5 loops=1)
         Output: r5, 1, r5, r3, r4, n
         Sort Key: r5n.r3 DESC, r5n.r4 DESC, r5n.n
         Presorted Key: r5n.r3, r5n.r4
         Full-sort Groups: 1  Sort Method: top-N heapsort
         ->  Index Scan Backward using r5n_r2_r3_r4_r5_idx on public.r5n (actual rows=22 loops=1)
               Output: r5, 1, r5, r3, r4, n
               Index Cond: (r5n.r2 = ANY ('{0,1,2,3}'::bigint[]))
               Merge Sort Key: r5n.r3 DESC, r5n.r4 DESC
               Merge Stream Key: r5n.r2
               Merge Streams: 4
               Merge Cond: (r5n.r2 = ANY ('{0,1,2,3}'::bigint[]))
(14 rows)

 r5 | ?column? | r5 
----+----------+----
  0 |        1 |  0
  0 |        1 |  0
  1 |        1 |  1
  1 |        1 |  1
  1 |        1 |  1
(5 rows)

 r5 | ?column? | r5 
----+----------+----
  0 |        1 |  0
  0 |        1 |  0
  1 |        1 |  1
  1 |        1 |  1
  1 |        1 |  1
(5 rows)

-- (Reset the explain change)
\set explain 'EXPLAIN (ANALYZE, DIST, VERBOSE, COSTS OFF, SUMMARY OFF, TIMING OFF)'
-- Secondary index scan VS SAOP merge PK scan
\set query 'SELECT r2, r3, r4, n, r1 FROM r5n WHERE r1 IN (1, 2, 3, 4, 5) AND r2 = 4 ORDER BY r3, r4, n LIMIT 5'
:explain2run2
                                       QUERY PLAN                                       
----------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r2, r3, r4, n, r1
   ->  Sort (actual rows=5 loops=1)
         Output: r2, r3, r4, n, r1
         Sort Key: r5n.r3, r5n.r4, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=234 loops=1)
               Output: r2, r3, r4, n, r1
               Index Cond: ((r5n.r1 = ANY ('{1,2,3,4,5}'::integer[])) AND (r5n.r2 = 4))
               Storage Table Read Requests: 2
               Storage Table Read Ops: 7
               Storage Table Rows Scanned: 234
(12 rows)

                                       QUERY PLAN                                       
----------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r2, r3, r4, n, r1
   ->  Incremental Sort (actual rows=5 loops=1)
         Output: r2, r3, r4, n, r1
         Sort Key: r5n.r3, r5n.r4, r5n.n
         Presorted Key: r5n.r3, r5n.r4
         Full-sort Groups: 1  Sort Method: quicksort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=9 loops=1)
               Output: r2, r3, r4, n, r1
               Index Cond: ((r5n.r1 = ANY ('{1,2,3,4,5}'::integer[])) AND (r5n.r2 = 4))
               Merge Sort Key: r5n.r3, r5n.r4
               Merge Stream Key: r5n.r1
               Merge Streams: 5
               Merge Cond: (r5n.r1 = ANY ('{1,2,3,4,5}'::integer[]))
               Storage Table Read Requests: 1
               Storage Table Read Ops: 5
               Storage Table Rows Scanned: 25
(17 rows)

 r2 | r3 | r4 |   n   | r1 
----+----+----+-------+----
  4 |  0 |  0 |    44 |  4
  4 |  0 |  0 | 20044 |  4
  4 |  0 |  0 | 60041 |  1
  4 |  0 |  0 | 70045 |  5
  4 |  0 |  1 | 11045 |  5
(5 rows)

 r2 | r3 | r4 |   n   | r1 
----+----+----+-------+----
  4 |  0 |  0 |    44 |  4
  4 |  0 |  0 | 20044 |  4
  4 |  0 |  0 | 60041 |  1
  4 |  0 |  0 | 70045 |  5
  4 |  0 |  1 | 11045 |  5
(5 rows)

-- SAOP merge secondary index scan VS SAOP merge PK scan
-- Third hint is to use the secondary index as the second hint ends up using
-- the PK index.
\set query 'SELECT r3, r4, r5, n, r1, r2 FROM r5n WHERE r1 IN (1, 2, 3, 4) AND r2 IN (1, 2, 3, 4) ORDER BY r3, r4, r5, n LIMIT 5'
\set hint3 '/*+IndexScan(r5n r5n_r2_r3_r4_r5_idx) Set(yb_max_saop_merge_streams 64)*/'
:explain3run3
                                                   QUERY PLAN                                                   
----------------------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r3, r4, r5, n, r1, r2
   ->  Sort (actual rows=5 loops=1)
         Output: r3, r4, r5, n, r1, r2
         Sort Key: r5n.r3, r5n.r4, r5n.r5, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=793 loops=1)
               Output: r3, r4, r5, n, r1, r2
               Index Cond: ((r5n.r1 = ANY ('{1,2,3,4}'::integer[])) AND (r5n.r2 = ANY ('{1,2,3,4}'::bigint[])))
               Storage Table Read Requests: 2
               Storage Table Read Ops: 7
               Storage Table Rows Scanned: 793
(12 rows)

                                                   QUERY PLAN                                                   
----------------------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r3, r4, r5, n, r1, r2
   ->  Incremental Sort (actual rows=5 loops=1)
         Output: r3, r4, r5, n, r1, r2
         Sort Key: r5n.r3, r5n.r4, r5n.r5, r5n.n
         Presorted Key: r5n.r3, r5n.r4, r5n.r5
         Full-sort Groups: 1  Sort Method: quicksort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=8 loops=1)
               Output: r3, r4, r5, n, r1, r2
               Index Cond: ((r5n.r1 = ANY ('{1,2,3,4}'::integer[])) AND (r5n.r2 = ANY ('{1,2,3,4}'::bigint[])))
               Merge Sort Key: r5n.r3, r5n.r4, r5n.r5
               Merge Stream Key: r5n.r1, r5n.r2
               Merge Streams: 16
               Merge Cond: ((r5n.r1 = ANY ('{1,2,3,4}'::integer[])) AND (r5n.r2 = ANY ('{1,2,3,4}'::bigint[])))
               Storage Table Read Requests: 1
               Storage Table Read Ops: 16
               Storage Table Rows Scanned: 80
(17 rows)

                                       QUERY PLAN                                       
----------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r3, r4, r5, n, r1, r2
   ->  Incremental Sort (actual rows=5 loops=1)
         Output: r3, r4, r5, n, r1, r2
         Sort Key: r5n.r3, r5n.r4, r5n.r5, r5n.n
         Presorted Key: r5n.r3, r5n.r4, r5n.r5
         Full-sort Groups: 1  Sort Method: quicksort
         ->  Index Scan using r5n_r2_r3_r4_r5_idx on public.r5n (actual rows=8 loops=1)
               Output: r3, r4, r5, n, r1, r2
               Index Cond: (r5n.r2 = ANY ('{1,2,3,4}'::bigint[]))
               Merge Sort Key: r5n.r3, r5n.r4, r5n.r5
               Merge Stream Key: r5n.r2
               Merge Streams: 4
               Merge Cond: (r5n.r2 = ANY ('{1,2,3,4}'::bigint[]))
               Storage Filter: (r5n.r1 = ANY ('{1,2,3,4}'::integer[]))
               Storage Table Read Requests: 1
               Storage Table Read Ops: 4
               Storage Table Rows Scanned: 15
               Storage Index Read Requests: 1
               Storage Index Read Ops: 4
               Storage Index Rows Scanned: 20
(21 rows)

 r3 | r4 | r5 |   n   | r1 | r2 
----+----+----+-------+----+----
  0 |  0 |  0 |    23 |  3 |  2
  0 |  0 |  0 |    44 |  4 |  4
  0 |  0 |  2 | 20013 |  3 |  1
  0 |  0 |  2 | 20044 |  4 |  4
  0 |  0 |  4 | 40014 |  4 |  1
(5 rows)

 r3 | r4 | r5 |   n   | r1 | r2 
----+----+----+-------+----+----
  0 |  0 |  0 |    23 |  3 |  2
  0 |  0 |  0 |    44 |  4 |  4
  0 |  0 |  2 | 20013 |  3 |  1
  0 |  0 |  2 | 20044 |  4 |  4
  0 |  0 |  4 | 40014 |  4 |  1
(5 rows)

 r3 | r4 | r5 |   n   | r1 | r2 
----+----+----+-------+----+----
  0 |  0 |  0 |    23 |  3 |  2
  0 |  0 |  0 |    44 |  4 |  4
  0 |  0 |  2 | 20013 |  3 |  1
  0 |  0 |  2 | 20044 |  4 |  4
  0 |  0 |  4 | 40014 |  4 |  1
(5 rows)

-- (Drop this index)
DROP INDEX r5n_r2_r3_r4_r5_idx;
--
-- Custom opclass secondary index
--
CREATE OPERATOR =#= (
    leftarg = int8,
    rightarg = int8,
    procedure = int8eq,
    commutator = =#=,
    negator = <>
);
CREATE FUNCTION my_int8_sort(int8,int8) RETURNS int LANGUAGE sql AS $$
    SELECT CASE WHEN $1 = $2 THEN 0 WHEN $1 > $2 THEN 1 ELSE -1 END;
$$;
CREATE OPERATOR CLASS test_int8_ops FOR TYPE int8 USING lsm AS
    OPERATOR 1 < (int8,int8), OPERATOR 2 <= (int8,int8),
    OPERATOR 3 =#= (int8,int8), OPERATOR 4 >= (int8,int8),
    OPERATOR 5 > (int8,int8), FUNCTION 1 my_int8_sort(int8,int8);
-- For numeric, treat 0 as highest value.
CREATE FUNCTION my_numeric_lt(numeric,numeric) RETURNS bool LANGUAGE sql AS $$
    SELECT CASE
        WHEN $1 = 0 THEN false
        WHEN $2 = 0 THEN true
        ELSE $1 < $2
    END;
$$;
CREATE FUNCTION my_numeric_le(numeric,numeric) RETURNS bool LANGUAGE sql AS $$
    SELECT CASE
        WHEN $1 = $2 THEN true
        WHEN $1 = 0 THEN false
        WHEN $2 = 0 THEN true
        ELSE $1 <= $2
    END;
$$;
CREATE FUNCTION my_numeric_ge(numeric,numeric) RETURNS bool LANGUAGE sql AS $$
    SELECT CASE
        WHEN $1 = $2 THEN true
        WHEN $2 = 0 THEN false
        WHEN $1 = 0 THEN true
        ELSE $1 >= $2
    END;
$$;
CREATE FUNCTION my_numeric_gt(numeric,numeric) RETURNS bool LANGUAGE sql AS $$
    SELECT CASE
        WHEN $2 = 0 THEN false
        WHEN $1 = 0 THEN true
        ELSE $1 > $2
    END;
$$;
CREATE OPERATOR #<# (
    leftarg = numeric,
    rightarg = numeric,
    procedure = my_numeric_lt,
    commutator = #>#,
    negator = #>=#
);
CREATE OPERATOR #<=# (
    leftarg = numeric,
    rightarg = numeric,
    procedure = my_numeric_le,
    commutator = #>=#,
    negator = #>#
);
CREATE OPERATOR #=# (
    leftarg = numeric,
    rightarg = numeric,
    procedure = numeric_eq,
    commutator = #=#,
    negator = <>
);
CREATE OPERATOR #>=# (
    leftarg = numeric,
    rightarg = numeric,
    procedure = my_numeric_ge,
    commutator = #<=#,
    negator = #<#
);
CREATE OPERATOR #># (
    leftarg = numeric,
    rightarg = numeric,
    procedure = my_numeric_gt,
    commutator = #<#,
    negator = #<=#
);
CREATE FUNCTION my_numeric_sort(numeric,numeric) RETURNS int LANGUAGE sql AS $$
    SELECT CASE
        WHEN $1 = $2 THEN 0
        WHEN $1 = 0 THEN 1
        WHEN $2 = 0 THEN -1
        WHEN $1 > $2 THEN 1
        ELSE -1
    END;
$$;
CREATE OPERATOR CLASS test_numeric_ops FOR TYPE numeric USING lsm AS
    OPERATOR 1 #<# (numeric,numeric), OPERATOR 2 #<=# (numeric,numeric),
    OPERATOR 3 #=# (numeric,numeric), OPERATOR 4 #>=# (numeric,numeric),
    OPERATOR 5 #># (numeric,numeric), FUNCTION 1 my_numeric_sort(numeric,numeric);
CREATE INDEX NONCONCURRENTLY ON r5n (r2 test_int8_ops ASC, r3, r4 test_numeric_ops, r5)
SPLIT AT VALUES (
    (1),
    (2),
    (2, 2),
    (2, 2, 2),
    (2, 2, 2, 2),
    (3));
-- No order
-- SAOP merge should not be used.
\set query 'SELECT * FROM r5n WHERE r2 =#= ANY(ARRAY[0, 1, 2, 3]) LIMIT 5'
:explain2
                            QUERY PLAN                            
------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: n, r5, r3, r1, r2, r4
   ->  Seq Scan on public.r5n (actual rows=5 loops=1)
         Output: n, r5, r3, r1, r2, r4
         Storage Filter: (r5n.r2 =#= ANY ('{0,1,2,3}'::bigint[]))
         Storage Table Read Requests: 1
         Storage Table Read Ops: 6
         Storage Table Rows Scanned: 21
(8 rows)

                            QUERY PLAN                            
------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: n, r5, r3, r1, r2, r4
   ->  Seq Scan on public.r5n (actual rows=5 loops=1)
         Output: n, r5, r3, r1, r2, r4
         Storage Filter: (r5n.r2 =#= ANY ('{0,1,2,3}'::bigint[]))
         Storage Table Read Requests: 1
         Storage Table Read Ops: 6
         Storage Table Rows Scanned: 21
(8 rows)

-- Forward scan
-- TODO(#29383): the output is incorrect where it relies on DocDB order.
-- \set query 'SELECT * FROM r5n WHERE r2 =#= ANY(ARRAY[0, 1, 2, 3]) ORDER BY r3, r4 USING #<#, n LIMIT 5'
-- :explain2run2
-- Backward scan
-- TODO(#29383): the output is incorrect where it relies on DocDB order.
-- \set query 'SELECT * FROM r5n WHERE r2 =#= ANY(ARRAY[0, 1, 2, 3]) ORDER BY r3 DESC, r4 USING #>#, n LIMIT 5'
-- :explain2run2
-- (Drop this index)
DROP INDEX r5n_r2_r3_r4_r5_idx;
--
-- INCLUDE index
--
CREATE INDEX NONCONCURRENTLY ON r5n (r2 ASC, r3, r4, r5) INCLUDE (r1, n)
SPLIT AT VALUES (
    (1),
    (2),
    (2, 2),
    (2, 2, 2),
    (2, 2, 2, 2),
    (3));
-- No order
-- SAOP merge should not be used.
\set query 'SELECT * FROM r5n WHERE r2 IN (0, 1, 2, 3) LIMIT 5'
:explain2
                           QUERY PLAN                           
----------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: n, r5, r3, r1, r2, r4
   ->  Seq Scan on public.r5n (actual rows=5 loops=1)
         Output: n, r5, r3, r1, r2, r4
         Storage Filter: (r5n.r2 = ANY ('{0,1,2,3}'::bigint[]))
         Storage Table Read Requests: 1
         Storage Table Read Ops: 6
         Storage Table Rows Scanned: 21
(8 rows)

                           QUERY PLAN                           
----------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: n, r5, r3, r1, r2, r4
   ->  Seq Scan on public.r5n (actual rows=5 loops=1)
         Output: n, r5, r3, r1, r2, r4
         Storage Filter: (r5n.r2 = ANY ('{0,1,2,3}'::bigint[]))
         Storage Table Read Requests: 1
         Storage Table Read Ops: 6
         Storage Table Rows Scanned: 21
(8 rows)

-- Following queries send various numbers of requests/scan various number of rows
-- due to non-deterministic order of equal rows in merge sort, hide their DIST
\set explain 'EXPLAIN (ANALYZE, VERBOSE, COSTS OFF, SUMMARY OFF, TIMING OFF)'
-- Forward scan
\set query 'SELECT * FROM r5n WHERE r2 IN (0, 1, 2, 3) ORDER BY r3, r4, n LIMIT 5'
:explain2run2
                                             QUERY PLAN                                              
-----------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: n, r5, r3, r1, r2, r4
   ->  Sort (actual rows=5 loops=1)
         Output: n, r5, r3, r1, r2, r4
         Sort Key: r5n.r3, r5n.r4, r5n.n
         Sort Method: top-N heapsort
         ->  Index Only Scan using r5n_r2_r3_r4_r5_r1_n_idx on public.r5n (actual rows=2045 loops=1)
               Output: n, r5, r3, r1, r2, r4
               Index Cond: (r5n.r2 = ANY ('{0,1,2,3}'::bigint[]))
               Heap Fetches: 0
(10 rows)

                                            QUERY PLAN                                             
---------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: n, r5, r3, r1, r2, r4
   ->  Incremental Sort (actual rows=5 loops=1)
         Output: n, r5, r3, r1, r2, r4
         Sort Key: r5n.r3, r5n.r4, r5n.n
         Presorted Key: r5n.r3, r5n.r4
         Full-sort Groups: 1  Sort Method: top-N heapsort
         ->  Index Only Scan using r5n_r2_r3_r4_r5_r1_n_idx on public.r5n (actual rows=25 loops=1)
               Output: n, r5, r3, r1, r2, r4
               Index Cond: (r5n.r2 = ANY ('{0,1,2,3}'::bigint[]))
               Merge Sort Key: r5n.r3, r5n.r4
               Merge Stream Key: r5n.r2
               Merge Streams: 4
               Merge Cond: (r5n.r2 = ANY ('{0,1,2,3}'::bigint[]))
               Heap Fetches: 0
(15 rows)

   n   | r5 | r3 | r1 | r2 | r4 
-------+----+----+----+----+----
     6 |  0 |  0 |  6 |  0 |  0
     8 |  0 |  0 |  8 |  0 |  0
    23 |  0 |  0 |  3 |  2 |  0
 10037 |  1 |  0 |  7 |  3 |  0
 20009 |  2 |  0 |  9 |  0 |  0
(5 rows)

   n   | r5 | r3 | r1 | r2 | r4 
-------+----+----+----+----+----
     6 |  0 |  0 |  6 |  0 |  0
     8 |  0 |  0 |  8 |  0 |  0
    23 |  0 |  0 |  3 |  2 |  0
 10037 |  1 |  0 |  7 |  3 |  0
 20009 |  2 |  0 |  9 |  0 |  0
(5 rows)

-- Backward scan
\set query 'SELECT * FROM r5n WHERE r2 IN (0, 1, 2, 3) ORDER BY r3 DESC, r4 DESC, n LIMIT 5'
:explain2run2
                                             QUERY PLAN                                              
-----------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: n, r5, r3, r1, r2, r4
   ->  Sort (actual rows=5 loops=1)
         Output: n, r5, r3, r1, r2, r4
         Sort Key: r5n.r3 DESC, r5n.r4 DESC, r5n.n
         Sort Method: top-N heapsort
         ->  Index Only Scan using r5n_r2_r3_r4_r5_r1_n_idx on public.r5n (actual rows=2045 loops=1)
               Output: n, r5, r3, r1, r2, r4
               Index Cond: (r5n.r2 = ANY ('{0,1,2,3}'::bigint[]))
               Heap Fetches: 0
(10 rows)

                                                 QUERY PLAN                                                 
------------------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: n, r5, r3, r1, r2, r4
   ->  Incremental Sort (actual rows=5 loops=1)
         Output: n, r5, r3, r1, r2, r4
         Sort Key: r5n.r3 DESC, r5n.r4 DESC, r5n.n
         Presorted Key: r5n.r3, r5n.r4
         Full-sort Groups: 1  Sort Method: top-N heapsort
         ->  Index Only Scan Backward using r5n_r2_r3_r4_r5_r1_n_idx on public.r5n (actual rows=22 loops=1)
               Output: n, r5, r3, r1, r2, r4
               Index Cond: (r5n.r2 = ANY ('{0,1,2,3}'::bigint[]))
               Merge Sort Key: r5n.r3 DESC, r5n.r4 DESC
               Merge Stream Key: r5n.r2
               Merge Streams: 4
               Merge Cond: (r5n.r2 = ANY ('{0,1,2,3}'::bigint[]))
               Heap Fetches: 0
(15 rows)

   n   | r5 | r3 | r1 | r2 | r4 
-------+----+----+----+----+----
  9911 |  0 |  9 |  1 |  1 |  9
  9927 |  0 |  9 |  7 |  2 |  9
 19903 |  1 |  9 |  3 |  0 |  9
 19919 |  1 |  9 |  9 |  1 |  9
 19936 |  1 |  9 |  6 |  3 |  9
(5 rows)

   n   | r5 | r3 | r1 | r2 | r4 
-------+----+----+----+----+----
  9911 |  0 |  9 |  1 |  1 |  9
  9927 |  0 |  9 |  7 |  2 |  9
 19903 |  1 |  9 |  3 |  0 |  9
 19919 |  1 |  9 |  9 |  1 |  9
 19936 |  1 |  9 |  6 |  3 |  9
(5 rows)

-- Targets
\set query 'SELECT n, 1, n FROM r5n WHERE r2 IN (0, 1, 2, 3) ORDER BY r3 DESC, r4 DESC, n LIMIT 5'
:explain2run2
                                             QUERY PLAN                                              
-----------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: n, 1, n, r3, r4
   ->  Sort (actual rows=5 loops=1)
         Output: n, 1, n, r3, r4
         Sort Key: r5n.r3 DESC, r5n.r4 DESC, r5n.n
         Sort Method: top-N heapsort
         ->  Index Only Scan using r5n_r2_r3_r4_r5_r1_n_idx on public.r5n (actual rows=2045 loops=1)
               Output: n, 1, n, r3, r4
               Index Cond: (r5n.r2 = ANY ('{0,1,2,3}'::bigint[]))
               Heap Fetches: 0
(10 rows)

                                                 QUERY PLAN                                                 
------------------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: n, 1, n, r3, r4
   ->  Incremental Sort (actual rows=5 loops=1)
         Output: n, 1, n, r3, r4
         Sort Key: r5n.r3 DESC, r5n.r4 DESC, r5n.n
         Presorted Key: r5n.r3, r5n.r4
         Full-sort Groups: 1  Sort Method: top-N heapsort
         ->  Index Only Scan Backward using r5n_r2_r3_r4_r5_r1_n_idx on public.r5n (actual rows=22 loops=1)
               Output: n, 1, n, r3, r4
               Index Cond: (r5n.r2 = ANY ('{0,1,2,3}'::bigint[]))
               Merge Sort Key: r5n.r3 DESC, r5n.r4 DESC
               Merge Stream Key: r5n.r2
               Merge Streams: 4
               Merge Cond: (r5n.r2 = ANY ('{0,1,2,3}'::bigint[]))
               Heap Fetches: 0
(15 rows)

   n   | ?column? |   n   
-------+----------+-------
  9911 |        1 |  9911
  9927 |        1 |  9927
 19903 |        1 | 19903
 19919 |        1 | 19919
 19936 |        1 | 19936
(5 rows)

   n   | ?column? |   n   
-------+----------+-------
  9911 |        1 |  9911
  9927 |        1 |  9927
 19903 |        1 | 19903
 19919 |        1 | 19919
 19936 |        1 | 19936
(5 rows)

-- (Reset the explain change)
\set explain 'EXPLAIN (ANALYZE, DIST, VERBOSE, COSTS OFF, SUMMARY OFF, TIMING OFF)'
-- Secondary index only scan VS SAOP merge PK scan
\set query 'SELECT r2, r3, r4, n, r1 FROM r5n WHERE r1 IN (1, 2, 3, 4, 5) ORDER BY r2, r3, r4, n LIMIT 5'
:explain2run2
                                            QUERY PLAN                                            
--------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r2, r3, r4, n, r1
   ->  Incremental Sort (actual rows=5 loops=1)
         Output: r2, r3, r4, n, r1
         Sort Key: r5n.r2, r5n.r3, r5n.r4, r5n.n
         Presorted Key: r5n.r2, r5n.r3, r5n.r4
         Full-sort Groups: 1  Sort Method: quicksort
         ->  Index Only Scan using r5n_r2_r3_r4_r5_r1_n_idx on public.r5n (actual rows=6 loops=1)
               Output: r2, r3, r4, n, r1
               Storage Filter: (r5n.r1 = ANY ('{1,2,3,4,5}'::integer[]))
               Heap Fetches: 0
               Storage Index Read Requests: 2
               Storage Index Read Ops: 2
               Storage Index Rows Scanned: 487
(14 rows)

                                            QUERY PLAN                                            
--------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r2, r3, r4, n, r1
   ->  Incremental Sort (actual rows=5 loops=1)
         Output: r2, r3, r4, n, r1
         Sort Key: r5n.r2, r5n.r3, r5n.r4, r5n.n
         Presorted Key: r5n.r2, r5n.r3, r5n.r4
         Full-sort Groups: 1  Sort Method: quicksort
         ->  Index Only Scan using r5n_r2_r3_r4_r5_r1_n_idx on public.r5n (actual rows=6 loops=1)
               Output: r2, r3, r4, n, r1
               Storage Filter: (r5n.r1 = ANY ('{1,2,3,4,5}'::integer[]))
               Heap Fetches: 0
               Storage Index Read Requests: 2
               Storage Index Read Ops: 2
               Storage Index Rows Scanned: 487
(14 rows)

 r2 | r3 | r4 |   n   | r1 
----+----+----+-------+----
  0 |  0 |  0 | 30002 |  2
  0 |  0 |  1 | 31004 |  4
  0 |  0 |  1 | 81005 |  5
  0 |  0 |  2 | 52001 |  1
  0 |  0 |  2 | 62001 |  1
(5 rows)

 r2 | r3 | r4 |   n   | r1 
----+----+----+-------+----
  0 |  0 |  0 | 30002 |  2
  0 |  0 |  1 | 31004 |  4
  0 |  0 |  1 | 81005 |  5
  0 |  0 |  2 | 52001 |  1
  0 |  0 |  2 | 62001 |  1
(5 rows)

-- (Drop this index)
DROP INDEX r5n_r2_r3_r4_r5_r1_n_idx;
--
-- Expression prefix secondary index
--
CREATE INDEX NONCONCURRENTLY ON r5n ((greatest(r2, r3, r4) - least(r2, r3, r4)) ASC, r2, r3, r4)
SPLIT AT VALUES (
    (1),
    (2),
    (2, 2),
    (2, 2, 2),
    (2, 2, 2, 2),
    (3));
-- No order
-- SAOP merge should not be used.
\set query 'SELECT * FROM r5n WHERE (greatest(r2, r3, r4) - least(r2, r3, r4)) IN (0, 2) LIMIT 5'
:explain2
                                                                           QUERY PLAN                                                                            
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: n, r5, r3, r1, r2, r4
   ->  Index Scan using r5n_expr_r2_r3_r4_idx on public.r5n (actual rows=5 loops=1)
         Output: n, r5, r3, r1, r2, r4
         Index Cond: ((GREATEST((r5n.r2)::numeric, (r5n.r3)::numeric, r5n.r4) - LEAST((r5n.r2)::numeric, (r5n.r3)::numeric, r5n.r4)) = ANY ('{0,2}'::numeric[]))
         Storage Table Read Requests: 1
         Storage Table Read Ops: 3
         Storage Table Rows Scanned: 5
         Storage Index Read Requests: 1
         Storage Index Read Ops: 6
         Storage Index Rows Scanned: 25
(11 rows)

                                                                           QUERY PLAN                                                                            
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: n, r5, r3, r1, r2, r4
   ->  Index Scan using r5n_expr_r2_r3_r4_idx on public.r5n (actual rows=5 loops=1)
         Output: n, r5, r3, r1, r2, r4
         Index Cond: ((GREATEST((r5n.r2)::numeric, (r5n.r3)::numeric, r5n.r4) - LEAST((r5n.r2)::numeric, (r5n.r3)::numeric, r5n.r4)) = ANY ('{0,2}'::numeric[]))
         Storage Table Read Requests: 1
         Storage Table Read Ops: 3
         Storage Table Rows Scanned: 5
         Storage Index Read Requests: 1
         Storage Index Read Ops: 6
         Storage Index Rows Scanned: 25
(11 rows)

-- Forward scan
\set query 'SELECT * FROM r5n WHERE (greatest(r2, r3, r4) - least(r2, r3, r4)) IN (0, 2) ORDER BY r2, r3, r4, n LIMIT 5'
:explain2run2
                                                                              QUERY PLAN                                                                               
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: n, r5, r3, r1, r2, r4
   ->  Sort (actual rows=5 loops=1)
         Output: n, r5, r3, r1, r2, r4
         Sort Key: r5n.r2, r5n.r3, r5n.r4, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_expr_r2_r3_r4_idx on public.r5n (actual rows=521 loops=1)
               Output: n, r5, r3, r1, r2, r4
               Index Cond: ((GREATEST((r5n.r2)::numeric, (r5n.r3)::numeric, r5n.r4) - LEAST((r5n.r2)::numeric, (r5n.r3)::numeric, r5n.r4)) = ANY ('{0,2}'::numeric[]))
               Storage Table Read Requests: 5
               Storage Table Read Ops: 19
               Storage Table Rows Scanned: 521
               Storage Index Read Requests: 1
               Storage Index Read Ops: 6
               Storage Index Rows Scanned: 521
(15 rows)

                                                                              QUERY PLAN                                                                               
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: n, r5, r3, r1, r2, r4
   ->  Incremental Sort (actual rows=5 loops=1)
         Output: n, r5, r3, r1, r2, r4
         Sort Key: r5n.r2, r5n.r3, r5n.r4, r5n.n
         Presorted Key: r5n.r2, r5n.r3, r5n.r4
         Full-sort Groups: 1  Sort Method: quicksort
         ->  Index Scan using r5n_expr_r2_r3_r4_idx on public.r5n (actual rows=9 loops=1)
               Output: n, r5, r3, r1, r2, r4
               Index Cond: ((GREATEST((r5n.r2)::numeric, (r5n.r3)::numeric, r5n.r4) - LEAST((r5n.r2)::numeric, (r5n.r3)::numeric, r5n.r4)) = ANY ('{0,2}'::numeric[]))
               Merge Sort Key: r5n.r2, r5n.r3, r5n.r4
               Merge Stream Key: (GREATEST((r5n.r2)::numeric, (r5n.r3)::numeric, r5n.r4) - LEAST((r5n.r2)::numeric, (r5n.r3)::numeric, r5n.r4))
               Merge Streams: 2
               Merge Cond: ((GREATEST((r5n.r2)::numeric, (r5n.r3)::numeric, r5n.r4) - LEAST((r5n.r2)::numeric, (r5n.r3)::numeric, r5n.r4)) = ANY ('{0,2}'::numeric[]))
               Storage Table Read Requests: 1
               Storage Table Read Ops: 3
               Storage Table Rows Scanned: 9
               Storage Index Read Requests: 1
               Storage Index Read Ops: 2
               Storage Index Rows Scanned: 10
(20 rows)

   n   | r5 | r3 | r1 | r2 | r4 
-------+----+----+----+----+----
     6 |  0 |  0 |  6 |  0 |  0
     8 |  0 |  0 |  8 |  0 |  0
 20009 |  2 |  0 |  9 |  0 |  0
 30002 |  3 |  0 |  2 |  0 |  0
 12007 |  1 |  0 |  7 |  0 |  2
(5 rows)

   n   | r5 | r3 | r1 | r2 | r4 
-------+----+----+----+----+----
     6 |  0 |  0 |  6 |  0 |  0
     8 |  0 |  0 |  8 |  0 |  0
 20009 |  2 |  0 |  9 |  0 |  0
 30002 |  3 |  0 |  2 |  0 |  0
 12007 |  1 |  0 |  7 |  0 |  2
(5 rows)

-- Backward scan
\set query 'SELECT * FROM r5n WHERE (greatest(r2, r3, r4) - least(r2, r3, r4)) IN (0, 2) ORDER BY r2 DESC, r3 DESC, r4 DESC, n LIMIT 5'
:explain2run2
                                                                              QUERY PLAN                                                                               
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: n, r5, r3, r1, r2, r4
   ->  Sort (actual rows=5 loops=1)
         Output: n, r5, r3, r1, r2, r4
         Sort Key: r5n.r2 DESC, r5n.r3 DESC, r5n.r4 DESC, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_expr_r2_r3_r4_idx on public.r5n (actual rows=521 loops=1)
               Output: n, r5, r3, r1, r2, r4
               Index Cond: ((GREATEST((r5n.r2)::numeric, (r5n.r3)::numeric, r5n.r4) - LEAST((r5n.r2)::numeric, (r5n.r3)::numeric, r5n.r4)) = ANY ('{0,2}'::numeric[]))
               Storage Table Read Requests: 5
               Storage Table Read Ops: 19
               Storage Table Rows Scanned: 521
               Storage Index Read Requests: 1
               Storage Index Read Ops: 6
               Storage Index Rows Scanned: 521
(15 rows)

                                                                              QUERY PLAN                                                                               
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: n, r5, r3, r1, r2, r4
   ->  Incremental Sort (actual rows=5 loops=1)
         Output: n, r5, r3, r1, r2, r4
         Sort Key: r5n.r2 DESC, r5n.r3 DESC, r5n.r4 DESC, r5n.n
         Presorted Key: r5n.r2, r5n.r3, r5n.r4
         Full-sort Groups: 1  Sort Method: quicksort
         ->  Index Scan Backward using r5n_expr_r2_r3_r4_idx on public.r5n (actual rows=10 loops=1)
               Output: n, r5, r3, r1, r2, r4
               Index Cond: ((GREATEST((r5n.r2)::numeric, (r5n.r3)::numeric, r5n.r4) - LEAST((r5n.r2)::numeric, (r5n.r3)::numeric, r5n.r4)) = ANY ('{0,2}'::numeric[]))
               Merge Sort Key: r5n.r2 DESC, r5n.r3 DESC, r5n.r4 DESC
               Merge Stream Key: (GREATEST((r5n.r2)::numeric, (r5n.r3)::numeric, r5n.r4) - LEAST((r5n.r2)::numeric, (r5n.r3)::numeric, r5n.r4))
               Merge Streams: 2
               Merge Cond: ((GREATEST((r5n.r2)::numeric, (r5n.r3)::numeric, r5n.r4) - LEAST((r5n.r2)::numeric, (r5n.r3)::numeric, r5n.r4)) = ANY ('{0,2}'::numeric[]))
               Storage Table Read Requests: 2
               Storage Table Read Ops: 7
               Storage Table Rows Scanned: 421
               Storage Index Read Requests: 2
               Storage Index Read Ops: 4
               Storage Index Rows Scanned: 432
(20 rows)

   n   | r5 | r3 | r1 | r2 | r4 
-------+----+----+----+----+----
  9996 |  0 |  9 |  6 |  9 |  9
 29996 |  2 |  9 |  6 |  9 |  9
 39994 |  3 |  9 |  4 |  9 |  9
 27992 |  2 |  9 |  2 |  9 |  7
 37991 |  3 |  9 |  1 |  9 |  7
(5 rows)

   n   | r5 | r3 | r1 | r2 | r4 
-------+----+----+----+----+----
  9996 |  0 |  9 |  6 |  9 |  9
 29996 |  2 |  9 |  6 |  9 |  9
 39994 |  3 |  9 |  4 |  9 |  9
 27992 |  2 |  9 |  2 |  9 |  7
 37991 |  3 |  9 |  1 |  9 |  7
(5 rows)

-- Targets
\set query 'SELECT (greatest(r2, r3, r4) - least(r2, r3, r4)), 1, (greatest(r2, r3, r4) - least(r2, r3, r4)) FROM r5n WHERE (greatest(r2, r3, r4) - least(r2, r3, r4)) IN (0, 2) ORDER BY r2 DESC, r3 DESC, r4 DESC, n LIMIT 5'
:explain2run2
                                                                                                       QUERY PLAN                                                                                                       
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: ((GREATEST((r2)::numeric, (r3)::numeric, r4) - LEAST((r2)::numeric, (r3)::numeric, r4))), 1, ((GREATEST((r2)::numeric, (r3)::numeric, r4) - LEAST((r2)::numeric, (r3)::numeric, r4))), r2, r3, r4, n
   ->  Sort (actual rows=5 loops=1)
         Output: ((GREATEST((r2)::numeric, (r3)::numeric, r4) - LEAST((r2)::numeric, (r3)::numeric, r4))), 1, ((GREATEST((r2)::numeric, (r3)::numeric, r4) - LEAST((r2)::numeric, (r3)::numeric, r4))), r2, r3, r4, n
         Sort Key: r5n.r2 DESC, r5n.r3 DESC, r5n.r4 DESC, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_expr_r2_r3_r4_idx on public.r5n (actual rows=521 loops=1)
               Output: (GREATEST((r2)::numeric, (r3)::numeric, r4) - LEAST((r2)::numeric, (r3)::numeric, r4)), 1, (GREATEST((r2)::numeric, (r3)::numeric, r4) - LEAST((r2)::numeric, (r3)::numeric, r4)), r2, r3, r4, n
               Index Cond: ((GREATEST((r5n.r2)::numeric, (r5n.r3)::numeric, r5n.r4) - LEAST((r5n.r2)::numeric, (r5n.r3)::numeric, r5n.r4)) = ANY ('{0,2}'::numeric[]))
               Storage Table Read Requests: 5
               Storage Table Read Ops: 19
               Storage Table Rows Scanned: 521
               Storage Index Read Requests: 1
               Storage Index Read Ops: 6
               Storage Index Rows Scanned: 521
(15 rows)

                                                                                                       QUERY PLAN                                                                                                       
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: ((GREATEST((r2)::numeric, (r3)::numeric, r4) - LEAST((r2)::numeric, (r3)::numeric, r4))), 1, ((GREATEST((r2)::numeric, (r3)::numeric, r4) - LEAST((r2)::numeric, (r3)::numeric, r4))), r2, r3, r4, n
   ->  Incremental Sort (actual rows=5 loops=1)
         Output: ((GREATEST((r2)::numeric, (r3)::numeric, r4) - LEAST((r2)::numeric, (r3)::numeric, r4))), 1, ((GREATEST((r2)::numeric, (r3)::numeric, r4) - LEAST((r2)::numeric, (r3)::numeric, r4))), r2, r3, r4, n
         Sort Key: r5n.r2 DESC, r5n.r3 DESC, r5n.r4 DESC, r5n.n
         Presorted Key: r5n.r2, r5n.r3, r5n.r4
         Full-sort Groups: 1  Sort Method: quicksort
         ->  Index Scan Backward using r5n_expr_r2_r3_r4_idx on public.r5n (actual rows=10 loops=1)
               Output: (GREATEST((r2)::numeric, (r3)::numeric, r4) - LEAST((r2)::numeric, (r3)::numeric, r4)), 1, (GREATEST((r2)::numeric, (r3)::numeric, r4) - LEAST((r2)::numeric, (r3)::numeric, r4)), r2, r3, r4, n
               Index Cond: ((GREATEST((r5n.r2)::numeric, (r5n.r3)::numeric, r5n.r4) - LEAST((r5n.r2)::numeric, (r5n.r3)::numeric, r5n.r4)) = ANY ('{0,2}'::numeric[]))
               Merge Sort Key: r5n.r2 DESC, r5n.r3 DESC, r5n.r4 DESC
               Merge Stream Key: (GREATEST((r5n.r2)::numeric, (r5n.r3)::numeric, r5n.r4) - LEAST((r5n.r2)::numeric, (r5n.r3)::numeric, r5n.r4))
               Merge Streams: 2
               Merge Cond: ((GREATEST((r5n.r2)::numeric, (r5n.r3)::numeric, r5n.r4) - LEAST((r5n.r2)::numeric, (r5n.r3)::numeric, r5n.r4)) = ANY ('{0,2}'::numeric[]))
               Storage Table Read Requests: 2
               Storage Table Read Ops: 7
               Storage Table Rows Scanned: 421
               Storage Index Read Requests: 2
               Storage Index Read Ops: 4
               Storage Index Rows Scanned: 432
(20 rows)

 ?column? | ?column? | ?column? 
----------+----------+----------
        0 |        1 |        0
        0 |        1 |        0
        0 |        1 |        0
        2 |        1 |        2
        2 |        1 |        2
(5 rows)

 ?column? | ?column? | ?column? 
----------+----------+----------
        0 |        1 |        0
        0 |        1 |        0
        0 |        1 |        0
        2 |        1 |        2
        2 |        1 |        2
(5 rows)

-- Secondary index scan VS SAOP merge PK scan
-- Third hint is to use the PK index as the second hint ends up using the
-- expression index.
\set query 'SELECT (greatest(r2, r3, r4) - least(r2, r3, r4)), r2, r3, r4, n, r1 FROM r5n WHERE r1 IN (1, 2, 3, 4, 5) AND (greatest(r2, r3, r4) - least(r2, r3, r4)) = 4 ORDER BY r2, r3, r4, n LIMIT 5'
\set hint3 '/*+IndexScan(r5n r5n_pkey) Set(yb_max_saop_merge_streams 64)*/'
:explain3run3
                                                                        QUERY PLAN                                                                         
-----------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: ((GREATEST((r2)::numeric, (r3)::numeric, r4) - LEAST((r2)::numeric, (r3)::numeric, r4))), r2, r3, r4, n, r1
   ->  Incremental Sort (actual rows=5 loops=1)
         Output: ((GREATEST((r2)::numeric, (r3)::numeric, r4) - LEAST((r2)::numeric, (r3)::numeric, r4))), r2, r3, r4, n, r1
         Sort Key: r5n.r2, r5n.r3, r5n.r4, r5n.n
         Presorted Key: r5n.r2, r5n.r3, r5n.r4
         Full-sort Groups: 1  Sort Method: quicksort
         ->  Index Scan using r5n_expr_r2_r3_r4_idx on public.r5n (actual rows=7 loops=1)
               Output: (GREATEST((r2)::numeric, (r3)::numeric, r4) - LEAST((r2)::numeric, (r3)::numeric, r4)), r2, r3, r4, n, r1
               Index Cond: ((GREATEST((r5n.r2)::numeric, (r5n.r3)::numeric, r5n.r4) - LEAST((r5n.r2)::numeric, (r5n.r3)::numeric, r5n.r4)) = '4'::numeric)
               Storage Filter: (r5n.r1 = ANY ('{1,2,3,4,5}'::integer[]))
               Storage Table Read Requests: 2
               Storage Table Read Ops: 8
               Storage Table Rows Scanned: 768
               Storage Index Read Requests: 2
               Storage Index Read Ops: 2
               Storage Index Rows Scanned: 768
(17 rows)

                                                                        QUERY PLAN                                                                         
-----------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: ((GREATEST((r2)::numeric, (r3)::numeric, r4) - LEAST((r2)::numeric, (r3)::numeric, r4))), r2, r3, r4, n, r1
   ->  Incremental Sort (actual rows=5 loops=1)
         Output: ((GREATEST((r2)::numeric, (r3)::numeric, r4) - LEAST((r2)::numeric, (r3)::numeric, r4))), r2, r3, r4, n, r1
         Sort Key: r5n.r2, r5n.r3, r5n.r4, r5n.n
         Presorted Key: r5n.r2, r5n.r3, r5n.r4
         Full-sort Groups: 1  Sort Method: quicksort
         ->  Index Scan using r5n_expr_r2_r3_r4_idx on public.r5n (actual rows=7 loops=1)
               Output: (GREATEST((r2)::numeric, (r3)::numeric, r4) - LEAST((r2)::numeric, (r3)::numeric, r4)), r2, r3, r4, n, r1
               Index Cond: ((GREATEST((r5n.r2)::numeric, (r5n.r3)::numeric, r5n.r4) - LEAST((r5n.r2)::numeric, (r5n.r3)::numeric, r5n.r4)) = '4'::numeric)
               Storage Filter: (r5n.r1 = ANY ('{1,2,3,4,5}'::integer[]))
               Storage Table Read Requests: 2
               Storage Table Read Ops: 8
               Storage Table Rows Scanned: 768
               Storage Index Read Requests: 2
               Storage Index Read Ops: 2
               Storage Index Rows Scanned: 768
(17 rows)

                                                                      QUERY PLAN                                                                       
-------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: ((GREATEST((r2)::numeric, (r3)::numeric, r4) - LEAST((r2)::numeric, (r3)::numeric, r4))), r2, r3, r4, n, r1
   ->  Incremental Sort (actual rows=5 loops=1)
         Output: ((GREATEST((r2)::numeric, (r3)::numeric, r4) - LEAST((r2)::numeric, (r3)::numeric, r4))), r2, r3, r4, n, r1
         Sort Key: r5n.r2, r5n.r3, r5n.r4, r5n.n
         Presorted Key: r5n.r2, r5n.r3, r5n.r4
         Full-sort Groups: 1  Sort Method: quicksort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=7 loops=1)
               Output: (GREATEST((r2)::numeric, (r3)::numeric, r4) - LEAST((r2)::numeric, (r3)::numeric, r4)), r2, r3, r4, n, r1
               Index Cond: (r5n.r1 = ANY ('{1,2,3,4,5}'::integer[]))
               Merge Sort Key: r5n.r2, r5n.r3, r5n.r4
               Merge Stream Key: r5n.r1
               Merge Streams: 5
               Merge Cond: (r5n.r1 = ANY ('{1,2,3,4,5}'::integer[]))
               Filter: ((GREATEST((r5n.r2)::numeric, (r5n.r3)::numeric, r5n.r4) - LEAST((r5n.r2)::numeric, (r5n.r3)::numeric, r5n.r4)) = '4'::numeric)
               Rows Removed by Filter: 30
               Storage Table Read Requests: 1
               Storage Table Read Ops: 6
               Storage Table Rows Scanned: 2143
(19 rows)

 ?column? | r2 | r3 | r4 |   n   | r1 
----------+----+----+----+-------+----
        4 |  0 |  0 |  4 | 14003 |  3
        4 |  0 |  0 |  4 | 24002 |  2
        4 |  0 |  0 |  4 | 34002 |  2
        4 |  0 |  0 |  4 | 44004 |  4
        4 |  0 |  0 |  4 | 64004 |  4
(5 rows)

 ?column? | r2 | r3 | r4 |   n   | r1 
----------+----+----+----+-------+----
        4 |  0 |  0 |  4 | 14003 |  3
        4 |  0 |  0 |  4 | 24002 |  2
        4 |  0 |  0 |  4 | 34002 |  2
        4 |  0 |  0 |  4 | 44004 |  4
        4 |  0 |  0 |  4 | 64004 |  4
(5 rows)

 ?column? | r2 | r3 | r4 |   n   | r1 
----------+----+----+----+-------+----
        4 |  0 |  0 |  4 | 14003 |  3
        4 |  0 |  0 |  4 | 24002 |  2
        4 |  0 |  0 |  4 | 34002 |  2
        4 |  0 |  0 |  4 | 44004 |  4
        4 |  0 |  0 |  4 | 64004 |  4
(5 rows)

-- SAOP merge secondary index scan VS SAOP merge PK scan
-- Third hint is to use the PK index as the second hint ends up using the
-- expression index.
\set query 'SELECT r2, r3, r4, n, r1, (greatest(r2, r3, r4) - least(r2, r3, r4)) FROM r5n WHERE r1 IN (1, 2, 3, 4) AND (greatest(r2, r3, r4) - least(r2, r3, r4)) IN (1, 2, 3, 4) ORDER BY r2, r3, r4, n LIMIT 5'
\set hint3 '/*+IndexScan(r5n r5n_pkey) Set(yb_max_saop_merge_streams 64)*/'
:explain3run3
                                                                                QUERY PLAN                                                                                 
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r2, r3, r4, n, r1, ((GREATEST((r2)::numeric, (r3)::numeric, r4) - LEAST((r2)::numeric, (r3)::numeric, r4)))
   ->  Sort (actual rows=5 loops=1)
         Output: r2, r3, r4, n, r1, ((GREATEST((r2)::numeric, (r3)::numeric, r4) - LEAST((r2)::numeric, (r3)::numeric, r4)))
         Sort Key: r5n.r2, r5n.r3, r5n.r4, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_expr_r2_r3_r4_idx on public.r5n (actual rows=858 loops=1)
               Output: r2, r3, r4, n, r1, (GREATEST((r2)::numeric, (r3)::numeric, r4) - LEAST((r2)::numeric, (r3)::numeric, r4))
               Index Cond: ((GREATEST((r5n.r2)::numeric, (r5n.r3)::numeric, r5n.r4) - LEAST((r5n.r2)::numeric, (r5n.r3)::numeric, r5n.r4)) = ANY ('{1,2,3,4}'::numeric[]))
               Storage Filter: (r5n.r1 = ANY ('{1,2,3,4}'::integer[]))
               Storage Table Read Requests: 7
               Storage Table Read Ops: 29
               Storage Table Rows Scanned: 2124
               Storage Index Read Requests: 2
               Storage Index Read Ops: 7
               Storage Index Rows Scanned: 2124
(16 rows)

                                                                                QUERY PLAN                                                                                 
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r2, r3, r4, n, r1, ((GREATEST((r2)::numeric, (r3)::numeric, r4) - LEAST((r2)::numeric, (r3)::numeric, r4)))
   ->  Incremental Sort (actual rows=5 loops=1)
         Output: r2, r3, r4, n, r1, ((GREATEST((r2)::numeric, (r3)::numeric, r4) - LEAST((r2)::numeric, (r3)::numeric, r4)))
         Sort Key: r5n.r2, r5n.r3, r5n.r4, r5n.n
         Presorted Key: r5n.r2, r5n.r3, r5n.r4
         Full-sort Groups: 1  Sort Method: quicksort
         ->  Index Scan using r5n_expr_r2_r3_r4_idx on public.r5n (actual rows=10 loops=1)
               Output: r2, r3, r4, n, r1, (GREATEST((r2)::numeric, (r3)::numeric, r4) - LEAST((r2)::numeric, (r3)::numeric, r4))
               Index Cond: ((GREATEST((r5n.r2)::numeric, (r5n.r3)::numeric, r5n.r4) - LEAST((r5n.r2)::numeric, (r5n.r3)::numeric, r5n.r4)) = ANY ('{1,2,3,4}'::numeric[]))
               Merge Sort Key: r5n.r2, r5n.r3, r5n.r4
               Merge Stream Key: (GREATEST((r5n.r2)::numeric, (r5n.r3)::numeric, r5n.r4) - LEAST((r5n.r2)::numeric, (r5n.r3)::numeric, r5n.r4))
               Merge Streams: 4
               Merge Cond: ((GREATEST((r5n.r2)::numeric, (r5n.r3)::numeric, r5n.r4) - LEAST((r5n.r2)::numeric, (r5n.r3)::numeric, r5n.r4)) = ANY ('{1,2,3,4}'::numeric[]))
               Storage Filter: (r5n.r1 = ANY ('{1,2,3,4}'::integer[]))
               Storage Table Read Requests: 2
               Storage Table Read Ops: 7
               Storage Table Rows Scanned: 236
               Storage Index Read Requests: 2
               Storage Index Read Ops: 8
               Storage Index Rows Scanned: 1709
(21 rows)

                                                                              QUERY PLAN                                                                               
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r2, r3, r4, n, r1, ((GREATEST((r2)::numeric, (r3)::numeric, r4) - LEAST((r2)::numeric, (r3)::numeric, r4)))
   ->  Incremental Sort (actual rows=5 loops=1)
         Output: r2, r3, r4, n, r1, ((GREATEST((r2)::numeric, (r3)::numeric, r4) - LEAST((r2)::numeric, (r3)::numeric, r4)))
         Sort Key: r5n.r2, r5n.r3, r5n.r4, r5n.n
         Presorted Key: r5n.r2, r5n.r3, r5n.r4
         Full-sort Groups: 1  Sort Method: quicksort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=10 loops=1)
               Output: r2, r3, r4, n, r1, (GREATEST((r2)::numeric, (r3)::numeric, r4) - LEAST((r2)::numeric, (r3)::numeric, r4))
               Index Cond: (r5n.r1 = ANY ('{1,2,3,4}'::integer[]))
               Merge Sort Key: r5n.r2, r5n.r3, r5n.r4
               Merge Stream Key: r5n.r1
               Merge Streams: 4
               Merge Cond: (r5n.r1 = ANY ('{1,2,3,4}'::integer[]))
               Filter: ((GREATEST((r5n.r2)::numeric, (r5n.r3)::numeric, r5n.r4) - LEAST((r5n.r2)::numeric, (r5n.r3)::numeric, r5n.r4)) = ANY ('{1,2,3,4}'::numeric[]))
               Rows Removed by Filter: 12
               Storage Table Read Requests: 1
               Storage Table Read Ops: 5
               Storage Table Rows Scanned: 1619
(19 rows)

 r2 | r3 | r4 |   n   | r1 | ?column? 
----+----+----+-------+----+----------
  0 |  0 |  1 | 31004 |  4 |        1
  0 |  0 |  2 | 52001 |  1 |        2
  0 |  0 |  2 | 62001 |  1 |        2
  0 |  0 |  4 | 14003 |  3 |        4
  0 |  0 |  4 | 24002 |  2 |        4
(5 rows)

 r2 | r3 | r4 |   n   | r1 | ?column? 
----+----+----+-------+----+----------
  0 |  0 |  1 | 31004 |  4 |        1
  0 |  0 |  2 | 52001 |  1 |        2
  0 |  0 |  2 | 62001 |  1 |        2
  0 |  0 |  4 | 14003 |  3 |        4
  0 |  0 |  4 | 24002 |  2 |        4
(5 rows)

 r2 | r3 | r4 |   n   | r1 | ?column? 
----+----+----+-------+----+----------
  0 |  0 |  1 | 31004 |  4 |        1
  0 |  0 |  2 | 52001 |  1 |        2
  0 |  0 |  2 | 62001 |  1 |        2
  0 |  0 |  4 | 14003 |  3 |        4
  0 |  0 |  4 | 24002 |  2 |        4
(5 rows)

-- (Drop this index)
DROP INDEX r5n_expr_r2_r3_r4_idx;
--
-- Expression suffix secondary index
--
CREATE INDEX NONCONCURRENTLY ON r5n (r2 ASC, (-r3), (-r4))
SPLIT AT VALUES (
    (1),
    (2),
    (2, -2),
    (2, -2, -2),
    (3));
-- Forward scan
\set query 'SELECT * FROM r5n WHERE r2 IN (0, 2) ORDER BY -r3, -r4, n LIMIT 5'
:explain2run2
                                  QUERY PLAN                                   
-------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: n, r5, r3, r1, r2, r4, ((- r3)), ((- r4))
   ->  Sort (actual rows=5 loops=1)
         Output: n, r5, r3, r1, r2, r4, ((- r3)), ((- r4))
         Sort Key: ((- r5n.r3)), ((- r5n.r4)), r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=998 loops=1)
               Output: n, r5, r3, r1, r2, r4, (- r3), (- r4)
               Index Cond: (r5n.r2 = ANY ('{0,2}'::bigint[]))
               Storage Table Read Requests: 2
               Storage Table Read Ops: 8
               Storage Table Rows Scanned: 998
(12 rows)

                                        QUERY PLAN                                         
-------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: n, r5, r3, r1, r2, r4, ((- r3)), ((- r4))
   ->  Incremental Sort (actual rows=5 loops=1)
         Output: n, r5, r3, r1, r2, r4, ((- r3)), ((- r4))
         Sort Key: ((- r5n.r3)), ((- r5n.r4)), r5n.n
         Presorted Key: ((- r5n.r3)), ((- r5n.r4))
         Full-sort Groups: 1  Sort Method: top-N heapsort
         ->  Index Scan using r5n_r2_expr_expr1_idx on public.r5n (actual rows=12 loops=1)
               Output: n, r5, r3, r1, r2, r4, (- r3), (- r4)
               Index Cond: (r5n.r2 = ANY ('{0,2}'::bigint[]))
               Merge Sort Key: (- r5n.r3), (- r5n.r4)
               Merge Stream Key: r5n.r2
               Merge Streams: 2
               Merge Cond: (r5n.r2 = ANY ('{0,2}'::bigint[]))
               Storage Table Read Requests: 2
               Storage Table Read Ops: 8
               Storage Table Rows Scanned: 693
               Storage Index Read Requests: 2
               Storage Index Read Ops: 4
               Storage Index Rows Scanned: 850
(20 rows)

   n   | r5 | r3 | r1 | r2 | r4 
-------+----+----+----+----+----
  9927 |  0 |  9 |  7 |  2 |  9
 19903 |  1 |  9 |  3 |  0 |  9
 29905 |  2 |  9 |  5 |  0 |  9
 29924 |  2 |  9 |  4 |  2 |  9
 39925 |  3 |  9 |  5 |  2 |  9
(5 rows)

   n   | r5 | r3 | r1 | r2 | r4 
-------+----+----+----+----+----
  9927 |  0 |  9 |  7 |  2 |  9
 19903 |  1 |  9 |  3 |  0 |  9
 29905 |  2 |  9 |  5 |  0 |  9
 29924 |  2 |  9 |  4 |  2 |  9
 39925 |  3 |  9 |  5 |  2 |  9
(5 rows)

-- Backward scan
\set query 'SELECT * FROM r5n WHERE r2 IN (0, 2) ORDER BY -r3 DESC, -r4 DESC, n LIMIT 5'
:explain2run2
                                  QUERY PLAN                                   
-------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: n, r5, r3, r1, r2, r4, ((- r3)), ((- r4))
   ->  Sort (actual rows=5 loops=1)
         Output: n, r5, r3, r1, r2, r4, ((- r3)), ((- r4))
         Sort Key: ((- r5n.r3)) DESC, ((- r5n.r4)) DESC, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=998 loops=1)
               Output: n, r5, r3, r1, r2, r4, (- r3), (- r4)
               Index Cond: (r5n.r2 = ANY ('{0,2}'::bigint[]))
               Storage Table Read Requests: 2
               Storage Table Read Ops: 8
               Storage Table Rows Scanned: 998
(12 rows)

                                             QUERY PLAN                                             
----------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: n, r5, r3, r1, r2, r4, ((- r3)), ((- r4))
   ->  Incremental Sort (actual rows=5 loops=1)
         Output: n, r5, r3, r1, r2, r4, ((- r3)), ((- r4))
         Sort Key: ((- r5n.r3)) DESC, ((- r5n.r4)) DESC, r5n.n
         Presorted Key: ((- r5n.r3)), ((- r5n.r4))
         Full-sort Groups: 1  Sort Method: top-N heapsort
         ->  Index Scan Backward using r5n_r2_expr_expr1_idx on public.r5n (actual rows=13 loops=1)
               Output: n, r5, r3, r1, r2, r4, (- r3), (- r4)
               Index Cond: (r5n.r2 = ANY ('{0,2}'::bigint[]))
               Merge Sort Key: (- r5n.r3) DESC, (- r5n.r4) DESC
               Merge Stream Key: r5n.r2
               Merge Streams: 2
               Merge Cond: (r5n.r2 = ANY ('{0,2}'::bigint[]))
               Storage Table Read Requests: 2
               Storage Table Read Ops: 9
               Storage Table Rows Scanned: 214
               Storage Index Read Requests: 2
               Storage Index Read Ops: 4
               Storage Index Rows Scanned: 592
(20 rows)

   n   | r5 | r3 | r1 | r2 | r4 
-------+----+----+----+----+----
     6 |  0 |  0 |  6 |  0 |  0
     8 |  0 |  0 |  8 |  0 |  0
    23 |  0 |  0 |  3 |  2 |  0
 20009 |  2 |  0 |  9 |  0 |  0
 30002 |  3 |  0 |  2 |  0 |  0
(5 rows)

   n   | r5 | r3 | r1 | r2 | r4 
-------+----+----+----+----+----
     6 |  0 |  0 |  6 |  0 |  0
     8 |  0 |  0 |  8 |  0 |  0
    23 |  0 |  0 |  3 |  2 |  0
 20009 |  2 |  0 |  9 |  0 |  0
 30002 |  3 |  0 |  2 |  0 |  0
(5 rows)

-- Targets
\set query 'SELECT -r4, 1, -r4 FROM r5n WHERE r2 IN (0, 2) ORDER BY -r3 DESC, -r4 DESC, n LIMIT 5'
:explain2run2
                                  QUERY PLAN                                   
-------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: ((- r4)), 1, ((- r4)), ((- r3)), n
   ->  Sort (actual rows=5 loops=1)
         Output: ((- r4)), 1, ((- r4)), ((- r3)), n
         Sort Key: ((- r5n.r3)) DESC, ((- r5n.r4)) DESC, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=998 loops=1)
               Output: (- r4), 1, (- r4), (- r3), n
               Index Cond: (r5n.r2 = ANY ('{0,2}'::bigint[]))
               Storage Table Read Requests: 2
               Storage Table Read Ops: 8
               Storage Table Rows Scanned: 998
(12 rows)

                                             QUERY PLAN                                             
----------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: ((- r4)), 1, ((- r4)), ((- r3)), n
   ->  Incremental Sort (actual rows=5 loops=1)
         Output: ((- r4)), 1, ((- r4)), ((- r3)), n
         Sort Key: ((- r5n.r3)) DESC, ((- r5n.r4)) DESC, r5n.n
         Presorted Key: ((- r5n.r3)), ((- r5n.r4))
         Full-sort Groups: 1  Sort Method: top-N heapsort
         ->  Index Scan Backward using r5n_r2_expr_expr1_idx on public.r5n (actual rows=13 loops=1)
               Output: (- r4), 1, (- r4), (- r3), n
               Index Cond: (r5n.r2 = ANY ('{0,2}'::bigint[]))
               Merge Sort Key: (- r5n.r3) DESC, (- r5n.r4) DESC
               Merge Stream Key: r5n.r2
               Merge Streams: 2
               Merge Cond: (r5n.r2 = ANY ('{0,2}'::bigint[]))
               Storage Table Read Requests: 2
               Storage Table Read Ops: 9
               Storage Table Rows Scanned: 214
               Storage Index Read Requests: 2
               Storage Index Read Ops: 4
               Storage Index Rows Scanned: 592
(20 rows)

 ?column? | ?column? | ?column? 
----------+----------+----------
        0 |        1 |        0
        0 |        1 |        0
        0 |        1 |        0
        0 |        1 |        0
        0 |        1 |        0
(5 rows)

 ?column? | ?column? | ?column? 
----------+----------+----------
        0 |        1 |        0
        0 |        1 |        0
        0 |        1 |        0
        0 |        1 |        0
        0 |        1 |        0
(5 rows)

-- (Drop this index)
DROP INDEX r5n_r2_expr_expr1_idx;
--
-- Duplicate columns secondary index
--
CREATE INDEX NONCONCURRENTLY ON r5n (r2 ASC, (r3 + r4), r2 DESC, (r3 + r4), r2)
SPLIT AT VALUES (
    (1),
    (2),
    (2, 2),
    (2, 2, 2),
    (2, 2, 2, 2),
    (2, 2, 2, 2, 2),
    (3));
-- No order
-- SAOP merge should not be used.
\set query 'SELECT * FROM r5n WHERE r2 IN (0, 1, 2, 3) LIMIT 5'
:explain2
                           QUERY PLAN                           
----------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: n, r5, r3, r1, r2, r4
   ->  Seq Scan on public.r5n (actual rows=5 loops=1)
         Output: n, r5, r3, r1, r2, r4
         Storage Filter: (r5n.r2 = ANY ('{0,1,2,3}'::bigint[]))
         Storage Table Read Requests: 1
         Storage Table Read Ops: 6
         Storage Table Rows Scanned: 21
(8 rows)

                           QUERY PLAN                           
----------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: n, r5, r3, r1, r2, r4
   ->  Seq Scan on public.r5n (actual rows=5 loops=1)
         Output: n, r5, r3, r1, r2, r4
         Storage Filter: (r5n.r2 = ANY ('{0,1,2,3}'::bigint[]))
         Storage Table Read Requests: 1
         Storage Table Read Ops: 6
         Storage Table Rows Scanned: 21
(8 rows)

-- Following queries send various numbers of requests/scan various number of rows
-- due to non-deterministic order of equal rows in merge sort, hide their DIST
\set explain 'EXPLAIN (ANALYZE, VERBOSE, COSTS OFF, SUMMARY OFF, TIMING OFF)'
-- Forward scan
\set query 'SELECT * FROM r5n WHERE r2 IN (0, 1, 2, 3) ORDER BY (r3 + r4), n LIMIT 5'
:explain2run2
                                   QUERY PLAN                                   
--------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: n, r5, r3, r1, r2, r4, (((r3)::numeric + r4))
   ->  Sort (actual rows=5 loops=1)
         Output: n, r5, r3, r1, r2, r4, (((r3)::numeric + r4))
         Sort Key: (((r5n.r3)::numeric + r5n.r4)), r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=2045 loops=1)
               Output: n, r5, r3, r1, r2, r4, ((r3)::numeric + r4)
               Index Cond: (r5n.r2 = ANY ('{0,1,2,3}'::bigint[]))
(9 rows)

                                            QUERY PLAN                                             
---------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: n, r5, r3, r1, r2, r4, (((r3)::numeric + r4))
   ->  Incremental Sort (actual rows=5 loops=1)
         Output: n, r5, r3, r1, r2, r4, (((r3)::numeric + r4))
         Sort Key: (((r5n.r3)::numeric + r5n.r4)), r5n.n
         Presorted Key: (((r5n.r3)::numeric + r5n.r4))
         Full-sort Groups: 1  Sort Method: top-N heapsort
         ->  Index Scan using r5n_r2_expr_r21_expr1_r22_idx on public.r5n (actual rows=25 loops=1)
               Output: n, r5, r3, r1, r2, r4, ((r3)::numeric + r4)
               Index Cond: (r5n.r2 = ANY ('{0,1,2,3}'::bigint[]))
               Merge Sort Key: ((r5n.r3)::numeric + r5n.r4)
               Merge Stream Key: r5n.r2
               Merge Streams: 4
               Merge Cond: (r5n.r2 = ANY ('{0,1,2,3}'::bigint[]))
(14 rows)

   n   | r5 | r3 | r1 | r2 | r4 
-------+----+----+----+----+----
     6 |  0 |  0 |  6 |  0 |  0
     8 |  0 |  0 |  8 |  0 |  0
    23 |  0 |  0 |  3 |  2 |  0
 10037 |  1 |  0 |  7 |  3 |  0
 20009 |  2 |  0 |  9 |  0 |  0
(5 rows)

   n   | r5 | r3 | r1 | r2 | r4 
-------+----+----+----+----+----
     6 |  0 |  0 |  6 |  0 |  0
     8 |  0 |  0 |  8 |  0 |  0
    23 |  0 |  0 |  3 |  2 |  0
 10037 |  1 |  0 |  7 |  3 |  0
 20009 |  2 |  0 |  9 |  0 |  0
(5 rows)

-- Forward scan (v2)
-- SAOP merge is not used.
\set query 'SELECT * FROM r5n WHERE r2 IN (0, 1, 2, 3) ORDER BY (r3 + r4), r2 DESC, n LIMIT 5'
:explain2
                                   QUERY PLAN                                   
--------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: n, r5, r3, r1, r2, r4, (((r3)::numeric + r4))
   ->  Sort (actual rows=5 loops=1)
         Output: n, r5, r3, r1, r2, r4, (((r3)::numeric + r4))
         Sort Key: (((r5n.r3)::numeric + r5n.r4)), r5n.r2 DESC, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=2045 loops=1)
               Output: n, r5, r3, r1, r2, r4, ((r3)::numeric + r4)
               Index Cond: (r5n.r2 = ANY ('{0,1,2,3}'::bigint[]))
(9 rows)

                                   QUERY PLAN                                   
--------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: n, r5, r3, r1, r2, r4, (((r3)::numeric + r4))
   ->  Sort (actual rows=5 loops=1)
         Output: n, r5, r3, r1, r2, r4, (((r3)::numeric + r4))
         Sort Key: (((r5n.r3)::numeric + r5n.r4)), r5n.r2 DESC, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=2045 loops=1)
               Output: n, r5, r3, r1, r2, r4, ((r3)::numeric + r4)
               Index Cond: (r5n.r2 = ANY ('{0,1,2,3}'::bigint[]))
(9 rows)

-- Backward scan
\set query 'SELECT * FROM r5n WHERE r2 IN (0, 1, 2, 3) ORDER BY (r3 + r4) DESC, n LIMIT 5'
:explain2run2
                                   QUERY PLAN                                   
--------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: n, r5, r3, r1, r2, r4, (((r3)::numeric + r4))
   ->  Sort (actual rows=5 loops=1)
         Output: n, r5, r3, r1, r2, r4, (((r3)::numeric + r4))
         Sort Key: (((r5n.r3)::numeric + r5n.r4)) DESC, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=2045 loops=1)
               Output: n, r5, r3, r1, r2, r4, ((r3)::numeric + r4)
               Index Cond: (r5n.r2 = ANY ('{0,1,2,3}'::bigint[]))
(9 rows)

                                                 QUERY PLAN                                                 
------------------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: n, r5, r3, r1, r2, r4, (((r3)::numeric + r4))
   ->  Incremental Sort (actual rows=5 loops=1)
         Output: n, r5, r3, r1, r2, r4, (((r3)::numeric + r4))
         Sort Key: (((r5n.r3)::numeric + r5n.r4)) DESC, r5n.n
         Presorted Key: (((r5n.r3)::numeric + r5n.r4))
         Full-sort Groups: 1  Sort Method: top-N heapsort
         ->  Index Scan Backward using r5n_r2_expr_r21_expr1_r22_idx on public.r5n (actual rows=22 loops=1)
               Output: n, r5, r3, r1, r2, r4, ((r3)::numeric + r4)
               Index Cond: (r5n.r2 = ANY ('{0,1,2,3}'::bigint[]))
               Merge Sort Key: ((r5n.r3)::numeric + r5n.r4) DESC
               Merge Stream Key: r5n.r2
               Merge Streams: 4
               Merge Cond: (r5n.r2 = ANY ('{0,1,2,3}'::bigint[]))
(14 rows)

   n   | r5 | r3 | r1 | r2 | r4 
-------+----+----+----+----+----
  9911 |  0 |  9 |  1 |  1 |  9
  9927 |  0 |  9 |  7 |  2 |  9
 19903 |  1 |  9 |  3 |  0 |  9
 19919 |  1 |  9 |  9 |  1 |  9
 19936 |  1 |  9 |  6 |  3 |  9
(5 rows)

   n   | r5 | r3 | r1 | r2 | r4 
-------+----+----+----+----+----
  9911 |  0 |  9 |  1 |  1 |  9
  9927 |  0 |  9 |  7 |  2 |  9
 19903 |  1 |  9 |  3 |  0 |  9
 19919 |  1 |  9 |  9 |  1 |  9
 19936 |  1 |  9 |  6 |  3 |  9
(5 rows)

-- Backward scan (v2)
-- SAOP merge is not used.
\set query 'SELECT * FROM r5n WHERE r2 IN (0, 1, 2, 3) ORDER BY (r3 + r4) DESC, r2, n LIMIT 5'
:explain2
                                   QUERY PLAN                                   
--------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: n, r5, r3, r1, r2, r4, (((r3)::numeric + r4))
   ->  Sort (actual rows=5 loops=1)
         Output: n, r5, r3, r1, r2, r4, (((r3)::numeric + r4))
         Sort Key: (((r5n.r3)::numeric + r5n.r4)) DESC, r5n.r2, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=2045 loops=1)
               Output: n, r5, r3, r1, r2, r4, ((r3)::numeric + r4)
               Index Cond: (r5n.r2 = ANY ('{0,1,2,3}'::bigint[]))
(9 rows)

                                   QUERY PLAN                                   
--------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: n, r5, r3, r1, r2, r4, (((r3)::numeric + r4))
   ->  Sort (actual rows=5 loops=1)
         Output: n, r5, r3, r1, r2, r4, (((r3)::numeric + r4))
         Sort Key: (((r5n.r3)::numeric + r5n.r4)) DESC, r5n.r2, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=2045 loops=1)
               Output: n, r5, r3, r1, r2, r4, ((r3)::numeric + r4)
               Index Cond: (r5n.r2 = ANY ('{0,1,2,3}'::bigint[]))
(9 rows)

-- Targets
\set query 'SELECT r5, 1, r5 FROM r5n WHERE r2 IN (0, 1, 2, 3) ORDER BY (r3 + r4) DESC, n LIMIT 5'
:explain2run2
                                   QUERY PLAN                                   
--------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r5, 1, r5, (((r3)::numeric + r4)), n
   ->  Sort (actual rows=5 loops=1)
         Output: r5, 1, r5, (((r3)::numeric + r4)), n
         Sort Key: (((r5n.r3)::numeric + r5n.r4)) DESC, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=2045 loops=1)
               Output: r5, 1, r5, ((r3)::numeric + r4), n
               Index Cond: (r5n.r2 = ANY ('{0,1,2,3}'::bigint[]))
(9 rows)

                                                 QUERY PLAN                                                 
------------------------------------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r5, 1, r5, (((r3)::numeric + r4)), n
   ->  Incremental Sort (actual rows=5 loops=1)
         Output: r5, 1, r5, (((r3)::numeric + r4)), n
         Sort Key: (((r5n.r3)::numeric + r5n.r4)) DESC, r5n.n
         Presorted Key: (((r5n.r3)::numeric + r5n.r4))
         Full-sort Groups: 1  Sort Method: top-N heapsort
         ->  Index Scan Backward using r5n_r2_expr_r21_expr1_r22_idx on public.r5n (actual rows=22 loops=1)
               Output: r5, 1, r5, ((r3)::numeric + r4), n
               Index Cond: (r5n.r2 = ANY ('{0,1,2,3}'::bigint[]))
               Merge Sort Key: ((r5n.r3)::numeric + r5n.r4) DESC
               Merge Stream Key: r5n.r2
               Merge Streams: 4
               Merge Cond: (r5n.r2 = ANY ('{0,1,2,3}'::bigint[]))
(14 rows)

 r5 | ?column? | r5 
----+----------+----
  0 |        1 |  0
  0 |        1 |  0
  1 |        1 |  1
  1 |        1 |  1
  1 |        1 |  1
(5 rows)

 r5 | ?column? | r5 
----+----------+----
  0 |        1 |  0
  0 |        1 |  0
  1 |        1 |  1
  1 |        1 |  1
  1 |        1 |  1
(5 rows)

-- Targets (v2)
-- SAOP merge is not used.
\set query 'SELECT r5, 1, r5 FROM r5n WHERE r2 IN (0, 1, 2, 3) ORDER BY (r3 + r4) DESC, r2, n LIMIT 5'
:explain2
                                   QUERY PLAN                                   
--------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r5, 1, r5, (((r3)::numeric + r4)), r2, n
   ->  Sort (actual rows=5 loops=1)
         Output: r5, 1, r5, (((r3)::numeric + r4)), r2, n
         Sort Key: (((r5n.r3)::numeric + r5n.r4)) DESC, r5n.r2, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=2045 loops=1)
               Output: r5, 1, r5, ((r3)::numeric + r4), r2, n
               Index Cond: (r5n.r2 = ANY ('{0,1,2,3}'::bigint[]))
(9 rows)

                                   QUERY PLAN                                   
--------------------------------------------------------------------------------
 Limit (actual rows=5 loops=1)
   Output: r5, 1, r5, (((r3)::numeric + r4)), r2, n
   ->  Sort (actual rows=5 loops=1)
         Output: r5, 1, r5, (((r3)::numeric + r4)), r2, n
         Sort Key: (((r5n.r3)::numeric + r5n.r4)) DESC, r5n.r2, r5n.n
         Sort Method: top-N heapsort
         ->  Index Scan using r5n_pkey on public.r5n (actual rows=2045 loops=1)
               Output: r5, 1, r5, ((r3)::numeric + r4), r2, n
               Index Cond: (r5n.r2 = ANY ('{0,1,2,3}'::bigint[]))
(9 rows)

-- (Reset the explain change)
\set explain 'EXPLAIN (ANALYZE, DIST, VERBOSE, COSTS OFF, SUMMARY OFF, TIMING OFF)'
-- (Drop this index)
DROP INDEX r5n_r2_expr_r21_expr1_r22_idx;
--
-- EXPLAIN FORMAT JSON
--
CREATE FUNCTION get_explain_property(query text, property text) RETURNS jsonb LANGUAGE plpgsql AS $$
DECLARE
    plan jsonb;
BEGIN
    FOR plan IN EXECUTE 'EXPLAIN (ANALYZE, DIST, FORMAT JSON, VERBOSE)' || query LOOP
        RETURN plan->0->'Plan'->property;
    END LOOP;
END $$;
SELECT get_explain_property(hint || 'SELECT * FROM r5n WHERE r1 IN (1, 2, 3) ORDER BY r2', property)
FROM unnest(ARRAY['/*+Set(yb_max_saop_merge_streams 0)*/',
                  '/*+Set(yb_max_saop_merge_streams 64)*/']) AS hint,
     unnest(ARRAY['Merge Sort Key',
                  'Merge Stream Key',
                  'Merge Streams',
                  'Merge Cond']) AS property;
          get_explain_property           
-----------------------------------------
 
 
 
 
 ["r5n.r2"]
 ["r5n.r1"]
 3
 "(r5n.r1 = ANY ('{1,2,3}'::integer[]))"
(8 rows)


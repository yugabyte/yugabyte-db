--
-- Test to check default for pid and query_id
--
SELECT is_yb_pg_tracing_enabled((SELECT pg_backend_pid()));
 is_yb_pg_tracing_enabled 
--------------------------
 f
(1 row)

SELECT yb_pg_enable_tracing(NULL);
 yb_pg_enable_tracing 
----------------------
 t
(1 row)

SELECT is_yb_pg_tracing_enabled(query_id => NULL);
 is_yb_pg_tracing_enabled 
--------------------------
 t
(1 row)

SELECT yb_pg_disable_tracing();
 yb_pg_disable_tracing 
-----------------------
 t
(1 row)

--
-- Test to enable and disable tracing and for current backend for all queries
--
SELECT yb_pg_enable_tracing(pid => NULL, query_id => NULL);
 yb_pg_enable_tracing 
----------------------
 t
(1 row)

SELECT yb_pg_enable_tracing(query_id => NULL, pid => (SELECT pg_backend_pid()));
 yb_pg_enable_tracing 
----------------------
 t
(1 row)

SELECT is_yb_pg_tracing_enabled((SELECT pg_backend_pid()), NULL);
 is_yb_pg_tracing_enabled 
--------------------------
 t
(1 row)

SELECT yb_pg_disable_tracing();
 yb_pg_disable_tracing 
-----------------------
 t
(1 row)

--
-- Test to enable and disabled tracing on all backends
--
SELECT yb_pg_enable_tracing(0, NULL);
 yb_pg_enable_tracing 
----------------------
 t
(1 row)

SELECT is_yb_pg_tracing_enabled(pid => 0, query_id => NULL);
 is_yb_pg_tracing_enabled 
--------------------------
 t
(1 row)

SELECT yb_pg_disable_tracing(query_id => NULL, pid => 0);
 yb_pg_disable_tracing 
-----------------------
 t
(1 row)

--
-- Test to check invalid pid
--
SELECT yb_pg_enable_tracing(-100, query_id => NULL);
WARNING:  Backend with the given pid doesn't exist
 yb_pg_enable_tracing 
----------------------
 f
(1 row)

SELECT yb_pg_disable_tracing(-1000, query_id => NULL);
WARNING:  Backend with the given pid doesn't exist
 yb_pg_disable_tracing 
-----------------------
 f
(1 row)

SELECT is_yb_pg_tracing_enabled(-10000, query_id => NULL);
WARNING:  Backend with the given pid doesn't exist
 is_yb_pg_tracing_enabled 
--------------------------
 f
(1 row)

--
-- Test to enable and disable tracing for a query id for current backend
--
SELECT yb_pg_enable_tracing(query_id => 12345);
 yb_pg_enable_tracing 
----------------------
 t
(1 row)

SELECT yb_pg_enable_tracing(query_id => 12345);
WARNING:  Query with the given id already had tracing enabled or the query tracing limit reached
 yb_pg_enable_tracing 
----------------------
 f
(1 row)

SELECT is_yb_pg_tracing_enabled(query_id => 12345);
 is_yb_pg_tracing_enabled 
--------------------------
 t
(1 row)

SELECT yb_pg_disable_tracing(query_id => 12345);
 yb_pg_disable_tracing 
-----------------------
 t
(1 row)

SELECT is_yb_pg_tracing_enabled(query_id => 12345);
 is_yb_pg_tracing_enabled 
--------------------------
 f
(1 row)

--
-- Test to disable a query id which was not enabled for current backend
-- This will throw a warning
--
SELECT is_yb_pg_tracing_enabled(query_id => 12346789);
 is_yb_pg_tracing_enabled 
--------------------------
 f
(1 row)

SELECT yb_pg_disable_tracing(query_id => 12346789);
WARNING:  Query with the given id didn't have tracing enabled in any of the backend(s)
 yb_pg_disable_tracing 
-----------------------
 f
(1 row)

--
-- Test to enable and disable tracing for a query id for all backends
-- This will throw a warning as the same query_id enabled twice
--
SELECT yb_pg_enable_tracing(0, query_id => 12345);
 yb_pg_enable_tracing 
----------------------
 t
(1 row)

SELECT yb_pg_enable_tracing(0, query_id => 12345);
WARNING:  Query with the given id already had tracing enabled or the query tracing limit reached
 yb_pg_enable_tracing 
----------------------
 f
(1 row)

SELECT is_yb_pg_tracing_enabled(0, query_id => 12345);
 is_yb_pg_tracing_enabled 
--------------------------
 t
(1 row)

SELECT yb_pg_disable_tracing(0, query_id => 12345);
 yb_pg_disable_tracing 
-----------------------
 t
(1 row)

SELECT is_yb_pg_tracing_enabled(0, query_id => 12345);
 is_yb_pg_tracing_enabled 
--------------------------
 f
(1 row)

--
-- Test to enable tracing for one backend and disable for all backends
--
SELECT yb_pg_enable_tracing();
 yb_pg_enable_tracing 
----------------------
 t
(1 row)

SELECT is_yb_pg_tracing_enabled(NULL);
 is_yb_pg_tracing_enabled 
--------------------------
 t
(1 row)

SELECT yb_pg_disable_tracing(0);
 yb_pg_disable_tracing 
-----------------------
 t
(1 row)

SELECT is_yb_pg_tracing_enabled();
 is_yb_pg_tracing_enabled 
--------------------------
 f
(1 row)

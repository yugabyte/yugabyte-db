CREATE TABLE test_truncate (k int generated by default as identity, v int);

-- test TRUNCATE ... CONTINUE IDENTITY
INSERT INTO test_truncate(v) VALUES (101), (102), (103);
SELECT * FROM test_truncate ORDER BY k;

TRUNCATE TABLE test_truncate CONTINUE IDENTITY;
SELECT * FROM test_truncate ORDER BY k;

INSERT INTO test_truncate(v) VALUES (101), (102), (103);
SELECT * FROM test_truncate ORDER BY k;

-- test TRUNCATE ... RESTART IDENTITY
TRUNCATE TABLE test_truncate RESTART IDENTITY;
SELECT * FROM test_truncate ORDER BY k;

INSERT INTO test_truncate(v) VALUES (101), (102), (103);
SELECT * FROM test_truncate ORDER BY k;

DROP TABLE test_truncate;

-- test TRUNCATE on partitioned tables
CREATE TABLE test_truncate (k int, v int, PRIMARY KEY (k ASC)) PARTITION BY RANGE (k);
CREATE TABLE test_truncate_1 PARTITION OF test_truncate FOR VALUES FROM (1) TO (5);
CREATE TABLE test_truncate_2 PARTITION OF test_truncate FOR VALUES FROM (5) TO (11);
INSERT INTO test_truncate(k, v) VALUES (generate_series(1, 10), generate_series(1, 10));
TRUNCATE test_truncate;
SELECT * FROM test_truncate;
INSERT INTO test_truncate(k, v) VALUES (generate_series(1, 10), generate_series(1, 10));
SELECT * FROM test_truncate;
DROP TABLE test_truncate;

-- test TRUNCATE on colocated tables
CREATE DATABASE mydb WITH colocation=true;
\c mydb
CREATE TABLE test_truncate (k int, v int);
INSERT INTO test_truncate(k, v) VALUES (1, 1), (2, 2), (3, 3);
TRUNCATE test_truncate;
SELECT * FROM test_truncate;
DROP TABLE test_truncate;

-- test TRUNCATE CASCADE
CREATE TABLE test_truncate (k int PRIMARY KEY, v int);
CREATE TABLE test_truncate_child (k int, v int, FOREIGN KEY (k) REFERENCES test_truncate(k));
INSERT INTO test_truncate(k, v) VALUES (1, 1), (2, 2), (3, 3);
INSERT INTO test_truncate_child(k, v) VALUES (1, 1), (2, 2), (3, 3);
SELECT * FROM test_truncate_child ORDER BY k;
TRUNCATE test_truncate CASCADE;
SELECT * FROM test_truncate;
SELECT * FROM test_truncate_child;

<script src="/js/site.js"></script>
<script src="/js/trackUtm.js"></script>
<!-- Add target/rel on external links -->
<script type="module">
  import detectExternalLink from 'https://cdn.jsdelivr.net/npm/detect-external-link@2/+esm';
  if (typeof detectExternalLink === 'function') {
    const selectLinks = document.querySelectorAll('.td-content a');
    selectLinks.forEach(element => {
      const linkHref = element.getAttribute('href');
      if (linkHref !== null) {
        const isExternal = detectExternalLink(linkHref, {
          'hosts': [
            'https://docs.yugabyte.com/'
          ]
        });
        if (isExternal) {
          if (!element.target) {
            element.target = '_blank';
            if (!element.rel) {
              element.rel = 'noopener';
            }
          }
        }
      }
    });
  }
</script>

{{- if .Site.Params.search.algolia_docsearch -}}
<script src="/js/search.js" id="algolia-search-script" {{- if .Site.Params.search.algolia_sequence_expressions }}
  data-sequence-expressions="true" {{- end }}></script>
{{- end -}}

{{- if .Site.Params.kapa_ai -}}
{{- $questions := `
How do I create an index?,
Follower Reads vs Read Replicas?,
What are transaction isolation levels?,
What does Voyager do?
` -}}
{{- $questions := replaceRE " +" " " (trim (replaceRE "\n\t\r" " " $questions) " \n\t\r") -}}
<script defer src="https://widget.kapa.ai/kapa-widget.bundle.js" data-button-bg-color="#FFFFFF"
  data-button-border-radius="8px" data-button-border="1px solid #D7DEE4"
  data-button-box-shadow="0px 2px 40px 0px rgba(37, 50, 61, 0.15)" data-button-height="94px"
  data-button-text-color="#4E5F6D" data-button-text-font-size="21px" data-button-text-shadow="none"
  data-button-width="97px"
  data-font-family="Inter,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;"
  data-modal-disclaimer="This is a custom LLM for Yugabyte with access to developer docs (docs.yugabyte.com), and all GitHub issues from the past year (github.com/yugabyte/yugabyte-db/issues). Please note that answers are generated by AI and may not be fully accurate."
  data-modal-example-questions="{{- $questions -}}" data-project-color="#5D5FeF" data-project-logo="/icons/yugabyte.svg"
  data-project-name="Yugabyte" data-search-mode-enabled="true" data-search-result-primary-text-color="#0B1117"
  data-switch-color="#4E5F6D" data-website-id="7669d105-58f8-41b7-b3f1-4799ac938657"
  data-search-include-source-names='["Documentation"]' data-user-analytics-fingerprint-enabled="true"></script>
<script>
  (function () {
    window.addEventListener('load', function () {
      const askAiTopSpan = document.querySelector('.ask-ai-top > span');
      const kapaWidgetButton = document.querySelector('#kapa-widget-container > button');
      if (askAiTopSpan && kapaWidgetButton) {
        askAiTopSpan.addEventListener('click', function () {
          kapaWidgetButton.click();
        });
      }

      if (window.yugabyteGetCookie) {
        let clearbitAnonymousId = window.yugabyteGetCookie('cb_anonymous_id');
        if (clearbitAnonymousId && clearbitAnonymousId !== 'null') {
          clearbitAnonymousId = clearbitAnonymousId.replace(/%22/g, '').replace(/"/g, '');
          const kapaUser = {
            uniqueClientId: clearbitAnonymousId,
          };

          let clearbitUserId = window.yugabyteGetCookie('cb_user_id');
          if (clearbitUserId && clearbitUserId !== 'null') {
            clearbitUserId = clearbitUserId.replace(/%22/g, '').replace(/"/g, '');
            kapaUser.email = clearbitUserId;
          }

          window.kapaSettings = {
            user: kapaUser,
          };
        }
      }
    });
  })();
</script>
{{- end -}}

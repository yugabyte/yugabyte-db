<script src="/js/site.js"></script>
<script src="/js/trackUtm.js"></script>
<!-- Add target/rel on external links -->
<script type="module">
import detectExternalLink from 'https://cdn.jsdelivr.net/npm/detect-external-link@2/+esm';
if (typeof detectExternalLink === 'function') {
  const selectLinks = document.querySelectorAll('.td-content a');
  selectLinks.forEach(element => {
    const linkHref = element.getAttribute('href');
    if (linkHref !== null) {
      const isExternal = detectExternalLink(linkHref, {
        'hosts': [
          'https://docs.yugabyte.com/'
        ]
      });
      if (isExternal) {
        if (!element.target) {
          element.target = '_blank';
          if (!element.rel) {
            element.rel = 'noopener';
          }
        }
      }
    }
  });
}
</script>

{{- if .Site.Params.search.algolia_docsearch -}}
  <script src="/js/search.js" id="algolia-search-script"{{- if .Site.Params.search.algolia_sequence_expressions }} data-sequence-expressions="true"{{- end }}></script>
{{- end -}}

{{- if .Site.Params.kapa_ai -}}
{{- $questions := `
  How do I create an index?,
  Follower Reads vs Read Replicas?,
  What are transaction isolation levels?,
  What does Voyager do?
` -}}
{{- $questions := replaceRE " +" " " (trim (replaceRE "\n\t\r" " " $questions) " \n\t\r") -}}
<script defer src="https://widget.kapa.ai/kapa-widget.bundle.js"
  data-website-id="7669d105-58f8-41b7-b3f1-4799ac938657"
  data-project-name="Yugabyte"
  data-project-color="rgb(120, 121, 241)"
  data-project-logo="/icons/yugabyte.svg"
  data-user-analytics-fingerprint-enabled="true"
  data-font-family="Inter,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;"
  data-font-size-xs="13px"
  data-font-size-xs="13px"
  data-font-size-sm="13px"
  data-font-size-md="15px"
  data-font-size-lg="18px"
  data-font-size-xl="18px"
  data-button-hide="true"
  data-button-text-font-weight="400"
  data-modal-disclaimer="This is a custom LLM for Yugabyte with access to developer docs (docs.yugabyte.com), and all GitHub issues from the past year (github.com/yugabyte/yugabyte-db/issues). Please note that answers are generated by AI and may not be fully accurate."
  data-modal-disclaimer-bg-color="#fff"
  data-modal-disclaimer-text-color="#4e5f6d"
  data-modal-disclaimer-font-size="11.5px"
  data-modal-example-questions="{{- $questions -}}"
  data-modal-z-index="99999"
  data-modal-size="642px"
  data-modal-header-bg-color="#fff"
  data-modal-header-border-bottom="1px solid #e9eef2"
  data-modal-header-padding-right="16px"
  data-modal-header-padding-left="16px"
  data-modal-title-font-family="Inter"
  data-modal-title-font-size="18px"
  data-modal-title-font-weight="600"
  data-modal-title-color="#0b1117"
  data-modal-image-height="24px"
  data-modal-image-width="24px"
  data-modal-overlay-bg-color="rgba(11, 17, 23, 0.2)"
  data-query-input-font-size="14px"
  data-query-input-text-color="#0b1117"
  data-query-input-placeholder-text-color="#6d7c88"
  data-query-input-border-color="#d7dee4"
  data-switch-color="#7879f1"
  data-switch-bg-color="#f0f4f7"
  data-example-question-button-height="36px"
  data-example-question-button-border="1px solid #d7dee4"
  data-example-question-button-border-radius="8px"
  data-example-question-button-bg-color="#fff"
  data-example-question-button-font-size="13px"
  data-search-mode-enabled="true"
  data-search-include-source-names='["Documentation"]'
  data-search-result-primary-text-color="#0b1117"
></script>
<script>
  (function() {
    window.addEventListener('load', function () {
      const askAiTopSpan = document.querySelector('.ask-ai-top > span');
      if (askAiTopSpan) {
        askAiTopSpan.addEventListener('click', function () {
          if (window.Kapa) {
            window.Kapa.open({
              mode: 'ai',
            });
          }
        });
      }

      let clearbitAnonymousId = window.yugabyteGetCookie('cb_anonymous_id');
      if (clearbitAnonymousId && clearbitAnonymousId !== 'null') {
        clearbitAnonymousId = clearbitAnonymousId.replace(/%22/g, '').replace(/"/g, '');
        const kapaUser = {
          uniqueClientId: clearbitAnonymousId,
        };

        let clearbitUserId = window.yugabyteGetCookie('cb_user_id');
        if (clearbitUserId && clearbitUserId !== 'null') {
          clearbitUserId = clearbitUserId.replace(/%22/g, '').replace(/"/g, '');
          kapaUser.email = clearbitUserId;
        }

        window.kapaSettings = {
          user: kapaUser,
        };
      }
    });
  })();
</script>
{{- end -}}

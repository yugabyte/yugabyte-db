---
title: TA-27380
headerTitle: Missing rows on xCluster target on range sharded tables with multiple tablets
headcontent: 05 Jun 2025
type: docs
showRightNav: true
cascade:
  unversioned: true
menu:
  preview_releases:
    identifier: ta-27380
    weight: 1
rightNav:
  hideH2: true
type: docs
---

|          Product           |  Affected Versions  |  Related Issues   | Fixed In |
| :------------------------- | :------------------ | :---------------- | :------- |
| {{<product "ysql">}}       | {{<release "2.20.x, 2024.1, 2024.2">}} | {{<issue 27380>}} | {{<release "2024.2.3.1, 2024.2.4.0, 2.20.12.0, 2024.1.7.0">}}  |

## Description

When the following conditions are true, the xCluster target could be missing some of the rows from the xCluster source permanently with no way to recover except to rebootstrap xCluster.

1. The table or index involved in xCluster replication is [range sharded](../../../architecture/docdb-sharding/sharding/#range-sharding). ([Hash sharded](/architecture/docdb-sharding/sharding/#hash-sharding) tables or indexes are not affected by this issue).

The table or index has multiple tablets on the target side.
Writes to the table/index are transactional. For YSQL this is almost always true.

The changes do get replicated from xCluster source to target, but the final apply step of transactions gets skipped on the xCluster target for all tablet key ranges except one - resulting in effectively only 1 tablet getting all the writes. As a result of this, all of the xCluster troubleshooting views and metrics on YBA show the replication lag as 0 and replication status as Healthy. However, a data comparison between source and target will indicate a difference in row count/data.

A few additional considerations to assess impact:

Range-sharding is currently not enabled by default, so if a table/index is created without any qualifiers on the primary key, it is hash-sharded by default.

YCQL tables cannot be created with range-sharding (Reference)

To explicitly create a range-sharded table/index, the customer would have to specify ASC or DESC as part of the Primary key specification as shown in the example below.

CREATE TABLE range(k1 int,
                              k2 int,
                              v1 int,
                              v2 text,
                              PRIMARY KEY (k1 ASC, k2 DESC));

Range-Sharding is also enabled by default for new tables with the pg_parity flags.
Default Tablet count with Range-sharding is 1, so if automatic tablet-splitting is NOT enabled, then the customer will not experience this issue. Note that tablet-splitting is enabled by default.

To identify whether a customer is impacted:

The problem occurs almost always when a range partitioned table has multiple tablets. The only scenario where it may not happen is if all writes are going to a single tablet which is unlikely. Another unlikely case is where the workload is not using transactions at all.
For tables, row counts can be compared on both source and target tables. Since the rows on the target are lost permanently, the inconsistency is permanent
For hash-sharded tables with range-sharded indexes, the row count may match as it scans the table, but an index only scan would show a difference between the source and target tables.
While depending on the key type, it might be possible to identify exactly which key range/tablet is correctly replicated and the remaining ones would be missing data - this may not really help the customer because all tablets except 1 tablet would be missing data.

The issue is caused by an implementation bug in determining whether a given key belongs to the tablet's key ranges during the apply of transactions on the xCluster target


## Mitigation


## Details

